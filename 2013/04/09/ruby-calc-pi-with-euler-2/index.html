<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ja" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Ruby - 円周率計算（オイラーの公式(2)）！ - mk-mode BLOG</title>
<meta name="description" content="前回は、C++ による「オイラーの公式(2)による円周率計算」のアルゴリズムを紹介しました。  C++ - 円周率計算（オイラーの公式(2)）！今日は、同じアルゴリズムを Ruby で実現してみました。アルゴリズム等については、上記リンクの記事を参照してください。Arctan 系公式による計算は項数・係数が異るだけなので、今回は汎用化した形にしました。">



<meta property="og:type" content="article">
<meta property="og:locale" content="ja_JP">
<meta property="og:site_name" content="mk-mode BLOG">
<meta property="og:title" content="Ruby - 円周率計算（オイラーの公式(2)）！">
<meta property="og:url" content="https://komasaru.github.io/2013/04/09/ruby-calc-pi-with-euler-2/">


  <meta property="og:description" content="前回は、C++ による「オイラーの公式(2)による円周率計算」のアルゴリズムを紹介しました。  C++ - 円周率計算（オイラーの公式(2)）！今日は、同じアルゴリズムを Ruby で実現してみました。アルゴリズム等については、上記リンクの記事を参照してください。Arctan 系公式による計算は項数・係数が異るだけなので、今回は汎用化した形にしました。">



  <meta property="og:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">



  <meta name="twitter:site" content="@rsm_mzk">
  <meta name="twitter:title" content="Ruby - 円周率計算（オイラーの公式(2)）！">
  <meta name="twitter:description" content="前回は、C++ による「オイラーの公式(2)による円周率計算」のアルゴリズムを紹介しました。  C++ - 円周率計算（オイラーの公式(2)）！今日は、同じアルゴリズムを Ruby で実現してみました。アルゴリズム等については、上記リンクの記事を参照してください。Arctan 系公式による計算は項数・係数が異るだけなので、今回は汎用化した形にしました。">
  <meta name="twitter:url" content="https://komasaru.github.io/2013/04/09/ruby-calc-pi-with-euler-2/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">
    
  

  



  <meta property="article:published_time" content="2013-04-09T00:20:00+09:00">





  

  


<link rel="canonical" href="https://komasaru.github.io/2013/04/09/ruby-calc-pi-with-euler-2/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://komasaru.github.io",
      "logo": "https://www.mk-mode.com/blog/assets/images/about_me.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "mk-mode.com",
      "url": "https://komasaru.github.io",
      "sameAs": null
    }
  </script>



  <meta name="google-site-verification" content="0kSwKhNo71fC7OeEFLllD3S11F8Pa-z_OqsBTSFxXAk" />





<!-- end _includes/seo.html -->


<link href="https://www.mk-mode.com/blog/atom.xml" type="application/atom+xml" rel="alternate" title="mk-mode BLOG Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    
    <script defer src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <!-- start custom head snippets -->

<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com" />
<link rel="dns-prefetch" href="//googleads.g.doubleclick.net" />
<link rel="dns-prefetch" href="//tpc.googlesyndication.com" />
<link rel="dns-prefetch" href="//cm.g.doubleclick.net" />
<link rel="dns-prefetch" href="//www.gstatic.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />
<link rel='dns-prefetch' href='//use.fontawesome.com' />
<link rel="dns-prefetch" href="//twitter.com" />
<link rel="dns-prefetch" href="//www.facebook.com" />

<link rel="icon" href="/assets/images/favicon.ico">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-7320193476057758",
      enable_page_level_ads: true
    });
  </script>


<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">mk-mode BLOG</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/" >Archives</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/calendar/calendar" >Calendar</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/jmaxml" >JMAXML</a>
            </li><li class="masthead__menu-item">
              <a href="/privacy.html" >Privacy Policy</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/about_me.png" alt="mk-mode.com" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">mk-mode.com</h3>
    
    
      <p class="author__bio" itemprop="description">
        Linux, Debian, IT, Server, PG, Ruby, Rails, Python, C++, Fortran, PC, MariaDB, math, GIS, etc...
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Ruby City MATSUE</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://www.mk-mode.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode SITE</a></li>
          
        
          
            <li><a href="https://www.mk-mode.com/blog" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode BLOG (original)</a></li>
          
        
          
            <li><a href="https://mk-mode.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode TUMBLR</a></li>
          
        
          
            <li><a href="https://mk-ephemeris.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode EPHEMERIS</a></li>
          
        
          
            <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
        
          
            <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Ruby - 円周率計算（オイラーの公式(2)）！">
    <meta itemprop="description" content="前回は、C++ による「オイラーの公式(2)による円周率計算」のアルゴリズムを紹介しました。  C++ - 円周率計算（オイラーの公式(2)）！今日は、同じアルゴリズムを Ruby で実現してみました。アルゴリズム等については、上記リンクの記事を参照してください。Arctan 系公式による計算は項数・係数が異るだけなので、今回は汎用化した形にしました。">
    <meta itemprop="datePublished" content="April 09, 2013">
    

    <div class="page__inner-wrap">
      
        <header>
          <!-- div id="google-ad-1"></div -->
          <h1 id="page-title" class="page__title" itemprop="headline">Ruby - 円周率計算（オイラーの公式(2)）！
</h1>
          
          
            
            <p class="page__date"><small><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2013-04-09T00:20:00+09:00">2013-04-09 00:20</time></small></p>
          
        </header>
      
      <div id="google-ad-2"></div>
      <br />

      <section class="page__content" itemprop="text">
        
        <p>前回は、C++ による「オイラーの公式(2)による円周率計算」のアルゴリズムを紹介しました。</p>

<ul>
  <li><a href="/2013/04/08/cpp-calc-pi-with-euler-2/" title="C++ - 円周率計算（オイラーの公式(2)）！">C++ - 円周率計算（オイラーの公式(2)）！</a></li>
</ul>

<p>今日は、同じアルゴリズムを Ruby で実現してみました。<br />
アルゴリズム等については、上記リンクの記事を参照してください。<br />
Arctan 系公式による計算は項数・係数が異るだけなので、今回は汎用化した形にしました。</p>

<!--more-->

<p>以下、Ruby によるサンプルスクリプトです。</p>

<h3 id="0-前提条件">0. 前提条件</h3>

<ul>
  <li>Linux Mint 14 Nadia (64bit) での作業を想定。</li>
  <li>Ruby 2.0.0-p0 を使用。</li>
</ul>

<h3 id="1-ruby-スクリプト作成">1. Ruby スクリプト作成</h3>

<p>File: <code class="language-plaintext highlighter-rouge">calc_pi_arctan_old.rb</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
</pre></td><td class="code"><pre><span class="c1">#! /usr/local/bin/ruby</span>
<span class="c1">#*********************************************</span>
<span class="c1"># 円周率計算 by Arctan 系の公式</span>
<span class="c1">#</span>
<span class="c1">#    1: Machin</span>
<span class="c1">#    2: Klingenstierna</span>
<span class="c1">#    3: Euler</span>
<span class="c1">#    4: Euler(2)</span>
<span class="c1">#*********************************************</span>
<span class="c1">#</span>
<span class="k">class</span> <span class="nc">CalcPiArctan</span>
  <span class="c1"># 公式</span>
  <span class="no">FORMULA</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Machin"</span><span class="p">,</span> <span class="s2">"Klingenstierna"</span><span class="p">,</span> <span class="s2">"Euler"</span><span class="p">,</span> <span class="s2">"Euler2"</span><span class="p">]</span>  <span class="c1"># 公式名</span>
  <span class="no">KK</span> <span class="o">=</span> <span class="p">[</span>                                    <span class="c1"># 公式内係数</span>
    <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">239</span>             <span class="p">],</span>  <span class="c1">#   1: Machin</span>
    <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">515</span><span class="p">],</span>  <span class="c1">#   2: Klingenstierna</span>
    <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>   <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">79</span>             <span class="p">],</span>  <span class="c1">#   3: Euler</span>
    <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">70</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">99</span><span class="p">]</span>   <span class="c1">#   4: Euler(2)</span>
  <span class="p">]</span>
  <span class="c1"># 保存ファイル名</span>
  <span class="no">FILE_PRE</span> <span class="o">=</span> <span class="s2">"PI_"</span>   <span class="c1"># プリフィックス</span>
  <span class="no">FILE_EXT</span> <span class="o">=</span> <span class="s2">".txt"</span>  <span class="c1"># 拡張子</span>
  <span class="c1"># 出力文字列 ( コンソール、テキストファイル共通 )</span>
  <span class="no">STR_TITLE</span>   <span class="o">=</span> <span class="s2">"** Pi Computation by Arctan method **"</span>
  <span class="no">STR_FORMULA</span> <span class="o">=</span> <span class="s2">"   Formula = [ %s ]"</span>
  <span class="no">STR_DIGITS</span>  <span class="o">=</span> <span class="s2">"   Digits  = %d"</span>
  <span class="no">STR_TIME</span>    <span class="o">=</span> <span class="s2">"   Time    = %f seconds"</span>
  <span class="c1"># 多桁計算</span>
  <span class="no">MAX_DIGITS</span> <span class="o">=</span> <span class="mi">100000000</span>  <span class="c1"># 1つの int で8桁扱う</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="c1"># 結果出力ファイル名生成</span>
    <span class="vi">@fname</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">FILE_PRE</span><span class="si">}#{</span><span class="no">FORMULA</span><span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="si">}#{</span><span class="no">FILE_EXT</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">puts</span>
    <span class="nb">puts</span> <span class="s2">"[ Output file : </span><span class="si">#{</span><span class="vi">@fname</span><span class="si">}</span><span class="s2"> ]"</span>
    <span class="nb">puts</span>
    <span class="vi">@formula</span> <span class="o">=</span> <span class="no">FORMULA</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>             <span class="c1"># 公式名取得</span>
    <span class="vi">@ks</span> <span class="o">=</span> <span class="no">KK</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nf">size</span> <span class="o">/</span> <span class="mi">3</span>              <span class="c1"># 計算対象公式の項数</span>
    <span class="vi">@kk</span> <span class="o">=</span> <span class="no">KK</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>                       <span class="c1"># 計算対象公式の係数</span>
    <span class="vi">@l</span>  <span class="o">=</span> <span class="n">y</span>                             <span class="c1"># 計算桁数</span>
    <span class="vi">@l1</span> <span class="o">=</span> <span class="p">(</span><span class="vi">@l</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>                  <span class="c1"># 配列サイズ</span>
    <span class="n">n</span>   <span class="o">=</span> <span class="vi">@l</span> <span class="o">/</span> <span class="no">Math</span><span class="o">::</span><span class="n">log10</span><span class="p">(</span><span class="vi">@kk</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="vi">@n</span>  <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">).</span><span class="nf">truncate</span> <span class="o">+</span> <span class="mi">1</span>          <span class="c1"># 計算項数</span>
  <span class="k">end</span>

  <span class="c1"># 計算・結果出力</span>
  <span class="k">def</span> <span class="nf">calc</span>
    <span class="c1"># ==== 計算開始時刻</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
    <span class="c1"># ==== 配列宣言・初期化</span>
    <span class="n">s</span>  <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 総和</span>
    <span class="n">a</span>  <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@ks</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>    <span class="c1"># 公式の各項</span>
    <span class="n">a</span><span class="p">.</span><span class="nf">each_index</span> <span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>
    <span class="n">q</span>  <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 各項の和</span>
    <span class="c1"># ==== 計算初期値</span>
    <span class="mi">0</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="vi">@ks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
      <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
      <span class="c1"># 分子が 1 で無ければ、さらに分子の値で除算しておく</span>
      <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">long_div</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">unless</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">end</span>
    <span class="c1"># ==== 計算</span>
    <span class="mi">1</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="vi">@n</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="o">|</span>
      <span class="c1"># 各項の分数計算 ( １つ前の計算結果に追加で除算・乗算 )</span>
      <span class="mi">0</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="vi">@ks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
        <span class="c1"># 本来 x * x で除算したい（した方が高速だ）が、</span>
        <span class="c1"># x が 8桁以下でも x * x が8桁超になるケースがあるため２回に分けている。</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">long_div</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">long_div</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
        <span class="c1"># 分子が 1 でない時</span>
        <span class="c1">#   本来 x * x を乗算したい（した方が高速だ）が、</span>
        <span class="c1">#   x が 8桁以下でも x * x が8桁超になるケースがあるため２回に分けている。</span>
        <span class="k">unless</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
          <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">long_mul</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
          <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">long_mul</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">end</span>
      <span class="k">end</span>
      <span class="c1"># 各項の加減算</span>
      <span class="mi">1</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="vi">@ks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
        <span class="k">if</span> <span class="vi">@kk</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>  <span class="c1"># 加算</span>
          <span class="n">q</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">?</span> <span class="n">long_add</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">:</span> <span class="n">long_add</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span>                <span class="c1"># 減算</span>
          <span class="n">q</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">?</span> <span class="n">long_sub</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">:</span> <span class="n">long_sub</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">end</span>
      <span class="k">end</span>
      <span class="c1"># 1 / (2 * k - 1) の部分</span>
      <span class="n">q</span> <span class="o">=</span> <span class="n">long_div</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
      <span class="c1"># 総和計算</span>
      <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="n">long_sub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="p">:</span> <span class="n">long_add</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="c1"># ==== 計算終了時刻</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
    <span class="c1"># ==== 計算時間</span>
    <span class="n">tt</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span>
    <span class="c1"># ==== 結果出力</span>
    <span class="nb">display</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="c1"># ロング + ロング</span>
  <span class="k">def</span> <span class="nf">long_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">cr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">downto</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">cr</span>
      <span class="k">if</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="no">MAX_DIGITS</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">else</span>
        <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="no">MAX_DIGITS</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">z</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="c1"># ロング - ロング</span>
  <span class="k">def</span> <span class="nf">long_sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">downto</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span>
      <span class="k">if</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">br</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">else</span>
        <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="no">MAX_DIGITS</span>
        <span class="n">br</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">z</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="c1"># ロング * ショート</span>
  <span class="k">def</span> <span class="nf">long_mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">cr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">downto</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">w</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">cr</span><span class="p">)</span> <span class="o">%</span> <span class="no">MAX_DIGITS</span>
      <span class="n">cr</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">cr</span><span class="p">)</span> <span class="o">/</span> <span class="no">MAX_DIGITS</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">z</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="c1"># ロング / ショート</span>
  <span class="k">def</span> <span class="nf">long_div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="mi">0</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="vi">@l1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">w</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span>
      <span class="n">r</span> <span class="o">=</span> <span class="p">((</span><span class="n">w</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="no">MAX_DIGITS</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">z</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="c1"># 結果出力</span>
  <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="no">STR_TITLE</span>
    <span class="nb">puts</span> <span class="no">STR_FORMULA</span> <span class="o">%</span> <span class="vi">@formula</span>
    <span class="nb">puts</span> <span class="no">STR_DIGITS</span> <span class="o">%</span> <span class="vi">@l</span>
    <span class="nb">puts</span> <span class="no">STR_TIME</span> <span class="o">%</span> <span class="n">tt</span>
    <span class="c1"># ファイル出力</span>
    <span class="n">out_file</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="vi">@fname</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span>
    <span class="n">out_file</span><span class="p">.</span><span class="nf">puts</span> <span class="no">STR_TITLE</span>
    <span class="n">out_file</span><span class="p">.</span><span class="nf">puts</span> <span class="no">STR_FORMULA</span> <span class="o">%</span> <span class="vi">@formula</span>
    <span class="n">out_file</span><span class="p">.</span><span class="nf">puts</span> <span class="no">STR_DIGITS</span> <span class="o">%</span> <span class="vi">@l</span>
    <span class="n">out_file</span><span class="p">.</span><span class="nf">puts</span> <span class="no">STR_TIME</span> <span class="o">%</span> <span class="n">tt</span>
    <span class="n">out_file</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">          %d."</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="mi">1</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="vi">@l1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">out_file</span><span class="p">.</span><span class="nf">printf</span><span class="p">(</span><span class="s2">"%08d:"</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">1</span>
      <span class="n">out_file</span><span class="p">.</span><span class="nf">printf</span><span class="p">(</span><span class="s2">" %08d"</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="n">out_file</span><span class="p">.</span><span class="nf">puts</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">if</span> <span class="kp">__FILE__</span> <span class="o">==</span> <span class="vg">$0</span>
  <span class="k">begin</span>
    <span class="c1"># ==== 使用公式番号入力</span>
    <span class="nb">print</span> <span class="s2">"1:Machin, 2:Klingenstierna, 3:Euler, 4:Euler(2) : "</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">gets</span><span class="p">.</span><span class="nf">to_i</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="mi">8</span>  <span class="c1"># 範囲外なら 1:Machin と判断</span>
    <span class="c1"># ==== 計算桁数入力</span>
    <span class="nb">print</span> <span class="s2">"Please input number of Pi Decimal-Digits : "</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">gets</span><span class="p">.</span><span class="nf">to_i</span>
    <span class="c1"># 計算クラスインスタンス化</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="no">CalcPiArctan</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="c1"># 円周率計算</span>
    <span class="n">obj</span><span class="p">.</span><span class="nf">calc</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="vg">$stderr</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"[</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
    <span class="n">e</span><span class="p">.</span><span class="nf">backtrace</span><span class="p">.</span><span class="nf">each</span><span class="p">{</span> <span class="o">|</span><span class="n">tr</span><span class="o">|</span> <span class="vg">$stderr</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"</span><span class="se">\t</span><span class="si">#{</span><span class="n">tr</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li><a href="https://gist.github.com/komasaru/5269032" title="Gist - Ruby script to compute Pi with arctan's formula.(old ver.)">Gist - Ruby script to compute Pi with arctan’s formula.(old ver.)</a></li>
</ul>

<h3 id="2-実行">2. 実行</h3>

<p>まず、実行権限を付与。</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ chmod +x calc_pi_arctan_old.rb
</code></pre></div></div>

<p>そして、実行。</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./calc_pi_arctan.rb
1:Machin, 2:Klingenstierna, 3:Euler, 4:Euler(2) : 4
Please input number of Pi Decimal-Digits : 10000

[ Output file : PI_Euler2.txt ]

** Pi Computation by Arctan method **
   Formula = [ Euler2 ]
   Digits  = 10000
   Time    = 11.852143 seconds
</code></pre></div></div>

<p>“PI_Euler2.txt” というテキストファイルができているはずである。</p>

<p>File: <code class="language-plaintext highlighter-rouge">PI_Euler2.txt</code></p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre>** Pi Computation by Arctan method **
   Formula = [ Euler2 ]
   Digits  = 10000
   Time    = 11.852143 seconds

          3.
00000001: 14159265 35897932 38462643 38327950 28841971 69399375 10582097 49445923 07816406 28620899
00000081: 86280348 25342117 06798214 80865132 82306647 09384460 95505822 31725359 40812848 11174502
00000161: 84102701 93852110 55596446 22948954 93038196 44288109 75665933 44612847 56482337 86783165
00000241: 27120190 91456485 66923460 34861045 43266482 13393607 26024914 12737245 87006606 31558817
00000321: 48815209 20962829 25409171 53643678 92590360 01133053 05488204 66521384 14695194 15116094
00000401: 33057270 36575959 19530921 86117381 93261179 31051185 48074462 37996274 95673518 85752724
00000481: 89122793 81830119 49129833 67336244 06566430 86021394 94639522 47371907 02179860 94370277
00000561: 05392171 76293176 75238467 48184676 69405132 00056812 71452635 60827785 77134275 77896091
00000641: 73637178 72146844 09012249 53430146 54958537 10507922 79689258 92354201 99561121 29021960
00000721: 86403441 81598136 29774771 30996051 87072113 49999998 37297804 99510597 31732816 09631859
00000801: 50244594 55346908 30264252 23082533 44685035 26193118 81710100 03137838 75288658 75332083
00000881: 81420617 17766914 73035982 53490428 75546873 11595628 63882353 78759375 19577818 57780532
00000961: 17122680 66130019 27876611 19590921 64201989 38095257 20106548 58632788 65936153 38182796
        :
===&lt; 途中省略 &gt;===
        :
00009121: 37800297 41207665 14793942 59029896 95946995 56576121 86561967 33786236 25612521 63208628
00009201: 69222103 27488921 86543648 02296780 70576561 51446320 46927906 82120738 83778142 33562823
00009281: 60896320 80682224 68012248 26117718 58963814 09183903 67367222 08883215 13755600 37279839
00009361: 40041529 70028783 07667094 44745601 34556417 25437090 69793961 22571429 89467154 35784687
00009441: 88614445 81231459 35719849 22528471 60504922 12424701 41214780 57345510 50080190 86996033
00009521: 02763478 70810817 54501193 07141223 39086639 38339529 42578690 50764310 06383519 83438934
00009601: 15961318 54347546 49556978 10382930 97164651 43840700 70736041 12373599 84345225 16105070
00009681: 27056235 26601276 48483084 07611830 13052793 20542746 28654036 03674532 86510570 65874882
00009761: 25698157 93678976 69742205 75059683 44086973 50201410 20672358 50200724 52256326 51341055
00009841: 92401902 74216248 43914035 99895353 94590944 07046912 09140938 70012645 60016237 42880210
00009921: 92764579 31065792 29552498 87275846 10126483 69998922 56959688 15920560 01016552 56375678
</pre></td></tr></tbody></table></code></pre></figure>

<p>C++ 版と同じ結果が得られました。</p>

<h3 id="3-参考サイト">3. 参考サイト</h3>

<ul>
  <li><a href="http://xn--w6q13e505b.jp/formula/" title="円周率を求める公式・アルゴリズム - 円周率.jp -">円周率を求める公式・アルゴリズム - 円周率.jp -</a></li>
  <li><a href="http://www5f.biglobe.ne.jp/~tsuushin/sub1d.html" title="πのArctan公式集">πのArctan公式集</a></li>
</ul>

<hr />

<p>C++ 版同様、「オイラーの公式」より「オイラーの公式(2)」の方が若干時間がかかりました。</p>

<p>Arctan 系の公式による計算を汎用することができたので、他の Arctan 系公式による計算も容易にできるようになりました。<br />
もちろん、もっと桁数を増やしたり高速化するには、まだまだ改良が必要ですが。。。</p>

<p>以上。</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/ruby" class="page__taxonomy-item" rel="tag">Ruby</a><span class="sep">, </span>
    
      
      
      <a href="/tags/%E5%86%86%E5%91%A8%E7%8E%87" class="page__taxonomy-item" rel="tag">円周率</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0" class="page__taxonomy-item" rel="tag">プログラミング</a><span class="sep">, </span>
    
      
      
      <a href="/categories/%E6%95%B0%E5%AD%A6" class="page__taxonomy-item" rel="tag">数学</a>
    
    </span>
  </p>


        
          
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2013-04-09T00:20:00+09:00">2013-04-09 00:20</time></p>
        
        <br />
      </footer>
      <div id="google-ad-3"></div>
      <br />
      <br />
      <br />
      <br />

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=rsm_mzk&text=Ruby+-+%E5%86%86%E5%91%A8%E7%8E%87%E8%A8%88%E7%AE%97%EF%BC%88%E3%82%AA%E3%82%A4%E3%83%A9%E3%83%BC%E3%81%AE%E5%85%AC%E5%BC%8F%282%29%EF%BC%89%EF%BC%81%20https%3A%2F%2Fkomasaru.github.io%2F2013%2F04%2F09%2Fruby-calc-pi-with-euler-2%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkomasaru.github.io%2F2013%2F04%2F09%2Fruby-calc-pi-with-euler-2%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  

  <a href="https://www.tumblr.com/share" class="btn btn--tumblr" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Tumblr"><i class="fab fa-fw fa-tumblr" aria-hidden="true"></i><span> Tumblr</span></a><script id="tumblr-js" async src="https://assets.tumblr.com/share-button.js"></script>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fkomasaru.github.io%2F2013%2F04%2F09%2Fruby-calc-pi-with-euler-2%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      <section>
        &nbsp;
        <h4>Sponsored Link</h4>
        <div id="rakuten-ad"></div>
        <div id="amazon-ad-1"></div>
      </section>
      &nbsp;
      
  <nav class="pagination">
    
      <a href="/2013/04/08/cpp-calc-pi-with-euler-2/" class="pagination--pager" title="C++ - 円周率計算（オイラーの公式(2)）！
">Previous</a>
    
    
      <a href="/2013/04/11/cpp-calc-pi-with-arctan/" class="pagination--pager" title="C++ - 円周率計算（Arctan 系公式）！
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <div id="google-ad-4"></div>
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2023/11/29/debian-12-groonga-installation-by-official-apt/" rel="permalink">Debian 12 (bookworm) - 全文検索エンジン Groonga インストール（by Groonga 公式リポジトリ）！
</a>
        &nbsp;<small>(2023-11-29)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 12 (bookworm) にカラムストア機能付き全文検索エンジン Groonga を Groonga の公式リポジトリを使用して導入する方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となってい...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2023/11/22/debian-12-postfix-log-analysis/" rel="permalink">Debian 12 (bookworm) - Postfix ログ解析！
</a>
        &nbsp;<small>(2023-11-22)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 12 (bookworm) に導入した SMTP サーバ Postfix のログを解析する方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてく...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2023/11/15/debian-12-postfix-anti-virus-with-clamav/" rel="permalink">Debian 12 (bookworm) - Postfix ウィルス・スパム対策(ClamAV)！
</a>
        &nbsp;<small>(2023-11-15)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 12 (bookworm) にアンチウイルスソフト ClamAV をインストールする方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてください...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2023/11/08/debian-12-mail-ssl-setting/" rel="permalink">Debian 12 (bookworm) - メールサーバ SSL 設定！
</a>
        &nbsp;<small>(2023-11-08)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 12 (bookworm) に導入したメールサーバを SSL 設定する方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてください）

</p>
  </article>
</div>

        
      </div>
      <!-- &nbsp;
      <div id="amazon-wd"></div -->
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <input type="text" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    </form>
    <div id="results" class="results">
        <gcse:searchresults-only></gcse:searchresults-only>    
    </div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<div id="qr"><img src="/assets/images/qr.png" alt="mk-mode BLOG"></div>
<div id="google-ad-5"></div>
<div class="page__footer-etc">
  <strong>ブログ開設日</strong> <tt>2009-01-05</tt><br />
  <strong>サーバ連続稼働時間</strong> <tt id="uptime">Loading...</tt><br />
  <strong>Page View</strong><br />
  &emsp;合計 <tt id="pv-total">Loading...</tt><br />
  &emsp;今日 <tt id="pv-today">Loading...</tt><br />
  &emsp;昨日 <tt id="pv-yesterday">Loading...</tt><br />
  <small>※<a href="/privacy.html" title="「プライバシーポリシー」ページへ">プライバシーポリシー</a></small>
</div>
<p id="page-top">
  <a href="#">
    <i class="fa fa-angle-double-up fa-2x" aria-hidden="true"></i>
  </a>
</p>
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    <li><a href="https://www.mk-mode.com/blog/atom.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 mk-mode.com. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script defer src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>
  <script defer src="/assets/js/my_custom.js"></script>


<script>
  (function () {
    var cx = 'partner-pub-7320193476057758:6328726109';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
</script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





    
  <script>
    var disqus_config = function () {
      this.page.url = "https://komasaru.github.io/2013/04/09/ruby-calc-pi-with-euler-2/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2013/04/09/ruby-calc-pi-with-euler-2"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://mkmodeblog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>
