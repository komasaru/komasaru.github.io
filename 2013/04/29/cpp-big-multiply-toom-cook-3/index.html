<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ja" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>C++ - 多桁乗算（Toom-Cook 法 (3-way)）！ - mk-mode BLOG</title>
<meta name="description" content="これまで、「標準（筆算）法」や「Karatsuba 法」による多桁同士の乗算アルゴリズムの C++ への実装を紹介しました。  C++ - 多桁乗算（標準（筆算）法）！  C++ - 多桁乗算（Karatsuba 法）！今回は、「Karatsuba 法」の上位にある「Toom-Cook 法」アルゴリズムを C++ で実装してみました。">



<meta property="og:type" content="article">
<meta property="og:locale" content="ja_JP">
<meta property="og:site_name" content="mk-mode BLOG">
<meta property="og:title" content="C++ - 多桁乗算（Toom-Cook 法 (3-way)）！">
<meta property="og:url" content="https://komasaru.github.io/2013/04/29/cpp-big-multiply-toom-cook-3/">


  <meta property="og:description" content="これまで、「標準（筆算）法」や「Karatsuba 法」による多桁同士の乗算アルゴリズムの C++ への実装を紹介しました。  C++ - 多桁乗算（標準（筆算）法）！  C++ - 多桁乗算（Karatsuba 法）！今回は、「Karatsuba 法」の上位にある「Toom-Cook 法」アルゴリズムを C++ で実装してみました。">



  <meta property="og:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">



  <meta name="twitter:site" content="@rsm_mzk">
  <meta name="twitter:title" content="C++ - 多桁乗算（Toom-Cook 法 (3-way)）！">
  <meta name="twitter:description" content="これまで、「標準（筆算）法」や「Karatsuba 法」による多桁同士の乗算アルゴリズムの C++ への実装を紹介しました。  C++ - 多桁乗算（標準（筆算）法）！  C++ - 多桁乗算（Karatsuba 法）！今回は、「Karatsuba 法」の上位にある「Toom-Cook 法」アルゴリズムを C++ で実装してみました。">
  <meta name="twitter:url" content="https://komasaru.github.io/2013/04/29/cpp-big-multiply-toom-cook-3/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">
    
  

  



  <meta property="article:published_time" content="2013-04-29T00:20:00+09:00">





  

  


<link rel="canonical" href="https://komasaru.github.io/2013/04/29/cpp-big-multiply-toom-cook-3/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://komasaru.github.io",
      "logo": "https://www.mk-mode.com/blog/assets/images/about_me.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "mk-mode.com",
      "url": "https://komasaru.github.io",
      "sameAs": null
    }
  </script>



  <meta name="google-site-verification" content="0kSwKhNo71fC7OeEFLllD3S11F8Pa-z_OqsBTSFxXAk" />





<!-- end _includes/seo.html -->


<link href="https://www.mk-mode.com/blog/atom.xml" type="application/atom+xml" rel="alternate" title="mk-mode BLOG Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    
    <script defer src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <!-- start custom head snippets -->

<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com" />
<link rel="dns-prefetch" href="//googleads.g.doubleclick.net" />
<link rel="dns-prefetch" href="//tpc.googlesyndication.com" />
<link rel="dns-prefetch" href="//cm.g.doubleclick.net" />
<link rel="dns-prefetch" href="//www.gstatic.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />
<link rel='dns-prefetch' href='//use.fontawesome.com' />
<link rel="dns-prefetch" href="//twitter.com" />
<link rel="dns-prefetch" href="//www.facebook.com" />

<link rel="icon" href="/assets/images/favicon.ico">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-7320193476057758",
      enable_page_level_ads: true
    });
  </script>


<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">mk-mode BLOG</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/" >Archives</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/calendar/calendar" >Calendar</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/jmaxml" >JMAXML</a>
            </li><li class="masthead__menu-item">
              <a href="/privacy.html" >Privacy Policy</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/about_me.png" alt="mk-mode.com" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">mk-mode.com</h3>
    
    
      <p class="author__bio" itemprop="description">
        Linux, Debian, IT, Server, PG, Ruby, Rails, Python, C++, Fortran, PC, MariaDB, math, GIS, etc...
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Ruby City MATSUE</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://www.mk-mode.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode SITE</a></li>
          
        
          
            <li><a href="https://www.mk-mode.com/blog" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode BLOG (original)</a></li>
          
        
          
            <li><a href="https://mk-mode.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode TUMBLR</a></li>
          
        
          
            <li><a href="https://mk-ephemeris.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode EPHEMERIS</a></li>
          
        
          
            <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
        
          
            <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="C++ - 多桁乗算（Toom-Cook 法 (3-way)）！">
    <meta itemprop="description" content="これまで、「標準（筆算）法」や「Karatsuba 法」による多桁同士の乗算アルゴリズムの C++ への実装を紹介しました。  C++ - 多桁乗算（標準（筆算）法）！  C++ - 多桁乗算（Karatsuba 法）！今回は、「Karatsuba 法」の上位にある「Toom-Cook 法」アルゴリズムを C++ で実装してみました。">
    <meta itemprop="datePublished" content="April 29, 2013">
    

    <div class="page__inner-wrap">
      
        <header>
          <!-- div id="google-ad-1"></div -->
          <h1 id="page-title" class="page__title" itemprop="headline">C++ - 多桁乗算（Toom-Cook 法 (3-way)）！
</h1>
          
          
            
            <p class="page__date"><small><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2013-04-29T00:20:00+09:00">2013-04-29 00:20</time></small></p>
          
        </header>
      
      <div id="google-ad-2"></div>
      <br />

      <section class="page__content" itemprop="text">
        
        <p>これまで、「標準（筆算）法」や「Karatsuba 法」による多桁同士の乗算アルゴリズムの C++ への実装を紹介しました。</p>

<ul>
  <li><a href="/2013/04/22/cpp-big-multiply-normal/" title="C++ - 多桁乗算（標準（筆算）法）！">C++ - 多桁乗算（標準（筆算）法）！</a></li>
  <li><a href="/2013/04/25/cpp-big-multiply-karatsuba/" title="C++ - 多桁乗算（Karatsuba 法）！">C++ - 多桁乗算（Karatsuba 法）！</a></li>
</ul>

<p>今回は、「Karatsuba 法」の上位にある「Toom-Cook 法」アルゴリズムを C++ で実装してみました。</p>

<!--more-->

<h3 id="0-前提条件">0. 前提条件</h3>

<ul>
  <li>Linux Mint 14 Nadia (64bit) での作業を想定。</li>
  <li>g++ (Ubuntu/Linaro 4.7.2-2ubuntu1) 4.7.2</li>
</ul>

<h3 id="1-karatsuba-法について">1. Karatsuba 法について</h3>

<p>（数式が多いので \(\TeX\) で記載）<br />
ちなみに、同程度の桁数同士で、３分割して考える方法を「Toom-Cook 法(3-way)」と言う。（３分割×２分割や４分割×４分割等の考え方もある）</p>

<p><img src="/images/2013/04/29/TOOMCOOK_1.png" alt="TOOMCOOK_1" title="TOOMCOOK_1" />
<img src="/images/2013/04/29/TOOMCOOK_2.png" alt="TOOMCOOK_2" title="TOOMCOOK_2" />
<img src="/images/2013/04/29/TOOMCOOK_3.png" alt="TOOMCOOK_3" title="TOOMCOOK_3" />
<img src="/images/2013/04/29/TOOMCOOK_4.png" alt="TOOMCOOK_4" title="TOOMCOOK_4" /></p>

<h3 id="2-c-ソース作成">2. C++ ソース作成</h3>

<p>例として、以下のようにソースを作成した。概要は以下のとおり。</p>

<ul>
  <li>1個の配列で1桁を扱う。</li>
  <li>計算可能な桁数は 3 のべき乗桁としている。<br />
（3 のべき乗以外の桁数にすると、ロジックが複雑になるため）</li>
  <li>繰り上がり処理は、最後にまとめて行う（但し、非常に大きい乗算桁数では桁あふれを起こすので注意）</li>
  <li>配列数が9個（桁数が9桁）になったら、標準（筆算）法による乗算を行う。<br />
（9個でなくてもよい。桁あふれしない程度で設定する）</li>
  <li>計算に使用する被乗数・乗数は、手入力は困難なため、乱数を使用している。</li>
  <li>冒頭の <code class="language-plaintext highlighter-rouge">// #define TEST</code> は、乗算回数をカウントしたり、処理時間を計測するテストを行うため。<br />
テストを行うならコメントを解除する。<br />
（テストの処理時間計測では <code class="language-plaintext highlighter-rouge">clock</code> 関数を使用しているため、あまり精度はよくない）</li>
</ul>

<p>File: <code class="language-plaintext highlighter-rouge">multiply_toom_cook_3.cpp</code></p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
</pre></td><td class="code"><pre><span class="cm">/*********************************************
 * 多倍長乗算 ( by Toom-Cook 法 (3-way) )
 *   - 最下位の桁を配列の先頭とする考え方
 *********************************************/</span>
<span class="cp">#include &lt;cstdlib&gt;   // for rand()
#include &lt;iostream&gt;  // for cout
#include &lt;math.h&gt;    // for pow()
#include &lt;stdio.h&gt;   // for printf()
</span>
<span class="c1">//#define TEST      // テスト ( 乗算回数・処理時間 ) するならコメント解除</span>
<span class="cp">#define D_MAX 729  // 計算可能な最大桁数 ( 3 のべき乗 )
#define D     729  // 実際に計算する桁数 ( D_MAX 以下 )
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="cm">/*
 * 計算クラス
 */</span>
<span class="k">class</span> <span class="nc">Calc</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">A</span><span class="p">[</span><span class="n">D</span><span class="p">];</span>  <span class="c1">// 被乗数配列</span>
    <span class="kt">int</span> <span class="n">B</span><span class="p">[</span><span class="n">D</span><span class="p">];</span>  <span class="c1">// 乗数配列</span>
<span class="cp">#ifdef TEST
</span>    <span class="kt">int</span> <span class="n">cnt_mul</span><span class="p">;</span>       <span class="c1">// 乗算回数</span>
    <span class="kt">clock_t</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">;</span>    <span class="c1">// 計算開始CPU時刻、計算終了CPU時刻</span>
    <span class="kt">double</span> <span class="n">tt</span><span class="p">;</span>         <span class="c1">// 計算時間</span>
<span class="cp">#endif
</span>
    <span class="nl">public:</span>
        <span class="n">Calc</span><span class="p">();</span>                                             <span class="c1">// コンストラクタ</span>
        <span class="kt">void</span> <span class="n">calcToomCook</span><span class="p">();</span>                                <span class="c1">// 計算 ( Toom-Cook 法 )</span>

    <span class="nl">private:</span>
        <span class="kt">void</span> <span class="n">multiplyNormal</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">);</span>      <span class="c1">// 乗算 ( 標準(筆算)法 )</span>
        <span class="kt">void</span> <span class="n">multiplyToomCook3</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">);</span>  <span class="c1">// 乗算 ( Toom-Cook 法 (3-way) )</span>
        <span class="kt">void</span> <span class="n">doCarry</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>                           <span class="c1">// 繰り上がり・借り処理</span>
        <span class="kt">void</span> <span class="n">display</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">);</span>                  <span class="c1">// 結果出力</span>
<span class="p">};</span>

<span class="cm">/*
 * コンストラクタ
 */</span>
<span class="n">Calc</span><span class="o">::</span><span class="n">Calc</span><span class="p">()</span>
<span class="p">{</span>
    <span class="cm">/* ====================================== *
     * テストなので、被乗数・乗数は乱数を使用 *
     * ====================================== */</span>

    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>  <span class="c1">// LOOP インデックス</span>

    <span class="c1">// 被乗数・乗数桁数設定</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*
 * 計算 ( Toom-Cook 法 )
 */</span>
<span class="kt">void</span> <span class="n">Calc</span><span class="o">::</span><span class="n">calcToomCook</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">D_MAX</span><span class="p">];</span>       <span class="c1">// 被乗数配列</span>
    <span class="kt">int</span> <span class="n">b</span><span class="p">[</span><span class="n">D_MAX</span><span class="p">];</span>       <span class="c1">// 乗数配列</span>
    <span class="kt">int</span> <span class="n">z</span><span class="p">[</span><span class="n">D_MAX</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>  <span class="c1">// 計算結果用配列</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>              <span class="c1">// LOOPインデックス</span>

<span class="cp">#ifdef TEST
</span>    <span class="n">t1</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>  <span class="c1">// 計算開始時刻</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">l</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cnt_mul</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// 乗算回数リセット</span>
<span class="cp">#endif
</span>    <span class="c1">// 配列初期設定 ( コンストラクタで設定した配列を設定 )</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// 最大桁に満たない部分は 0 を設定</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">D</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">D_MAX</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 乗算 ( Toom-Cook 法 (3-way) )</span>
    <span class="n">multiplyToomCook3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">D_MAX</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>

    <span class="c1">// 繰り上がり・借り処理</span>
    <span class="n">doCarry</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">D_MAX</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="cp">#ifdef TEST
</span>    <span class="p">}</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>  <span class="c1">// 計算終了時刻</span>
    <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span> <span class="o">/</span> <span class="n">CLOCKS_PER_SEC</span><span class="p">;</span>  <span class="c1">// ==== 計算時間</span>
<span class="cp">#endif
</span>
    <span class="c1">// 結果出力</span>
    <span class="n">display</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*
 * 乗算 ( 標準(筆算)法 )
 */</span>
<span class="kt">void</span> <span class="n">Calc</span><span class="o">::</span><span class="n">multiplyNormal</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tLen</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">z</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>  <span class="c1">// ループインデックス</span>

    <span class="c1">// 計算結果初期化</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tLen</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// 各配列を各桁とみなして乗算</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">tLen</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tLen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">z</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<span class="cp">#ifdef TEST
</span>            <span class="n">cnt_mul</span><span class="o">++</span><span class="p">;</span>  <span class="c1">// 乗算カウント</span>
<span class="cp">#endif
</span>        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*
 * 乗算 ( Toom-Cook 法 (3-way) )
 *   結果用配列は以下のように配置し、
 *     +----+----+----+----+----+----+----+----+----+----+
 *     |   c0    |   c2    |   c4    |   c1    |   c3    |
 *     +----+----+----+----+----+----+----+----+----+----+
 *   最後に、c1, c3 を所定の位置に加算する。
 *     +----+----+----+----+----+----+
 *     |   c0    |   c2    |   c4    |
 *     +----+----+----+----+----+----+
 *          +----+----+----+----+
 *          |   c1    |   c3    |
 *          +----+----+----+----+
 *   その他、計算に必要な配列ポインタを詳細に設定。
 */</span>
<span class="kt">void</span> <span class="n">Calc</span><span class="o">::</span><span class="n">multiplyToomCook3</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tLen</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">z</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ==== 変数宣言</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">a0</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>                <span class="c1">// 被乗数/右側配列ポインタ</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">a1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// 被乗数/中央配列ポインタ</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">a2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">tLen</span> <span class="o">*</span> <span class="mi">2</span><span class="o">/</span> <span class="mi">3</span><span class="p">];</span>      <span class="c1">// 被乗数/左側配列ポインタ</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">b0</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>                <span class="c1">// 乗数  /右側配列ポインタ</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">b1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// 乗数  /中央配列ポインタ</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">b2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">[</span><span class="n">tLen</span> <span class="o">*</span> <span class="mi">2</span><span class="o">/</span> <span class="mi">3</span><span class="p">];</span>      <span class="c1">// 乗数  /左側配列ポインタ</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">c0</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">z</span><span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span>  <span class="mi">0</span><span class="p">];</span>  <span class="c1">// c0     用配列ポインタ</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">c2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">z</span><span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span>  <span class="mi">2</span><span class="p">];</span>  <span class="c1">// c2     用配列ポインタ</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">c4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">z</span><span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span>  <span class="mi">4</span><span class="p">];</span>  <span class="c1">// c4     用配列ポインタ</span>
    <span class="kt">int</span> <span class="n">c1</span>      <span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>   <span class="c1">// c1     用配列</span>
    <span class="kt">int</span> <span class="n">c3</span>      <span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>   <span class="c1">// c3     用配列</span>
    <span class="kt">int</span> <span class="n">a_m2</span>    <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// a( -2) 用配列</span>
    <span class="kt">int</span> <span class="n">a_m1</span>    <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// a( -1) 用配列</span>
    <span class="kt">int</span> <span class="n">a_0</span>     <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// a(  0) 用配列</span>
    <span class="kt">int</span> <span class="n">a_1</span>     <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// a(  1) 用配列</span>
    <span class="kt">int</span> <span class="n">a_inf</span>   <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// a(inf) 用配列</span>
    <span class="kt">int</span> <span class="n">b_m2</span>    <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// b( -2) 用配列</span>
    <span class="kt">int</span> <span class="n">b_m1</span>    <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// b( -1) 用配列</span>
    <span class="kt">int</span> <span class="n">b_0</span>     <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// b(  0) 用配列</span>
    <span class="kt">int</span> <span class="n">b_1</span>     <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// b(  1) 用配列</span>
    <span class="kt">int</span> <span class="n">b_inf</span>   <span class="p">[</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">];</span>         <span class="c1">// b(inf) 用配列</span>
    <span class="kt">int</span> <span class="n">c_m2</span>    <span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>   <span class="c1">// c( -2) 用配列</span>
    <span class="kt">int</span> <span class="n">c_m1</span>    <span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>   <span class="c1">// c( -1) 用配列</span>
    <span class="kt">int</span> <span class="n">c_0</span>     <span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>   <span class="c1">// c(  0) 用配列</span>
    <span class="kt">int</span> <span class="n">c_1</span>     <span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>   <span class="c1">// c(  1) 用配列</span>
    <span class="kt">int</span> <span class="n">c_inf</span>   <span class="p">[(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>   <span class="c1">// c(inf) 用配列</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>                          <span class="c1">// LOOPインデックス</span>

    <span class="c1">// ==== 9 桁（配列 9 個）になった場合は標準乗算</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tLen</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">multiplyNormal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">tLen</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ==== a(-2) = 4 * a2 - 2 * a1 + a0, b(1) = 4 * b2 - 2 * b1 + b0 (by シフト演算)</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a_m2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">a0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">b_m2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// ==== a(-1) = a2 - a1 + a0, b(1) = b2 - b1 + b0</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a_m1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">a0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">b_m1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// ==== a(0) = a0, b(0) = b0</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a_0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">b_0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// ==== a(1) = a2 + a1 + a0, b(1) = b2 + b1 + b0</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">a0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">b_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// ==== a(inf) = a2, b(inf) = b2</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a_inf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">b_inf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// ==== c(-2) = a(-2) * b(-2)</span>
    <span class="n">multiplyToomCook3</span><span class="p">(</span><span class="n">a_m2</span><span class="p">,</span>  <span class="n">b_m2</span><span class="p">,</span>  <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">c_m2</span> <span class="p">);</span>

    <span class="c1">// ==== c(-1) = a(-1) * b(-1)</span>
    <span class="n">multiplyToomCook3</span><span class="p">(</span><span class="n">a_m1</span><span class="p">,</span>  <span class="n">b_m1</span><span class="p">,</span>  <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">c_m1</span> <span class="p">);</span>

    <span class="c1">// ==== c(0) = a(0) * b(0)</span>
    <span class="n">multiplyToomCook3</span><span class="p">(</span><span class="n">a_0</span><span class="p">,</span>   <span class="n">b_0</span><span class="p">,</span>   <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">c_0</span>  <span class="p">);</span>

    <span class="c1">// ==== c(1) = a(1) * b(1)</span>
    <span class="n">multiplyToomCook3</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span>   <span class="n">b_1</span><span class="p">,</span>   <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">c_1</span>  <span class="p">);</span>

    <span class="c1">// ==== c(inf) = a(inf) * b(inf)</span>
    <span class="n">multiplyToomCook3</span><span class="p">(</span><span class="n">a_inf</span><span class="p">,</span> <span class="n">b_inf</span><span class="p">,</span> <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">c_inf</span><span class="p">);</span>

    <span class="c1">// ==== c4 = 6 * c(inf) / 6</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">c4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_inf</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

    <span class="c1">// ==== c3 = -c(-2) + 3 * c(-1) - 3 * c(0) + c(1) + 12 * c(inf) / 6</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">c3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">c_m2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">c3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c_m1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_m1</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">c3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">c_0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">c3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c_1</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">c3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c_inf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c_inf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">c3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ==== c2 = 3 * c(-1) - 6 * c(0) + 3 * c(1) - 6 * c(inf) / 6</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">c2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">c_m1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_m1</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">c2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">c_0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c_0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">c2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_1</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">c2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">c_inf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c_inf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">c2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ==== c1 = c(-2) - 6 * c(-1) + 3 * c(0) + 2 * c(1) - 12 * c(inf) / 6</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span> <span class="n">c_m2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">c_m1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c_m1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c_0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">c_inf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c_inf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ==== c0 = 6 * c(0) / 6</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">c0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

    <span class="c1">// ==== z = c4 * x^4 + c3 * x^3 + c2 * x^2 + c1 * x + c0</span>
    <span class="c1">//      (c0, c2, c4 は最初から所定の位置に格納されているので、</span>
    <span class="c1">//       c1, c3 のみ加算 )</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">tLen</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c3</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>

<span class="cm">/*
 * 繰り上がり・借り処理
 */</span>
<span class="kt">void</span> <span class="n">Calc</span><span class="o">::</span><span class="n">doCarry</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tLen</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">cr</span><span class="p">;</span>  <span class="c1">// 繰り上がり</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>   <span class="c1">// ループインデックス</span>

    <span class="n">cr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tLen</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cr</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cr</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">cr</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">cr</span> <span class="o">*</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// オーバーフロー時</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">"[ OVERFLOW!! ] %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">cr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*
 * 結果出力
 */</span>
<span class="kt">void</span> <span class="n">Calc</span><span class="o">::</span><span class="n">display</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">z</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>  <span class="c1">// LOOPインデックス</span>

    <span class="c1">// 上位桁の不要な 0 を削除するために、配列サイズを取得</span>
    <span class="kt">int</span> <span class="n">aLen</span> <span class="o">=</span> <span class="n">D_MAX</span><span class="p">,</span> <span class="n">bLen</span> <span class="o">=</span> <span class="n">D_MAX</span><span class="p">,</span> <span class="n">zLen</span> <span class="o">=</span> <span class="n">D_MAX</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">aLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">aLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">aLen</span><span class="o">--</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">bLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">bLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">bLen</span><span class="o">--</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">zLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">zLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">zLen</span><span class="o">--</span><span class="p">;</span>

    <span class="c1">// a 値</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"a =</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">aLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">aLen</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">aLen</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="c1">// b 値</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"b =</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">bLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">bLen</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">bLen</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="c1">// z 値</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"z =</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">zLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">zLen</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">zLen</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>

<span class="cp">#ifdef TEST
</span>    <span class="n">printf</span><span class="p">(</span><span class="s">"Counts of multiply / 1 loop = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">cnt_mul</span><span class="p">);</span>     <span class="c1">// 乗算回数</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Total time of all loops     = %f seconds</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span>  <span class="c1">// 処理時間</span>
<span class="cp">#endif
</span><span class="p">}</span>

<span class="cm">/*
 * メイン処理
 */</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="c1">// 計算クラスインスタンス化</span>
        <span class="n">Calc</span> <span class="n">objCalc</span><span class="p">;</span>

        <span class="c1">// 乗算 ( Toom-Cook 法 )</span>
        <span class="n">objCalc</span><span class="p">.</span><span class="n">calcToomCook</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"例外発生！"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 正常終了</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li><a href="https://gist.github.com/komasaru/23809f416f6dbec64beb3d13a805efa5" title="Gist - C++ source code to multiply big-digit values with Toom-Cook 3-way method.">Gist - C++ source code to multiply big-digit values with Toom-Cook 3-way method.</a></li>
</ul>

<h3 id="3-c-ソースコンパイル">3. C++ ソースコンパイル</h3>

<p>（<code class="language-plaintext highlighter-rouge">-Wall</code> は警告出力、<code class="language-plaintext highlighter-rouge">-O2</code> 最適化のオプション）</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ g++ -Wall -O2 -o multiply_toom_cook_3 multiply_toom_cook_3.cpp
</code></pre></div></div>

<p>何も出力されなければ成功。</p>

<h3 id="4-実行">4. 実行</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./multiply_toom_cook_3
a =
2591143596 2346775392 0937646531 6568615864 8398725493 
4087130219 1596917334 0177683992 0813223745 9779754352 
8944932316 9629947339 9445091835 0388960192 8955061632 
3738412276 1433199925 0315713085 9378419329 3659409294 
2480119500 7197101549 2212451932 2704588466 4812771903 
8901977387 5802786582 6405523129 4325764724 6720143000 
1277681909 6692814478 7319151423 1290842279 3038342092 
1065637955 8549310037 0533764082 9436637253 9515438679 
7766720886 1618471741 7221329703 7458017793 3575966087 
0590224271 1768660254 4076013016 1293279873 5945959708 
9946080467 5263339808 7033368282 4246141390 0394299488 
0252206204 7509191362 6987956604 6039990313 8920242824 
0815106928 5729454200 4798463368 3859845729 7374431491 
6860803289 6677917104 5612777454 6962438673 4424366456 
2613584191 3929722712 030296373
b =
5640936430 9010018506 2074049213 9225420531 7120391806 
3626925169 5258572474 6042646617 5789516910 0220359949 
3394237741 5504199300 2689317010 0173030204 0908343875 
7276728921 5639684944 4001086363 5835539015 9644066815 
4976237121 6087234637 2062179441 7355273885 5857697267 
0889167023 0551830095 0630610627 7679851212 5513317149 
5213794389 4091568806 9338677524 8328634542 4070207416 
2850176096 3013514856 8183157295 7343340228 8454195001 
4934592104 9265001117 5102743998 1388994837 8389707468 
3149905673 0009246688 7647591722 9004589105 9497241813 
2372874109 8652730769 6483888898 1629437542 5694561003 
2950241948 0871495217 0922867240 6583613401 1096478656 
6501028381 4742690593 3678808349 1837517816 5164400885 
1539589914 3536751799 9106221809 6280914880 4755795751 
0306047932 6782530986 669712556
z =
1461647630 9696028535 6604503489 0007526041 7343634144 
9012424224 8203055051 5188762825 4647083693 9946556987 
1776705770 8951386873 3310520107 5767293276 2918257300 
9738034682 1299762223 5923897458 8934279861 7465049365 
8843967704 2679161515 9650724804 3745565830 2404529184 
8153750484 9136923387 1070699742 2427487328 8754504356 
0612755617 5184216545 5162560665 5429356048 4383287541 
4349677390 3284617894 6977135150 5866219438 8254075770 
4288514897 9756324873 9356425815 0617270838 9035401309 
6240946056 6087222538 2876110571 6041803886 8836295631 
6066052571 8502983404 6640486292 8470602933 3206771844 
7507565069 1263592396 6290321271 2071370365 4580134837 
4120524514 9596367407 7615557930 1753573529 9672002811 
5021333258 2795047488 9411440436 6051342406 6652384845 
5125046986 6299991328 7858252156 3928407926 0968969006 
3788059606 7048907697 3132905363 4969631212 6879889153 
7202723230 4021160144 7598686317 9619939624 8796424549 
6233736832 4323370236 2032503373 8424220248 9204990020 
4555937281 9315727632 6895093765 7046148316 3323171219 
9024915269 7062742069 7796088716 2920824597 2157070237 
6571127379 0423318203 7392124983 1535487696 9993725368 
6009296714 8076417516 5151775265 7836148991 1043480618 
3435401050 4007027779 1974470200 0895993617 3597893980 
3172290388 4700169184 9026298285 0863879579 5031583805 
5355823672 0136388135 2633831672 8029491896 2705418710 
5843171306 8493018874 8709677353 7863144237 7967352645 
5041214394 2329737718 2084198684 3461291462 7753947528 
5224644934 3464361873 3201519986 6919424192 2331637031 
3569475240 6078406677 2868569397 5160753082 4809755113 
99359388
</code></pre></div></div>

<p>「標準（筆算）法」や「Karatsuba 法」で桁数を指定して計算した結果と同じ結果になった。</p>

<h3 id="5-検証">5. 検証</h3>

<p>上記のコードを利用して、乗算回数が何回になるか、計算にどれくらい時間がかかるかを検証してみた。<br />
参考のため「Karatsuba 法」での乗算テスト結果も掲載している。計算桁数が異なるため単純には比較できないが、１万桁を超えると乗算回数は「Karatsuba 法」より微減し、計算に要する時間も少しずつ短くなっているのが分かる。</p>

<p>ちなみに、「Karatsuba 法」の計算量は \(O(n ^{1.585})\) で、「Toom-Cook 法(3-way)」の計算量は \(O(n ^{1.465})\) である。</p>

<p><img src="/images/2013/04/29/MULTIPLY_TOOMCOOK_CPP.png" alt="MULTIPLY_TOOMCOOK_CPP" title="MULTIPLY_TOOMCOOK_CPP" /></p>

<hr />

<p>「Karatsuba 法」（=「Toom-Cook 法」を２分割×２分割で考える方法）に比べ、「Toom-Cook 法(3-way)」はそれほど大きな効果はありませんが、分割数を調整して試してみてみるのもよいかも知れません。</p>

<p>今回は1桁を1個の配列で扱ったが、乗算する桁数があらかじめ分かっているのなら、1個の配列で4桁を扱ったりすると速度が向上する。（但し、桁あふれに注意）<br />
また、今回は繰り上がり処理を最後にまとめて行なっているが、乗算の都度行うとさらに速度が向上する。（但し、繰り上がりにより配列の個数が変動するので厄介）</p>

<p>このアルゴリズムをどこで使用できるかは、今のところ不明だが、知っておいて悪くないでしょう。<br />
（ちなみに、少し前に当ブログでも紹介した Arctan 系公式を使用した円周率の計算でも、使用する場面は無い）</p>

<p>以上。</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/c%E8%A8%80%E8%AA%9E" class="page__taxonomy-item" rel="tag">C言語</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0" class="page__taxonomy-item" rel="tag">プログラミング</a><span class="sep">, </span>
    
      
      
      <a href="/categories/%E6%95%B0%E5%AD%A6" class="page__taxonomy-item" rel="tag">数学</a>
    
    </span>
  </p>


        
          
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2013-04-29T00:20:00+09:00">2013-04-29 00:20</time></p>
        
        <br />
      </footer>
      <div id="google-ad-3"></div>
      <br />
      <br />
      <br />
      <br />

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=rsm_mzk&text=C%2B%2B+-+%E5%A4%9A%E6%A1%81%E4%B9%97%E7%AE%97%EF%BC%88Toom-Cook+%E6%B3%95+%283-way%29%EF%BC%89%EF%BC%81%20https%3A%2F%2Fkomasaru.github.io%2F2013%2F04%2F29%2Fcpp-big-multiply-toom-cook-3%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkomasaru.github.io%2F2013%2F04%2F29%2Fcpp-big-multiply-toom-cook-3%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  

  <a href="https://www.tumblr.com/share" class="btn btn--tumblr" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Tumblr"><i class="fab fa-fw fa-tumblr" aria-hidden="true"></i><span> Tumblr</span></a><script id="tumblr-js" async src="https://assets.tumblr.com/share-button.js"></script>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fkomasaru.github.io%2F2013%2F04%2F29%2Fcpp-big-multiply-toom-cook-3%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      <section>
        &nbsp;
        <h4>Sponsored Link</h4>
        <div id="rakuten-ad"></div>
        <div id="amazon-ad-1"></div>
      </section>
      &nbsp;
      
  <nav class="pagination">
    
      <a href="/2013/04/26/ruby-big-multiply-karatsuba/" class="pagination--pager" title="Ruby - 多桁乗算（Karatsuba 法）！
">Previous</a>
    
    
      <a href="/2013/04/30/ruby-big-multiply-toom-cook-3/" class="pagination--pager" title="Ruby - 多桁乗算（Toom-Cook 法 (3-way)）！
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <div id="google-ad-4"></div>
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/04/06/debian-11-munin-installation/" rel="permalink">Debian 11 (bullseye) - サーバ監視ツール munin 導入！
</a>
        &nbsp;<small>(2022-04-06)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 11 (bullseye) にサーバ監視ツール munin をインストールする方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてください）

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/04/01/blog-access/" rel="permalink">2022年3月 - OS・ブラウザ別アクセス状況！
</a>
        &nbsp;<small>(2022-04-01)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">4月になりましたので、先月3月分の当ブログアクセス状況を公開します。（※自分用の記録）

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/03/30/debian-11-php-installation-by-src-with-nginx-cooperation/" rel="permalink">Debian 11 (bullseye) - PHP インストール（Nginx と連携）！
</a>
        &nbsp;<small>(2022-03-30)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 11 (bullseye) に PHP をソースをビルドしてインストールし、 Web／リバースプロキシサーバ Nginx と連携する方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/03/23/debian-11-git-installation-by-src/" rel="permalink">Debian 11 (bullseye) - Git インストール（ソースビルド）！
</a>
        &nbsp;<small>(2022-03-23)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 11 (bullseye) に Git サーバをソースをビルドしてインストールする方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてください）

</p>
  </article>
</div>

        
      </div>
      <!-- &nbsp;
      <div id="amazon-wd"></div -->
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <input type="text" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    </form>
    <div id="results" class="results">
        <gcse:searchresults-only></gcse:searchresults-only>    
    </div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<div id="qr"><img src="/assets/images/qr.png" alt="mk-mode BLOG"></div>
<div id="google-ad-5"></div>
<div class="page__footer-etc">
  <strong>ブログ開設日</strong> <tt>2009-01-05</tt><br />
  <strong>サーバ連続稼働時間</strong> <tt id="uptime">Loading...</tt><br />
  <strong>Page View</strong><br />
  &emsp;合計 <tt id="pv-total">Loading...</tt><br />
  &emsp;今日 <tt id="pv-today">Loading...</tt><br />
  &emsp;昨日 <tt id="pv-yesterday">Loading...</tt><br />
  <small>※<a href="/privacy.html" title="「プライバシーポリシー」ページへ">プライバシーポリシー</a></small>
</div>
<p id="page-top">
  <a href="#">
    <i class="fa fa-angle-double-up fa-2x" aria-hidden="true"></i>
  </a>
</p>
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    <li><a href="https://www.mk-mode.com/blog/atom.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 mk-mode.com. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script defer src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>
  <script defer src="/assets/js/my_custom.js"></script>


<script>
  (function () {
    var cx = 'partner-pub-7320193476057758:6328726109';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
</script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





    
  <script>
    var disqus_config = function () {
      this.page.url = "https://komasaru.github.io/2013/04/29/cpp-big-multiply-toom-cook-3/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2013/04/29/cpp-big-multiply-toom-cook-3"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://mkmodeblog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>
