<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ja" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Ruby - Google Geocoding API で住所から緯度・経度、緯度・経度から住所を取得！ - mk-mode BLOG</title>
<meta name="description" content="“Google Geocoding API” を使用して、住所から緯度・経度を取得したり、緯度・経度から住所を取得する方法についてです。よくある “Google Maps JavaScript API v3” についてではありません。ちなみに、住所から緯度・経度を取得することを「ジオコーディング(“Geocoding”)」 と呼び、緯度・経度から住所を取得することを 「逆ジオコーディング(“Inverse Geocoding”)」と呼ぶようです。この「ジオコーディングによる緯度・経度取得処理」と「逆ジオコーディングによる住所取得処理」を、１本の Ruby で実装してみました。（Google Geocoding API の仕組みを理解すれば、Ruby である必要がないことも分かるかと思います）">



<meta property="og:type" content="article">
<meta property="og:locale" content="ja_JP">
<meta property="og:site_name" content="mk-mode BLOG">
<meta property="og:title" content="Ruby - Google Geocoding API で住所から緯度・経度、緯度・経度から住所を取得！">
<meta property="og:url" content="https://komasaru.github.io/2013/07/02/ruby-google-geocoding-api/">


  <meta property="og:description" content="“Google Geocoding API” を使用して、住所から緯度・経度を取得したり、緯度・経度から住所を取得する方法についてです。よくある “Google Maps JavaScript API v3” についてではありません。ちなみに、住所から緯度・経度を取得することを「ジオコーディング(“Geocoding”)」 と呼び、緯度・経度から住所を取得することを 「逆ジオコーディング(“Inverse Geocoding”)」と呼ぶようです。この「ジオコーディングによる緯度・経度取得処理」と「逆ジオコーディングによる住所取得処理」を、１本の Ruby で実装してみました。（Google Geocoding API の仕組みを理解すれば、Ruby である必要がないことも分かるかと思います）">



  <meta property="og:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">



  <meta name="twitter:site" content="@rsm_mzk">
  <meta name="twitter:title" content="Ruby - Google Geocoding API で住所から緯度・経度、緯度・経度から住所を取得！">
  <meta name="twitter:description" content="“Google Geocoding API” を使用して、住所から緯度・経度を取得したり、緯度・経度から住所を取得する方法についてです。よくある “Google Maps JavaScript API v3” についてではありません。ちなみに、住所から緯度・経度を取得することを「ジオコーディング(“Geocoding”)」 と呼び、緯度・経度から住所を取得することを 「逆ジオコーディング(“Inverse Geocoding”)」と呼ぶようです。この「ジオコーディングによる緯度・経度取得処理」と「逆ジオコーディングによる住所取得処理」を、１本の Ruby で実装してみました。（Google Geocoding API の仕組みを理解すれば、Ruby である必要がないことも分かるかと思います）">
  <meta name="twitter:url" content="https://komasaru.github.io/2013/07/02/ruby-google-geocoding-api/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">
    
  

  



  <meta property="article:published_time" content="2013-07-02T00:20:00+09:00">





  

  


<link rel="canonical" href="https://komasaru.github.io/2013/07/02/ruby-google-geocoding-api/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://komasaru.github.io",
      "logo": "https://www.mk-mode.com/blog/assets/images/about_me.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "mk-mode.com",
      "url": "https://komasaru.github.io",
      "sameAs": null
    }
  </script>



  <meta name="google-site-verification" content="0kSwKhNo71fC7OeEFLllD3S11F8Pa-z_OqsBTSFxXAk" />





<!-- end _includes/seo.html -->


<link href="https://www.mk-mode.com/blog/atom.xml" type="application/atom+xml" rel="alternate" title="mk-mode BLOG Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    
    <script defer src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <!-- start custom head snippets -->

<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com" />
<link rel="dns-prefetch" href="//googleads.g.doubleclick.net" />
<link rel="dns-prefetch" href="//tpc.googlesyndication.com" />
<link rel="dns-prefetch" href="//cm.g.doubleclick.net" />
<link rel="dns-prefetch" href="//www.gstatic.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />
<link rel='dns-prefetch' href='//use.fontawesome.com' />
<link rel="dns-prefetch" href="//twitter.com" />
<link rel="dns-prefetch" href="//www.facebook.com" />

<link rel="icon" href="/assets/images/favicon.ico">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-7320193476057758",
      enable_page_level_ads: true
    });
  </script>


<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">mk-mode BLOG</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/" >Archives</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/calendar/calendar" >Calendar</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/jmaxml" >JMAXML</a>
            </li><li class="masthead__menu-item">
              <a href="/privacy.html" >Privacy Policy</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/about_me.png" alt="mk-mode.com" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">mk-mode.com</h3>
    
    
      <p class="author__bio" itemprop="description">
        Linux, Debian, IT, Server, PG, Ruby, Rails, Python, C++, Fortran, PC, MariaDB, math, GIS, etc...
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Ruby City MATSUE</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://www.mk-mode.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode SITE</a></li>
          
        
          
            <li><a href="https://www.mk-mode.com/blog" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode BLOG (original)</a></li>
          
        
          
            <li><a href="https://mk-mode.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode TUMBLR</a></li>
          
        
          
            <li><a href="https://mk-ephemeris.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode EPHEMERIS</a></li>
          
        
          
            <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
        
          
            <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Ruby - Google Geocoding API で住所から緯度・経度、緯度・経度から住所を取得！">
    <meta itemprop="description" content="“Google Geocoding API” を使用して、住所から緯度・経度を取得したり、緯度・経度から住所を取得する方法についてです。よくある “Google Maps JavaScript API v3” についてではありません。ちなみに、住所から緯度・経度を取得することを「ジオコーディング(“Geocoding”)」 と呼び、緯度・経度から住所を取得することを 「逆ジオコーディング(“Inverse Geocoding”)」と呼ぶようです。この「ジオコーディングによる緯度・経度取得処理」と「逆ジオコーディングによる住所取得処理」を、１本の Ruby で実装してみました。（Google Geocoding API の仕組みを理解すれば、Ruby である必要がないことも分かるかと思います）">
    <meta itemprop="datePublished" content="July 02, 2013">
    

    <div class="page__inner-wrap">
      
        <header>
          <!-- div id="google-ad-1"></div -->
          <h1 id="page-title" class="page__title" itemprop="headline">Ruby - Google Geocoding API で住所から緯度・経度、緯度・経度から住所を取得！
</h1>
          
          
            
            <p class="page__date"><small><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2013-07-02T00:20:00+09:00">2013-07-02 00:20</time></small></p>
          
        </header>
      
      <div id="google-ad-2"></div>
      <br />

      <section class="page__content" itemprop="text">
        
        <p>“Google Geocoding API” を使用して、住所から緯度・経度を取得したり、緯度・経度から住所を取得する方法についてです。<br />
よくある “Google Maps JavaScript API v3” についてではありません。</p>

<p>ちなみに、住所から緯度・経度を取得することを「ジオコーディング(“Geocoding”)」 と呼び、緯度・経度から住所を取得することを 「逆ジオコーディング(“Inverse Geocoding”)」と呼ぶようです。</p>

<p>この「ジオコーディングによる緯度・経度取得処理」と「逆ジオコーディングによる住所取得処理」を、１本の Ruby で実装してみました。<br />
（Google Geocoding API の仕組みを理解すれば、Ruby である必要がないことも分かるかと思います）</p>

<!--more-->

<h4 id="0-前提条件">0. 前提条件</h4>

<ul>
  <li>Ruby 2.0.0-p195 での作業を想定。</li>
  <li>コマンドライン引数で住所または緯度・経度を指定し、引数が住所なら緯度・経度を取得、引数が緯度と経度なら住所を取得するようにする。</li>
  <li>コマンドライン引数の緯度・経度は「度」で指定する。<br />
「度・分・秒」は、「度」＋「分」÷60＋「秒」÷60÷60で「度」に変換して指定する。</li>
  <li>データは JSON 形式か XML 形式で取得できるが、今回は JSON 形式で取得する。</li>
  <li>取得できるデータは複数あるが、先頭データ（最優先データ）のみを表示する。</li>
  <li>既定のブラウザを起動して Google マップで該当の場所を表示する。（<strong>後述「3. 注意」参照</strong>）</li>
</ul>

<h4 id="1-ruby-スクリプト作成">1. Ruby スクリプト作成</h4>

<p>以下のように Ruby スクリプトを作成してみた。</p>

<p>File: <code class="language-plaintext highlighter-rouge">google_geocode.rb</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
</pre></td><td class="code"><pre><span class="c1">#*********************************************</span>
<span class="c1"># 住所から緯度・経度を取得する、又は、</span>
<span class="c1"># 緯度・経度から住所を取得する。</span>
<span class="c1"># ( by Google Geocode API )</span>
<span class="c1">#*********************************************</span>
<span class="c1">#</span>
<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'net/http'</span>

<span class="no">BASE_URL</span> <span class="o">=</span> <span class="s2">"http://maps.googleapis.com/maps/api/geocode/json"</span>
<span class="no">OPEN_URL</span> <span class="o">=</span> <span class="s2">"http://maps.google.co.jp/maps"</span>
<span class="no">USAGE</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="no">"EOS"</span><span class="sh">
[USAGE] - 住所から緯度・経度を取得する場合
            第１引数：住所
        - 緯度・経度から住所を取得する場合
            第１引数：緯度 ( -90 〜  90)
            第２引数：経度 (-180 〜 180)
</span><span class="no">EOS</span>

<span class="k">class</span> <span class="nc">GoogleGeocode</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@addr</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="vi">@lat</span>  <span class="o">=</span> <span class="mi">0</span>
    <span class="vi">@lng</span>  <span class="o">=</span> <span class="mi">0</span>
  <span class="k">end</span>

  <span class="c1"># コマンドライン引数チェック</span>
  <span class="k">def</span> <span class="nf">check_args</span>
    <span class="k">begin</span>
      <span class="n">ret</span> <span class="o">=</span> <span class="kp">true</span>

      <span class="c1"># 引数の個数別にチェック</span>
      <span class="k">case</span> <span class="no">ARGV</span><span class="p">.</span><span class="nf">size</span>
      <span class="k">when</span> <span class="mi">0</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kp">false</span>
      <span class="k">when</span> <span class="mi">1</span>
        <span class="c1"># 住所（半角数字と半角ピリオドだけなら、明らかに住所ではないのでエラー）</span>
        <span class="k">if</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">=~</span> <span class="sr">/^([-+]?[\d\.]+)$/</span>
          <span class="n">ret</span> <span class="o">=</span> <span class="kp">false</span>
        <span class="k">else</span>
          <span class="vi">@addr</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">to_s</span>
        <span class="k">end</span>
      <span class="k">when</span> <span class="mi">2</span>
        <span class="c1"># 緯度（半角数字と半角ピリオド以外、-90〜90以外はエラー）</span>
        <span class="k">if</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">=~</span> <span class="sr">/^([-+]?[\d\.]+)$/</span>
          <span class="vi">@lat</span> <span class="o">=</span> <span class="vg">$1</span><span class="p">.</span><span class="nf">to_f</span>
          <span class="n">ret</span> <span class="o">=</span> <span class="kp">false</span> <span class="k">if</span> <span class="vi">@lat</span> <span class="o">&gt;</span> <span class="mf">90.0</span> <span class="o">||</span> <span class="vi">@lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90.0</span>
        <span class="k">else</span>
          <span class="n">ret</span> <span class="o">=</span> <span class="kp">false</span>
        <span class="k">end</span>
        <span class="c1"># 経度（半角数字と半角ピリオド以外、-180〜180以外はエラー）</span>
        <span class="k">if</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">=~</span> <span class="sr">/^([-+]?[\d\.]+)$/</span>
          <span class="vi">@lng</span> <span class="o">=</span> <span class="vg">$1</span><span class="p">.</span><span class="nf">to_f</span>
          <span class="n">ret</span> <span class="o">=</span> <span class="kp">false</span> <span class="k">if</span> <span class="vi">@lng</span> <span class="o">&gt;</span> <span class="mf">180.0</span> <span class="o">||</span> <span class="vi">@lng</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">180.0</span>
        <span class="k">else</span>
          <span class="n">ret</span> <span class="o">=</span> <span class="kp">false</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">return</span> <span class="n">ret</span>
    <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="s2">"[EXCEPTION]["</span> <span class="o">+</span> <span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span> <span class="o">+</span> <span class="s2">".check_args] "</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="nf">to_s</span>
      <span class="no">STDERR</span><span class="p">.</span><span class="nf">puts</span> <span class="n">msg</span>
      <span class="nb">exit</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># 主処理</span>
  <span class="k">def</span> <span class="nf">proc_main</span>
    <span class="k">begin</span>
      <span class="k">if</span> <span class="vi">@addr</span> <span class="o">==</span> <span class="s2">""</span>
        <span class="c1"># 緯度・経度から住所を取得</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">BASE_URL</span><span class="si">}</span><span class="s2">?latlng=</span><span class="si">#{</span><span class="vi">@lat</span><span class="si">}</span><span class="s2">,</span><span class="si">#{</span><span class="vi">@lng</span><span class="si">}</span><span class="s2">&amp;sensor=false&amp;language=ja"</span>
        <span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
        <span class="n">status</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"OK"</span>
          <span class="vi">@addr</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s1">'results'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'formatted_address'</span><span class="p">]</span>
          <span class="nb">puts</span> <span class="s2">"緯度・経度 : </span><span class="si">#{</span><span class="vi">@lat</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="vi">@lng</span><span class="si">}</span><span class="s2">"</span>
          <span class="nb">puts</span> <span class="s2">"住      所 : </span><span class="si">#{</span><span class="vi">@addr</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">else</span>
          <span class="nb">puts</span> <span class="s2">"STATUS : </span><span class="si">#{</span><span class="n">status</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">end</span>
      <span class="k">else</span>
        <span class="c1"># 住所から緯度・経度を取得</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">BASE_URL</span><span class="si">}</span><span class="s2">?address=</span><span class="si">#{</span><span class="no">URI</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="vi">@addr</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;sensor=false&amp;language=ja"</span>
        <span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
        <span class="n">status</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"OK"</span>
          <span class="vi">@addr</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s1">'results'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'formatted_address'</span><span class="p">]</span>
          <span class="vi">@lat</span>  <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s1">'results'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'geometry'</span><span class="p">][</span><span class="s1">'location'</span><span class="p">][</span><span class="s1">'lat'</span><span class="p">]</span>
          <span class="vi">@lng</span>  <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s1">'results'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'geometry'</span><span class="p">][</span><span class="s1">'location'</span><span class="p">][</span><span class="s1">'lng'</span><span class="p">]</span>
          <span class="nb">puts</span> <span class="s2">"住      所 : </span><span class="si">#{</span><span class="vi">@addr</span><span class="si">}</span><span class="s2">"</span>
          <span class="nb">puts</span> <span class="s2">"緯度・経度 : </span><span class="si">#{</span><span class="vi">@lat</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="vi">@lng</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">else</span>
          <span class="nb">puts</span> <span class="s2">"STATUS : </span><span class="si">#{</span><span class="n">status</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="s2">"[EXCEPTION]["</span> <span class="o">+</span> <span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span> <span class="o">+</span> <span class="s2">".proc_main] "</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="nf">to_s</span>
      <span class="no">STDERR</span><span class="p">.</span><span class="nf">puts</span> <span class="n">msg</span>
      <span class="nb">exit</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># ブラウザ表示</span>
  <span class="c1">#   Linux   : xdg-open</span>
  <span class="c1">#   MacOS   : open</span>
  <span class="c1">#   Windows : start /B</span>
  <span class="c1">#   Cygwin  : cmd /C start /B</span>
  <span class="k">def</span> <span class="nf">open_web</span>
    <span class="k">begin</span>
      <span class="c1"># 緯度・経度をブラウザ表示</span>
      <span class="nb">system</span> <span class="sb">`xdg-open '</span><span class="si">#{</span><span class="no">OPEN_URL</span><span class="si">}</span><span class="sb">?q=</span><span class="si">#{</span><span class="vi">@addr</span><span class="si">}</span><span class="sb">&amp;ll=</span><span class="si">#{</span><span class="vi">@lat</span><span class="si">}</span><span class="sb">,</span><span class="si">#{</span><span class="vi">@lng</span><span class="si">}</span><span class="sb">&amp;z=16'`</span>
    <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="s2">"[EXCEPTION]["</span> <span class="o">+</span> <span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span> <span class="o">+</span> <span class="s2">".open_web] "</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="nf">to_s</span>
      <span class="no">STDERR</span><span class="p">.</span><span class="nf">puts</span> <span class="n">msg</span>
      <span class="nb">exit</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># クラスインスタンス化</span>
<span class="n">obj_main</span> <span class="o">=</span> <span class="no">GoogleGeocode</span><span class="p">.</span><span class="nf">new</span>

<span class="c1"># 引数チェック</span>
<span class="k">unless</span> <span class="n">obj_main</span><span class="p">.</span><span class="nf">check_args</span>
  <span class="nb">puts</span> <span class="no">USAGE</span>
  <span class="nb">exit</span>
<span class="k">end</span>

<span class="c1"># 主処理</span>
<span class="n">obj_main</span><span class="p">.</span><span class="nf">proc_main</span>

<span class="c1"># ブラウザ表示</span>
<span class="n">obj_main</span><span class="p">.</span><span class="nf">open_web</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p><a href="https://gist.github.com/komasaru/5820771" title="Gist - Ruby script to get a address or latitude, longitude with Google Geocoding API.">Gist - Ruby script to get a address or latitude, longitude with Google Geocoding API.</a></p>

<p>※URL 指定部分のクエリストリングについて。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">address=XXXX</code> で住所を指定。</li>
  <li><code class="language-plaintext highlighter-rouge">latlng=999.9999,999.9999</code> で緯度・経度を指定。</li>
  <li><code class="language-plaintext highlighter-rouge">sensor=false</code> は一般のブラウザである場合の設定。
GPS センサー搭載のデバイスなら <code class="language-plaintext highlighter-rouge">sensor=true</code> とする。</li>
  <li><code class="language-plaintext highlighter-rouge">language=ja</code> は結果を日本語で返す設定。</li>
</ul>

<p>その他詳細は、<a href="https://developers.google.com/maps/documentation/geocoding/?hl=ja" title="Google Geocoding API - Google Maps API ウェブ サービス — Google Developers">参考サイト</a>で確認可能。</p>

<h4 id="2-実行">2. 実行</h4>

<p>以下のように実行する。</p>

<p>File: <code class="language-plaintext highlighter-rouge">引数が不正な場合</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="nv">$ </span>ruby google_geocode.rb 35abc abc123
<span class="o">[</span>USAGE] - 住所から緯度・経度を取得する場合
            第１引数：住所
        - 緯度・経度から住所を取得する場合
            第１引数：緯度 <span class="o">(</span> <span class="nt">-90</span> 〜  90<span class="o">)</span>
            第２引数：経度 <span class="o">(</span><span class="nt">-180</span> 〜 180<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>File: <code class="language-plaintext highlighter-rouge">データが取得できなかった場合</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="nv">$ </span>ruby google_geocode.rb 123ab
STATUS : ZERO_RESULTS
</pre></td></tr></tbody></table></code></pre></figure>

<p>File: <code class="language-plaintext highlighter-rouge">住所から緯度・経度を取得する場合</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="nv">$ </span>ruby google_geocode.rb 松江市殿町１
住      所 : 日本, 島根県松江市殿町１
緯度・経度 : 35.472248, 133.0508302
</pre></td></tr></tbody></table></code></pre></figure>

<p>上記の住所は島根県庁の住所。</p>

<p>File: <code class="language-plaintext highlighter-rouge">緯度・経度から住所を取得する場合</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="nv">$ </span>ruby google_geocode.rb 35.472222 133.050556
緯度・経度 : 35.472222, 133.050556
住      所 : 日本, 島根県松江市殿町１
</pre></td></tr></tbody></table></code></pre></figure>

<p>上記の緯度・経度は国土地理院登録の島根県庁の緯度・経度で、「度」＋「分」÷60＋「秒」÷60÷60で「度」に変換。</p>

<h4 id="3-注意">3. 注意</h4>

<p>紹介したスクリプトでは、住所、緯度・経度取得後に既定のブラウザで該当の地点の地図を表示するようにしている。<br />
理由は、”Google Geocoding API” の「使用制限」内に記述されている。</p>

<p>以下、「<a href="https://developers.google.com/maps/documentation/geocoding/policies?hl=ja" title="ポリシー - Google Maps Geocoding API - Google Developers">ポリシー - Google Maps Geocoding API - Google Developers</a>」より引用。</p>
<blockquote>
  <p><strong>マップを表示する<br />
Google Maps Geocoding API は、Google マップに結果を表示するときにのみ併用されます。Google マップを表示せずに Google Maps Geocoding API のデータを使用することは禁止されています。</strong></p>
</blockquote>

<p>紹介したスクリプト内でブラウザを開く部分で <code class="language-plaintext highlighter-rouge">xdg-open</code> コマンドを使用しているが、これは Linux の場合である。<br />
Linux 以外の場合、環境にあったコマンドを使用すること。（一部の環境については、スクリプト内のコメントでも紹介している）</p>

<h4 id="参考サイト">参考サイト</h4>

<p>上記では、基本的な使い方しか使用していないが、オプション設定や返却値やステータス等の詳細は、以下のサイトを参照。</p>

<ul>
  <li><a href="https://developers.google.com/maps/documentation/geocoding/start?hl=ja" title="スタートガイド - Google Maps Geocoding API - Google Developers">スタートガイド - Google Maps Geocoding API - Google Developers</a></li>
</ul>

<hr />

<p>今回は、「住所から緯度・経度を取得する処理」と「緯度・経度から住所を取得処理」を１本にまとめたり、コマンドライン引数を指定したりしています。<br />
しかし、当然、用途が限定的なら記法を絞って簡素化しても良いでしょう。</p>

<p>当方、今回の “Google Geocoding API” とは別に、 “Google Maps JavaScript API v3” を使った Web アプリも作ってみたいと思っています。（近いうちに）</p>

<p>以上。</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/google" class="page__taxonomy-item" rel="tag">Google</a><span class="sep">, </span>
    
      
      
      <a href="/tags/ruby" class="page__taxonomy-item" rel="tag">Ruby</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0" class="page__taxonomy-item" rel="tag">プログラミング</a>
    
    </span>
  </p>


        
          
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2013-07-02T00:20:00+09:00">2013-07-02 00:20</time></p>
        
        <br />
      </footer>
      <div id="google-ad-3"></div>
      <br />
      <br />
      <br />
      <br />

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=rsm_mzk&text=Ruby+-+Google+Geocoding+API+%E3%81%A7%E4%BD%8F%E6%89%80%E3%81%8B%E3%82%89%E7%B7%AF%E5%BA%A6%E3%83%BB%E7%B5%8C%E5%BA%A6%E3%80%81%E7%B7%AF%E5%BA%A6%E3%83%BB%E7%B5%8C%E5%BA%A6%E3%81%8B%E3%82%89%E4%BD%8F%E6%89%80%E3%82%92%E5%8F%96%E5%BE%97%EF%BC%81%20https%3A%2F%2Fkomasaru.github.io%2F2013%2F07%2F02%2Fruby-google-geocoding-api%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkomasaru.github.io%2F2013%2F07%2F02%2Fruby-google-geocoding-api%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  

  <a href="https://www.tumblr.com/share" class="btn btn--tumblr" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Tumblr"><i class="fab fa-fw fa-tumblr" aria-hidden="true"></i><span> Tumblr</span></a><script id="tumblr-js" async src="https://assets.tumblr.com/share-button.js"></script>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fkomasaru.github.io%2F2013%2F07%2F02%2Fruby-google-geocoding-api%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      <section>
        &nbsp;
        <h4>Sponsored Link</h4>
        <div id="rakuten-ad"></div>
        <div id="amazon-ad-1"></div>
      </section>
      &nbsp;
      
  <nav class="pagination">
    
      <a href="/2013/07/01/blog-access/" class="pagination--pager" title="2013年6月 - OS・ブラウザ別アクセス状況！【自動集計】
">Previous</a>
    
    
      <a href="/2013/07/04/ruby-github-api-octokit/" class="pagination--pager" title="Ruby - GitHub API ラッパー Octokit 使用！
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <div id="google-ad-4"></div>
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2025/10/30/debian-13-installation-for-small-server/" rel="permalink">Debian 13 (trixie) - インストール（サーバ用途・最小構成）！
</a>
        &nbsp;<small>(2025-10-30)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 13 (trixie) をサーバ用途・最小構成でインストールする方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてください）

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2024/05/18/debian-12-ruby-3-3-installation-by-src/" rel="permalink">Debian 12 (bookworm) - Ruby 3.3 インストール（ソースビルド）！
</a>
        &nbsp;<small>(2024-05-18)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 12 (bookworm) に Ruby 3.3 をソースをビルドしてインストール方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてください）

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2024/05/01/blog-access/" rel="permalink">2024年4月 - OS・ブラウザ別アクセス状況！
</a>
        &nbsp;<small>(2024-05-01)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">5月になりましたので、先月4月分の当ブログアクセス状況を公開します。（※自分用の記録）

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2024/04/30/blog-access/" rel="permalink">2024年3月 - OS・ブラウザ別アクセス状況！
</a>
        &nbsp;<small>(2024-04-30)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">4月になりましたので、先月3月分の当ブログアクセス状況を公開します。（※自分用の記録）

</p>
  </article>
</div>

        
      </div>
      <!-- &nbsp;
      <div id="amazon-wd"></div -->
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <input type="text" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    </form>
    <div id="results" class="results">
        <gcse:searchresults-only></gcse:searchresults-only>    
    </div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<div id="qr"><img src="/assets/images/qr.png" alt="mk-mode BLOG"></div>
<div id="google-ad-5"></div>
<div class="page__footer-etc">
  <strong>ブログ開設日</strong> <tt>2009-01-05</tt><br />
  <strong>サーバ連続稼働時間</strong> <tt id="uptime">Loading...</tt><br />
  <strong>Page View</strong><br />
  &emsp;合計 <tt id="pv-total">Loading...</tt><br />
  &emsp;今日 <tt id="pv-today">Loading...</tt><br />
  &emsp;昨日 <tt id="pv-yesterday">Loading...</tt><br />
  <small>※<a href="/privacy.html" title="「プライバシーポリシー」ページへ">プライバシーポリシー</a></small>
</div>
<p id="page-top">
  <a href="#">
    <i class="fa fa-angle-double-up fa-2x" aria-hidden="true"></i>
  </a>
</p>
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    <li><a href="https://www.mk-mode.com/blog/atom.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 mk-mode.com. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script defer src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>
  <script defer src="/assets/js/my_custom.js"></script>


<script>
  (function () {
    var cx = 'partner-pub-7320193476057758:6328726109';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
</script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





    
  <script>
    var disqus_config = function () {
      this.page.url = "https://komasaru.github.io/2013/07/02/ruby-google-geocoding-api/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2013/07/02/ruby-google-geocoding-api"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://mkmodeblog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>
