<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ja" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Ruby - Nokogiri による XML 解析の速度検証！ - mk-mode BLOG</title>
<meta name="description" content="Ruby で HTML/XML パーサの Nokogiri を使用して XML を解析する際、名前空間(Namespace)が宣言されている場合は厳密に指定する必要があるものだと考えております。しかし、実際は名前空間を指定せずに解析することも可能です。（実際、 XML 内の名前空間を削除するメソッドも用意されています。しかし、そのメソッドは名前空間について理解していない人のためのものであり、一般的には使用すべきではありません）今回は、各種方法で解析し、どの方法が高速であるかを検証してみました。">



<meta property="og:type" content="article">
<meta property="og:locale" content="ja_JP">
<meta property="og:site_name" content="mk-mode BLOG">
<meta property="og:title" content="Ruby - Nokogiri による XML 解析の速度検証！">
<meta property="og:url" content="https://komasaru.github.io/2015/09/22/ruby-verify-xml-parsing-by-nokogiri/">


  <meta property="og:description" content="Ruby で HTML/XML パーサの Nokogiri を使用して XML を解析する際、名前空間(Namespace)が宣言されている場合は厳密に指定する必要があるものだと考えております。しかし、実際は名前空間を指定せずに解析することも可能です。（実際、 XML 内の名前空間を削除するメソッドも用意されています。しかし、そのメソッドは名前空間について理解していない人のためのものであり、一般的には使用すべきではありません）今回は、各種方法で解析し、どの方法が高速であるかを検証してみました。">



  <meta property="og:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">



  <meta name="twitter:site" content="@rsm_mzk">
  <meta name="twitter:title" content="Ruby - Nokogiri による XML 解析の速度検証！">
  <meta name="twitter:description" content="Ruby で HTML/XML パーサの Nokogiri を使用して XML を解析する際、名前空間(Namespace)が宣言されている場合は厳密に指定する必要があるものだと考えております。しかし、実際は名前空間を指定せずに解析することも可能です。（実際、 XML 内の名前空間を削除するメソッドも用意されています。しかし、そのメソッドは名前空間について理解していない人のためのものであり、一般的には使用すべきではありません）今回は、各種方法で解析し、どの方法が高速であるかを検証してみました。">
  <meta name="twitter:url" content="https://komasaru.github.io/2015/09/22/ruby-verify-xml-parsing-by-nokogiri/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">
    
  

  



  <meta property="article:published_time" content="2015-09-22T00:20:00+09:00">





  

  


<link rel="canonical" href="https://komasaru.github.io/2015/09/22/ruby-verify-xml-parsing-by-nokogiri/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://komasaru.github.io",
      "logo": "https://www.mk-mode.com/blog/assets/images/about_me.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "mk-mode.com",
      "url": "https://komasaru.github.io",
      "sameAs": null
    }
  </script>



  <meta name="google-site-verification" content="0kSwKhNo71fC7OeEFLllD3S11F8Pa-z_OqsBTSFxXAk" />





<!-- end _includes/seo.html -->


<link href="https://www.mk-mode.com/blog/atom.xml" type="application/atom+xml" rel="alternate" title="mk-mode BLOG Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    
    <script defer src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <!-- start custom head snippets -->

<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com" />
<link rel="dns-prefetch" href="//googleads.g.doubleclick.net" />
<link rel="dns-prefetch" href="//tpc.googlesyndication.com" />
<link rel="dns-prefetch" href="//cm.g.doubleclick.net" />
<link rel="dns-prefetch" href="//www.gstatic.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />
<link rel='dns-prefetch' href='//use.fontawesome.com' />
<link rel="dns-prefetch" href="//twitter.com" />
<link rel="dns-prefetch" href="//www.facebook.com" />

<link rel="icon" href="/assets/images/favicon.ico">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-7320193476057758",
      enable_page_level_ads: true
    });
  </script>


<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">mk-mode BLOG</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/" >Archives</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/calendar/calendar" >Calendar</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/jmaxml" >JMAXML</a>
            </li><li class="masthead__menu-item">
              <a href="/privacy.html" >Privacy Policy</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/about_me.png" alt="mk-mode.com" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">mk-mode.com</h3>
    
    
      <p class="author__bio" itemprop="description">
        Linux, Debian, IT, Server, PG, Ruby, Rails, Python, C++, Fortran, PC, MariaDB, math, GIS, etc...
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Ruby City MATSUE</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://www.mk-mode.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode SITE</a></li>
          
        
          
            <li><a href="https://www.mk-mode.com/blog" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode BLOG (original)</a></li>
          
        
          
            <li><a href="https://mk-mode.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode TUMBLR</a></li>
          
        
          
            <li><a href="https://mk-ephemeris.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode EPHEMERIS</a></li>
          
        
          
            <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
        
          
            <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Ruby - Nokogiri による XML 解析の速度検証！">
    <meta itemprop="description" content="Ruby で HTML/XML パーサの Nokogiri を使用して XML を解析する際、名前空間(Namespace)が宣言されている場合は厳密に指定する必要があるものだと考えております。しかし、実際は名前空間を指定せずに解析することも可能です。（実際、 XML 内の名前空間を削除するメソッドも用意されています。しかし、そのメソッドは名前空間について理解していない人のためのものであり、一般的には使用すべきではありません）今回は、各種方法で解析し、どの方法が高速であるかを検証してみました。">
    <meta itemprop="datePublished" content="September 22, 2015">
    

    <div class="page__inner-wrap">
      
        <header>
          <!-- div id="google-ad-1"></div -->
          <h1 id="page-title" class="page__title" itemprop="headline">Ruby - Nokogiri による XML 解析の速度検証！
</h1>
          
          
            
            <p class="page__date"><small><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2015-09-22T00:20:00+09:00">2015-09-22 00:20</time></small></p>
          
        </header>
      
      <div id="google-ad-2"></div>
      <br />

      <section class="page__content" itemprop="text">
        
        <p>Ruby で HTML/XML パーサの Nokogiri を使用して XML を解析する際、名前空間(Namespace)が宣言されている場合は厳密に指定する必要があるものだと考えております。</p>

<p>しかし、実際は名前空間を指定せずに解析することも可能です。<br />
（実際、 XML 内の名前空間を削除するメソッドも用意されています。しかし、そのメソッドは名前空間について理解していない人のためのものであり、一般的には使用すべきではありません）</p>

<p>今回は、各種方法で解析し、どの方法が高速であるかを検証してみました。</p>

<!--more-->

<h3 id="0-前提条件">0. 前提条件</h3>

<ul>
  <li>Ruby 2.2.3-p173 での作業を想定。</li>
  <li>以下で紹介する検証結果は、使用する XML の構造等により若干異なることもあるかもしれない、ということに留意。</li>
</ul>

<h3 id="1-検証に使用する-xml-ファイル">1. 検証に使用する XML ファイル</h3>

<p>以下のような XML を使用する。（実際の「気象庁防災情報 XML」通知用 Atom フィードを流用。情報の内容は24時間以内に <code class="language-plaintext highlighter-rouge">link</code> タグ内の URL にアクセスして得ることになっている）</p>

<p>File: <code class="language-plaintext highlighter-rouge">test_nokogiri.xml</code></p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="code"><pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;feed</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/2005/Atom"</span> <span class="na">xml:lang=</span><span class="s">"ja"</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>JMAXML publishing feed<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;subtitle&gt;</span>this feed is published by JMA<span class="nt">&lt;/subtitle&gt;</span>
<span class="nt">&lt;updated&gt;</span>2015-08-27T17:28:02+09:00<span class="nt">&lt;/updated&gt;</span>
<span class="nt">&lt;id&gt;</span>urn:uuid:d38e0e80-12ba-3236-b10f-256b78a08995<span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"http://www.jma.go.jp/"</span> <span class="na">rel=</span><span class="s">"related"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"http://xml.kishou.go.jp/feed/other.xml"</span> <span class="na">rel=</span><span class="s">"self"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;rights&gt;</span>Published by Japan Meteorological Agency<span class="nt">&lt;/rights&gt;</span>

<span class="nt">&lt;entry&gt;</span>
<span class="nt">&lt;title&gt;</span>地方海上警報<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;id&gt;</span>urn:uuid:ac97395c-e388-33a9-922f-ab2a32e61bb1<span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;updated&gt;</span>2015-08-27T08:27:18Z<span class="nt">&lt;/updated&gt;</span>
<span class="nt">&lt;author&gt;&lt;name&gt;</span>新潟地方気象台<span class="nt">&lt;/name&gt;&lt;/author&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"http://xml.kishou.go.jp/data/ac97395c-e388-33a9-922f-ab2a32e61bb1.xml"</span> <span class="na">type=</span><span class="s">"application/xml"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;content</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>【新潟海上気象】<span class="nt">&lt;/content&gt;</span>
<span class="nt">&lt;/entry&gt;</span>
<span class="nt">&lt;entry&gt;</span>
<span class="nt">&lt;title&gt;</span>地方海上警報<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;id&gt;</span>urn:uuid:b42a06f2-a6f0-351a-a8c4-3619a847f66d<span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;updated&gt;</span>2015-08-27T08:27:02Z<span class="nt">&lt;/updated&gt;</span>
<span class="nt">&lt;author&gt;&lt;name&gt;</span>仙台管区気象台<span class="nt">&lt;/name&gt;&lt;/author&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"http://xml.kishou.go.jp/data/b42a06f2-a6f0-351a-a8c4-3619a847f66d.xml"</span> <span class="na">type=</span><span class="s">"application/xml"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;content</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>【仙台海上気象】<span class="nt">&lt;/content&gt;</span>
<span class="nt">&lt;/entry&gt;</span>
<span class="nt">&lt;entry&gt;</span>
<span class="nt">&lt;title&gt;</span>紫外線観測データ<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;id&gt;</span>urn:uuid:f27e93c8-ff97-376d-b3b0-5307d07e4a24<span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;updated&gt;</span>2015-08-27T08:27:10Z<span class="nt">&lt;/updated&gt;</span>
<span class="nt">&lt;author&gt;&lt;name&gt;</span>気象庁地球環境・海洋部<span class="nt">&lt;/name&gt;&lt;/author&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"http://xml.kishou.go.jp/data/f27e93c8-ff97-376d-b3b0-5307d07e4a24.xml"</span> <span class="na">type=</span><span class="s">"application/xml"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;content</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>【紫外線観測データ】<span class="nt">&lt;/content&gt;</span>
<span class="nt">&lt;/entry&gt;</span>
<span class="nt">&lt;/feed&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="2-検証用-ruby-スクリプトの作成">2. 検証用 Ruby スクリプトの作成</h3>

<ul>
  <li>以下のスクリプト内で指定する名前空間は、 “text_nokogiri.xml” 内で宣言されているものと同じ。</li>
  <li><code class="language-plaintext highlighter-rouge">entry</code> ノードをループし、各 <code class="language-plaintext highlighter-rouge">title</code> ノードのテキストを取得するだけの簡単な処理を 10,000 回繰り返す。</li>
  <li>今回は７種類（スクリプト内コメント参照）の解析方法で検証する。</li>
  <li>以下のスクリプト内の XPath での「Namespace 指定なし」とは、 Nokogiri での厳密な指定をしないという意味。</li>
</ul>

<p>File: <code class="language-plaintext highlighter-rouge">test_nokogiri_xml.rb</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
</pre></td><td class="code"><pre><span class="c1">#! /usr/local/bin/ruby</span>
<span class="c1"># coding: utf-8</span>
<span class="c1">#</span>
<span class="c1"># Ruby script to verify the speed of xml parsing by Nokogiri.</span>
<span class="c1">#</span>
<span class="c1">#++</span>
<span class="nb">require</span> <span class="s1">'benchmark'</span>
<span class="nb">require</span> <span class="s1">'nokogiri'</span>

<span class="k">class</span> <span class="nc">TestNokogiriXml</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@xml</span>  <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"test_nokogiri.xml"</span><span class="p">))</span>
    <span class="vi">@secs</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="vi">@ns</span>   <span class="o">=</span> <span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"http://www.w3.org/2005/Atom"</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">exec</span>
    <span class="c1"># 1. css メソッド(CSS セレクタ)による解析</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"CASE-1: %.4f secs.</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">case_1</span><span class="p">)</span>

    <span class="c1"># 2. search メソッド(CSS セレクタ)による解析</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"CASE-2: %.4f secs.</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">case_2</span><span class="p">)</span>

    <span class="c1"># 3. search メソッド(XPath, Namespace 指定なし)による解析</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"CASE-3: %.4f secs.</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">case_3</span><span class="p">)</span>

    <span class="c1"># 4. / メソッド(CSS セレクタ)による解析</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"CASE-4: %.4f secs.</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">case_4</span><span class="p">)</span>

    <span class="c1"># 5. / メソッド(XPath, Namespace 指定なし)による解析</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"CASE-5: %.4f secs.</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">case_5</span><span class="p">)</span>

    <span class="c1"># 6. xpath メソッド(XPath, Namespace 指定なし)による解析</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"CASE-6: %.4f secs.</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">case_6</span><span class="p">)</span>

    <span class="c1"># 7. xpath メソッド(XPath, Namespace 指定あり)による解析</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"CASE-7: %.4f secs.</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">case_7</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="vg">$stderr</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"[</span><span class="si">#{</span><span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">__method__</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">e</span><span class="p">.</span><span class="nf">backtrace</span><span class="p">.</span><span class="nf">each</span><span class="p">{</span> <span class="o">|</span><span class="n">tr</span><span class="o">|</span> <span class="vg">$stderr</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"</span><span class="se">\t</span><span class="si">#{</span><span class="n">tr</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
    <span class="nb">exit</span> <span class="mi">1</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">case_1</span>
    <span class="k">return</span> <span class="no">Benchmark</span><span class="p">.</span><span class="nf">realtime</span> <span class="k">do</span>
      <span class="vi">@secs</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
        <span class="vi">@xml</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="s2">"entry"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="s2">"title"</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">text</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">case_2</span>
    <span class="k">return</span> <span class="no">Benchmark</span><span class="p">.</span><span class="nf">realtime</span> <span class="k">do</span>
      <span class="vi">@secs</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
        <span class="vi">@xml</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="s2">"entry"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="s2">"title"</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">text</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">case_3</span>
    <span class="k">return</span> <span class="no">Benchmark</span><span class="p">.</span><span class="nf">realtime</span> <span class="k">do</span>
      <span class="vi">@secs</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
        <span class="vi">@xml</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="s2">"//xmlns:entry"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="s2">"./xmlns:title"</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">text</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">case_4</span>
    <span class="k">return</span> <span class="no">Benchmark</span><span class="p">.</span><span class="nf">realtime</span> <span class="k">do</span>
      <span class="vi">@secs</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
        <span class="p">(</span><span class="vi">@xml</span><span class="o">/</span><span class="s2">"entry"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
          <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">/</span><span class="s2">"title"</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">text</span>
        <span class="k">end</span>
        <span class="c1"># 以下でも同様。しかし、ごく少し遅い。</span>
        <span class="c1">#(@xml/:entry).each do |e|</span>
        <span class="c1">#  title = (e/:title).first.text</span>
        <span class="c1">#end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">case_5</span>
    <span class="k">return</span> <span class="no">Benchmark</span><span class="p">.</span><span class="nf">realtime</span> <span class="k">do</span>
      <span class="vi">@secs</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
        <span class="p">(</span><span class="vi">@xml</span><span class="o">/</span><span class="s2">"//xmlns:entry"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
          <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">/</span><span class="s2">"./xmlns:title"</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">text</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">case_6</span>
    <span class="k">return</span> <span class="no">Benchmark</span><span class="p">.</span><span class="nf">realtime</span> <span class="k">do</span>
      <span class="vi">@secs</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
        <span class="vi">@xml</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s2">"//xmlns:entry"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s2">"xmlns:title"</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">text</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">case_7</span>
    <span class="k">return</span> <span class="no">Benchmark</span><span class="p">.</span><span class="nf">realtime</span> <span class="k">do</span>
      <span class="vi">@secs</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
        <span class="vi">@xml</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s2">"//a:entry"</span><span class="p">,</span> <span class="vi">@ns</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s2">"a:title"</span><span class="p">,</span> <span class="vi">@ns</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">text</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">TestNokogiriXml</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">exec</span>
</pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li><a href="https://gist.github.com/komasaru/1f737b67baba38213570" title="Gist - Ruby script to verify the speed of xml parsing by Nokogiri. ">Gist - Ruby script to verify the speed of xml parsing by Nokogiri. </a></li>
</ul>

<h3 id="3-ruby-スクリプトの実行">3. Ruby スクリプトの実行</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./test.rb
CASE-1: 2.3432 secs.
CASE-2: 2.4821 secs.
CASE-3: 2.0588 secs.
CASE-4: 2.4949 secs.
CASE-5: 2.0672 secs.
CASE-6: 1.7549 secs.
CASE-7: 1.5359 secs.
</code></pre></div></div>

<h3 id="4-検証結果について">4. 検証結果について</h3>

<ul>
  <li>何回か実行してみたが、全て同じような結果となった。</li>
  <li><code class="language-plaintext highlighter-rouge">xpath</code> メソッドは <code class="language-plaintext highlighter-rouge">css</code>, <code class="language-plaintext highlighter-rouge">search</code>, <code class="language-plaintext highlighter-rouge">/</code> メソッドより高速に解析することができる。</li>
  <li><code class="language-plaintext highlighter-rouge">xpath</code> メソッドで厳密に名前空間を指定した方が、指定せずに解析するより高速である。</li>
  <li>要は、XML を解析する際は <code class="language-plaintext highlighter-rouge">xpath</code> メソッドで名前空間を指定しましょう、ということ。</li>
  <li>今回の検証結果が全てという訳ではない（場合によっては「一概には言えない」ということがあるかもしれない）</li>
</ul>

<hr />

<p>当方、以前は CSS セレクタを使用して XML 解析を行なっていた時期もありましたが、現在は XPath で厳密に名前空間を指定して解析を行うようにしています。</p>

<p>以上。</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/ruby" class="page__taxonomy-item" rel="tag">Ruby</a><span class="sep">, </span>
    
      
      
      <a href="/tags/xml" class="page__taxonomy-item" rel="tag">XML</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0" class="page__taxonomy-item" rel="tag">プログラミング</a>
    
    </span>
  </p>


        
          
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2015-09-22T00:20:00+09:00">2015-09-22 00:20</time></p>
        
        <br />
      </footer>
      <div id="google-ad-3"></div>
      <br />
      <br />
      <br />
      <br />

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=rsm_mzk&text=Ruby+-+Nokogiri+%E3%81%AB%E3%82%88%E3%82%8B+XML+%E8%A7%A3%E6%9E%90%E3%81%AE%E9%80%9F%E5%BA%A6%E6%A4%9C%E8%A8%BC%EF%BC%81%20https%3A%2F%2Fkomasaru.github.io%2F2015%2F09%2F22%2Fruby-verify-xml-parsing-by-nokogiri%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkomasaru.github.io%2F2015%2F09%2F22%2Fruby-verify-xml-parsing-by-nokogiri%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  

  <a href="https://www.tumblr.com/share" class="btn btn--tumblr" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Tumblr"><i class="fab fa-fw fa-tumblr" aria-hidden="true"></i><span> Tumblr</span></a><script id="tumblr-js" async src="https://assets.tumblr.com/share-button.js"></script>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fkomasaru.github.io%2F2015%2F09%2F22%2Fruby-verify-xml-parsing-by-nokogiri%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      <section>
        &nbsp;
        <h4>Sponsored Link</h4>
        <div id="rakuten-ad"></div>
        <div id="amazon-ad-1"></div>
      </section>
      &nbsp;
      
  <nav class="pagination">
    
      <a href="/2015/09/17/postfix-management-of-mail-queue/" class="pagination--pager" title="Postfix - メールキューの管理！
">Previous</a>
    
    
      <a href="/2015/10/01/blog-access/" class="pagination--pager" title="2015年9月 - OS・ブラウザ別アクセス状況！【自動集計】
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <div id="google-ad-4"></div>
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/05/11/ruby-simultaneous-equation-by-gauss-elimination-pivot/" rel="permalink">Ruby - 連立方程式解法（ガウスの消去法（ピボット選択））！
</a>
        &nbsp;<small>(2022-05-11)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">かつて、連立方程式を「ガウスの消去法」で解くアルゴリズムを Ruby で実装したことを紹介しました。


  Ruby - 連立方程式解法（ガウスの消去法）！


しかし、計算途中で対角成分がゼロになるケースでは計算ができませんでした。

今回はその問題を解決すべく、「ガウスの消去法（ピボット選択）」で解くアルゴ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/05/04/debian-11-gcc-installation/" rel="permalink">Debian 11 (bullseye) - GCC 11.2 インストール（ソースビルド）！
</a>
        &nbsp;<small>(2022-05-04)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 11 へ最新版 GCC をソースビルドでインストールする方法についての記録です。

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/05/01/blog-access/" rel="permalink">2022年4月 - OS・ブラウザ別アクセス状況！
</a>
        &nbsp;<small>(2022-05-01)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">5月になりましたので、先月4月分の当ブログアクセス状況を公開します。（※自分用の記録）

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/04/27/debian-11-gmt-installation/" rel="permalink">Debian 11 (bullseye) - 地図描画ツール GMT インストール！
</a>
        &nbsp;<small>(2022-04-27)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 11 (bullseye) に地図描画ツール GMT(Generic Mapping Tool) をインストールする方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、...</p>
  </article>
</div>

        
      </div>
      <!-- &nbsp;
      <div id="amazon-wd"></div -->
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <input type="text" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    </form>
    <div id="results" class="results">
        <gcse:searchresults-only></gcse:searchresults-only>    
    </div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<div id="qr"><img src="/assets/images/qr.png" alt="mk-mode BLOG"></div>
<div id="google-ad-5"></div>
<div class="page__footer-etc">
  <strong>ブログ開設日</strong> <tt>2009-01-05</tt><br />
  <strong>サーバ連続稼働時間</strong> <tt id="uptime">Loading...</tt><br />
  <strong>Page View</strong><br />
  &emsp;合計 <tt id="pv-total">Loading...</tt><br />
  &emsp;今日 <tt id="pv-today">Loading...</tt><br />
  &emsp;昨日 <tt id="pv-yesterday">Loading...</tt><br />
  <small>※<a href="/privacy.html" title="「プライバシーポリシー」ページへ">プライバシーポリシー</a></small>
</div>
<p id="page-top">
  <a href="#">
    <i class="fa fa-angle-double-up fa-2x" aria-hidden="true"></i>
  </a>
</p>
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    <li><a href="https://www.mk-mode.com/blog/atom.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 mk-mode.com. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script defer src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>
  <script defer src="/assets/js/my_custom.js"></script>


<script>
  (function () {
    var cx = 'partner-pub-7320193476057758:6328726109';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
</script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





    
  <script>
    var disqus_config = function () {
      this.page.url = "https://komasaru.github.io/2015/09/22/ruby-verify-xml-parsing-by-nokogiri/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2015/09/22/ruby-verify-xml-parsing-by-nokogiri"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://mkmodeblog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>
