<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.2">Jekyll</generator><link href="https://komasaru.github.io/atom.xml" rel="self" type="application/atom+xml" /><link href="https://komasaru.github.io/" rel="alternate" type="text/html" /><updated>2023-11-01T00:01:17+09:00</updated><id>https://komasaru.github.io/atom.xml</id><title type="html">mk-mode BLOG</title><subtitle>このブログは自宅サーバ(Debian GNU/Linux)で運用してしている&lt;a href=&quot;https://www.mk-mode.com/blog/&quot;&gt;ブログ&lt;/a&gt;のクローンです。&lt;br /&gt;PC・サーバ構築等の話題を中心に公開しております。</subtitle><author><name>mk-mode.com</name></author><entry><title type="html">2023年10月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2023/11/01/blog-access/" rel="alternate" type="text/html" title="2023年10月 - OS・ブラウザ別アクセス状況！" /><published>2023-11-01T00:00:00+09:00</published><updated>2023-11-01T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/11/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2023/11/01/blog-access/">&lt;p&gt;11月になりましたので、先月10月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,340&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;72.8792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,516&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16.1697&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;837&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.3792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;572&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.6761&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;158&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0154&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;132&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8483&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0257&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0064&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15,560&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,260&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;72.3650&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,516&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16.1697&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;837&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.3792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;572&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.6761&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;158&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0154&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;132&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8483&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;53&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3406&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;23&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1478&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0257&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;XP&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0193&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0064&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0064&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15,560&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12,896&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;82.8792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,350&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8.6761&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,179&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7.5771&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;131&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8419&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0193&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0064&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15,560&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5,213&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;33.5026&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,878&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24.9229&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,196&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20.5398&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;838&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.3856&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;659&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.2352&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;337&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.1658&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;307&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.9730&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;131&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8419&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;114.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;90&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5784&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;102.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;89&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5720&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;82&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5270&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;82&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5270&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;109.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;78&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5013&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;119.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;78&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5013&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;78.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;43&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2763&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;112.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;34&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2185&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0.5845.2271&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;29&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1864&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;50.0.2661.102&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1542&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;108.0.5359.128&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;21&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1350&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;111.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1221&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15,560&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">11月になりましたので、先月10月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 12 (bookworm) - POP/IMAP サーバ Dovecot 構築！</title><link href="https://komasaru.github.io/2023/10/25/debian-12-dovecot-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - POP/IMAP サーバ Dovecot 構築！" /><published>2023-10-25T00:00:00+09:00</published><updated>2023-10-25T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/10/25/debian-12-dovecot-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/10/25/debian-12-dovecot-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に POP/IMAP サーバ Dovecot を構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;接続可能なマシンのネットワークは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.0/24&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、サーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vbox&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-dovecot-のインストール&quot;&gt;1. Dovecot のインストール&lt;/h3&gt;

&lt;p&gt;POP/IMAP サーバ Dovecot を以下のようにしてインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install dovecot-common dovecot-pop3d dovecot-imapd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-設定ファイル-dovecotconf-の編集&quot;&gt;2. 設定ファイル dovecot.conf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dovecot/dovecot.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;listen &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= IPv6を使用しない場合&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-設定ファイル-10-authconf-の編集&quot;&gt;3. 設定ファイル 10-auth.conf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dovecot/conf.d/10-auth.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;disable_plaintext_auth &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; no    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= プレーンテキスト認証も許可&lt;/span&gt;

auth_mechanisms &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; plain login  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 認証時のパスフレーズ送信方式&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-設定ファイル-10-mailconf-の編集&quot;&gt;4. 設定ファイル 10-mail.conf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dovecot/conf.d/10-mail.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mail_location &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; maildir:~/Maildir  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= メールボックス形式をMaildir形式&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-設定ファイル-10-masterconf-の編集&quot;&gt;5. 設定ファイル 10-master.conf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dovecot/conf.d/10-master.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Postfix smtp-auth&lt;/span&gt;
unix_listener /var/spool/postfix/private/auth &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
    mode &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0666                                  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
    user &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; postfix                               &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加（ユーザ）&lt;/span&gt;
    group &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; postfix                              &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加（グループ）&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;                                                &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-dovecot-の再起動&quot;&gt;6. Dovecot の再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart dovecot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-ファイアウォールufwの設定&quot;&gt;7. ファイアウォール(ufw)の設定&lt;/h3&gt;

&lt;p&gt;実際に運用する場合は、TCPポート 110(POP3), 143(IMAP) を開放する必要がある。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 110,143/tcp
Rule added

# ufw status
    :
110,143/tcp                ALLOW       Anywhere
    :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-メールソフトの設定&quot;&gt;8. メールソフトの設定&lt;/h3&gt;

&lt;p&gt;Postfix, Dovecot 構築が完了すれば、メールソフトでメールの送受信が可能になる。&lt;br /&gt;
メールソフトでは以下のように設定すればよい。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;メールアドレス：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;アカウント名@メールホスト名&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;パスワード：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;アカウントのパスワード&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;受信メールサーバ：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;POP&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IMAP&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;受信メールサーバアドレス：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;メールホスト名&lt;/code&gt;（内部なら &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;サーバローカルIPアドレス&lt;/code&gt; でもよい）&lt;/li&gt;
  &lt;li&gt;受信メールサーバポート番号：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;110&lt;/code&gt;(POP) or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;143&lt;/code&gt;(IMAP)&lt;/li&gt;
  &lt;li&gt;ログオンユーザ：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;アカウント名&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;送信メールサーバアドレス：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;メールホスト名&lt;/code&gt;（内部なら &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;サーバローカルIPアドレス&lt;/code&gt; でもよい）&lt;/li&gt;
  &lt;li&gt;送信メールサーバポート番号：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;25&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;送信認証：「必要」&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Dovecot" /><summary type="html">Debian GNU/Linux 12 (bookworm) に POP/IMAP サーバ Dovecot を構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - SMTP サーバ Postfix 受信拒否設定！</title><link href="https://komasaru.github.io/2023/10/18/debian-12-postfix-reject-reception/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - SMTP サーバ Postfix 受信拒否設定！" /><published>2023-10-18T00:00:00+09:00</published><updated>2023-10-18T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/10/18/debian-12-postfix-reject-reception</id><content type="html" xml:base="https://komasaru.github.io/2023/10/18/debian-12-postfix-reject-reception/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) 上の SMTP サーバ Postfix で受信を拒否する設定についての記録です。&lt;/p&gt;

&lt;p&gt;（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;SMTP サーバ Postfix を「&lt;a href=&quot;/2023/10/11/debian-12-postfix-installation&quot; title=&quot;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&quot;&gt;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&lt;/a&gt;」の方法で導入済み。&lt;/li&gt;
  &lt;li&gt;メールの header や body の内容をチェックしてフィルタリングする設定。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-設定ファイル-maincf-の編集&quot;&gt;1. 設定ファイル main.cf の編集&lt;/h3&gt;

&lt;p&gt;コメントアウトされていれば、アンコメントする。&lt;br /&gt;
行自体が存在しなければ、追加する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/main.cf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;header_checks &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; regexp:/etc/postfix/header_checks
body_checks   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; regexp:/etc/postfix/body_checks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-header-のフィルタリング設定&quot;&gt;2. header のフィルタリング設定&lt;/h3&gt;

&lt;p&gt;以下は header の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Received&lt;/code&gt; に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aznavrchol.cz&lt;/code&gt; があれば、そのメールを受信拒否してエラーにする例。&lt;br /&gt;
（受信拒否でなく、受信して破棄したければ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISCARD&lt;/code&gt; にする）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/header_checks&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/^Received:.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;aznavrchol&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;cz/ REJECT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Received&lt;/code&gt; の他に、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Subject&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;From&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-Mailer-Agent&lt;/code&gt; 等、 &lt;strong&gt;正規表現&lt;/strong&gt; を使用して設定可能。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-body-のフィルタリング設定&quot;&gt;3. body のフィルタリング設定&lt;/h3&gt;

&lt;p&gt;以下は body の内容に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Bitcoin&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bitcoin&lt;/code&gt; があれば、そのメールを受信拒否してエラーにする例。&lt;br /&gt;
※以下、実際の設定内容。(230926 現在)&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/body_checks&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Bb]itcoin.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/ REJECT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;（受信拒否でなく、受信して破棄したければ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISCARD&lt;/code&gt; にする）&lt;/p&gt;

&lt;p&gt;※上記の設定で、メール本文に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Bitcoin&lt;/code&gt; や &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bitcoin&lt;/code&gt; がある場合に廃棄するようになるが、この場合、メールログ解析（後日紹介予定の pflogsumm ）の結果メールも廃棄してしまうので、注意。&lt;/p&gt;

&lt;h3 id=&quot;4-設定のリロード&quot;&gt;4. 設定のリロード&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# postmap /etc/postfix/header_checks
# postmap /etc/postfix/body_checks
# systemctl reload postfix
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;これで、 Postfix のみで基本的な header, body のフィルタリングが可能になる。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Postfix" /><summary type="html">Debian GNU/Linux 12 (bookworm) 上の SMTP サーバ Postfix で受信を拒否する設定についての記録です。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - SMTP サーバ Postfix 構築！</title><link href="https://komasaru.github.io/2023/10/11/debian-12-postfix-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - SMTP サーバ Postfix 構築！" /><published>2023-10-11T00:00:00+09:00</published><updated>2023-10-11T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/10/11/debian-12-postfix-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/10/11/debian-12-postfix-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に SMTP サーバ Postfix を構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;接続可能なマシンのネットワークは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.0/24&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、サーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mail&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-postfix-のインストール&quot;&gt;1. Postfix のインストール&lt;/h3&gt;

&lt;p&gt;SMTP サーバ Postfix を以下のようにしてインストールする。&lt;br /&gt;
途中でどの設定を選択するか確認されるが、後で設定を行うので「設定なし」(No Configuration)を選択する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install postfix sasl2-bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-設定ファイルの編集&quot;&gt;2. 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;設定ファイル雛形から &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main.cf&lt;/code&gt; を複製後、編集する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cp /usr/share/postfix/main.cf.dist /etc/postfix/main.cf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;もしくは、以下のようにしてもよい。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main.cf.dist&lt;/code&gt; と &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main.cf.proto&lt;/code&gt; は内容が同じようなので）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cp /etc/postfix/main.cf{.proto,}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/main.cf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mail_owner &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; postfix                   &lt;span class=&quot;c&quot;&gt;# &amp;lt;= メール所有者&lt;/span&gt;

myhostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mail.mk-mode.com          &lt;span class=&quot;c&quot;&gt;# &amp;lt;= ホスト名&lt;/span&gt;

mydomain &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mk-mode.com                 &lt;span class=&quot;c&quot;&gt;# &amp;lt;= ドメイン名&lt;/span&gt;

myorigin &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$mydomain&lt;/span&gt;                   &lt;span class=&quot;c&quot;&gt;# &amp;lt;= ローカルからのメール送信時の送信元メールアドレス@以降にドメイン名を付加&lt;/span&gt;

inet_interfaces &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; all                  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 外部からのメール受信を許可&lt;/span&gt;

mydestination &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$myhostname&lt;/span&gt;, localhost.&lt;span class=&quot;nv&quot;&gt;$mydomain&lt;/span&gt;, localhost, &lt;span class=&quot;nv&quot;&gt;$mydomain&lt;/span&gt;, mail.&lt;span class=&quot;nv&quot;&gt;$mydomain&lt;/span&gt;, vbox.&lt;span class=&quot;nv&quot;&gt;$mydomain&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 自ドメイン宛メールを受信できるようにする&lt;/span&gt;

local_recipient_maps &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; unix:passwd.byname &lt;span class=&quot;nv&quot;&gt;$alias_maps&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= サーバにアカウントがあれば、その人宛に届く&lt;/span&gt;

mynetworks &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 127.0.0.0/8               &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 自ネットワーク&lt;/span&gt;

alias_maps &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt;:/etc/aliases         &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 受信メールの再転送先ファイル&lt;/span&gt;

alias_database &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt;:/etc/aliases     &lt;span class=&quot;c&quot;&gt;# &amp;lt;= newaliasesコマンドの実行対象&lt;/span&gt;

home_mailbox &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Maildir/                &lt;span class=&quot;c&quot;&gt;# &amp;lt;= メールボックス形式を Maildir 形式に&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#smtpd_banner = $myhostname ESMTP $mail_name (Debian/GNU)&lt;/span&gt;
smtpd_banner &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$myhostname&lt;/span&gt; ESMTP       &lt;span class=&quot;c&quot;&gt;# &amp;lt;= メールサーバーソフト名の隠蔽化&lt;/span&gt;

sendmail_path &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /usr/sbin/postfix      &lt;span class=&quot;c&quot;&gt;# &amp;lt;= Postfix sendmail コマンドの場所&lt;/span&gt;

newaliases_path &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /usr/bin/newaliases  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= Postfix newaliases コマンドの場所&lt;/span&gt;

mailq_path &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /usr/bin/mailq            &lt;span class=&quot;c&quot;&gt;# &amp;lt;= Postfix mailq コマンドの場所&lt;/span&gt;

setgid_group &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; postdrop                &lt;span class=&quot;c&quot;&gt;# &amp;lt;= set-gid Postfix コマンドおよびグループ書き込み可能な Postfix ディレクトリを所有するグループ&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#html_directory =                      # &amp;lt;= コメント化&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#manpage_directory =                   # &amp;lt;= コメント化&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#sample_directory =                    # &amp;lt;= コメント化&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#readme_directory =                    # &amp;lt;= コメント化&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# 最終行へ追加&lt;/span&gt;
message_size_limit &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 10485760          &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 送受信メールサイズを10Mに制限&lt;/span&gt;
mailbox_size_limit &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1073741824        &lt;span class=&quot;c&quot;&gt;# &amp;lt;= メールボックスサイズを1Gに制限&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# SMTP-Auth用&lt;/span&gt;
smtpd_sasl_type &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; dovecot
smtpd_sasl_path &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; private/auth
smtpd_sasl_auth_enable &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;yes
&lt;/span&gt;smtpd_sasl_security_options &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; noanonymous
smtpd_sasl_local_domain &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$myhostname&lt;/span&gt;
smtpd_client_restrictions &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; permit_mynetworks,reject_unknown_client,permit
smtpd_recipient_restrictions &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; permit_mynetworks,permit_auth_destination,permit_sasl_authenticated,reject

&lt;span class=&quot;c&quot;&gt;# 特定ドメイン／アドレス受信拒否（必要であれば）&lt;/span&gt;
smtpd_sender_restrictions &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; reject_unknown_sender_domain, reject_non_fqdn_sender, &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt;:/etc/postfix/reject_sender
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;3-1-上記で特定のドメインアドレスを受信拒否する設定にした場合&quot;&gt;3-1. 上記で特定のドメイン／アドレスを受信拒否する設定にした場合&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/reject_sender&lt;/code&gt; を作成して、設定したいドメイン／アドレスを記述する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/reject_sender&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;xxxxxxxxxx.xxx REJECT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;REJECT&lt;/code&gt;: 拒否をし、その旨のメッセージを返信する&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISCARD&lt;/code&gt;: 拒否をし、その旨のメッセージも返信しない&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;そして、ハッシュマップの生成。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# postmap /etc/postfix/reject_sender
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;最後に、 Postfix を再起動（or リロード）。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart postfix
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-saslauthd-の編集&quot;&gt;3. saslauthd の編集&lt;/h3&gt;

&lt;p&gt;マシン起動時に saslauthd を自動起動させるために “saslauthd” を編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/saslauthd&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;START&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;yes&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# 5行目辺りに追記&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;これをしないと saslauthd 起動時に以下のような警告が出力される。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;To enable saslauthd, edit /etc/default/saslauthd and set START=yes (warning).
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-saslauthd-の再起動&quot;&gt;4. saslauthd の再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart saslauthd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-postfix-の再起動&quot;&gt;5. Postfix の再起動&lt;/h3&gt;

&lt;p&gt;設定を反映させるためにエイリアスの変更を反映させ、 Postfix を再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# newaliases
# systemctl restart postfix
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-ファイアウォールufwの設定&quot;&gt;6. ファイアウォール(ufw)の設定&lt;/h3&gt;

&lt;p&gt;実際に運用する場合は、TCP ポート 25(SMTP) を開放する必要がある。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 25/tcp
Rule added

# ufw status
    :
25/tcp                     ALLOW       Anywhere
    :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-メールの転送設定&quot;&gt;7. メールの転送設定&lt;/h3&gt;

&lt;p&gt;root や postmaster 等宛に届いたメールを一般ユーザに転送するには &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/aliases&lt;/code&gt; を編集する。&lt;br /&gt;
以下は一例。（最近は最初から &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postomaster&lt;/code&gt; を &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; に、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; を一般ユーザに転送するようになっているかも知れない）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/aliases&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;postmaster: root
root:       masaru
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;この設定を有効にするために以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# newaliases                 # &amp;lt;= エイリアスの即時反映
# systemctl restart postfix  # &amp;lt;= Postfix の再起動
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/main.cf&lt;/code&gt; 内で説明されているとおり、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;newaliases&lt;/code&gt; の代わりに &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postalias /etc/aliases&lt;/code&gt; でもよい。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Postfix" /><summary type="html">Debian GNU/Linux 12 (bookworm) に SMTP サーバ Postfix を構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - Windows ファイルサーバ Samba 構築！</title><link href="https://komasaru.github.io/2023/10/04/debian-12-samba-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - Windows ファイルサーバ Samba 構築！" /><published>2023-10-04T00:00:00+09:00</published><updated>2023-10-04T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/10/04/debian-12-samba-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/10/04/debian-12-samba-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に Windows 用ファイルサーバ Samba を構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;接続可能なマシンのネットワークは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.0/24&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、サーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vbox&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;全ユーザ共有ディレクトリは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/share&lt;/code&gt; とする。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-samba-サーバのインストール&quot;&gt;1. Samba サーバのインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt install -y samba
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-共有ディレクトリの作成&quot;&gt;2. 共有ディレクトリの作成&lt;/h3&gt;

&lt;p&gt;全ユーザが共有でフルアクセス可能なディレクトリを作成する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir /home/share
# chown nobody:nogroup /home/share
# chmod 777 /home/share
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-設定ファイルの編集&quot;&gt;3. 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;次のように設定する。&lt;br /&gt;
※実際には、記述のある行の後ろにコメント（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#&lt;/code&gt; で始まる文字列）を入れないこと。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/samba/smb.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[global]
   unix charset = UTF-8            # &amp;lt;= 追加
   dos charset  = CP932            # &amp;lt;= 追加

   workgroup = WORKGROUP           # &amp;lt;= Windows のワークグループ名に合わせる

   interfaces = 127.0.0.0/8 192.168.11.0/24  # &amp;lt;= 接続許可するインターフェースを指定
   bind interfaces only = yes      # &amp;lt;= interfaces 項目に指定したホストだけに接続を限定する

   map to guest = bad user         # &amp;lt;= 未登録アカウントで接続された場合にゲストとして扱う

   load printers = no              # &amp;lt;= プリンタを使用していない場合
   disable spoolss = yes           # &amp;lt;= プリンタを使用していない場合

   printing = bsd                  # &amp;lt;= プリンタを使用していない場合

# 最終行に追加
[share]                            # &amp;lt;= 共有名
   path           = /home/share    # &amp;lt;= 共有ディレクトリ
   writable       = yes            # &amp;lt;= 書込可
   guest ok       = yes            # &amp;lt;= ゲストユーザー可
   guest only     = yes            # &amp;lt;= 全てゲストとして扱う
   create mode    = 0777           # &amp;lt;= ファイル作成はフル権限で
   directory mode = 0777           # &amp;lt;= ディレクトリ作成はフル権限で
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-samba-サーバの再起動&quot;&gt;4. Samba サーバの再起動&lt;/h3&gt;

&lt;p&gt;設定を反映させるため、Samba サーバを再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart smbd
# systemctl restart nmbd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-ファイアウォール設定&quot;&gt;5. ファイアウォール設定&lt;/h3&gt;

&lt;p&gt;ファイアウォールを設定している場合、Samba サーバが使用するポート（udp:137,138, tcp:139,445）を開放する必要がある。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 137,138/udp
Rule added

# ufw allow 139,445/tcp
Rule added

# ufw status
     :
     :
137,138/udp                ALLOW       Anywhere
139,445/tcp                ALLOW       Anywhere
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-動作確認&quot;&gt;6. 動作確認&lt;/h3&gt;

&lt;p&gt;クライアントマシンから Samba サーバの &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/share&lt;/code&gt; ディレクトリにアクセスし、ファイル操作が可能か確認する。&lt;/p&gt;

&lt;h3 id=&quot;7-アクセス権限付き設定&quot;&gt;7. アクセス権限付き設定&lt;/h3&gt;

&lt;p&gt;通常、中規模以下のネットワークでは上記のようなフルアクセスで問題ないが、大規模ネットワークやよりセキュアに構築したければ、アクセス権限を設定する。&lt;br /&gt;
以下、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hoge&lt;/code&gt; グループに属するユーザのみが、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/hoge&lt;/code&gt; ディレクトリにアクセスできるようにする設定例。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# groupadd hoge          # &amp;lt;= グループ追加
# mkdir /home/hoge       # &amp;lt;= 専用ディレクトリ作成
# chgrp hoge /home/hoge  # &amp;lt;= ディレクトリに所有グループ設定
# chmod 770 /home/hoge   # &amp;lt;= 専用ディレクトリに権限付与
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/samba/smb.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;security = user  # &amp;lt; = ユーザ認証モード

# 最終行に追加
[Hoge]
   path = /home/hoge
   writable = yes
   create mode = 0770
   directory mode = 0770
   share modes = yes
   guest ok = no        # &amp;lt; = ゲストユーザ不許可
   valid users = @hoge  # &amp;lt; = hoge グループのみ許可
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# smbpasswd -a fuga       # &amp;lt; = Samba アクセスユーザ追加登録
New SMB password:         # &amp;lt; = パスワード設定
Retype new SMB password:  # &amp;lt; = パスワード再入力
# usermod -G hoge fuga    # &amp;lt; = hoge グループに fuga ユーザ追加
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /etc/init.d/samba restart  # &amp;lt; = Samba 再起動
Stopping Samba daemons: nmbd smbd.
Starting Samba daemons: nmbd smbd.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Postfix" /><summary type="html">Debian GNU/Linux 12 (bookworm) に Windows 用ファイルサーバ Samba を構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">2023年9月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2023/10/01/blog-access/" rel="alternate" type="text/html" title="2023年9月 - OS・ブラウザ別アクセス状況！" /><published>2023-10-01T00:00:00+09:00</published><updated>2023-10-01T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/10/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2023/10/01/blog-access/">&lt;p&gt;10月になりましたので、先月9月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,776&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;70.3507&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18.1851&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;823&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.9167&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;713&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.2595&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;193&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.1530&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;178&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0634&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0538&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0060&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;69.8728&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18.1851&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;823&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.9167&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;713&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.2595&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;193&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.1530&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;178&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0634&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;59&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3525&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1075&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0538&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Vista&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0060&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0060&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13,737&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;82.0658&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,546&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9.2359&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,315&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7.8559&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;126&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7527&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0358&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla SeaMonkey&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0299&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Debian IceWeasel&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9,067&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;54.1669&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,920&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;17.4443&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;953&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.6933&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;908&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.4245&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;904&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.4006&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;405&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.4195&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;114.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;268&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.6011&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;102.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;228&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.3621&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;126&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7527&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;119&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7109&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;66&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3943&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;62&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3704&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;78.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;57&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3405&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;109.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;56&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3345&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;112.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;43&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2569&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;113.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2509&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;50.0.2661.102&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;27&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1613&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;113.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;25&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1494&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1195&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;110.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1195&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">10月になりましたので、先月9月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 12 (bookworm) - NFS サーバのポート固定！</title><link href="https://komasaru.github.io/2023/09/27/debian-12-nfs-port-fixing/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - NFS サーバのポート固定！" /><published>2023-09-27T00:00:00+09:00</published><updated>2023-09-27T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/09/27/debian-12-nfs-port-fixing</id><content type="html" xml:base="https://komasaru.github.io/2023/09/27/debian-12-nfs-port-fixing/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に NFS サーバで使用するポートを固定化する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;NFS サーバ構築済み。&lt;br /&gt;
（参照：「&lt;a href=&quot;/2023/09/20/debian-12-nfs-installation&quot; title=&quot;Debian 12 (bookworm) - NFS サーバ構築！&quot;&gt;Debian 12 (bookworm) - NFS サーバ構築！&lt;/a&gt;」）&lt;/li&gt;
  &lt;li&gt;以下で設定するポート番号は&lt;a href=&quot;https://wiki.debian.org/SecuringNFS&quot; title=&quot;SecuringNFS - Debian Wiki&quot;&gt;参考サイト&lt;/a&gt;によるもであり、任意に設定可能。&lt;/li&gt;
  &lt;li&gt;quota は使用していないので、&lt;a href=&quot;https://wiki.debian.org/SecuringNFS&quot; title=&quot;SecuringNFS - Debian Wiki&quot;&gt;参考サイト&lt;/a&gt;にある quota の設定はしない。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-前提知識&quot;&gt;1. 前提知識&lt;/h3&gt;

&lt;p&gt;NFS サーバが使用するポートは以下のとおり。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;portmapper =&amp;gt; TCP: 111, UDP: 111
nfs        =&amp;gt; TCP:2049, UDP:2049
statd      =&amp;gt; TCP:不定, UDP:不定
mountd     =&amp;gt; TCP:不定, UDP:不定
nlockmgrq  =&amp;gt; TCP:不定, UDP:不定
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-statd-用ポートの固定&quot;&gt;2. statd 用ポートの固定&lt;/h3&gt;

&lt;p&gt;statd のポートを固定するには &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/nfs-common&lt;/code&gt; を以下のようにする。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/nfs-common&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;STATDOPTS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;--port 32765 --outgoing-port 32766&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-mountd-用ポートの固定&quot;&gt;3. mountd 用ポートの固定&lt;/h3&gt;

&lt;p&gt;mountd のポートを固定するには &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/nfs-kernel-server&lt;/code&gt; を以下のようにする。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/nfs-kernel-server&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;RPCMOUNTDOPTS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-p 32767&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-lockd-モジュールの設定&quot;&gt;4. lockd モジュールの設定&lt;/h3&gt;

&lt;p&gt;オプション付き lockd モジュールを提供するために、以下のように &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/modprobe.d/local.conf&lt;/code&gt; を作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/modprobe.d/local.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;options lockd &lt;span class=&quot;nv&quot;&gt;nlm_udpport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;32768 &lt;span class=&quot;nv&quot;&gt;nlm_tcpport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;32768
options nfs &lt;span class=&quot;nv&quot;&gt;callback_tcpport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;32764
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-マシンの再起動&quot;&gt;5. マシンの再起動&lt;/h3&gt;

&lt;p&gt;設定を反映させるため、マシンを再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl reboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-設定の確認&quot;&gt;6. 設定の確認&lt;/h3&gt;

&lt;p&gt;以下のようにして、RPC 情報（ポートの設定）を確認してみる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpcinfo -p
   program vers proto   port  service
    100000    4   tcp    111  portmapper
    100000    3   tcp    111  portmapper
    100000    2   tcp    111  portmapper
    100000    4   udp    111  portmapper
    100000    3   udp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp  32767  mountd
    100005    1   tcp  32767  mountd
    100005    2   udp  32767  mountd
    100005    2   tcp  32767  mountd
    100005    3   udp  32767  mountd
    100005    3   tcp  32767  mountd
    100003    3   tcp   2049  nfs
    100003    4   tcp   2049  nfs
    100227    3   tcp   2049
    100003    3   udp   2049  nfs
    100003    4   udp   2049  nfs
    100227    3   udp   2049
    100021    1   udp  32768  nlockmgr
    100021    3   udp  32768  nlockmgr
    100021    4   udp  32768  nlockmgr
    100021    1   tcp  32768  nlockmgr
    100021    3   tcp  32768  nlockmgr
    100021    4   tcp  32768  nlockmgr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-ファイアウォールufwの設定&quot;&gt;7. ファイアウォール(ufw)の設定&lt;/h3&gt;

&lt;p&gt;NFS サーバが使用するポートが固定されたので、ufw でファイアウォールの設定を行う。（以下はローカルネットワーク内からのみアクセス可能にする例）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow proto tcp from 192.168.11.0/24 to any port 111,2049,32765,32767,32768
Rule added
# ufw allow proto udp from 192.168.11.0/24 to any port 111,2049,32765,32767,32768
Rule added
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;確認。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw status
Status: active

To                         Action      From
--                         ------      ----
6835/tcp                   ALLOW       192.168.11.0/24
53                         ALLOW       Anywhere
21                         ALLOW       Anywhere
4000,4001,4002,4003,4004,4005/tcp ALLOW       Anywhere
111,2049,32765,32767,32768/tcp ALLOW       192.168.11.0/24
111,2049,32765,32767,32768/udp ALLOW       192.168.11.0/24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-動作確認&quot;&gt;8. 動作確認&lt;/h3&gt;

&lt;p&gt;クライアントマシンでマウントして接続できることも確認しておく。&lt;/p&gt;

&lt;h3 id=&quot;9-参考サイト&quot;&gt;9. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://wiki.debian.org/SecuringNFS&quot; title=&quot;SecuringNFS - Debian Wiki&quot;&gt;SecuringNFS - Debian Wiki&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="NFS" /><summary type="html">Debian GNU/Linux 12 (bookworm) に NFS サーバで使用するポートを固定化する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - NFS サーバ構築！</title><link href="https://komasaru.github.io/2023/09/20/debian-12-nfs-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - NFS サーバ構築！" /><published>2023-09-20T00:00:00+09:00</published><updated>2023-09-20T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/09/20/debian-12-nfs-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/09/20/debian-12-nfs-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に NFS サーバを構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworms; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;接続可能なマシンのネットワークは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.0/24&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、サーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opti&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;NFS 用ディレクトリを新たに作成する。（”/var” 配下に “/exports” ディレクトリを作成する）&lt;/li&gt;
  &lt;li&gt;クライアント側でマウントに使用するディレクトリも “/var/exports” とする。&lt;/li&gt;
  &lt;li&gt;サーバ側は root で作業することを想定、クライアント側は一般ユーザで作業することを想定している。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-nfs-サーバのインストール&quot;&gt;1. NFS サーバのインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install nfs-kernel-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-idmapd-設定の編集&quot;&gt;2. idmapd 設定の編集&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/idmapd.conf&lt;/code&gt; というユーザー名・グループ名と UID/GID のマッピングを保持するデーモンの設定ファイルを以下のように編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/idmapd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Domain &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mk-mode.com  &lt;span class=&quot;c&quot;&gt;# &amp;lt; = コメント解除＆自ドメイン名に変更&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-nfs-用ディレクトリの作成&quot;&gt;3. NFS 用ディレクトリの作成&lt;/h3&gt;

&lt;p&gt;共有 NFS ディレクトリを以下のようにして作成する。&lt;br /&gt;
所有者・所有グループは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/idmapd.conf&lt;/code&gt; に記載されている &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nobody&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nogroup&lt;/code&gt; とする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir /var/exports
# chown -R nobody:nogroup /var/exports
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-exports-の編集&quot;&gt;4. exports の編集&lt;/h3&gt;

&lt;p&gt;設定ファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/exports&lt;/code&gt; を以下のように編集（追記）する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/exports&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/var/exports 192.168.11.0/24&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;rw,sync,fsid&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0,no_root_squash,no_subtree_check&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-ファイアウォール-ufw-の無効化&quot;&gt;5. ファイアウォール (ufw) の無効化&lt;/h3&gt;

&lt;p&gt;NFS サーバは都度ポート番号が変更になるため、ファイアウォールで開放するポートを指定できない。&lt;br /&gt;
ファイアウォール ufw を「一時的」にオフにする。&lt;br /&gt;
（別途、NFS サーバのポートを固定する措置を施せばよい（別記事））&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw disable
Firewall stopped and disabled on system startup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-nfs-サーバ再起動&quot;&gt;6. NFS サーバ再起動&lt;/h3&gt;

&lt;p&gt;設定を反映させるため、NFS サーバを再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart nfs-kernel-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;【以下、クライアント側・ローカルユーザでの作業】&lt;/p&gt;

&lt;h3 id=&quot;7-nfs-クライアントのインストール&quot;&gt;7. NFS クライアントのインストール&lt;/h3&gt;

&lt;p&gt;NFS クライアントを以下のようにしてインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo apt install -y nfs-client
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Linux ディストリビューションによっては &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apt command [options]&lt;/code&gt; でなく &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apt [options] command&lt;/code&gt; のことがあるので注意。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;8-idmapd-設定の編集&quot;&gt;8. idmapd 設定の編集&lt;/h3&gt;

&lt;p&gt;NFS サーバ同様 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;etc/idmapd.conf&lt;/code&gt; という設定ファイルを、以下のように編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/idmapd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Domain &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mk-mode.com  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除＆自ドメイン名に変更&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-nfs-クライアントの再起動&quot;&gt;9. NFS クライアントの再起動&lt;/h3&gt;

&lt;p&gt;設定を反映させるため、NFS クライアントを再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl restart nfs-common
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ちなみに、nfs-common は自動起動するようになっているが、普段使用しない場合は、以下のように自動起動しないように設定しておいてもよいだろう。（NFS を使用したい時のみ nfs-common を起動させる）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl disable nfs-common
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;10-マウント用ディレクトリの作成&quot;&gt;10. マウント用ディレクトリの作成&lt;/h3&gt;

&lt;p&gt;マウントするディレクトリを作成する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mkdir /var/exports
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;11-マウント&quot;&gt;11. マウント&lt;/h3&gt;

&lt;p&gt;NFS サーバのディレクトリ使用するために、クライアントマシンでマウントする。&lt;br /&gt;
以下では、クライアントマシンの &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/exports&lt;/code&gt; ディレクトリにマウントしている。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mount -t nfs vostro.mk-mode.com:/var/exports /var/exports
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;12-確認&quot;&gt;12. 確認&lt;/h3&gt;

&lt;p&gt;マウントできているか &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;df&lt;/code&gt; コマンドで確認する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# df -h
Filesystem                     Size  Used Avail Use% Mounted on
         :
====&amp;lt; 途中省略 &amp;gt;====
         :
vostro.mk-mode.com:/var/exports   1.7G  431M  1.2G   28% /var/exports
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;その他、クライアントマシンからファイルを貼り付けてみたり、削除してみたりしてみる。&lt;/p&gt;

&lt;h3 id=&quot;13-自動マウントの設定&quot;&gt;13. 自動マウントの設定&lt;/h3&gt;

&lt;p&gt;上記の方法ではクライアントマシンを再起動するたびにマウントしないといけないので、マシン起動時に自動マウントするようにしたければ以下のように fstab を設定する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/fstab&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vbox.mk-mode.com:/var/exports   /var/exports  nfs     defaults        0       0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;クライアントマシン再起動時にマウントされるかも確認しておく。&lt;/p&gt;

&lt;h3 id=&quot;14-ファイアウォール-ufw-の有効化&quot;&gt;14. ファイアウォール (ufw) の有効化&lt;/h3&gt;

&lt;p&gt;テストのために無効化していたファイアウォールを有効化に戻す。※サーバ側&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw enable
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;実際に運用する場会は、 NVF サーバのポートを固定する設定を施す。&lt;br /&gt;
ここでは、一旦ファイアウォールを有効化に戻しておく。（この後続けて、次記事（次回投稿予定の記事）の方法で NFS サーバのポート固定の設定を施すのであれば、この限りでない）&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="NFS" /><summary type="html">Debian GNU/Linux 12 (bookworm) に NFS サーバを構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - FTP サーバ構築！</title><link href="https://komasaru.github.io/2023/09/13/debian-12-ftp-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - FTP サーバ構築！" /><published>2023-09-13T00:00:00+09:00</published><updated>2023-09-13T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/09/13/debian-12-ftp-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/09/13/debian-12-ftp-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に FTP サーバを構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12.0.0 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12.0.0 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;接続テストでは FileZilla という FTP クライアントを使用する。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-vsftpd-のインストール&quot;&gt;1. vsftpd のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install vsftpd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-vsftpd-設定ファイルの編集&quot;&gt;2. vsftpd 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# anonymous によるログインを無効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;anonymous_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO

&lt;span class=&quot;c&quot;&gt;# ローカルアクセスの許可&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;local_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# 書き込み許可&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;write_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# アスキーモードでの転送を許可&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;ascii_upload_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;span class=&quot;nv&quot;&gt;ascii_download_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# chroot 有効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chroot_local_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# chroot リスト有効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chroot_list_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# chrootリスト指定&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chroot_list_file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/etc/vsftpd.chroot_list

&lt;span class=&quot;c&quot;&gt;# ディレクトリごと一括での転送を有効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;ls_recurse_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# chroot のルートディレクトリ指定&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ( 指定しない場合はユーザーのホームディレクトリ直下 )&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# public_htmlを指定した場合で、且つ当該ディレクトリがないとログインできないので注意&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;local_root&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;public_html

&lt;span class=&quot;c&quot;&gt;# seccomp filter をオフにする&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;seccomp_sandbox&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO

&lt;span class=&quot;c&quot;&gt;# PASV モード有効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;pasv_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;span class=&quot;nv&quot;&gt;pasv_min_port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4000
&lt;span class=&quot;nv&quot;&gt;pasv_max_port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4005
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-ホームディレクトリより上層へのアクセス許可設定&quot;&gt;3. ホームディレクトリより上層へのアクセス許可設定&lt;/h3&gt;

&lt;p&gt;ホームディレクトリより上層へのアクセスを許可するユーザのリストを作成する。（上記設定ファイル内の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.chroot_list&lt;/code&gt; のこと）&lt;br /&gt;
指定は、１行に１ユーザ。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.chroot_list&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;masaru
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-ssl-サーバの構築&quot;&gt;4. SSL サーバの構築&lt;/h3&gt;

&lt;p&gt;vsftpd を SSL/TLS で使用できるようにするには SSL サーバが必要であるので、未インストールなら OpenSSL をインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install openssl
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-サーバ証明書の作成&quot;&gt;5. サーバ証明書の作成&lt;/h3&gt;

&lt;p&gt;vsftpd を SSL/TLS で使用できるようサーバ証明書を作成する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /etc/ssl/private
# openssl req -x509 -nodes -newkey rsa:2048 -keyout /etc/ssl/private/vsftpd.pem -out /etc/ssl/private/vsftpd.pem

      :
===&amp;lt; 中略 &amp;gt;===
      :

-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &apos;.&apos;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:JP                                    # &amp;lt;= 国の略名
State or Province Name (full name) [Some-State]:Shimane                 # &amp;lt;= 都道府県名
Locality Name (eg, city) []:Matsue                                      # &amp;lt;= 市区町村名
Organization Name (eg, company) [Internet Widgits Pty Ltd]:mk-mode.com  # &amp;lt;= サイト名（何でもよい）
Organizational Unit Name (eg, section) []:                              # &amp;lt;= 部署名（空でよい）
Common Name (e.g. server FQDN or YOUR name) []:ftp.mk-mode.com          # &amp;lt;= ホスト名
Email Address []:root@mk-mode.com                                       # &amp;lt;= 管理者メールアドレス
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;作成したサーバ証明書のパーミッションを設定する。（所有者読み込み専用に）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chmod 400 vsftpd.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-vsftpd-設定ファイルの編集&quot;&gt;6. vsftpd 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;サーバ証明書を使用できるよう vsftpd 設定ファイルを以下のように編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;ssl_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES              &lt;span class=&quot;c&quot;&gt;# 編集（SSL有効化）&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;ssl_ciphers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;HIGH
&lt;span class=&quot;nv&quot;&gt;ssl_tlsv1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;span class=&quot;nv&quot;&gt;ssl_sslv2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO
&lt;span class=&quot;nv&quot;&gt;ssl_sslv3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO
&lt;span class=&quot;nv&quot;&gt;force_local_data_ssl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;span class=&quot;nv&quot;&gt;force_local_logins_ssl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-vsftpd-の再起動&quot;&gt;7. vsftpd の再起動&lt;/h3&gt;

&lt;p&gt;設定を有効化するために vsftpd を再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart vsftpd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-ファイアウォール-ufw-の設定&quot;&gt;8. ファイアウォール (ufw) の設定&lt;/h3&gt;

&lt;p&gt;外部に公開する場合は、TCP ポート 21(FTP) へのアクセスを許可する必要がある。&lt;br /&gt;
また、 PASV モードで運用する場合は、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.conf&lt;/code&gt; の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pasv_min_port&lt;/code&gt; から &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pasv_max_port&lt;/code&gt; で設定したポートも開放する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 21/tcp
Rule added

# ufw allow 4000,4001,4002,4003,4004,4005/tcp
Rule added

# ufw status
Status: active

To                         Action      From
--                         ------      ----
9999/tcp                   ALLOW       192.168.11.0/24
53                         ALLOW       Anywhere
21/tcp                     ALLOW       Anywhere
4000,4001,4002,4003,4004,4005/tcp ALLOW       Anywhere
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-動作確認&quot;&gt;9. 動作確認&lt;/h3&gt;

&lt;p&gt;クライアント側からコマンドラインや FTP クライアントでサーバに接続して、アップロード・ダウンロード等各種操作が可能かチェックする。&lt;br /&gt;
FTP クライアント FileZilla なら以下のように設定してログイン。
e&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ホスト：サーバホスト名 or サーバ IP アドレス&lt;/li&gt;
  &lt;li&gt;プロトコル：「FTP - ファイル転送プロトコル」&lt;/li&gt;
  &lt;li&gt;暗号化：「明示的な FTP over TLS が必要」&lt;/li&gt;
  &lt;li&gt;ログオンの種類：「通常」 or 「パスワードを尋ねる」&lt;/li&gt;
  &lt;li&gt;ユーザ：ユーザ名&lt;/li&gt;
  &lt;li&gt;転送モード：「アクティブ」&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;lftp を使用するなら、インストール後、設定を行なう。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt install lftp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.lftprc&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;set ftp:ssl-auth TLS
set ftp:ssl-force true
set ftp:ssl-protect-list yes
set ftp:ssl-protect-data yes
set ftp:ssl-protect-fxp yes
set ssl:verify-certificate no
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そして、ログイン。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ lftp -u masaru 192.168.11.101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;10-自動起動の設定&quot;&gt;10. 自動起動の設定&lt;/h3&gt;

&lt;p&gt;vsftpd インストール直後はマシン起動時に自動で vsftpd が起動するようになっている。&lt;/p&gt;

&lt;p&gt;自動起動しないように設定するなら以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl disable vsftpd
Synchronizing state of vsftpd.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable vsftpd
insserv: warning: current start runlevel(s) (empty) of script `vsftpd&apos; overrides LSB defaults (2 3 4 5).
insserv: warning: current stop runlevel(s) (0 1 2 3 4 5 6) of script `vsftpd&apos; overrides LSB defaults (0 1 6).

# systemctl is-enabled vsftpd
disabled  # &amp;lt;= disabled であることを確認
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;逆に自動起動するように設定するなら以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl enable vsftpd
Synchronizing state of vsftpd.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable vsftpd
insserv: warning: current start runlevel(s) (empty) of script `vsftpd&apos; overrides LSB defaults (2 3 4 5).
insserv: warning: current stop runlevel(s) (0 1 2 3 4 5 6) of script `vsftpd&apos; overrides LSB defaults (0 1 6).

# systemctl is-enabled vsftpd
enabled  # &amp;lt;= enabled であることを確認
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="FTP" /><summary type="html">Debian GNU/Linux 12 (bookworm) に FTP サーバを構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - DNS サーバ BIND9 構築！</title><link href="https://komasaru.github.io/2023/09/06/debian-12-bind-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - DNS サーバ BIND9 構築！" /><published>2023-09-06T00:00:00+09:00</published><updated>2023-09-06T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/09/06/debian-12-bind-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/09/06/debian-12-bind-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に DNS サーバを構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12.0.0 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;サーバのローカル IP アドレスは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.11&lt;/code&gt;、グローバル IP アドレスは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xxx.yyy.zzz.aaa&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、マシンのホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opti&lt;/code&gt;、ネームサーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ns&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;セカンダリ DNS は用意しない。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-bind-のインストール&quot;&gt;1. BIND のインストール&lt;/h3&gt;

&lt;p&gt;（”dnsutils” は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dig&lt;/code&gt; コマンド用）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install bind9 dnsutils
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-bind-設定ファイルの編集&quot;&gt;2. BIND 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.options&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.local&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#include &quot;/etc/bind/named.conf.default-zones&quot;;  # &amp;lt;= コメント化（内部向け・外部向けゾーンファイルで定義するので）&lt;/span&gt;
include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.internal-zones&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# &amp;lt; = 追加&lt;/span&gt;
include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.external-zones&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# &amp;lt; = 追加&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-内部向けゾーンファイルの作成&quot;&gt;3. 内部向けゾーンファイルの作成&lt;/h3&gt;

&lt;p&gt;BIND 設定ファイルで指定している内部向けゾーンファイルを以下のように作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf.internal-zones&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;view &lt;span class=&quot;s2&quot;&gt;&quot;internal&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# 内部向け設定の対象範囲定義&lt;/span&gt;
    match-clients &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        192.168.11.0/24&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 内部向け正引きゾーン定義&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;mk-mode.com&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/mk-mode.com.lan&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 内部向け逆引きゾーン定義&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;11.168.192.in-addr.arpa&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/11.168.192.db&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.default-zones&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    empty-zones-enable no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;最後の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;empty-zones-enable no;&lt;/code&gt; は、ログに以下のようなメッセージが出力されないための対処。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Warning: view internal: &apos;empty-zones-enable/disable-empty-zone&apos; not set: disabling RFC 1918 empty zones
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-外部向けゾーンファイルの作成&quot;&gt;4. 外部向けゾーンファイルの作成&lt;/h3&gt;

&lt;p&gt;BIND 設定ファイルで指定している外部向けゾーンファイルを以下のように作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf.external-zones&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;view &lt;span class=&quot;s2&quot;&gt;&quot;external&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    match-clients &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# 全て対象（内部向け範囲以外のホスト）&lt;/span&gt;
    allow-query &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# 問い合わせは全て許可&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#recursion no;            # 再帰検索禁止&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 外部向け正引きゾーン定義&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;mk-mode.com&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/mk-mode.com.wan&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 外部向け正引き情報を定義 *注&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;zzz.yyy.xxx.in-addr.arpa&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/zzz.yyy.xxx.db&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-オプション設定ファイルの編集&quot;&gt;5. オプション設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;その他の設定用ファイルを以下のように編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf.options&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;options &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        directory &lt;span class=&quot;s2&quot;&gt;&quot;/var/cache/bind&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        // 問合わせを許可する範囲
        // &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;サーバー、ローカルネットワーク内のホストからの問合せのみ許可&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        allow-query &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; localnets&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;      &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

        // ゾーン情報の転送を許可する範囲
        // &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;サーバー、ローカルネットワーク内のホストへのみ転送を許可&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; localnets&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

        // 再帰検索を許可する範囲
        // &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;サーバー、ローカルネットワーク内のホストのみ再検索を許可&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        allow-recursion &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; localnets&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

        dnssec-validation auto&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        auth-nxdomain no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;# conform to RFC1035&lt;/span&gt;

        // IPv6 は使用しないので無効化
        //listen-on-v6 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        listen-on-v6 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# EDNS0 の無効化&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# &quot;error (unexpected RCODE REFUSED) ...&quot; 出力の抑止&lt;/span&gt;
server 0.0.0.0 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        edns no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# &quot;DNS format error ... invalid response&quot; 出力の抑止&lt;/span&gt;
logging &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        category resolver &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-内部向け正引きゾーン定義ファイルの作成&quot;&gt;6. 内部向け正引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/mk-mode.com.lan&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2023082201  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  A       192.168.11.11
        IN  MX 10   ns.mk-mode.com.
ns      IN  A       192.168.11.101
vbox    IN  A       192.168.11.101
hoge    IN  A       192.168.11.2
fuga    IN  A       192.168.11.3
www     IN  CNAME   ns.mk-mode.com.
ftp     IN  CNAME   ns.mk-mode.com.
mail    IN  CNAME   ns.mk-mode.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hoge&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fuga&lt;/code&gt; はローカルネットワーク内の別のマシン。&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ftp&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mail&lt;/code&gt; は別名定義。&lt;/p&gt;

&lt;h3 id=&quot;7-外部向け正引きゾーン定義ファイルの作成&quot;&gt;7. 外部向け正引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/mk-mode.com.wan&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2023082201  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  A       xxx.yyy.zzz.aaa
        IN  MX 10   ns.mk-mode.com.
ns      IN  A       xxx.yyy.zzz.aaa
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-内部向け逆引きゾーン定義ファイルの作成&quot;&gt;8. 内部向け逆引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/11.168.192.db&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2023082201  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  PTR     mk-mode.com.
        IN  A       255.255.255.0
101     IN  PTR     ns.mk-mode.com.
101     IN  PTR     vbox.mk-mode.com.
2       IN  PTR     hoge.mk-mode.com.
3       IN  PTR     fuga.mk-mode.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-外部向け逆引きゾーン定義ファイルの作成&quot;&gt;9. 外部向け逆引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/zzz.yyy.xxx.db&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2023082201  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  PTR     mk-mode.com.
        IN  A       255.255.255.254
aaa     IN  PTR     ns.mk-mode.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;255.255.255.254&lt;/code&gt; はグローバル IP が１個のみの場合の設定値）&lt;/p&gt;

&lt;h3 id=&quot;10-問合せ先-dns-サーバの追加&quot;&gt;10. 問合せ先 DNS サーバの追加&lt;/h3&gt;

&lt;p&gt;DNS サーバー自身も問合せ先に追加する。&lt;br /&gt;
最初から記載のあるルータの IP アドレス（インストール・初期設定時のもの）をセカンダリ、今回構築のサーバ自身をプライマリに設定するので、ルータより先に記述する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/resolv.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;domain localdomai
search localdomain
nameserver 192.168.11.101  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;
nameserver 192.168.11.1    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= ルータの IP アドレス&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;11-ipv6-の無効化設定&quot;&gt;11. IPv6 の無効化設定&lt;/h3&gt;

&lt;p&gt;システムとして IPv6 を無効にしている場合は、以下のように “/etc/default/bind9” を編集する。
（”/var/log/syslog” に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;... named[9999]: error (network unreachable) resolving ...&lt;/code&gt; のようなエラーが出力されないようにするため）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/named&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;OPTIONS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-u bind -4&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;12-bind-の再起動&quot;&gt;12. BIND の再起動&lt;/h3&gt;

&lt;p&gt;設定を有効化するために BIND を再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart named
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;もし、この際に次のようなエラーとなる場合、&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;System has not been booted with systemd as init system (PID 1). Can&apos;t operate.
Failed to connect to bus: ホストが落ちています
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;これは、 SystemD が正常に起動していない（SystemCtl がインストールされていない）ためなので、 SystemCtl をインストールする。&lt;/p&gt;

&lt;h3 id=&quot;13-動作確認&quot;&gt;13. 動作確認&lt;/h3&gt;

&lt;p&gt;DNS サーバが正常に機能する（正引きで IP アドレス、逆引きでホスト名が返ってくる）か、確認してみる。&lt;/p&gt;

&lt;p&gt;・内部向け正引きテスト&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig ns.mk-mode.com.

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1~deb12u1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; ns.mk-mode.com.
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 33866
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 3366292790b8d1870100000064f6b3d7b3b6be5ed17756da (good)
;; QUESTION SECTION:
;ns.mk-mode.com.                        IN      A

;; ANSWER SECTION:
ns.mk-mode.com.         86400   IN      A       192.168.11.101

;; Query time: 0 msec
;; SERVER: 192.168.11.101#53(192.168.11.101) (UDP)
;; WHEN: Tue Sep 05 13:51:35 JST 2023
;; MSG SIZE  rcvd: 87
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;・内部向け逆引きテスト&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig -x 192.168.11.101

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1~deb12u1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; -x 192.168.11.101
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 14510
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 0134ba8c574723ea0100000064f6b3f8eef6d1ed068fcb4e (good)
;; QUESTION SECTION:
;101.11.168.192.in-addr.arpa.   IN      PTR

;; ANSWER SECTION:
101.11.168.192.in-addr.arpa. 86400 IN   PTR     vbox.mk-mode.com.
101.11.168.192.in-addr.arpa. 86400 IN   PTR     ns.mk-mode.com.

;; Query time: 0 msec
;; SERVER: 192.168.11.101#53(192.168.11.101) (UDP)
;; WHEN: Tue Sep 05 13:52:08 JST 2023
;; MSG SIZE  rcvd: 131
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;・外部向け正引きテスト&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig www.isc.org

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1~deb12u1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; www.isc.org
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 42466
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 6609a8b670fa84ae0100000064f6b42016133bc852f562a9 (good)
;; QUESTION SECTION:
;www.isc.org.                   IN      A

;; ANSWER SECTION:
www.isc.org.            300     IN      CNAME   dualstack.osff2.map.fastly.net.
dualstack.osff2.map.fastly.net. 30 IN   A       151.101.90.217

;; Query time: 1027 msec
;; SERVER: 192.168.11.101#53(192.168.11.101) (UDP)
;; WHEN: Tue Sep 05 13:52:48 JST 2023
;; MSG SIZE  rcvd: 128
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;・外部向け逆引きテスト&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig -x 151.101.110.217

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1~deb12u1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; -x 151.101.110.217
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NXDOMAIN, id: 55453
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 9748c1f85cf218f90100000064f6b43b64ac3ea5263aab9a (good)
;; QUESTION SECTION:
;217.110.101.151.in-addr.arpa.  IN      PTR

;; AUTHORITY SECTION:
151.in-addr.arpa.       3600    IN      SOA     pri.authdns.ripe.net. dns.ripe.net. 1693818121 3600 600 864000 3600

;; Query time: 1543 msec
;; SERVER: 192.168.11.101#53(192.168.11.101) (UDP)
;; WHEN: Tue Sep 05 13:53:15 JST 2023
;; MSG SIZE  rcvd: 169
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;14-ファイアウォール-ufw-の設定&quot;&gt;14. ファイアウォール (ufw) の設定&lt;/h3&gt;

&lt;p&gt;実際に運用する場合は、外部からのTCP/UDP53番ポート(DNS)へのアクセスを許可する必要がある。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 53
Rule added

# ufw status
Status: active

To                         Action      From
--                         ------      ----
9999/tcp                   ALLOW       192.168.11.0/24
53                         ALLOW       Anywhere
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="DNS" /><summary type="html">Debian GNU/Linux 12 (bookworm) に DNS サーバを構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry></feed>