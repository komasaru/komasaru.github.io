<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator><link href="https://komasaru.github.io/atom.xml" rel="self" type="application/atom+xml" /><link href="https://komasaru.github.io/" rel="alternate" type="text/html" /><updated>2022-05-01T07:18:47+09:00</updated><id>https://komasaru.github.io/atom.xml</id><title type="html">mk-mode BLOG</title><subtitle>このブログは自宅サーバ(Debian GNU/Linux)で運用してしている&lt;a href=&quot;https://www.mk-mode.com/blog/&quot;&gt;ブログ&lt;/a&gt;のクローンです。&lt;br /&gt;PC・サーバ構築等の話題を中心に公開しております。</subtitle><author><name>mk-mode.com</name></author><entry><title type="html">2022年4月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2022/05/01/blog-access/" rel="alternate" type="text/html" title="2022年4月 - OS・ブラウザ別アクセス状況！" /><published>2022-05-01T00:20:00+09:00</published><updated>2022-05-01T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/05/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2022/05/01/blog-access/">&lt;p&gt;5月になりましたので、先月4月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;21,100&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;64.4629&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7,344&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;22.4368&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,721&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8.3130&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,043&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.1865&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;305&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.9318&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;185&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5652&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;23&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0703&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0275&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Debian GNU/Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0031&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OpenBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0031&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;32,732&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,479&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;50.3452&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7,344&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;22.4368&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,355&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13.3050&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,721&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8.3130&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,043&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.1865&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;305&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.9318&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;217&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6630&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;185&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5652&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;23&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0703&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;21&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0642&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;XP&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0611&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0275&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0153&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Vista&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0092&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Debian GNU/Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0031&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OpenBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0031&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;32,732&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20,977&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;64.0871&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,275&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13.0606&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,257&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13.0056&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,867&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8.7590&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;354&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0815&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla SeaMonkey&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0061&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;32,732&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;100.0.4896.127&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6,208&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18.9661&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,257&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13.0056&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;100.0.4896.75&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,919&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11.9730&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;100.0.4896.88&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,688&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8.2121&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,768&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.4014&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;100.0.4896.60&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,713&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.2334&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.84&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,615&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.9340&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9537.53&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,553&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.7446&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,532&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.6804&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;96.0.4664.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,385&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.2313&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;933&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.8504&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.74&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;613&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.8728&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;529&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.6162&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;91.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;439&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.3412&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;11.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;327&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.9990&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.51&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;297&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.9074&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;101.0.4951.41&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;238&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7271&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98.0.4758.102&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;233&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7118&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;100.0.4896.79&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;233&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7118&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.82&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;174&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5316&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;32,732&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">5月になりましたので、先月4月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 11 (bullseye) - 地図描画ツール GMT インストール！</title><link href="https://komasaru.github.io/2022/04/27/debian-11-gmt-installation/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - 地図描画ツール GMT インストール！" /><published>2022-04-27T00:20:00+09:00</published><updated>2022-04-27T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/04/27/debian-11-gmt-installation</id><content type="html" xml:base="https://komasaru.github.io/2022/04/27/debian-11-gmt-installation/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) に地図描画ツール GMT(Generic Mapping Tool) をインストールする方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11.2.0 (bullseye; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
  &lt;li&gt;以前は海岸線データやポリゴンデータとともにソースをビルドしてインストールしていたが、今回は全て apt インストールする。&lt;/li&gt;
  &lt;li&gt;root での作業を想定。&lt;/li&gt;
  &lt;li&gt;GMT 4 系や 5 系とスクリプトの書き方（モジュールの仕様）が多々異なるので、注意！&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-gmt-のインストール&quot;&gt;1. GMT のインストール&lt;/h3&gt;

&lt;p&gt;GMT(6.1.1), DCW(1.1.4), GSHHG(2.3.7) をインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install gmt gmt-dcw gmt-gshhg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-必要パッケージのインストール&quot;&gt;2. 必要パッケージのインストール&lt;/h3&gt;

&lt;p&gt;他の必要なパッケージもインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install ghostscript
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-追加パッケージのインストール&quot;&gt;3. 追加パッケージのインストール&lt;/h3&gt;

&lt;p&gt;必要なら、追加で以下のパッケージもインストールする。（当方は、念の為、インストール）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install gdal-bin graphicsmagick ffmpeg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-動作確認&quot;&gt;4. 動作確認&lt;/h3&gt;

&lt;p&gt;GMT のパラメータデフォルト値の一覧を表示してみる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# gmt defaults
#
# GMT 6.1.1 Defaults file
#
# COLOR Parameters
#
COLOR_BACKGROUND               = black
COLOR_FOREGROUND               = white
COLOR_NAN                      = 127.5
COLOR_MODEL                    = none
COLOR_HSV_MIN_S                = 1
COLOR_HSV_MAX_S                = 0.1
COLOR_HSV_MIN_V                = 0.3
COLOR_HSV_MAX_V                = 1
#
         :
====&amp;lt; 以下省略 &amp;gt;====
         :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ちなみに、 GMT 4, 5 系は以下のようなコマンドだった。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# gmtdefaults -D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-地図描画スクリプトの作成&quot;&gt;5. 地図描画スクリプトの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/path/to/gmt_test.sh&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;#! /bin/bash&lt;/span&gt;

gmt begin MAP_TEST png E100,A+m0.2c+s18c/20c &lt;span class=&quot;nt&quot;&gt;-C&lt;/span&gt;
  gmt basemap &lt;span class=&quot;nt&quot;&gt;-JM15c&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-R126&lt;/span&gt;/149/25/46 &lt;span class=&quot;nt&quot;&gt;-B&lt;/span&gt;+t&lt;span class=&quot;s2&quot;&gt;&quot;GMT 6 TEST (by mk-mode.com)&quot;&lt;/span&gt;
  gmt coast &lt;span class=&quot;nt&quot;&gt;-Dh&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Ba10f5g5&lt;/span&gt;:WSen &lt;span class=&quot;nt&quot;&gt;-Wthinnest&lt;/span&gt;,black &lt;span class=&quot;nt&quot;&gt;-Gwheat&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-S240&lt;/span&gt;/255/255
gmt end&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;GMT 6 系では GMT モジュールを &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gmt begin&lt;/code&gt; と &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gmt end&lt;/code&gt; で囲む。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gmt begin&lt;/code&gt; 行で、出力フォーマとを指定。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gmt basemap&lt;/code&gt; で、元となる地図を描画。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gmt coast&lt;/code&gt; で、海岸線を描画。&lt;/li&gt;
  &lt;li&gt;その他、モジュールの詳細については「&lt;a href=&quot;https://docs.generic-mapping-tools.org/6.2/modules.html&quot; title=&quot;Modules — GMT 6.2.0 documentation&quot;&gt;こちら&lt;/a&gt;」を参照。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;6-地図描画スクリプトの実行&quot;&gt;6. 地図描画スクリプトの実行&lt;/h3&gt;

&lt;p&gt;まず、実行権限を付与。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /path/to
# chmod +x gmt_test.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そして、実行。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ./gmt_test.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-描画された地図の確認&quot;&gt;7. 描画された地図の確認&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/2022/04/27/MAP_TEST.png&quot; alt=&quot;MAP_TEST&quot; title=&quot;MAP_TEST&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;8-参考サイト&quot;&gt;8. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.generic-mapping-tools.org/&quot; title=&quot;The Generic Mapping Tools&quot;&gt;The Generic Mapping Tools&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="munin" /><summary type="html">Debian GNU/Linux 11 (bullseye) に地図描画ツール GMT(Generic Mapping Tool) をインストールする方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - Monit でプロセス監視！</title><link href="https://komasaru.github.io/2022/04/20/debian-11-monit-installation/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - Monit でプロセス監視！" /><published>2022-04-20T00:20:00+09:00</published><updated>2022-04-20T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/04/20/debian-11-monit-installation</id><content type="html" xml:base="https://komasaru.github.io/2022/04/20/debian-11-monit-installation/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) にプロセス監視ツール monit をインストールする方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11.2.0 (bullseye; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1--monit-のインストール&quot;&gt;1.  monit のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install monit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-設定ファイル編集&quot;&gt;2. 設定ファイル編集&lt;/h3&gt;

&lt;p&gt;設定ファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/monit/monitrc&lt;/code&gt; を編集する。&lt;br /&gt;
以下は当方の例。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/monit/monitrc&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;  &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;daemon 120                              &lt;span class=&quot;c&quot;&gt;# 監視間隔（秒）&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;log /var/log/monit.log                  &lt;span class=&quot;c&quot;&gt;# ログファイル&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;idfile /var/lib/monit/id                &lt;span class=&quot;c&quot;&gt;# Monit インスタンスの ID ファイル&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;statefile /var/lib/monit/state          &lt;span class=&quot;c&quot;&gt;# Monitering ステート保存ファイル&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;mailserver localhost                    &lt;span class=&quot;c&quot;&gt;# メールサーバ&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;eventqueue
        basedir /var/lib/monit/events         &lt;span class=&quot;c&quot;&gt;# メールサーバが利用できない場合の通知用&lt;/span&gt;
        slots 100                             &lt;span class=&quot;c&quot;&gt;#   〃&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;mail-format &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;                           &lt;span class=&quot;c&quot;&gt;# メール書式&lt;/span&gt;
    from:    Monit &amp;lt;monit@&lt;span class=&quot;nv&quot;&gt;$HOST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    subject: monit alert &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$EVENT&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SERVICE&lt;/span&gt;
    message: &lt;span class=&quot;nv&quot;&gt;$EVENT&lt;/span&gt; Service &lt;span class=&quot;nv&quot;&gt;$SERVICE&lt;/span&gt;
                  Date:        &lt;span class=&quot;nv&quot;&gt;$DATE&lt;/span&gt;
                  Action:      &lt;span class=&quot;nv&quot;&gt;$ACTION&lt;/span&gt;
                  Host:        &lt;span class=&quot;nv&quot;&gt;$HOST&lt;/span&gt;
                  Description: &lt;span class=&quot;nv&quot;&gt;$DESCRIPTION&lt;/span&gt;

             Your faithful employee,
             Monit
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;alert root@localhost                    &lt;span class=&quot;c&quot;&gt;# 通知先メールアドレス&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;httpd port 2812 and
      allow localhost

    include /etc/monit/conf.d/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               &lt;span class=&quot;c&quot;&gt;# 別の設定ファイル読み込み&lt;/span&gt;
    include /etc/monit/conf-enabled/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;         &lt;span class=&quot;c&quot;&gt;#   〃&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set log /var/log/monit.log&lt;/code&gt; を &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set log syslog facility log_daemon&lt;/code&gt; とすると syslog での出力となる。&lt;/li&gt;
  &lt;li&gt;メールサーバは複数設定可能。&lt;/li&gt;
  &lt;li&gt;メール通知先も複数設定可能。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set alert root@localhost only on { xxxx }&lt;/code&gt; などとすれば、xxxx アクション発生時のみメール通知するようにする。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set alert root@localhost but not on { xxxx }&lt;/code&gt; などとすれば、xxxx 以外のアクション発生時のみメール通知するようにする。&lt;/li&gt;
  &lt;li&gt;その他の設定等については、 “monit.conf” 内のコメントや&lt;a href=&quot;https://mmonit.com/monit/documentation/monit.html&quot;&gt;公式ドキュメント&lt;/a&gt;を参照のこと。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-アラート機能の設定&quot;&gt;3. アラート機能の設定&lt;/h3&gt;

&lt;p&gt;以下は MariaDB サーバを監視する例。（パスは環境に合わせて適宜置き換えること）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/monit/conf.d/mysqld&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;check process mysql with pidfile /var/run/mysqld/mysqld.pid
    every 1 cycle
    start program &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/etc/rc.d/init.d/mysqld start&quot;&lt;/span&gt;
    stop  program &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/etc/rc.d/init.d/mysqld stop&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;failed
        host localhost port 3306 protocol mysql
        with &lt;span class=&quot;nb&quot;&gt;timeout &lt;/span&gt;15 seconds &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;3 &lt;span class=&quot;nb&quot;&gt;times &lt;/span&gt;within 4 cycles
    &lt;span class=&quot;k&quot;&gt;then &lt;/span&gt;restart&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;failed
        unixsocket /var/run/mysqld/mysqld.sock protocol mysql
        &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;3 &lt;span class=&quot;nb&quot;&gt;times &lt;/span&gt;within 4 cycles
    &lt;span class=&quot;k&quot;&gt;then &lt;/span&gt;restart&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;5 restarts within 5 cycles &lt;span class=&quot;k&quot;&gt;then &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;timeout&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;`mysqld.pid~ ファイルを1サイクル（今回の設定では 120秒 * 1 = 60秒）毎に監視し、存在しなければ MySQL サーバを再起動する。&lt;/li&gt;
  &lt;li&gt;TCP ポート 3306 への接続が4回中3回15秒のタイムアウトで失敗する場合は、 MariaDB サーバを再起動する。&lt;/li&gt;
  &lt;li&gt;Unix ソケットへの接続が4回中3回失敗する場合は、 MariaDB サーバを再起動する。&lt;/li&gt;
  &lt;li&gt;5回中5回再起動となる場合は、タイムアウトする。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;group xxxx&lt;/code&gt; としてグループ単位で監視の制御をすることも可能。&lt;/li&gt;
  &lt;li&gt;CPU 使用量やメモリ使用量等を監視することも可能。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;PID ファイルの存在を監視するのではなく、プロセス自体の存在を監視したければ、１行目を以下のようにする。（以下は、プロセス名に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hoge&lt;/code&gt; を含むプロセスを監視する例で、正規表現で指定する）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/monit.d/hoge&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;check process hoge matching &lt;span class=&quot;s2&quot;&gt;&quot;hoge&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;4-構文チェック&quot;&gt;4. 構文チェック&lt;/h3&gt;

&lt;p&gt;予め設定ファイルの構文をチェックすることができる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# monit -t
Control file syntax OK
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-monit-の再起動&quot;&gt;5. Monit の再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart monit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-監視状況の確認&quot;&gt;6. 監視状況の確認&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# monit status
Monit 5.27.2 uptime: 0m

System &apos;vbox&apos;
  status                       OK
  monitoring status            Monitored
  monitoring mode              active
  on reboot                    start
  load average                 [1.27] [1.71] [2.43]
  cpu                          0.0%usr 0.0%sys 0.0%nice 0.0%iowait 0.0%hardirq 0.0%softirq 0.0%steal 0.0%guest 0.0%guestnice
  memory usage                 946.1 MB [96.9%]
  swap usage                   1.2 GB [31.3%]
  uptime                       1h 0m
  boot time                    Wed, 22 Sep 2021 15:24:00
  filedescriptors              1888 [0.0% of 9223372036854775807 limit]
  data collected               Wed, 22 Sep 2021 16:24:14

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;status&lt;/code&gt; が &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Running&lt;/code&gt; であれば、「監視中」である。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;monit summary&lt;/code&gt; だと &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;status&lt;/code&gt; だけを確認できる。&lt;/p&gt;

&lt;h3 id=&quot;7-個別監視の停止起動&quot;&gt;7. 個別監視の停止・起動&lt;/h3&gt;

&lt;p&gt;個別に監視を停止・起動するには以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# monit stop xxxx
# monit start xxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-グループ単位での監視の停止起動&quot;&gt;8. グループ単位での監視の停止・起動&lt;/h3&gt;

&lt;p&gt;個別の設定ファイル内で &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;group xxxx&lt;/code&gt; のように記述していれば、xxxx グループの単位で監視を停止・起動することができる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# monit -g xxxx stop
# monit -g xxxx start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-参考サイト&quot;&gt;9. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://mmonit.com/monit/&quot; title=&quot;Easy, proactive monitoring of processes, programs, files, directories, filesystems and hosts - Monit&quot;&gt;Easy, proactive monitoring of processes, programs, files, directories, filesystems and hosts - Monit&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="munin" /><summary type="html">Debian GNU/Linux 11 (bullseye) にプロセス監視ツール monit をインストールする方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - munin 各種監視追加！</title><link href="https://komasaru.github.io/2022/04/13/debian-11-munin-additional-setting/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - munin 各種監視追加！" /><published>2022-04-13T00:20:00+09:00</published><updated>2022-04-13T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/04/13/debian-11-munin-additional-setting</id><content type="html" xml:base="https://komasaru.github.io/2022/04/13/debian-11-munin-additional-setting/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) にインストールしたサーバ監視ツール munin に各種監視を追加する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11.2.0 (bullseye; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;サーバ監視ツール munin がインストール済み。&lt;/li&gt;
  &lt;li&gt;ハードディスク温度の監視を追加する。&lt;/li&gt;
  &lt;li&gt;CPU 温度・電圧・ファン回転数の監視を追加する。&lt;/li&gt;
  &lt;li&gt;MariaDB の監視を追加する。&lt;/li&gt;
  &lt;li&gt;Nginx の監視を追加する。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-ハードディスク温度の監視追加&quot;&gt;1. ハードディスク温度の監視追加&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;smartctl&lt;/code&gt; コマンドを使用するので、以下のようにしてインストールしておく。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install smartmontools
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;以下のように設定ファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hddtemp_smartctl&lt;/code&gt; を作成する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;munin-node&lt;/code&gt; に追記してもよい）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/munin/plugin-conf.d/hddtemp_smartctl&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;hddtemp_smartctl]
user root
env.drives sda                 &lt;span class=&quot;c&quot;&gt;# &amp;lt;= sda は監視するハードディスク&lt;/span&gt;
env.smartctl /usr/sbin/smartctl
env.args_sda &lt;span class=&quot;nt&quot;&gt;--all&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; ata&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;以下のようにしてシンボリックリンクを張る。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ln -s /usr/share/munin/plugins/hddtemp_smartctl /etc/munin/plugins/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-cpu-温度電圧ファン回転数の監視追加&quot;&gt;2. CPU 温度・電圧・ファン回転数の監視追加&lt;/h3&gt;

&lt;p&gt;まず、センサーツール &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lm-sensors&lt;/code&gt;、依存パッケージをインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install lm-sensors libsensors4-dev fancontrol
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そして、センサーを検出する。&lt;br /&gt;
全て「エンター」応答で大丈夫だが、最後に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/modules&lt;/code&gt; へ書き込むかどうか問われたら &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yes&lt;/code&gt; 応答する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sensors-detect
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;マシンを再起動して、センサーをチェックしてみる。（当然、表示内容は環境により異なる）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sensors
dell_smm-virtual-0
Adapter: Virtual device
Processor Fan:   1800 RPM
Motherboard Fan: 1928 RPM

coretemp-isa-0000
Adapter: ISA adapter
Core 0:       +43.0°C  (high = +76.0°C, crit = +100.0°C)
Core 1:       +37.0°C  (high = +76.0°C, crit = +100.0°C)

it8720-isa-0a10
Adapter: ISA adapter
in0:          +1.07 V  (min =  +2.54 V, max =  +4.08 V)  ALARM
in1:          +1.10 V  (min =  +0.00 V, max =  +3.82 V)
in2:          +2.86 V  (min =  +0.00 V, max =  +3.02 V)
+5V:          +3.02 V  (min =  +4.06 V, max =  +4.08 V)  ALARM
in4:          +3.31 V  (min =  +0.00 V, max =  +4.08 V)
in5:          +2.16 V  (min =  +0.00 V, max =  +4.08 V)
in6:          +2.16 V  (min =  +0.00 V, max =  +4.08 V)
5VSB:         +2.98 V  (min =  +0.00 V, max =  +4.08 V)
Vbat:         +3.18 V
fan1:        1800 RPM  (min =   10 RPM)
fan2:        1928 RPM  (min =    0 RPM)
temp1:        +29.0°C  (low  = -65.0°C, high = +127.0°C)  sensor = thermal diode
temp2:        +22.0°C  (low  =  -2.0°C, high = +127.0°C)  sensor = thermistor
temp3:        +29.0°C  (low  =  -1.0°C, high = +127.0°C)  sensor = Intel PECI
cpu0_vid:    +0.000 V
intrusion0:  ALARM

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;以下のように設定ファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sensors&lt;/code&gt; を作成する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;munin-node&lt;/code&gt; に追記してもよい）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/munin/plugin-conf.d/sensors&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;sensors_&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
user root&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;以下のようにしてシンボリックリンクを張る。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ln -s /usr/share/munin/plugins/sensors_ /etc/munin/plugins/sensors_volt
# ln -s /usr/share/munin/plugins/sensors_ /etc/munin/plugins/sensors_temp
# ln -s /usr/share/munin/plugins/sensors_ /etc/munin/plugins/sensors_fan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-mariadb-の監視追加&quot;&gt;3. MariaDB の監視追加&lt;/h3&gt;

&lt;p&gt;以下のように設定ファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mariadb&lt;/code&gt; を作成する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;munin-node&lt;/code&gt; に追記してもよい）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/munin/plugin-conf.d/mariadb&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mariadb&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
env.mysqlopts &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; root &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;＜root パスワード＞
env.mysqladmin /usr/local/mysql/bin/mysqladmin   &lt;span class=&quot;c&quot;&gt;# &amp;lt;= mysqladmin フルパス指定&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;以下のようにしてシンボリックリンクを張る。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ln -s /usr/share/munin/plugins/mysql_bytes /etc/munin/plugins/mysql_bytes
# ln -s /usr/share/munin/plugins/mysql_innodb /etc/munin/plugins/mysql_innodb
# ln -s /usr/share/munin/plugins/mysql_isam_space_ /etc/munin/plugins/mysql_isam_space_  # &amp;lt;= MyISAM 不使用なら不要
# ln -s /usr/share/munin/plugins/mysql_queries /etc/munin/plugins/mysql_queries
# ln -s /usr/share/munin/plugins/mysql_slowqueries /etc/munin/plugins/mysql_slowqueries
# ln -s /usr/share/munin/plugins/mysql_threads /etc/munin/plugins/mysql_threads
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-nginx-の監視追加&quot;&gt;4. Nginx の監視追加&lt;/h3&gt;

&lt;p&gt;Nginx の設定ファイルに以下のような記述を追加する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server&lt;/code&gt; ディレクティブ内）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/nginx/conf.d/default.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# munin&lt;/span&gt;
    location /nginx_status &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        stub_status on&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        access_log off&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow 127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow 192.168.11.0/24&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 内部からのアクセスのみ許可&lt;/span&gt;
        deny all&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;Nginx をソースをビルドしてインストールしている場合は、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;configure&lt;/code&gt; 時に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--with-http_stub_status_module&lt;/code&gt; オプションを指定しなければならない。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;そして、Nginx を再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;以下のように設定ファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nginx&lt;/code&gt; を作成する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;munin-node&lt;/code&gt; に追記してもよい）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/munin/plugin-conf.d/nginx&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;nginx&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
env.url http://localhost/nginx_status&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;以下のようにしてシンボリックリンクを張る。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ln -s /usr/share/munin/plugins/nginx_request /etc/munin/plugins/nginx_request
# ln -s /usr/share/munin/plugins/nginx_status /etc/munin/plugins/nginx_status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ちなみに、上記以外のプラグインを使用するなら以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /usr/local/share
# mkdir munin
# cd munin
# git clone https://github.com/munin-monitoring/contrib.git
# ln -s /usr/local/share/munin/contrib/plugins/nginx/nginx_connection_request /etc/munin/plugins/nginx_connection_request
# ln -s /usr/local/share/munin/contrib/plugins/nginx/nginx-combined /etc/munin/plugins/nginx-combined
# ln -s /usr/local/share/munin/contrib/plugins/nginx/nginx_memory /etc/munin/plugins/nginx_memory
# ln -s /usr/local/share/munin/contrib/plugins/nginx/nginx_vhost_traffic /etc/munin/plugins/nginx_vhost_traffic
etc...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-munin-node-の再起動&quot;&gt;5. munin-node の再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart munin-node
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-動作確認&quot;&gt;6. 動作確認&lt;/h3&gt;

&lt;p&gt;ブラウザで &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://＜Webサーバのホスト名 or IP アドレス＞/munin&lt;/code&gt; にアクセスし、表示されることを確認する。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="munin" /><summary type="html">Debian GNU/Linux 11 (bullseye) にインストールしたサーバ監視ツール munin に各種監視を追加する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - サーバ監視ツール munin 導入！</title><link href="https://komasaru.github.io/2022/04/06/debian-11-munin-installation/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - サーバ監視ツール munin 導入！" /><published>2022-04-06T00:20:00+09:00</published><updated>2022-04-06T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/04/06/debian-11-munin-installation</id><content type="html" xml:base="https://komasaru.github.io/2022/04/06/debian-11-munin-installation/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) にサーバ監視ツール munin をインストールする方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11.2.0 (bullseye; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;Web サーバは Nginx を想定。&lt;/li&gt;
  &lt;li&gt;munin 用ディレクトリは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/munin&lt;/code&gt; とする。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-munin-のインストール&quot;&gt;1. munin のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install munin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-設定ファイルの編集&quot;&gt;2. 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/munin/munin.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;dbdir   /var/lib/munin    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
htmldir /var/www/munin    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除＆変更&lt;/span&gt;
logdir /var/log/munin     &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
rundir  /var/run/munin    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#[localhost.localdomain]  # &amp;lt;= コメント化（変更したければ）&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;foo.mk-mode.com]        &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加      （変更したければ）&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-ディレクトリの作成&quot;&gt;3. ディレクトリの作成&lt;/h3&gt;

&lt;p&gt;munin 用ディレクトリを所定の位置に作成する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir -p /var/www/munin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そして、所有者・所有グループを変更する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chown -R munin:munin /var/www/munin/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-監視項目の確認&quot;&gt;4. 監視項目の確認&lt;/h3&gt;

&lt;p&gt;以下のようにして、監視項目を確認できる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# munin-node-configure
Plugin                     | Used | Extra information
------                     | ---- | -----------------
acpi                       | no   |
amavis                     | no   |
apache_accesses            | no   |
         :
===&amp;lt; 途中省略 &amp;gt;===
         :
vserver_cpu_               | no   |
vserver_loadavg            | no   |
vserver_resources          | no   |
yum                        | no   |
zimbra_                    | no   |
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-web-サーバの設定&quot;&gt;5. Web サーバの設定&lt;/h3&gt;

&lt;p&gt;Web サーバに Nginx を使用する場合は、設定ファイルに以下のような記述を追加する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server&lt;/code&gt; ディレクティブ内に）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/nginx/conf.d/default.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    location /munin &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;alias&lt;/span&gt; /var/www/munin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        index index.html index.htm index&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow 127.0.0.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow 192.168.11.0/24&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        deny  all&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;6-web-サーバの再起動&quot;&gt;6. Web サーバの再起動&lt;/h3&gt;

&lt;p&gt;設定を有効化するために Web サーバ Nginx を再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-munin-node-の再起動&quot;&gt;7. munin-node の再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart munin-node
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-自動実行の設定&quot;&gt;8. 自動実行の設定&lt;/h3&gt;

&lt;p&gt;デフォルトで自動起動するようになっているが、なっていなければ設定する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl enable munin-node
Synchronizing state of munin-node.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable munin-node
insserv: warning: current start runlevel(s) (empty) of script `munin-node&apos; overrides LSB defaults (2 3 4 5).
insserv: warning: current stop runlevel(s) (0 1 2 3 4 5 6) of script `munin-node&apos; overrides LSB defaults (0 1 6).

# systemctl is-enabled munin-node
enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-動作確認&quot;&gt;9. 動作確認&lt;/h3&gt;

&lt;p&gt;５分ほど経過してから、ブラウザで &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://＜Webサーバのホスト名 or IP アドレス＞/munin&lt;/code&gt; にアクセスし、表示されることを確認する。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="munin" /><summary type="html">Debian GNU/Linux 11 (bullseye) にサーバ監視ツール munin をインストールする方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">2022年3月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2022/04/01/blog-access/" rel="alternate" type="text/html" title="2022年3月 - OS・ブラウザ別アクセス状況！" /><published>2022-04-01T00:20:00+09:00</published><updated>2022-04-01T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/04/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2022/04/01/blog-access/">&lt;p&gt;4月になりましたので、先月3月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20,632&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;67.9534&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6,864&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;22.6072&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,367&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.5023&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;986&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.2475&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;310&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0210&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;155&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5105&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;36&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1186&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0329&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OpenBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0033&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Wii&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0033&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;30,362&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,473&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;54.2553&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6,864&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;22.6072&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,831&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12.6177&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,367&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.5023&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;986&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.2475&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;310&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0210&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;262&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8629&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;155&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5105&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;36&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1186&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;XP&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;30&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0988&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NT&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0494&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;14&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0461&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0329&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0165&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Server 2003&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0066&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OpenBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0033&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Wii&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0033&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;30,362&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19,434&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;64.0076&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,809&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12.5453&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,661&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12.0578&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,006&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9.9005&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;432&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.4228&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla SeaMonkey&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0263&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Opera&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0231&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0132&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Epiphany&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0033&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;30,362&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.51&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6,402&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;21.0856&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,661&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12.0578&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98.0.4758.102&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,447&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11.3530&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.74&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,730&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8.9915&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.82&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,887&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6.2150&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9537.53&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,494&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.9206&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,455&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.7922&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,308&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.3080&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.84&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;900&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.9642&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;97.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;853&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.8094&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;833&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.7436&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98.0.4758.109&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;618&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.0354&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.83&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;481&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.5842&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;91.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;466&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.5348&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;11.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;409&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.3471&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98.0.4758.80&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;266&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8761&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.58&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;241&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7938&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;99.0.4844.73&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;238&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7839&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98.0.4758.101&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;228&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7509&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;97.0.4692.99&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;149&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4907&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;30,362&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">4月になりましたので、先月3月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 11 (bullseye) - PHP インストール（Nginx と連携）！</title><link href="https://komasaru.github.io/2022/03/30/debian-11-php-installation-by-src-with-nginx-cooperation/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - PHP インストール（Nginx と連携）！" /><published>2022-03-30T00:20:00+09:00</published><updated>2022-03-30T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/03/30/debian-11-php-installation-by-src-with-nginx-cooperation</id><content type="html" xml:base="https://komasaru.github.io/2022/03/30/debian-11-php-installation-by-src-with-nginx-cooperation/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) に PHP をソースをビルドしてインストールし、 Web／リバースプロキシサーバ Nginx と連携する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11.2.0 (bullseye; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;サーバ用途なので、作業は基本的に全て一般ユーザから root になって行う。&lt;/li&gt;
  &lt;li&gt;クライアント側も Debian GNU/Linux 11 (bullseye; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;Web サーバとして Apache2 でなく Nginx と連携させることを想定しているので、 Nginx がインストール済みであること。（参照： &lt;a href=&quot;/2022/02/02/debian-11-nginx-installation-by-official-apt&quot; title=&quot;Debian 11 (bullseye) - Web サーバ Nginx 構築（Nginx 公式リポジトリ使用）！&quot;&gt;Debian 11 (bullseye) - Web サーバ Nginx 構築（Nginx 公式リポジトリ使用）！&lt;/a&gt;）&lt;/li&gt;
  &lt;li&gt;標準リポジトリから PHP 7.4 系をインストールする。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1--php-のインストール&quot;&gt;1.  PHP のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install php php-cgi php-fpm php-common php-pear php-mbstring
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-インストールの確認&quot;&gt;2. インストールの確認&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# php -v
PHP 7.4.21 (cli) (built: Jul  2 2021 03:59:48) ( NTS )
Copyright (c) The PHP Group
Zend Engine v3.4.0, Copyright (c) Zend Technologies
    with Zend OPcache v7.4.21, Copyright (c), by Zend Technologies
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-php-fpm-設定ファイルの編集&quot;&gt;3. php-fpm 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;group&lt;/code&gt; 等を Nginx と同じものに編集する。&lt;br /&gt;
ついでに、ソケットファイルの設定も確認しておく。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/php/7.4/fpm/pool.d/www.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;user &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nginx              &lt;span class=&quot;c&quot;&gt;# &amp;lt;= www-data から変更&lt;/span&gt;
group &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nginx             &lt;span class=&quot;c&quot;&gt;# &amp;lt;= www-data から変更&lt;/span&gt;

listen.owner &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nginx      &lt;span class=&quot;c&quot;&gt;# &amp;lt;= www-data から変更&lt;/span&gt;
listen.group &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nginx      &lt;span class=&quot;c&quot;&gt;# &amp;lt;= www-data から変更&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;4-php-設定ファイルの編集&quot;&gt;4. PHP 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;タイムゾーンを設定する。（日本時間）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/php/7.4/fpm/php.ini&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Date]
&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Defines the default timezone used by the &lt;span class=&quot;nb&quot;&gt;date &lt;/span&gt;functions
&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; http://php.net/date.timezone
&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;date.timezone &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
date.timezone &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Asia/Tokyo  // &amp;lt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 追加&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;5-nginx-設定ファイルの編集&quot;&gt;5. Nginx 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/nginx/conf.d/default.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;location ~ &lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;php&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    root          html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    fastcgi_pass  unix:/run/php/php7.4-fpm.sock&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    fastcgi_index index.php&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    fastcgi_param SCRIPT_FILENAME  /var/www/html&lt;span class=&quot;nv&quot;&gt;$fastcgi_script_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    fastcgi_pass_header &lt;span class=&quot;s2&quot;&gt;&quot;X-Accel-Redirect&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    fastcgi_pass_header &lt;span class=&quot;s2&quot;&gt;&quot;X-Accel-Buffering&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    fastcgi_pass_header &lt;span class=&quot;s2&quot;&gt;&quot;X-Accel-Charset&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    fastcgi_pass_header &lt;span class=&quot;s2&quot;&gt;&quot;X-Accel-Expires&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    fastcgi_pass_header &lt;span class=&quot;s2&quot;&gt;&quot;X-Accel-Limit-Rate&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    include fastcgi_params&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;6-表示テスト用-php-ソースの作成&quot;&gt;6. 表示テスト用 PHP ソースの作成&lt;/h3&gt;

&lt;p&gt;ドキュメントルートへ以下のような内容の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;phpinfo.php&lt;/code&gt; を作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;phpinfo.php&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;phpinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;7-サービスの再起動&quot;&gt;7. サービスの再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart nginx
# systemctl restart php7.4-fpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-動作確認&quot;&gt;8. 動作確認&lt;/h3&gt;

&lt;p&gt;プラウザで &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://＜サーバアドレス＞/phpinfo.php&lt;/code&gt; にアクセスしてみて、 PHP 情報ページが表示されればよい。&lt;/p&gt;

&lt;h3 id=&quot;9-参考サイト&quot;&gt;9. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://jp2.php.net/manual/ja/install.unix.php&quot; title=&quot;PHP: Unix システムへのインストール - Manual&quot;&gt;PHP: Unix システムへのインストール - Manual&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="PHP" /><category term="Nginx" /><summary type="html">Debian GNU/Linux 11 (bullseye) に PHP をソースをビルドしてインストールし、 Web／リバースプロキシサーバ Nginx と連携する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - Git インストール（ソースビルド）！</title><link href="https://komasaru.github.io/2022/03/23/debian-11-git-installation-by-src/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - Git インストール（ソースビルド）！" /><published>2022-03-23T00:20:00+09:00</published><updated>2022-03-23T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/03/23/debian-11-git-installation-by-src</id><content type="html" xml:base="https://komasaru.github.io/2022/03/23/debian-11-git-installation-by-src/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) に Git サーバをソースをビルドしてインストールする方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11.2.0 (bullseye; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;Git 2.33.0 （当記事執筆時点で最新）を Git サーバとしてインストールすることを想定。&lt;/li&gt;
  &lt;li&gt;アーカイブ保存先は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/local/src&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;インストール先は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/local&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;クライアントからアクセスがあった時だけサーバを起動するために xinetd を使用する。&lt;/li&gt;
  &lt;li&gt;ドキュメント(doc, html, info)はインストールしない。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-依存パッケージのインストール&quot;&gt;1. 依存パッケージのインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install xinetd libcurl4-gnutls-dev libexpat1-dev \
gettext libz-dev libssl-dev
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-アーカイブファイルの取得展開&quot;&gt;2. アーカイブファイルの取得＆展開&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /usr/local/src
# wget https://www.kernel.org/pub/software/scm/git/git-2.33.0.tar.gz
# tar xvf git-2.33.0.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ちなみに、最新版のソースを使用したければ、以下のように取得すればよい。（既インストールの git を使用して）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# git clone https://github.com/git/git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-ビルドインストール&quot;&gt;3. ビルド＆インストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd git-2.33.0
# make configure
# ./configure --prefix=/usr/local
# make
# make install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-インストールの確認&quot;&gt;4. インストールの確認&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# git --version
git version 2.33.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-xinetd-設定ファイルの作成&quot;&gt;5. xinetd 設定ファイルの作成&lt;/h3&gt;

&lt;p&gt;デフォルトでは存在しないので作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/xinetd.d/git&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;service git
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        disable         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; no
        socket_type     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; stream
        &lt;span class=&quot;nb&quot;&gt;wait&lt;/span&gt;            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; no
        user            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; nobody
        server          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /usr/local/libexec/git-core/git-daemon
        server_args     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--base-path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/var/lib/git &lt;span class=&quot;nt&quot;&gt;--export-all&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--user-path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;public_git &lt;span class=&quot;nt&quot;&gt;--syslog&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--inetd&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--verbose&lt;/span&gt;
        log_on_failure  +&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; USERID
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-xinetd-の再起動&quot;&gt;6. Xinetd の再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart xinetd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-リポジトリの作成&quot;&gt;7. リポジトリの作成&lt;/h3&gt;

&lt;p&gt;作成先は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/xinetd.d/git&lt;/code&gt; の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--base-path&lt;/code&gt; で指定している &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/git/&lt;/code&gt; とした。（以下は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;test.git&lt;/code&gt; という Git リポジトリを作成する例）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /var/lib/
# mkdir -p git/public_git
# cd git/public_git
# git --bare init --shared test.git
Initialized empty shared Git repository in /var/lib/git/public_git/test.git/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-git-用グループの作成&quot;&gt;8. Git 用グループの作成&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# groupadd git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-権限の変更&quot;&gt;9. 権限の変更&lt;/h3&gt;

&lt;p&gt;リポジトリの所有者・所有グループを変更する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chown -R root:git test.git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;10-リポジトリのディレクトリを確認&quot;&gt;10. リポジトリのディレクトリを確認&lt;/h3&gt;

&lt;p&gt;現状のリポジトリ内を確認してみる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ls -l
合計 32
-rw-rw-r-- 1 root git   23 10月  2 12:05 HEAD
drwxrwsr-x 2 root git 4096 10月  2 12:05 branches
-rw-rw-r-- 1 root git  126 10月  2 12:05 config
-rw-rw-r-- 1 root git   73 10月  2 12:05 description
drwxrwsr-x 2 root git 4096 10月  2 12:05 hooks
drwxrwsr-x 2 root git 4096 10月  2 12:05 info
drwxrwsr-x 4 root git 4096 10月  2 12:05 objects
drwxrwsr-x 4 root git 4096 10月  2 12:05 refs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;11-動作確認&quot;&gt;11. 動作確認&lt;/h3&gt;

&lt;p&gt;ここではクライアント側からの操作について説明はしないが、各種作業を行い問題がないことを確認しておく。&lt;br /&gt;
(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;git status&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;git add&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;git clone&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;git push&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;git pull&lt;/code&gt; etc.)&lt;/p&gt;

&lt;h3 id=&quot;12-参考サイト&quot;&gt;12. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://git-scm.com/downloads&quot; title=&quot;Git - Downloads&quot;&gt;Git - Downloads&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://git-scm.com/book/en/v2/Getting-Started-Installing-Git&quot; title=&quot;Git - Installing Git &quot;&gt;Git - Installing Git &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Git" /><summary type="html">Debian GNU/Linux 11 (bullseye) に Git サーバをソースをビルドしてインストールする方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - 自動バックアップ運用！</title><link href="https://komasaru.github.io/2022/03/16/debian-11-automatic-backup-setting/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - 自動バックアップ運用！" /><published>2022-03-16T00:20:00+09:00</published><updated>2022-03-16T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/03/16/debian-11-automatic-backup-setting</id><content type="html" xml:base="https://komasaru.github.io/2022/03/16/debian-11-automatic-backup-setting/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) で自動バックアップ運用する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11.2.0 (bullseye; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;バックファイルを配置するディレクトリは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/foo/bak&lt;/code&gt; （foo ユーザのホーム内の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bak&lt;/code&gt; ディレクトリ）とする。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-バックアップスクリプトの作成&quot;&gt;1. バックアップスクリプトの作成&lt;/h3&gt;

&lt;p&gt;以下のような内容でバックアップスクリプトを作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/root/backup.sh&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ローカル内でバックアップ&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;LANG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;C

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 設定開始&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# バックアップ対象リスト名&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ※バックアップ対象をフルパスで記述したリスト&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;BACKUPLIST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/root/backuplist
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLIST&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$BACKUPLIST&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; is not found&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; error_exit

&lt;span class=&quot;c&quot;&gt;# バックアップ対象外リスト名&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ※バックアップ対象外をフルパスで記述したリスト&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;BACKUPNOLIST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/root/backupnolist

&lt;span class=&quot;c&quot;&gt;# バックアップ先ディレクトリ名&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;BACKUPDIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/home/foo/bak
&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# バックアップ保存世代数&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ※当日分を含めた過去分バックアップを保存する世代数&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ※過去分バックアップを保存しない場合は1を指定する&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;BACKUPGEN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8

&lt;span class=&quot;c&quot;&gt;# 暗号化・復号化パスフレーズ&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ※指定がないときは暗号化しない&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;PASS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# バックアップログファイル名&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;BACKUPLOG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/var/log/backup.log

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 設定終了&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# 異常終了処理関数定義&lt;/span&gt;
error_exit &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TMPBACKUPNOLIST&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# バックアップファイルをバックアップ対象外リストに追加&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ※バックアップ先ファイルをバックアップしないようにする&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;TMPBACKUPNOLIST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mktemp&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPNOLIST&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPNOLIST&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TMPBACKUPNOLIST&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/*backup.tar.bz2&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TMPBACKUPNOLIST&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# 前回バックアップをリネーム&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;OLDBACKUPFILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls &lt;/span&gt;backup.tar.bz2&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$OLDBACKUPFILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TIMESTAMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--full-time&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$OLDBACKUPFILE&lt;/span&gt;|awk &lt;span class=&quot;s1&quot;&gt;&apos;{print $6}&apos;&lt;/span&gt;|tr &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; -&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;mv&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/&lt;span class=&quot;nv&quot;&gt;$OLDBACKUPFILE&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TIMESTAMP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$OLDBACKUPFILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null 2&amp;gt;&amp;amp;1
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# バックアップログファイル作成&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;touch&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;chmod &lt;/span&gt;400 &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# バックアップ実行&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; backup start&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# -X オプションが効かない =&amp;gt; 削除&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#tar cjvfP $BACKUPDIR/backup.tar.bz2 -T $BACKUPLIST -X $TMPBACKUPNOLIST &amp;gt;&amp;gt; $BACKUPLOG 2&amp;gt;&amp;amp;1&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;tar &lt;/span&gt;cjvfP &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/backup.tar.bz2 &lt;span class=&quot;nt&quot;&gt;-T&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLIST&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt; 2&amp;gt;&amp;amp;1
&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$?&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$code&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt; | mail &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;BACKUP NG CODE IS &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$code&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; root
    &lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/backup.tar.bz2
    error_exit
&lt;span class=&quot;k&quot;&gt;fi
&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; backup end&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# バックアップ暗号化(暗号化・復号化パスフレーズ指定時のみ)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$PASS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; encrypt start&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.gnupg
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$PASS&lt;/span&gt;|gpg &lt;span class=&quot;nt&quot;&gt;--passphrase-fd&lt;/span&gt; 0 &lt;span class=&quot;nt&quot;&gt;--batch&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/backup.tar.bz2 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$?&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$code&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt; | mail &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;BACKUP NG CODE IS &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$code&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; root
        &lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/backup.tar.bz2&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
        error_exit
    &lt;span class=&quot;k&quot;&gt;fi
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/backup.tar.bz2
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; encrypt end&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPLOG&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# バックアップ保存世代を超えた古いバックアップを削除&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;backup.tar.bz2&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;|wc &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-gt&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPGEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;OLDBACKUPCNT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;expr&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;backup.tar.bz2&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;|wc &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt; - &lt;span class=&quot;nv&quot;&gt;$BACKUPGEN&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;file &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUPDIR&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;backup.tar.bz2&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;|tail &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$OLDBACKUPCNT&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$file&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;done
fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# バックアップ対象外リスト削除&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TMPBACKUPNOLIST&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-実行権限の付与&quot;&gt;2. 実行権限の付与&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chmod +x backup.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-バックアップ対象リストの作成&quot;&gt;3. バックアップ対象リストの作成&lt;/h3&gt;

&lt;p&gt;バックアップするディレクトリやファイルを一覧にしたファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;backuplist&lt;/code&gt; を以下のように作成する。（以下は単なる一例。内容は適宜編集すること。そして、最終行で改行しないこと）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/root/backuplist&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/home
/root
/var/www
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-バックアップ対象外リストの作成&quot;&gt;4. バックアップ対象外リストの作成&lt;/h3&gt;

&lt;p&gt;バックアップ対象のディレクトリやファイルの中でもバックアップしたくないディレクトリやファイルを一覧にしたファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;backupnolist&lt;/code&gt; を以下のように作成する。（以下は単なる一例。内容は適宜編集すること。そして、最終行で改行しないこと。また、対象外にするディレクトリやファイルが無ければ作成しなくてよい）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/root/backupnolist&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/home/hoge
/var/www/fuga
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-バックアップの実行&quot;&gt;5. バックアップの実行&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ./backup.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;バックアップディレクトリにアーカイブファイルが作成されるはずである。&lt;br /&gt;
また、ファイルが増えれば最大８世代残すようになっている。（そういうスクリプトにしているから）（以下は、8日経過後の様子）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ls -l /home/bak/
total 522
-rw-r--r-- 1 root root     84205 Jun 30 03:01 20150430backup.tar.bz2
-rw-r--r-- 1 root root     84276 Jul  1 03:01 20150501backup.tar.bz2
-rw-r--r-- 1 root root     84336 Jul  2 03:01 20150502backup.tar.bz2
-rw-r--r-- 1 root root     84133 Jul  3 03:01 20150503backup.tar.bz2
-rw-r--r-- 1 root root     84140 Jul  4 03:01 20150504backup.tar.bz2
-rw-r--r-- 1 root root     84029 Jul  5 03:01 20150505backup.tar.bz2
-rw-r--r-- 1 root root     84124 Jul  6 03:01 20150506backup.tar.bz2
-rw-r--r-- 1 root root     84128 Jul  7 03:01 backup.tar.bz2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-自動実行の設定&quot;&gt;6. 自動実行の設定&lt;/h3&gt;

&lt;p&gt;毎日定時に実行するよう cron 登録する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/cron.d/backup&lt;/code&gt; を以下の内容で作成する）&lt;br /&gt;
以下は毎日午前3時1分にバックアップスクリプトを実行する例。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/cron.d/backup&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1 3 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; root /root/backup.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-参考サイト&quot;&gt;7. 参考サイト&lt;/h3&gt;

&lt;p&gt;CentOS での自動バックアップ運用を参考にしている（流用している）。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://centossrv.com/backup.shtml&quot; title=&quot;自動バックアップ運用(tar+GnuPG+rsync/ftp) - CentOSで自宅サーバー構築&quot;&gt;自動バックアップ運用(tar+GnuPG+rsync/ftp) - CentOSで自宅サーバー構築&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><summary type="html">Debian GNU/Linux 11 (bullseye) で自動バックアップ運用する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - ログ解析ツール logwatch インストール！</title><link href="https://komasaru.github.io/2022/03/12/debian-11-logwatch-installation/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - ログ解析ツール logwatch インストール！" /><published>2022-03-12T00:20:00+09:00</published><updated>2022-03-12T00:20:00+09:00</updated><id>https://komasaru.github.io/2022/03/12/debian-11-logwatch-installation</id><content type="html" xml:base="https://komasaru.github.io/2022/03/12/debian-11-logwatch-installation/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) にログ監視ツール LogWatch をインストールする方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11 (bullseye; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-logwatch-のインストール&quot;&gt;1. logwatch のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install logwatch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-logwatch-設定ファイルの編集&quot;&gt;2. logwatch 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;まず、デフォルトの設定ファイルを複製する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cp /usr/share/logwatch/default.conf/logwatch.conf /etc/logwatch/conf/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;デフォルトの設定で充分であるが、必要なら編集する。&lt;br /&gt;
メールの送信先等を変更するなら以下のようにする。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/logwatch/conf/logwatch.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;MailTo &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; hoge@xxxx.com  &lt;span class=&quot;c&quot;&gt;# &amp;lt; = メール送信先&lt;/span&gt;
Detail &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; High           &lt;span class=&quot;c&quot;&gt;# &amp;lt; = ログの詳細レベル (Low(0), Med(5), High(10) か 1～10 の整数)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-ディレクトリの作成&quot;&gt;3. ディレクトリの作成&lt;/h3&gt;

&lt;p&gt;キャッシュで使用するディレクトリが無いので作成しておく。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir /var/cache/logwatch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-動作確認&quot;&gt;4. 動作確認&lt;/h3&gt;

&lt;p&gt;logwatch をインストールするとデフォルトで cron 登録されるので、毎日レポートメールが届くはずである。後はそのメール内容をチェックする。&lt;br /&gt;
今すぐに確認したければ、以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /etc/cron.daily/00logwatch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;以下のような内容のメールが届くはずである。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
 ################### Logwatch 7.5.5 (01/22/21) ####################
        Processing Initiated: Sun Sep 19 16:15:39 2021
        Date Range Processed: yesterday
                              ( 2021-Sep-18 )
                              Period is day.
        Detail Level of Output: 0
        Type of Output/Format: mail / text
        Logfiles for Host: vbox
 ##################################################################

         :
====&amp;lt; 以下省略 &amp;gt;====
         :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><summary type="html">Debian GNU/Linux 11 (bullseye) にログ監視ツール LogWatch をインストールする方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry></feed>