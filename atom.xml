<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator><link href="https://komasaru.github.io/atom.xml" rel="self" type="application/atom+xml" /><link href="https://komasaru.github.io/" rel="alternate" type="text/html" /><updated>2021-11-02T09:44:52+09:00</updated><id>https://komasaru.github.io/atom.xml</id><title type="html">mk-mode BLOG</title><subtitle>このブログは自宅サーバ(Debian GNU/Linux)で運用してしている&lt;a href=&quot;https://www.mk-mode.com/blog/&quot;&gt;ブログ&lt;/a&gt;のクローンです。&lt;br /&gt;PC・サーバ構築等の話題を中心に公開しております。</subtitle><author><name>mk-mode.com</name></author><entry><title type="html">Debian 11 (bullseye) - DNS サーバ BIND9 構築！</title><link href="https://komasaru.github.io/2021/11/03/debian-11-bind-installation/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - DNS サーバ BIND9 構築！" /><published>2021-11-03T00:20:00+09:00</published><updated>2021-11-03T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/11/03/debian-11-bind-installation</id><content type="html" xml:base="https://komasaru.github.io/2021/11/03/debian-11-bind-installation/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) に DNS サーバを構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11.0.0 (bullseye; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;サーバのローカル IP アドレスは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.101&lt;/code&gt;、グローバル IP アドレスは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xxx.yyy.zzz.aaa&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、マシンのホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vbox&lt;/code&gt;、ネームサーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ns&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;セカンダリ DNS は用意しない。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-bind-のインストール&quot;&gt;1. BIND のインストール&lt;/h3&gt;

&lt;p&gt;（dnsutils は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dig&lt;/code&gt; コマンド用）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install bind9 dnsutils
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-bind-設定ファイルの編集&quot;&gt;2. BIND 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.options&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.local&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#include &quot;/etc/bind/named.conf.default-zones&quot;;  # &amp;lt;= コメント化（内部向け・外部向けゾーンファイルで定義するので）&lt;/span&gt;
include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.internal-zones&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt; = 追加&lt;/span&gt;
include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.external-zones&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt; = 追加&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-内部向けゾーンファイルの作成&quot;&gt;3. 内部向けゾーンファイルの作成&lt;/h3&gt;

&lt;p&gt;BIND 設定ファイルで指定している内部向けゾーンファイルを以下のように作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf.internal-zones&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;view &lt;span class=&quot;s2&quot;&gt;&quot;internal&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# 内部向け設定の対象範囲定義&lt;/span&gt;
    match-clients &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        192.168.11.0/24&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 内部向け正引きゾーン定義&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;mk-mode.com&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/mk-mode.com.lan&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 内部向け逆引きゾーン定義&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;11.168.192.in-addr.arpa&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/11.168.192.db&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.default-zones&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    empty-zones-enable no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;最後の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;empty-zones-enable no;&lt;/code&gt; は、ログに以下のようなメッセージが出力されないための対処。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Warning: view internal: &apos;empty-zones-enable/disable-empty-zone&apos; not set: disabling RFC 1918 empty zones
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-外部向けゾーンファイルの作成&quot;&gt;4. 外部向けゾーンファイルの作成&lt;/h3&gt;

&lt;p&gt;BIND 設定ファイルで指定している外部向けゾーンファイルを以下のように作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf.external-zones&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;view &lt;span class=&quot;s2&quot;&gt;&quot;external&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    match-clients &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# 全て対象（内部向け範囲以外のホスト）&lt;/span&gt;
    allow-query &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# 問い合わせは全て許可&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#recursion no;            # 再帰検索禁止&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 外部向け正引きゾーン定義&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;mk-mode.com&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/mk-mode.com.wan&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 外部向け正引き情報を定義 *注&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;zzz.yyy.xxx.in-addr.arpa&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/zzz.yyy.xxx.db&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;5-オプション設定ファイルの編集&quot;&gt;5. オプション設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;その他の設定用ファイルを以下のように編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf.options&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;options &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        directory &lt;span class=&quot;s2&quot;&gt;&quot;/var/cache/bind&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        // 問合わせを許可する範囲
        // &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;サーバー、ローカルネットワーク内のホストからの問合せのみ許可&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        allow-query &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; localnets&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;      &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

        // ゾーン情報の転送を許可する範囲
        // &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;サーバー、ローカルネットワーク内のホストへのみ転送を許可&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; localnets&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

        // 再帰検索を許可する範囲
        // &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;サーバー、ローカルネットワーク内のホストのみ再検索を許可&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        allow-recursion &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; localnets&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

        dnssec-validation auto&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        auth-nxdomain no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;# conform to RFC1035&lt;/span&gt;

        // IPv6 は使用しないので無効化
        //listen-on-v6 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        listen-on-v6 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# EDNS0 の無効化&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# &quot;error (unexpected RCODE REFUSED) ...&quot; 出力の抑止&lt;/span&gt;
server 0.0.0.0 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        edns no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# &quot;DNS format error ... invalid response&quot; 出力の抑止&lt;/span&gt;
logging &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        category resolver &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;6-内部向け正引きゾーン定義ファイルの作成&quot;&gt;6. 内部向け正引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/mk-mode.com.lan&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2021083101  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  A       192.168.11.101
        IN  MX 10   ns.mk-mode.com.
ns      IN  A       192.168.11.101
vbox    IN  A       192.168.11.101
hoge    IN  A       192.168.11.2
fuga    IN  A       192.168.11.3
www     IN  CNAME   ns.mk-mode.com.
ftp     IN  CNAME   ns.mk-mode.com.
mail    IN  CNAME   ns.mk-mode.com.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hoge&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fuga&lt;/code&gt; はローカルネットワーク内の別のマシン。&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ftp&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mail&lt;/code&gt; は別名定義。&lt;/p&gt;

&lt;h3 id=&quot;7-外部向け正引きゾーン定義ファイルの作成&quot;&gt;7. 外部向け正引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/mk-mode.com.wan&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2021083101  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  A       xxx.yyy.zzz.aaa
        IN  MX 10   ns.mk-mode.com.
ns      IN  A       xxx.yyy.zzz.aaa&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;8-内部向け逆引きゾーン定義ファイルの作成&quot;&gt;8. 内部向け逆引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/11.168.192.db&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2021083101  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  PTR     mk-mode.com.
        IN  A       255.255.255.0
101     IN  PTR     ns.mk-mode.com.
101     IN  PTR     vbox.mk-mode.com.
2       IN  PTR     hoge.mk-mode.com.
3       IN  PTR     fuga.mk-mode.com.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;9-外部向け逆引きゾーン定義ファイルの作成&quot;&gt;9. 外部向け逆引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/zzz.yyy.xxx.db&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2021083101  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  PTR     mk-mode.com.
        IN  A       255.255.255.254
aaa     IN  PTR     ns.mk-mode.com.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;255.255.255.254&lt;/code&gt; はグローバル IP が１個のみの場合の設定値）&lt;/p&gt;

&lt;h3 id=&quot;10-問合せ先-dns-サーバの追加&quot;&gt;10. 問合せ先 DNS サーバの追加&lt;/h3&gt;

&lt;p&gt;DNS サーバー自身も問合せ先に追加する。&lt;br /&gt;
最初から記載のあるルータの IP アドレス（インストール・初期設定時のもの）をセカンダリ、今回構築のサーバ自身をプライマリに設定するので、ルータより先に記述する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/resolv.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;#domain localdomain        # &amp;lt;= コメント化&lt;/span&gt;
domain mk-mode.com         &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#search localdomain        # &amp;lt;= コメント化&lt;/span&gt;
search mk-mode.com         &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;
nameserver 192.168.11.101  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;
nameserver 192.168.11.1    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= ルータの IP アドレス&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;11-ipv6-の無効化設定&quot;&gt;11. IPv6 の無効化設定&lt;/h3&gt;

&lt;p&gt;システムとして IPv6 を無効にしている場合は、以下のように &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/named&lt;/code&gt; を編集する。&lt;br /&gt;
（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/log/syslog&lt;/code&gt; に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;... named[9999]: error (network unreachable) resolving ...&lt;/code&gt; のようなエラーが出力されないようにするため）&lt;br /&gt;
※かつては、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;named&lt;/code&gt; というファイル名ではなく &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bind9&lt;/code&gt; というファイル名だった。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/named&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;OPTIONS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-u bind -4&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;12-bind-の再起動&quot;&gt;12. BIND の再起動&lt;/h3&gt;

&lt;p&gt;設定を有効化するために BIND を再起動する。（サービス名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bind9&lt;/code&gt; も可）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart named
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;13-動作確認&quot;&gt;13. 動作確認&lt;/h3&gt;

&lt;p&gt;DNS サーバが正常に機能する（正引きで IP アドレス、逆引きでホスト名が返ってくる）か、確認してみる。&lt;/p&gt;

&lt;p&gt;【内部向け正引きテスト】&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig ns.mk-mode.com.

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.16.15-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; ns.mk-mode.com.
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 42607
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: feae014ca532b70b01000000612d88232c502b8a27dff786 (good)
;; QUESTION SECTION:
;ns.mk-mode.com.                        IN      A

;; ANSWER SECTION:
ns.mk-mode.com.         86400   IN      A       192.168.11.101

;; Query time: 8 msec
;; SERVER: 192.168.11.101#53(192.168.11.101)
;; WHEN: Tue Aug 31 10:38:43 JST 2021
;; MSG SIZE  rcvd: 87

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;【内部向け逆引きテスト】&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig -x 192.168.11.101

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.16.15-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; -x 192.168.11.101
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 30868
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 1a0f1c91c39ba3aa01000000612d885de1fc62bcd5c5375a (good)
;; QUESTION SECTION:
;101.11.168.192.in-addr.arpa.   IN      PTR

;; ANSWER SECTION:
101.11.168.192.in-addr.arpa. 86400 IN   PTR     ns.mk-mode.com.
101.11.168.192.in-addr.arpa. 86400 IN   PTR     vbox.mk-mode.com.

;; Query time: 3 msec
;; SERVER: 192.168.11.101#53(192.168.11.101)
;; WHEN: Tue Aug 31 10:39:41 JST 2021
;; MSG SIZE  rcvd: 131

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;【外部向け正引きテスト】&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig www.isc.org

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.16.15-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; www.isc.org
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 1984
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;www.isc.org.                   IN      A

;; ANSWER SECTION:
www.isc.org.            60      IN      CNAME   dualstack.osff2.map.fastly.net.
dualstack.osff2.map.fastly.net. 4 IN    A       151.101.90.217

;; Query time: 175 msec
;; SERVER: 192.168.11.1#53(192.168.11.1)
;; WHEN: Tue Aug 31 10:40:24 JST 2021
;; MSG SIZE  rcvd: 100

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;【外部向け逆引きテスト】&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig -x 151.101.90.217

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.16.15-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; -x 151.101.90.217
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NXDOMAIN, id: 60481
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;217.90.101.151.in-addr.arpa.   IN      PTR

;; AUTHORITY SECTION:
151.in-addr.arpa.       749     IN      SOA     pri.authdns.ripe.net. dns.ripe.net. 1630366598 3600 600 864000 3600

;; Query time: 55 msec
;; SERVER: 192.168.11.1#53(192.168.11.1)
;; WHEN: Tue Aug 31 10:40:49 JST 2021
;; MSG SIZE  rcvd: 116

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;14-ファイアウォール-ufw-の設定&quot;&gt;14. ファイアウォール (ufw) の設定&lt;/h3&gt;

&lt;p&gt;実際に運用する場合は、外部からのTCP/UDP53番ポート(DNS)へのアクセスを許可する必要がある。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 53
Rule added

# ufw status
Status: active

To                         Action      From
--                         ------      ----
9999/tcp                   ALLOW       192.168.11.0/24
53                         ALLOW       Anywhere
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="DNS" /><summary type="html">Debian GNU/Linux 11 (bullseye) に DNS サーバを構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">2021年10月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2021/11/01/blog-access/" rel="alternate" type="text/html" title="2021年10月 - OS・ブラウザ別アクセス状況！" /><published>2021-11-01T00:20:00+09:00</published><updated>2021-11-01T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/11/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2021/11/01/blog-access/">&lt;p&gt;11月になりましたので、先月10月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;28,077&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;66.4403&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10,216&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24.1747&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,622&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.8382&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,480&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.5022&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;634&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.5003&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;166&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3928&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;46&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1089&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0189&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0189&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OpenBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0047&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42,259&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;22,849&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;54.0690&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10,216&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24.1747&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,663&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11.0343&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,622&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.8382&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,480&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.5022&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;634&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.5003&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;493&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.1666&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;166&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3928&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;46&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1089&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0994&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;XP&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;23&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0544&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0189&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0189&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Vista&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0071&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OpenBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0047&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0047&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0047&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42,259&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;26,644&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;63.0493&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6,256&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;14.8039&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,526&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10.7101&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,013&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9.4962&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;809&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.9144&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla SeaMonkey&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0189&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0047&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0024&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42,259&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;94.0.4606.81&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9,709&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;22.9750&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;94.0.4606.71&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5,937&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;14.0491&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,526&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10.7101&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;95.0.4638.54&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,758&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8.8928&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;94.0.4606.61&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,101&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7.3381&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,046&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7.2079&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;93.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,149&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.0853&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9537.53&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,889&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.4701&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,295&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.0644&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;93.0.4577.82&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,057&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.5012&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;11.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;789&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.8671&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;92.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;789&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.8671&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;78.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;604&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.4293&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;94.0.4606.85&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;450&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0649&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;93.0.4577.63&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;335&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7927&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;92.0.4515.159&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;283&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6697&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;95.0.4638.50&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;150&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3550&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;92.0.4515.131&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;145&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3431&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;95.0.4638.69&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;124&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2934&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;92.0.4515.107&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2366&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42,259&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">11月になりましたので、先月10月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 11 (bullseye) - サービスの管理！</title><link href="https://komasaru.github.io/2021/10/27/debian-11-service-management/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - サービスの管理！" /><published>2021-10-27T00:20:00+09:00</published><updated>2021-10-27T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/10/27/debian-11-service-management</id><content type="html" xml:base="https://komasaru.github.io/2021/10/27/debian-11-service-management/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) でのサービスの管理についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11 (bullseye) での作業を想定。&lt;/li&gt;
  &lt;li&gt;SystemD の簡単な使用法の説明と SysVinit の導入を行う。&lt;br /&gt;
（当方、普段は SystemD でサービスの管理を行うが、有事の際に備えて &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; コマンドも使用できるよう準備しておく（RedHat 系ディストリビューションのサービス管理ツール &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chkconfig&lt;/code&gt; にあたるもの））&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-systemd-の使用方法&quot;&gt;1. SystemD の使用方法&lt;/h3&gt;

&lt;p&gt;以下は vsftpd サーバの例。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vsftpd.service&lt;/code&gt; が正式なサービス名だが &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.service&lt;/code&gt; は省略可能）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ systemctl start vsftpd        # &amp;lt;= vsftpd サービスの起動
$ systemctl stop vsftpd         # &amp;lt;= vsftpd サービスの停止
$ systemctl status vsftpd       # &amp;lt;= vsftpd サービスの状況確認
$ systemctl enable vsftpd       # &amp;lt;= vsftpd サービスの自動起動設定
$ systemctl disble vsftpd       # &amp;lt;= vsftpd サービスの自動起動解除
$ systemctl is-enabled vsftpd   # &amp;lt;= vsftpd サービスが自動起動設定されているか
$ systemctl list-unit-files -t service | grep vsftpd  # &amp;lt;= vsftpd 起動設定の確認
$ systemctl -t service          # &amp;lt;= 起動中サービス一覧の確認
$ systemctl -t service --all    # &amp;lt;= 全サービス一覧の確認
$ systemctl poweroff            # &amp;lt;= システム Shutdown 後電源 OFF
$ systemctl halt                # &amp;lt;= システム Shutdown 後 Halt
$ systemctl reboot              # &amp;lt;= システム Shutdown 後リブート
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SystemD 未対応のサービスの場合でも自動で従来の SysVinit にサービスの管理を移譲しますが、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;systemctl list-unit-files&lt;/code&gt; での確認はできないので注意。&lt;/p&gt;

&lt;h3 id=&quot;2-sysv-rc-conf-のインストール&quot;&gt;2. sysv-rc-conf のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install sysv-rc-conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-sysv-rc-conf-でサービス一覧表示&quot;&gt;3. sysv-rc-conf でサービス一覧表示&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; でサービスの一覧を表示するには以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sysv-rc-conf --list
apparmor     S:on
chrony       0:off      1:off   2:on    3:on    4:on    5:on    6:off
clamav-daemo 0:off      1:off   2:on    3:on    4:on    5:on    6:off
clamav-fresh 0:off      1:off   2:on    3:on    4:on    5:on    6:off
cron         2:on       3:on    4:on    5:on
dbus         2:on       3:on    4:on    5:on
         :
====&amp;lt; 途中省略 &amp;gt;====
         :
sudo         2:on       3:on    4:on    5:on
udev         0:off      6:off   S:on
ufw          1:off      S:on
unattended-u 0:off      2:on    3:on    4:on    5:on    6:off
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-sysv-rc-conf-でのサービス自動起動設定&quot;&gt;4. sysv-rc-conf でのサービス自動起動設定&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; でサービスの自動起動を有効化・無効化するには以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sysv-rc-conf acpid off  # acpid の自動起動無効化する場合

# sysv-rc-conf acpid on   # acpid の自動起動有効化する場合
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-一覧形式での自動起動設定&quot;&gt;5. 一覧形式での自動起動設定&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; をオプション無しで実行すると以下のような画面になる。（ある程度のサイズのコンソール画面が必要）&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-&lt;/code&gt; でサービス停止、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;=&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;+&lt;/code&gt; でサービス開始、スペースでランレベル別に ON/OFF できる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌ SysV Runlevel Config   -: stop service  =/+: start service  h: help  q: qu$ ┐
│                                                                             │
│ service      1       2       3       4       5       0       6       S      │
│ --------------------------------------------------------------------------$ │
│ chrony      [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]     │
│ clamav-da$  [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]     │
│ clamav-fr$  [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]     │
│ cron        [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]     │
│ dbus        [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]     │
│ exim4       [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────────────────────┐
│ Use the arrow keys or mouse to move around.      ^n: next pg     ^p: prev $ │
│                        space: toggle service on / off                       │
└─────────────────────────────────────────────────────────────────────────────
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-insserv-コマンドの利用&quot;&gt;6. insserv コマンドの利用&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; をインストールして使用しなくても、デフォルトで用意されている &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;insserv&lt;/code&gt; コマンドを使用することも可能である。※しかし、当記事執筆時点では、エラーとなる。当項最後を参照&lt;/p&gt;

&lt;p&gt;以下のコマンドでサービスの一覧（終了・起動時のランレベル等）を表示する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-s&lt;/code&gt; は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--showall&lt;/code&gt; でもよい）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# insserv -s
K:01:0 1 6:chrony
K:03:0 1 6:rsyslog
K:02:0 6:networking
K:04:0 6:hwclock.sh
K:01:0 6:unattended-upgrades
         :
====&amp;lt; 途中省略 &amp;gt;====
         :
S:01:2 3 4 5:console-setup.sh
S:03:S:x11-common
S:03:S:procps
S:02:S:keyboard-setup.sh
S:05:S:kmod
S:02:2 3 4 5:sudo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;サービスの自動起動を無効化するには以下のようにする。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-r&lt;/code&gt; は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--remove&lt;/code&gt; でもよい）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# insserv -r hoge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;サービスの自動起動を有効化するには以下のようにする。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-d&lt;/code&gt; は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--default&lt;/code&gt; でもよい）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# insserv -d hoge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;210830 時点では、以下のようなエラーとなる。（未調査）&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ insserv -s
insserv: FATAL: service mountkernfs has to exist for service udev
insserv: FATAL: service urandom has to exist for service networking
insserv: FATAL: service mountdevsubfs has to exist for service lvm2
insserv: exiting now!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><summary type="html">Debian GNU/Linux 11 (bullseye) でのサービスの管理についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - ファイアウォール設定！</title><link href="https://komasaru.github.io/2021/10/20/debian-11-firewall-setting/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - ファイアウォール設定！" /><published>2021-10-20T00:20:00+09:00</published><updated>2021-10-20T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/10/20/debian-11-firewall-setting</id><content type="html" xml:base="https://komasaru.github.io/2021/10/20/debian-11-firewall-setting/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) でファイアウォールを設定する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11 (bullseye) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンは Debian GNU/Linux 10 (buster; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;ufw (= Uncomplicated Firewall) という iptables のフロントエンドツールを使用する。&lt;/li&gt;
  &lt;li&gt;ファイアウォールのルールは、取り急ぎ最低限の設定のみ。（運用する環境やインストールしたサービスに合わせて適宜行う）&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-ufw-のインストール&quot;&gt;1. ufw のインストール&lt;/h3&gt;

&lt;p&gt;依存する iptables 等もインストールされる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install ufw
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-設定ファイルの編集&quot;&gt;2. 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;IPv6 を使用しない場合は以下のように編集しておく&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/ufw&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;IPV6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-各種コマンドについて&quot;&gt;3. 各種コマンドについて&lt;/h3&gt;

&lt;p&gt;各種コマンドの使用法について簡単に説明する。&lt;br /&gt;
（以下のサービス名、ポート番号は一例）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw status            # &amp;lt;= 状況確認
# ufw enable            # &amp;lt;= ファイアウォールの有効化
# ufw disable           # &amp;lt;= ファイアウォールの無効化
# ufw default deny      # &amp;lt;= 全アクセスの拒否
# ufw default allow     # &amp;lt;= 全アクセスの許可
# ufw deny smtp         # &amp;lt;= SMTP サービスのアクセスを拒否
# ufw allow ftp         # &amp;lt;= FTP サービスのアクセスを許可
# ufw deny 25/tcp       # &amp;lt;= TCP ポート 25 でのアクセスを拒否
# ufw allow 80/udp      # &amp;lt;= UDP ポート 80 でのアクセスを許可
# ufw allow 53          # &amp;lt;= TCP ポート 53, UDP ポート 53 でのアクセスを拒否
# ufw allow in http     # &amp;lt;= HTTP サービスのアクセスを IN のみ許可
# ufw reject out smtp   # &amp;lt;= SMTP サービスのアクセスを OUT のみ却下
# ufw allow proto tcp from any to any port 8080:8090
                        # &amp;lt;= TCP ポート 8080 〜 8090 での全アクセスを許可
# ufw allow proto tcp from 192.168.11.0/24 to any port 9999
                        # &amp;lt;= TCP ローカルネットワーク 192.168.11.0/24 からの
                        #    TCP ポート 9999 でのアクセスを許可
# ufw delete 3          # &amp;lt;= 3 番目のルールを削除
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;その他、詳細な説明は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;man ufw&lt;/code&gt; で確認可。&lt;/p&gt;

&lt;h3 id=&quot;4-その他&quot;&gt;4. その他&lt;/h3&gt;

&lt;p&gt;一般的には、一旦全てのアクセスを拒否し、許可したいポートのみ解放するという形式となる。&lt;/p&gt;

&lt;p&gt;サーバインストール直後（SSH サーバ導入済み）なら、以下のようにローカルネットからのみ SSH 接続を許可するようにし、後に各種サービスを運用するたびに開放するポートを設定すればよいだろう。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;9999&lt;/code&gt; は SSH 接続用に開放するポート番号。適宜変更すること）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw default deny
Default incoming policy changed to &apos;deny&apos;
(be sure to update your rules accordingly)

# ufw allow proto tcp from 192.168.11.0/24 to any port 9999
Rules updated

# ufw enable
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup

# ufw status
Status: active

To                         Action      From
--                         ------      ----
9999/tcp                   ALLOW       192.168.11.0/24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ファイアウォールを有効にする際に SSH 接続できるように設定しておかないとリモートで操作できなるのでご注意を。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="ファイアウォール" /><summary type="html">Debian GNU/Linux 11 (bullseye) でファイアウォールを設定する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - 時刻同期設定(systemd-timesyncd)！</title><link href="https://komasaru.github.io/2021/10/13/debian-11-systemd-timesyncd/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - 時刻同期設定(systemd-timesyncd)！" /><published>2021-10-13T00:20:00+09:00</published><updated>2021-10-13T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/10/13/debian-11-systemd-timesyncd</id><content type="html" xml:base="https://komasaru.github.io/2021/10/13/debian-11-systemd-timesyncd/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) 上で systemd-timesyncd サービスを使用して時刻同期する設定についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11 (bullseye) での作業を想定。&lt;/li&gt;
  &lt;li&gt;従来からの &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntpd&lt;/code&gt; ではなく &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chronyd&lt;/code&gt; をインストールする。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntpd&lt;/code&gt; と &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chronyd&lt;/code&gt; の違いについて、ここでは説明しない。&lt;/li&gt;
  &lt;li&gt;ローカルネットワークは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.0/24&lt;/code&gt; とする。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-chrony-のインストール&quot;&gt;1. Chrony のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install chrony
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-設定ファイルの編集&quot;&gt;2. 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/chrony/chrony.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;server ntp.nict.jp iburst           &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;
server ntp1.jst.mfeed.ad.jp iburst  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;
server ntp2.jst.mfeed.ad.jp iburst  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;
server ntp3.jst.mfeed.ad.jp iburst  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

allow 192.168.11.0/24                 &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;うるう秒にも対応させるには、以下のような記述も追記する。（参考： &lt;a href=&quot;https://chrony.tuxfamily.org/manual.html&quot; title=&quot;chrony - Documentation&quot;&gt;chrony - Manual for version 2.3&lt;/a&gt;）&lt;br /&gt;
（うるう秒対策時のみでもよいだろう）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/chrony/chrony.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;leapsecmode slew
maxslewrate 1000
smoothtime 400 0.001 leaponly&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-chrony-の再起動&quot;&gt;3. Chrony の再起動&lt;/h3&gt;

&lt;p&gt;インストール直後は起動した状態になっているので、変更を有効化するために再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart chrony
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-chrony-の自動起動設定&quot;&gt;4. Chrony の自動起動設定&lt;/h3&gt;

&lt;p&gt;インストール後はデフォルトで自動起動するように設定されているはずだが、自動起動するようなっていなければ設定する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl enable chrony
Synchronizing state of chrony.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable chrony
Created symlink /etc/systemd/system/chronyd.service → /lib/systemd/system/chrony.service.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;確認してみる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl is-enabled chrony
enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;以下のようにして確認してもよい。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl list-unit-files -t service | grep chrony
chrony-dnssrv@.service                 static
chrony.service                         enabled
chronyd.service                        enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-時刻同期状況の確認&quot;&gt;5. 時刻同期状況の確認&lt;/h3&gt;

&lt;p&gt;数分後くらいに同期状況を確認してみる。（ntpd の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntpq -p&lt;/code&gt; にあたる）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chronyc sources
210 Number of sources = 12
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^? ns1.ooonet.ru                 0   7     0     -     +0ns[   +0ns] +/-    0ns
^- karhu.miuku.net               2   6    57    24    +51us[  +51us] +/-   82ms
^- helium.supersandro.de         2   6    37    25  +6171us[+6171us] +/-  179ms
^- fetchmail.mediainvent.at      2   6    37    26  +2925us[+2925us] +/-  189ms
^? 2a0b:4341:1500:123::          0   6     0     -     +0ns[   +0ns] +/-    0ns
^? 2600:70ff:b817::9             0   6     0     -     +0ns[   +0ns] +/-    0ns
^? 2606:5580:30a:7fca::1         0   6     0     -     +0ns[   +0ns] +/-    0ns
^? 2001:470:19:301::100          0   6     0     -     +0ns[   +0ns] +/-    0ns
^- ntp-b2.nict.go.jp             1   6    37    29  +4088us[+4088us] +/-   18ms
^- ntp1.jst.mfeed.ad.jp          2   6    37    30   -801us[ -801us] +/-   76ms
^* ntp2.jst.mfeed.ad.jp          2   6    37    32    +88us[ +207ms] +/-   70ms
^- ntp3.jst.mfeed.ad.jp          2   6    37    28   +925us[ +925us] +/-   97ms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;１カラム目の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;^&lt;/code&gt; は「サーバ」（他に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;=&lt;/code&gt; は「ピア」、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#&lt;/code&gt; はローカルのハードウェアクロック）&lt;/li&gt;
  &lt;li&gt;２カラム目の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*&lt;/code&gt; は「同期対象として採用」&lt;/li&gt;
  &lt;li&gt;２カラム目の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;+&lt;/code&gt; は「同期対象候補」&lt;/li&gt;
  &lt;li&gt;２カラム目の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-&lt;/code&gt; は「アルゴリズムにより同期対象から除外」&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Linux" /><category term="Debian" /><summary type="html">Debian GNU/Linux 11 (bullseye) 上で systemd-timesyncd サービスを使用して時刻同期する設定についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - アンチウィルスソフト導入！</title><link href="https://komasaru.github.io/2021/10/06/debian-11-anti-virus-installation/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - アンチウィルスソフト導入！" /><published>2021-10-06T00:20:00+09:00</published><updated>2021-10-06T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/10/06/debian-11-anti-virus-installation</id><content type="html" xml:base="https://komasaru.github.io/2021/10/06/debian-11-anti-virus-installation/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) にウイルス対策ソフト ClamAV をインストールする方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11 (bullseye) での作業を想定。&lt;/li&gt;
  &lt;li&gt;Apt でインストールする。（但し、Apt のパッケージはバージョンが古い。最新版が良ければ、&lt;a href=&quot;https://sourceforge.net/projects/clamav/files/&quot; title=&quot;Clam AntiVirus - Browse Files at SourceForge.net&quot;&gt;こちら&lt;/a&gt;からダウンロードしてビルドするとよい）&lt;/li&gt;
  &lt;li&gt;毎日自動でウィルススキャンを実行するようにする。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-clamav-のインストール&quot;&gt;1. ClamAV のインストール&lt;/h3&gt;

&lt;p&gt;以下のようにして、アンチウィルスソフト ClamAV, ClamAV Daemon をインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install clamav clamav-daemon
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-ウィルス定義ファイルの最新化&quot;&gt;2. ウィルス定義ファイルの最新化&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;freshclam&lt;/code&gt; コマンドでウィルス定義ファイルを最新に更新する。&lt;/p&gt;

&lt;p&gt;しかし、デフォルトの状態では以下のようになってしまう。（以前はこのような事態にはならなかったが）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# freshclam
ERROR: /var/log/clamav/freshclam.log is locked by another process
ERROR: Problem with internal logger (UpdateLogFile = /var/log/clamav/freshclam.log).
ERROR: initialize: libfreshclam init failed.
ERROR: Initialization error!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そこで、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/log/clamav/freshclam.log&lt;/code&gt; を作り直す。&lt;br /&gt;
（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamav:adm&lt;/code&gt; となっている所有者・グループを &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamav:clamav&lt;/code&gt; に変更するだけはうまく行かない）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rm -f /var/log/clamav/freshclam.log
# touch /var/log/clamav/freshclam.log
# chown clamav:clamav /var/log/clamav/freshclam.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そして、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;freshclam&lt;/code&gt; を実行&lt;br /&gt;
（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;freshclam&lt;/code&gt; を実行する際は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamav-freshclam&lt;/code&gt; を停止する）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl stop clamav-freshclam

# freshclam
Mon Aug 30 10:22:37 2021 -&amp;gt; ClamAV update process started at Mon Aug 30 10:22:37 2021
Mon Aug 30 10:22:38 2021 -&amp;gt; ^Your ClamAV installation is OUTDATED!
Mon Aug 30 10:22:38 2021 -&amp;gt; ^Local version: 0.103.2 Recommended version: 0.103.3
Mon Aug 30 10:22:38 2021 -&amp;gt; DON&apos;T PANIC! Read https://www.clamav.net/documents/upgrading-clamav
Mon Aug 30 10:22:38 2021 -&amp;gt; daily.cld database is up-to-date (version: 26278, sigs: 1969151, f-level: 90, builder: raynman)
Mon Aug 30 10:22:38 2021 -&amp;gt; main.cvd database is up-to-date (version: 61, sigs: 6607162, f-level: 90, builder: sigmgr)
Mon Aug 30 10:22:38 2021 -&amp;gt; bytecode.cvd database is up-to-date (version: 333, sigs: 92, f-level: 63, builder: awillia2)

# systemctl start clamav-freshclam
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;（インストールした ClamAV のバージョンが古い場合に警告メッセージが出力されるが、特に問題はないので無視してよい）&lt;/p&gt;

&lt;h3 id=&quot;3-ウィルススキャンのテストウィルス無しの場合&quot;&gt;3. ウィルススキャンのテスト（ウィルス無しの場合）&lt;/h3&gt;

&lt;p&gt;以下のようにして、ウィルススキャンを行ってみる。&lt;br /&gt;
（スキャンするディレクトリを指定するなら、最後にディレクトリを指定する）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# clamscan --infected --remove --recursive

----------- SCAN SUMMARY -----------
Known viruses: 8561077
Engine version: 0.103.2
Scanned directories: 4
Scanned files: 4
Infected files: 0
Data scanned: 0.02 MB
Data read: 0.01 MB (ratio 2.00:1)
Time: 1470.707 sec (24 m 30 s)
Start Date: 2021:08:30 10:23:55
End Date:   2021:08:30 10:48:26
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-ウィルススキャンのテストウィルス有りの場合&quot;&gt;4. ウィルススキャンのテスト（ウィルス有りの場合）&lt;/h3&gt;

&lt;p&gt;ウィルスが有る場合に正常に機能するかをテストするために、まずテスト用ウィルスを用意する。&lt;br /&gt;
今回は以下の４つのテストウィルスをダウンロードしてみた。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# wget http://www.eicar.org/download/eicar.com \
http://www.eicar.org/download/eicar.com.txt \
http://www.eicar.org/download/eicar_com.zip \
http://www.eicar.org/download/eicarcom2.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そして、ウィルススキャンを行ってみる。&lt;br /&gt;
４つとも検知し削除されているのが分かる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# clamscan --infected --remove --recursive
/root/eicarcom2.zip: Win.Test.EICAR_HDB-1 FOUND
/root/eicarcom2.zip: Removed.
/root/eicar_com.zip: Win.Test.EICAR_HDB-1 FOUND
/root/eicar_com.zip: Removed.
/root/eicar.com.txt: Win.Test.EICAR_HDB-1 FOUND
/root/eicar.com.txt: Removed.
/root/eicar.com: Win.Test.EICAR_HDB-1 FOUND
/root/eicar.com: Removed.

----------- SCAN SUMMARY -----------
Known viruses: 8561077
Engine version: 0.103.2
Scanned directories: 4
Scanned files: 8
Infected files: 4
Data scanned: 0.02 MB
Data read: 0.01 MB (ratio 2.00:1)
Time: 1606.701 sec (26 m 46 s)
Start Date: 2021:08:30 10:50:49
End Date:   2021:08:30 11:17:36
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-ウィルススキャン実行用スクリプトの作成&quot;&gt;5. ウィルススキャン実行用スクリプトの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/bin:/bin

&lt;span class=&quot;c&quot;&gt;# スキャン除外設定&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# （clamdscan でなく clamscan を使用する場合はコメント解除）&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#excludelist=/root/clamscan.exclude&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#if [ -s $excludelist ]; then&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    for i in `cat $excludelist`&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    do&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#        if [ $(echo &quot;$i&quot;|grep \/$) ]; then&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#            i=`echo $i|sed -e &apos;s/^\([^ ]*\)\/$/\1/p&apos; -e d`&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#            excludeopt=&quot;${excludeopt} --exclude-dir=^$i&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#        else&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#            excludeopt=&quot;${excludeopt} --exclude=^$i&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#        fi&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    done&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#fi&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ウィルス定義ファイル最新化&lt;/span&gt;
freshclam &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null

&lt;span class=&quot;c&quot;&gt;# ウィルススキャン&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CLAMSCANTMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mktemp&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# （clamdscan では --remove オプションが使用できない）&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#clamscan --recursive --remove ${excludeopt} / &amp;gt; $CLAMSCANTMP 2&amp;gt;&amp;amp;1&lt;/span&gt;
clamdscan &lt;span class=&quot;nt&quot;&gt;--recursive&lt;/span&gt; / &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CLAMSCANTMP&lt;/span&gt; 2&amp;gt;&amp;amp;1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;FOUND&lt;span class=&quot;nv&quot;&gt;$ $CLAMSCANTMP&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# レポートのメール送信&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;FOUND&lt;span class=&quot;nv&quot;&gt;$ $CLAMSCANTMP&lt;/span&gt; | mail &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Virus Found in &lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; root
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CLAMSCANTMP&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;6-ウィルススキャン実行用スクリプトに実行権限付与&quot;&gt;6. ウィルススキャン実行用スクリプトに実行権限付与&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chmod +x clamscan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-スキャン対象外ファイルの編集&quot;&gt;7. スキャン対象外ファイルの編集&lt;/h3&gt;

&lt;p&gt;ウィルススキャンを行わないディレクトリがあれば、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan.exclude&lt;/code&gt; ファイルに記述する。（但し、 clamscan を使用する場合）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan.exclude&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;/dev/   &lt;span class=&quot;c&quot;&gt;# &amp;lt;= &quot;dev&quot;  ディレクトリをスキャン対象外にする場合&lt;/span&gt;
/proc/  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= &quot;proc&quot; ディレクトリをスキャン対象外にする場合&lt;/span&gt;
/sys/   &lt;span class=&quot;c&quot;&gt;# &amp;lt;= &quot;sys&quot;  ディレクトリをスキャン対象外にする場合&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ウィルススキャン実行用スクリプト内で &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan&lt;/code&gt; でなく &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamdscan&lt;/code&gt; を使用するようにしている場合は、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan.exclude&lt;/code&gt; を作成せず、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/clamav/clamd.conf&lt;/code&gt; に以下のように追記する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/clamav/clamd.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;ExcludePath ^/dev/
ExcludePath ^/proc/
ExcludePath ^/sys/
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;8-スクリプトの実行&quot;&gt;8. スクリプトの実行&lt;/h3&gt;

&lt;p&gt;作成したウィルススキャン実行スクリプトが正常に実行されるか試しに動かしてみる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ./clamscan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-自動実行の設定&quot;&gt;9. 自動実行の設定&lt;/h3&gt;

&lt;p&gt;ウィルススキャン実行スクリプトに問題がなければ、毎日自動で実行させるために cron ディレクトリへ移動する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;daily&lt;/code&gt; でなく &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;weekly&lt;/code&gt; や &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;monthly&lt;/code&gt; でもよい。好みの問題）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mv clamscan /etc/cron.daily/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="ウイルス対策" /><summary type="html">Debian GNU/Linux 11 (bullseye) にウイルス対策ソフト ClamAV をインストールする方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">2021年9月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2021/10/01/blog-access/" rel="alternate" type="text/html" title="2021年9月 - OS・ブラウザ別アクセス状況！" /><published>2021-10-01T00:20:00+09:00</published><updated>2021-10-01T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/10/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2021/10/01/blog-access/">&lt;p&gt;10月になりましたので、先月9月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24,170&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;66.7716&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8,770&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24.2279&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,410&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.8952&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,149&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.1742&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;506&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.3979&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;156&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4310&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;28&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0774&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0166&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0083&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;36,198&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19,652&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;54.2903&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8,770&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24.2279&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,013&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11.0862&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,410&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.8952&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,149&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.1742&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;506&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.3979&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;436&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.2045&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;156&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4310&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;36&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0995&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;28&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0774&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;XP&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;27&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0746&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0166&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;98&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0111&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0083&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Server 2003&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0028&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Vista&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0028&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;36,198&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;23,094&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;63.7991&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,909&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13.5615&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,850&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10.6359&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,475&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9.6000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;868&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.3979&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Debian IceWeasel&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0028&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Opera&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0028&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;36,198&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;93.0.4577.63&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7,036&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19.4375&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;93.0.4577.82&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6,507&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;17.9761&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;92.0.4515.159&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4,949&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13.6720&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,850&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10.6359&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,074&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.7296&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;94.0.4606.61&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,835&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.0693&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9537.53&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,669&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.6108&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;92.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,535&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.2406&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,133&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.1300&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;91.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;945&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.6106&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;11.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;844&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.3316&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;78.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;596&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.6465&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;92.0.4515.131&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;543&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.5001&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;93.0.4577.62&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;307&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8481&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;94.0.4606.54&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;217&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5995&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;92.0.4515.107&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;173&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4779&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;91.0.4472.114&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;117&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3232&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;92.0.4515.166&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;114&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3149&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;91.0.4472.164&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;80&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2210&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;93.0.4577.83&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;76&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2100&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;36,198&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">10月になりましたので、先月9月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 11 (bullseye) - rootkit 検出ツール chkrootkit インストール！</title><link href="https://komasaru.github.io/2021/09/29/debian-11-chrootkit-installation/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - rootkit 検出ツール chkrootkit インストール！" /><published>2021-09-29T00:20:00+09:00</published><updated>2021-09-29T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/09/29/debian-11-chrootkit-installation</id><content type="html" xml:base="https://komasaru.github.io/2021/09/29/debian-11-chrootkit-installation/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) に rootkit 検出ツール chkrootkit をインストールする方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11 (bullseye) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンは Debian GNU/Linux 10 (buster; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;chkrootkit が検知できるのは既知の rootkit のみであり、新規の rootkit は検知できないことを認識しておく。&lt;/li&gt;
  &lt;li&gt;chkrootkit では誤検知もあるので、検知結果は参考程度に留める。&lt;/li&gt;
  &lt;li&gt;コマンド自体が改竄されてからでは遅いので、 OS インストール直後に行うのがよいらしい。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-chkrootkit-のインストール&quot;&gt;1. chkrootkit のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install chkrootkit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-chkrootkit-の実行&quot;&gt;2. chkrootkit の実行&lt;/h3&gt;

&lt;p&gt;以下のようにして chkrootkit を実行してみる。&lt;br /&gt;
問題のある（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;INFECTED&lt;/code&gt; の）場合のみ出力する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chkrootkit | grep INFECTED
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-自動実行用スクリプト作成&quot;&gt;3. 自動実行用スクリプト作成&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;今は自動で /etc/cron.daily/chkrtootkit が作成され、毎日自動で実行されるので、この作業は不要&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;これで、rootkit が仕掛けられていた場合に root 宛にメールが届くようになる。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><summary type="html">Debian GNU/Linux 11 (bullseye) に rootkit 検出ツール chkrootkit をインストールする方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - セキュリティ・アップデートの自動化！</title><link href="https://komasaru.github.io/2021/09/22/debian-11-automation-security-update/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - セキュリティ・アップデートの自動化！" /><published>2021-09-22T00:20:00+09:00</published><updated>2021-09-22T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/09/22/debian-11-automation-security-update</id><content type="html" xml:base="https://komasaru.github.io/2021/09/22/debian-11-automation-security-update/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) のセキュリティ・アップデートを自動化する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 11 (bullseye) サーバでの作業を想定。&lt;/li&gt;
  &lt;li&gt;cron-apt でもパッケージアップデートの自動化は可能であるが、今回はセキュリティ・アップデートのみなので unattended-upgrades を使用する。&lt;br /&gt;
（ちなみに、インストール済みの各種パッケージを自動アップデートするのは（依存パッケージの整合性等の問題があるため）危険であり、当方はセキュリティ・アップデート以外は自動でアップデートしない方針）&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-unattended-upgrades-のインストール&quot;&gt;1. unattended-upgrades のインストール&lt;/h3&gt;

&lt;p&gt;unattended-upgrades とパッケージ変更履歴ツール apt-listchanges をインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install unattended-upgrades apt-listchanges
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-50unattended-upgrades-の編集&quot;&gt;2. “50unattended-upgrades” の編集&lt;/h3&gt;

&lt;p&gt;メール送信先を編集（コメント解除＆変更）する。（当然、ユーザ名のみならず外部のメールアドレスも設定可）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apt/apt.conf.d/50unattended-upgrades&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;Unattended-Upgrade::Mail &lt;span class=&quot;s2&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-20auto-upgrades-の作成&quot;&gt;3. “20auto-upgrades” の作成&lt;/h3&gt;

&lt;p&gt;以下のコマンドを実行して自動アップデートに関する質問に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Yes&lt;/code&gt; 応答すると、自動アップグレードのための設定ファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;20auto-upgrades&lt;/code&gt; が作成される。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dpkg-reconfigure -plow unattended-upgrades
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;もしくは、以下のような内容で &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;20auto-upgrades&lt;/code&gt; 作成してもよい。&lt;br /&gt;
（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/cron.daily/apt&lt;/code&gt; に記述があるとおりデフォルトでは無効になっているので、有効にするための記述）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apt/apt.conf.d/20auto-upgrades&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;APT::Periodic::Update-Package-Lists &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
APT::Periodic::Unattended-Upgrade &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;4-02periodic-の作成&quot;&gt;4. “02periodic” の作成&lt;/h3&gt;

&lt;p&gt;cron ジョブのための設定ファイルを作成する。&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/cron.daily/apt&lt;/code&gt; に記述があるとおりデフォルトで設定されている項目もあるが、以下のように「&lt;a href=&quot;https://wiki.debian.org/UnattendedUpgrades&quot; title=&quot;UnattendedUpgrades - Debian Wiki&quot;&gt;作成例&lt;/a&gt;」をそのまま流用している。&lt;br /&gt;
（各設定項目の説明はコメントに記述されているとおりなので、あらためて説明しない）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apt/apt.conf.d/02periodic&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;// Control parameters &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;cron &lt;span class=&quot;nb&quot;&gt;jobs &lt;/span&gt;by /etc/cron.daily/apt //

// Enable the update/upgrade script &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;disable&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
APT::Periodic::Enable &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

// Do &lt;span class=&quot;s2&quot;&gt;&quot;apt update&quot;&lt;/span&gt; automatically every n-days &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;disable&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
APT::Periodic::Update-Package-Lists &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

// Do &lt;span class=&quot;s2&quot;&gt;&quot;apt upgrade --download-only&quot;&lt;/span&gt; every n-days &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;disable&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
APT::Periodic::Download-Upgradeable-Packages &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

// Run the &lt;span class=&quot;s2&quot;&gt;&quot;unattended-upgrade&quot;&lt;/span&gt; security upgrade script
// every n-days &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;disabled&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
// Requires the package &lt;span class=&quot;s2&quot;&gt;&quot;unattended-upgrades&quot;&lt;/span&gt; and will write
// a log &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; /var/log/unattended-upgrades
APT::Periodic::Unattended-Upgrade &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

// Do &lt;span class=&quot;s2&quot;&gt;&quot;apt autoclean&quot;&lt;/span&gt; every n-days &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;disable&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
APT::Periodic::AutocleanInterval &lt;span class=&quot;s2&quot;&gt;&quot;21&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

// Send report mail to root
//     0:  no report             &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;or null string&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
//     1:  progress report       &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;actually any string&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
//     2:  + &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;outputs     &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;remove &lt;span class=&quot;nt&quot;&gt;-qq&lt;/span&gt;, remove 2&amp;gt;/dev/null, add &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
//     3:  + trace on
APT::Periodic::Verbose &lt;span class=&quot;s2&quot;&gt;&quot;2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;5-listchangesconf-の編集&quot;&gt;5. “listchanges.conf” の編集&lt;/h3&gt;

&lt;p&gt;パッケージ変更履歴ツール apt-listchanges のための設定を行う。（Debian 9 までとは若干異なる）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apt/listchanges.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;apt]
&lt;span class=&quot;nv&quot;&gt;frontend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;pager
&lt;span class=&quot;nv&quot;&gt;which&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;both          &lt;span class=&quot;c&quot;&gt;# &amp;lt;= news から変更&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;email_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;root
&lt;span class=&quot;nv&quot;&gt;email_format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;text
&lt;span class=&quot;nv&quot;&gt;confirm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;reverse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;save_seen&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/var/lib/apt/listchanges.db
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;6-動作確認&quot;&gt;6. 動作確認&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/cron.daily/apt-campat&lt;/code&gt; により毎日実行されるので、後日メールやログを確認してみる。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;メールは設定したユーザ（or メールアドレス）宛に送信される。&lt;/li&gt;
  &lt;li&gt;dpkg 関連のログは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/log/dpkg.log&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;unattended-upgrades 関連のログは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/log/unattended-upgrades&lt;/code&gt; ディレクトリ配下。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;7-参考サイト&quot;&gt;7. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://wiki.debian.org/UnattendedUpgrades&quot; title=&quot;UnattendedUpgrades - Debian Wiki&quot;&gt;UnattendedUpgrades - Debian Wiki&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><summary type="html">Debian GNU/Linux 11 (bullseye) のセキュリティ・アップデートを自動化する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 11 (bullseye) - SSH サーバ構築！</title><link href="https://komasaru.github.io/2021/09/15/debian-11-ssh-installation/" rel="alternate" type="text/html" title="Debian 11 (bullseye) - SSH サーバ構築！" /><published>2021-09-15T00:20:00+09:00</published><updated>2021-09-15T00:20:00+09:00</updated><id>https://komasaru.github.io/2021/09/15/debian-11-ssh-installation</id><content type="html" xml:base="https://komasaru.github.io/2021/09/15/debian-11-ssh-installation/">&lt;p&gt;Debian GNU/Linux 11 (bullseye) 上に SSH サーバを構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;「&lt;a href=&quot;/2021/09/02/debian-11-installation-for-small-server&quot; title=&quot;Debian 11 (bullseye) - インストール（サーバ用途・最小構成）！&quot;&gt;Debian 11 (bullseye) - インストール（サーバ用途・最小構成）！&lt;/a&gt;」の方法でインストールが完了していることを想定。&lt;/li&gt;
  &lt;li&gt;「&lt;a href=&quot;/2021/09/08/debian-11-initial-setting&quot; title=&quot;Debian 11 (bullseye) - サーバ初期設定&quot;&gt;Debian 11 (bullseye) - サーバ初期設定！&lt;/a&gt;」の方法で初期設定が完了していることを想定。&lt;/li&gt;
  &lt;li&gt;サーバの IP アドレス &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.101&lt;/code&gt;、ホスト名 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vbox&lt;/code&gt;、ユーザ名 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foo&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;DNS サーバは未だ設定していない。&lt;br /&gt;
（設定済みなら、ローカルから IP アドレスではなくホスト名で SSH 接続可）&lt;/li&gt;
  &lt;li&gt;クライアント側は Debian 10 (64bit) を想定。&lt;/li&gt;
  &lt;li&gt;SSH 接続は端末コンソールから行う。&lt;/li&gt;
  &lt;li&gt;ポートは、デフォルトの &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;22&lt;/code&gt; から &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;9999&lt;/code&gt; に変更することを想定。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;9999&lt;/code&gt; は架空）&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-ssh-サーバのインストール&quot;&gt;1. SSH サーバのインストール&lt;/h3&gt;

&lt;p&gt;Debian インストール時に SSH サーバをインストールしていなければ、以下のようにして SSH サーバをインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install ssh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-ssh-設定ファイルの編集&quot;&gt;2. SSH 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;root でログインできないよう、設定ファイルを編集する。&lt;br /&gt;
ポートもデフォルトの &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;22&lt;/code&gt; から変更する。（セキュリティ上、必須）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/ssh/sshd_config&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;#Port 22&lt;/span&gt;
Port 9999                         &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 適当に変更&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# rootユーザーのログインはパスワード認証以外のみ許可する&lt;/span&gt;
PermitRootLogin without-password

&lt;span class=&quot;c&quot;&gt;# SSHプロトコル ver.2 で公開鍵認証を許可する&lt;/span&gt;
PubkeyAuthentication &lt;span class=&quot;nb&quot;&gt;yes&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# パスワード認証を許可する(rootユーザー以外に適用)&lt;/span&gt;
PasswordAuthentication &lt;span class=&quot;nb&quot;&gt;yes&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# チャレンジレスポンス認証を拒否する&lt;/span&gt;
ChallengeResponseAuthentication no

&lt;span class=&quot;c&quot;&gt;# PAMを使用する&lt;/span&gt;
UsePAM &lt;span class=&quot;nb&quot;&gt;yes

&lt;/span&gt;AllowUsers root foo  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= ログイン可能なユーザを明示的に設定&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PermitRootLogin without-password&lt;/code&gt; は、root のログインは許可されるものの、ログインを行うには適切な SSH のキーが必要とされるようになるという意味。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-ssh-サーバの再起動&quot;&gt;3. SSH サーバの再起動&lt;/h3&gt;

&lt;p&gt;設定を有効化するため、SSH サーバを再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart ssh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-パスワード接続&quot;&gt;4. パスワード接続&lt;/h3&gt;

&lt;p&gt;一旦ログアウト後、再度クライント側の端末コンソールからサーバに接続してみる。&lt;br /&gt;
“Are you sure you want to continue connecting (yes/no)?” で &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yes&lt;/code&gt; 応答、その後パスワードを入力すれば接続できる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ssh -p 9999 vbox
The authenticity of host &apos;[vbox]:6835 ([192.168.11.101]:6835)&apos; can&apos;t be established.
ECDSA key fingerprint is SHA256:AjguasHf6ZiCZ0bi+h4+Dzx3FU/jQUNR/PQ78j2xlAA.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &apos;[vbox]:6835,[192.168.11.101]:6835&apos; (ECDSA) to the list of known hosts.
foo@vbox&apos;s password:
Linux vbox 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-08-03) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Aug 30 09:44:23 2021 from 192.168.11.13
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;クライアント側のユーザがサーバ側と異なる場合は、以下のようにユーザ名も指定する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh -p 9999 hoge@vbox
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;以降、サーバ操作時にクライアント側の端末コンソールから行なう。&lt;br /&gt;
クライント側からリモート接続すれば、文字化けしていた日本語も正常に表示されるはず。&lt;/p&gt;

&lt;h3 id=&quot;5-鍵ペア公開秘密の生成&quot;&gt;5. 鍵ペア（公開・秘密）の生成&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;クライアント側で&lt;/strong&gt;以下のコマンドで公開鍵・秘密鍵を生成する。&lt;br /&gt;
作成先・ファイル名を指定しなければ、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/(ユーザ名)/.ssh/&lt;/code&gt; に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id_rsa&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id_rsa.pub&lt;/code&gt; が作成される。 途中、鍵用のパスワードも入力する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/foo/.ssh/id_rsa): /home/foo/.ssh/id_rsa
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/foo/.ssh/id_rsa.
Your public key has been saved in /home/foo/.ssh/id_rsa.pub.
The key fingerprint is:
96:af:59:18:9c:a0:c2:da:86:7e:d7:24:05:d0:31:da foo@p183
The key&apos;s randomart image is:
+--[ RSA 2048]-----------------------------------------+
|   .oo.          |
|    oo.          |
|   . Eo          |
| .   . + o       |
|  o . . S        |
| + . . o +       |
|o o   + . o      |
|.. . . . +       |
| .. .   o        |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-サーバ側の設定&quot;&gt;6. サーバ側の設定&lt;/h3&gt;

&lt;p&gt;作成した鍵ペアで SSH サーバーへ鍵方式でログインできるように、サーバ側の「ログインしようとする一般ユーザ」で設定する。&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/authorized_keys&lt;/code&gt; には、先ほど作成した鍵ペアの公開鍵ファイル（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xxxx.pub&lt;/code&gt;）の内容をそのまま貼り付ける。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ mkdir ~/.ssh

$ chmod 700 ~/.ssh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.ssh/authorized_keys&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;ssh-rsa .........&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ chmod 600 ~/.ssh/authorized_keys
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-ssh-設定ファイルの編集&quot;&gt;7. SSH 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;パスワード認証をできないようにするため、 SSH 設定ファイルを編集する。&lt;br /&gt;
今度は一般ユーザではなく、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;su -&lt;/code&gt; で root になって（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; コマンドを導入していれば、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo vi ...&lt;/code&gt; でもよい）。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/ssh/sshd_config&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;PasswordAuthentication no  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 変更&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;8-ssh-サーバの再起動&quot;&gt;8. SSH サーバの再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart ssh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-鍵認証接続のテスト&quot;&gt;9. 鍵認証接続のテスト&lt;/h3&gt;

&lt;p&gt;一旦ログアウトし、再度接続する。&lt;br /&gt;
パスワード認証ではなく、鍵認証なので以下のようなコマンドとなる。（指定する秘密キーのファイル名は、ペア作成時に指定したファイル名）&lt;br /&gt;
鍵用のパスワード問い合わせダイアログが表示されるので応答する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh -i ~/.ssh/id_rsa -p 9999 vbox
Enter passphrase for key &apos;/home/foo/.ssh/id_rsa&apos;:
Linux vbox 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-08-03) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Aug 30 09:58:32 2021 from 192.168.11.13
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2回目からは以下のコマンドでよい。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ssh -p 9999 vbox
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="SSH" /><summary type="html">Debian GNU/Linux 11 (bullseye) 上に SSH サーバを構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry></feed>