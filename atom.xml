<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.2">Jekyll</generator><link href="https://komasaru.github.io/atom.xml" rel="self" type="application/atom+xml" /><link href="https://komasaru.github.io/" rel="alternate" type="text/html" /><updated>2023-10-01T00:02:09+09:00</updated><id>https://komasaru.github.io/atom.xml</id><title type="html">mk-mode BLOG</title><subtitle>このブログは自宅サーバ(Debian GNU/Linux)で運用してしている&lt;a href=&quot;https://www.mk-mode.com/blog/&quot;&gt;ブログ&lt;/a&gt;のクローンです。&lt;br /&gt;PC・サーバ構築等の話題を中心に公開しております。</subtitle><author><name>mk-mode.com</name></author><entry><title type="html">2023年9月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2023/10/01/blog-access/" rel="alternate" type="text/html" title="2023年9月 - OS・ブラウザ別アクセス状況！" /><published>2023-10-01T00:00:00+09:00</published><updated>2023-10-01T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/10/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2023/10/01/blog-access/">&lt;p&gt;10月になりましたので、先月9月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,776&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;70.3507&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18.1851&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;823&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.9167&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;713&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.2595&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;193&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.1530&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;178&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0634&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0538&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0060&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;69.8728&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18.1851&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;823&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.9167&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;713&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.2595&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;193&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.1530&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;178&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0634&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;59&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3525&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1075&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0538&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Vista&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0060&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0060&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13,737&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;82.0658&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,546&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9.2359&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,315&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7.8559&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;126&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7527&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0358&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla SeaMonkey&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0299&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Debian IceWeasel&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9,067&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;54.1669&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,920&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;17.4443&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;953&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.6933&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;908&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.4245&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;904&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.4006&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;405&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.4195&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;114.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;268&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.6011&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;102.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;228&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.3621&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;126&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7527&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;119&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7109&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;66&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3943&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;62&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3704&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;78.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;57&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3405&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;109.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;56&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3345&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;112.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;43&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2569&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;113.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2509&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;50.0.2661.102&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;27&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1613&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;113.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;25&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1494&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1195&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;110.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1195&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16,739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">10月になりましたので、先月9月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 12 (bookworm) - NFS サーバのポート固定！</title><link href="https://komasaru.github.io/2023/09/27/debian-12-nfs-port-fixing/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - NFS サーバのポート固定！" /><published>2023-09-27T00:00:00+09:00</published><updated>2023-09-27T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/09/27/debian-12-nfs-port-fixing</id><content type="html" xml:base="https://komasaru.github.io/2023/09/27/debian-12-nfs-port-fixing/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に NFS サーバで使用するポートを固定化する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;NFS サーバ構築済み。&lt;br /&gt;
（参照：「&lt;a href=&quot;/2023/09/20/debian-12-nfs-installation&quot; title=&quot;Debian 12 (bookworm) - NFS サーバ構築！&quot;&gt;Debian 12 (bookworm) - NFS サーバ構築！&lt;/a&gt;」）&lt;/li&gt;
  &lt;li&gt;以下で設定するポート番号は&lt;a href=&quot;https://wiki.debian.org/SecuringNFS&quot; title=&quot;SecuringNFS - Debian Wiki&quot;&gt;参考サイト&lt;/a&gt;によるもであり、任意に設定可能。&lt;/li&gt;
  &lt;li&gt;quota は使用していないので、&lt;a href=&quot;https://wiki.debian.org/SecuringNFS&quot; title=&quot;SecuringNFS - Debian Wiki&quot;&gt;参考サイト&lt;/a&gt;にある quota の設定はしない。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-前提知識&quot;&gt;1. 前提知識&lt;/h3&gt;

&lt;p&gt;NFS サーバが使用するポートは以下のとおり。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;portmapper =&amp;gt; TCP: 111, UDP: 111
nfs        =&amp;gt; TCP:2049, UDP:2049
statd      =&amp;gt; TCP:不定, UDP:不定
mountd     =&amp;gt; TCP:不定, UDP:不定
nlockmgrq  =&amp;gt; TCP:不定, UDP:不定
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-statd-用ポートの固定&quot;&gt;2. statd 用ポートの固定&lt;/h3&gt;

&lt;p&gt;statd のポートを固定するには &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/nfs-common&lt;/code&gt; を以下のようにする。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/nfs-common&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;STATDOPTS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;--port 32765 --outgoing-port 32766&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-mountd-用ポートの固定&quot;&gt;3. mountd 用ポートの固定&lt;/h3&gt;

&lt;p&gt;mountd のポートを固定するには &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/nfs-kernel-server&lt;/code&gt; を以下のようにする。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/nfs-kernel-server&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;RPCMOUNTDOPTS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-p 32767&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-lockd-モジュールの設定&quot;&gt;4. lockd モジュールの設定&lt;/h3&gt;

&lt;p&gt;オプション付き lockd モジュールを提供するために、以下のように &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/modprobe.d/local.conf&lt;/code&gt; を作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/modprobe.d/local.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;options lockd &lt;span class=&quot;nv&quot;&gt;nlm_udpport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;32768 &lt;span class=&quot;nv&quot;&gt;nlm_tcpport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;32768
options nfs &lt;span class=&quot;nv&quot;&gt;callback_tcpport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;32764
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-マシンの再起動&quot;&gt;5. マシンの再起動&lt;/h3&gt;

&lt;p&gt;設定を反映させるため、マシンを再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl reboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-設定の確認&quot;&gt;6. 設定の確認&lt;/h3&gt;

&lt;p&gt;以下のようにして、RPC 情報（ポートの設定）を確認してみる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpcinfo -p
   program vers proto   port  service
    100000    4   tcp    111  portmapper
    100000    3   tcp    111  portmapper
    100000    2   tcp    111  portmapper
    100000    4   udp    111  portmapper
    100000    3   udp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp  32767  mountd
    100005    1   tcp  32767  mountd
    100005    2   udp  32767  mountd
    100005    2   tcp  32767  mountd
    100005    3   udp  32767  mountd
    100005    3   tcp  32767  mountd
    100003    3   tcp   2049  nfs
    100003    4   tcp   2049  nfs
    100227    3   tcp   2049
    100003    3   udp   2049  nfs
    100003    4   udp   2049  nfs
    100227    3   udp   2049
    100021    1   udp  32768  nlockmgr
    100021    3   udp  32768  nlockmgr
    100021    4   udp  32768  nlockmgr
    100021    1   tcp  32768  nlockmgr
    100021    3   tcp  32768  nlockmgr
    100021    4   tcp  32768  nlockmgr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-ファイアウォールufwの設定&quot;&gt;7. ファイアウォール(ufw)の設定&lt;/h3&gt;

&lt;p&gt;NFS サーバが使用するポートが固定されたので、ufw でファイアウォールの設定を行う。（以下はローカルネットワーク内からのみアクセス可能にする例）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow proto tcp from 192.168.11.0/24 to any port 111,2049,32765,32767,32768
Rule added
# ufw allow proto udp from 192.168.11.0/24 to any port 111,2049,32765,32767,32768
Rule added
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;確認。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw status
Status: active

To                         Action      From
--                         ------      ----
6835/tcp                   ALLOW       192.168.11.0/24
53                         ALLOW       Anywhere
21                         ALLOW       Anywhere
4000,4001,4002,4003,4004,4005/tcp ALLOW       Anywhere
111,2049,32765,32767,32768/tcp ALLOW       192.168.11.0/24
111,2049,32765,32767,32768/udp ALLOW       192.168.11.0/24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-動作確認&quot;&gt;8. 動作確認&lt;/h3&gt;

&lt;p&gt;クライアントマシンでマウントして接続できることも確認しておく。&lt;/p&gt;

&lt;h3 id=&quot;9-参考サイト&quot;&gt;9. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://wiki.debian.org/SecuringNFS&quot; title=&quot;SecuringNFS - Debian Wiki&quot;&gt;SecuringNFS - Debian Wiki&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="NFS" /><summary type="html">Debian GNU/Linux 12 (bookworm) に NFS サーバで使用するポートを固定化する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - NFS サーバ構築！</title><link href="https://komasaru.github.io/2023/09/20/debian-12-nfs-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - NFS サーバ構築！" /><published>2023-09-20T00:00:00+09:00</published><updated>2023-09-20T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/09/20/debian-12-nfs-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/09/20/debian-12-nfs-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に NFS サーバを構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworms; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;接続可能なマシンのネットワークは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.0/24&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、サーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opti&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;NFS 用ディレクトリを新たに作成する。（”/var” 配下に “/exports” ディレクトリを作成する）&lt;/li&gt;
  &lt;li&gt;クライアント側でマウントに使用するディレクトリも “/var/exports” とする。&lt;/li&gt;
  &lt;li&gt;サーバ側は root で作業することを想定、クライアント側は一般ユーザで作業することを想定している。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-nfs-サーバのインストール&quot;&gt;1. NFS サーバのインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install nfs-kernel-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-idmapd-設定の編集&quot;&gt;2. idmapd 設定の編集&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/idmapd.conf&lt;/code&gt; というユーザー名・グループ名と UID/GID のマッピングを保持するデーモンの設定ファイルを以下のように編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/idmapd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Domain &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mk-mode.com  &lt;span class=&quot;c&quot;&gt;# &amp;lt; = コメント解除＆自ドメイン名に変更&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-nfs-用ディレクトリの作成&quot;&gt;3. NFS 用ディレクトリの作成&lt;/h3&gt;

&lt;p&gt;共有 NFS ディレクトリを以下のようにして作成する。&lt;br /&gt;
所有者・所有グループは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/idmapd.conf&lt;/code&gt; に記載されている &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nobody&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nogroup&lt;/code&gt; とする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir /var/exports
# chown -R nobody:nogroup /var/exports
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-exports-の編集&quot;&gt;4. exports の編集&lt;/h3&gt;

&lt;p&gt;設定ファイル &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/exports&lt;/code&gt; を以下のように編集（追記）する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/exports&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/var/exports 192.168.11.0/24&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;rw,sync,fsid&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0,no_root_squash,no_subtree_check&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-ファイアウォール-ufw-の無効化&quot;&gt;5. ファイアウォール (ufw) の無効化&lt;/h3&gt;

&lt;p&gt;NFS サーバは都度ポート番号が変更になるため、ファイアウォールで開放するポートを指定できない。&lt;br /&gt;
ファイアウォール ufw を「一時的」にオフにする。&lt;br /&gt;
（別途、NFS サーバのポートを固定する措置を施せばよい（別記事））&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw disable
Firewall stopped and disabled on system startup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-nfs-サーバ再起動&quot;&gt;6. NFS サーバ再起動&lt;/h3&gt;

&lt;p&gt;設定を反映させるため、NFS サーバを再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart nfs-kernel-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;【以下、クライアント側・ローカルユーザでの作業】&lt;/p&gt;

&lt;h3 id=&quot;7-nfs-クライアントのインストール&quot;&gt;7. NFS クライアントのインストール&lt;/h3&gt;

&lt;p&gt;NFS クライアントを以下のようにしてインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo apt install -y nfs-client
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Linux ディストリビューションによっては &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apt command [options]&lt;/code&gt; でなく &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apt [options] command&lt;/code&gt; のことがあるので注意。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;8-idmapd-設定の編集&quot;&gt;8. idmapd 設定の編集&lt;/h3&gt;

&lt;p&gt;NFS サーバ同様 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;etc/idmapd.conf&lt;/code&gt; という設定ファイルを、以下のように編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/idmapd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Domain &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mk-mode.com  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除＆自ドメイン名に変更&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-nfs-クライアントの再起動&quot;&gt;9. NFS クライアントの再起動&lt;/h3&gt;

&lt;p&gt;設定を反映させるため、NFS クライアントを再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl restart nfs-common
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ちなみに、nfs-common は自動起動するようになっているが、普段使用しない場合は、以下のように自動起動しないように設定しておいてもよいだろう。（NFS を使用したい時のみ nfs-common を起動させる）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl disable nfs-common
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;10-マウント用ディレクトリの作成&quot;&gt;10. マウント用ディレクトリの作成&lt;/h3&gt;

&lt;p&gt;マウントするディレクトリを作成する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mkdir /var/exports
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;11-マウント&quot;&gt;11. マウント&lt;/h3&gt;

&lt;p&gt;NFS サーバのディレクトリ使用するために、クライアントマシンでマウントする。&lt;br /&gt;
以下では、クライアントマシンの &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/exports&lt;/code&gt; ディレクトリにマウントしている。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mount -t nfs vostro.mk-mode.com:/var/exports /var/exports
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;12-確認&quot;&gt;12. 確認&lt;/h3&gt;

&lt;p&gt;マウントできているか &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;df&lt;/code&gt; コマンドで確認する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# df -h
Filesystem                     Size  Used Avail Use% Mounted on
         :
====&amp;lt; 途中省略 &amp;gt;====
         :
vostro.mk-mode.com:/var/exports   1.7G  431M  1.2G   28% /var/exports
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;その他、クライアントマシンからファイルを貼り付けてみたり、削除してみたりしてみる。&lt;/p&gt;

&lt;h3 id=&quot;13-自動マウントの設定&quot;&gt;13. 自動マウントの設定&lt;/h3&gt;

&lt;p&gt;上記の方法ではクライアントマシンを再起動するたびにマウントしないといけないので、マシン起動時に自動マウントするようにしたければ以下のように fstab を設定する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/fstab&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vbox.mk-mode.com:/var/exports   /var/exports  nfs     defaults        0       0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;クライアントマシン再起動時にマウントされるかも確認しておく。&lt;/p&gt;

&lt;h3 id=&quot;14-ファイアウォール-ufw-の有効化&quot;&gt;14. ファイアウォール (ufw) の有効化&lt;/h3&gt;

&lt;p&gt;テストのために無効化していたファイアウォールを有効化に戻す。※サーバ側&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw enable
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;実際に運用する場会は、 NVF サーバのポートを固定する設定を施す。&lt;br /&gt;
ここでは、一旦ファイアウォールを有効化に戻しておく。（この後続けて、次記事（次回投稿予定の記事）の方法で NFS サーバのポート固定の設定を施すのであれば、この限りでない）&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="NFS" /><summary type="html">Debian GNU/Linux 12 (bookworm) に NFS サーバを構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - FTP サーバ構築！</title><link href="https://komasaru.github.io/2023/09/13/debian-12-ftp-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - FTP サーバ構築！" /><published>2023-09-13T00:00:00+09:00</published><updated>2023-09-13T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/09/13/debian-12-ftp-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/09/13/debian-12-ftp-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に FTP サーバを構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12.0.0 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12.0.0 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;接続テストでは FileZilla という FTP クライアントを使用する。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-vsftpd-のインストール&quot;&gt;1. vsftpd のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install vsftpd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-vsftpd-設定ファイルの編集&quot;&gt;2. vsftpd 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# anonymous によるログインを無効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;anonymous_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO

&lt;span class=&quot;c&quot;&gt;# ローカルアクセスの許可&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;local_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# 書き込み許可&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;write_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# アスキーモードでの転送を許可&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;ascii_upload_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;span class=&quot;nv&quot;&gt;ascii_download_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# chroot 有効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chroot_local_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# chroot リスト有効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chroot_list_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# chrootリスト指定&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chroot_list_file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/etc/vsftpd.chroot_list

&lt;span class=&quot;c&quot;&gt;# ディレクトリごと一括での転送を有効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;ls_recurse_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES

&lt;span class=&quot;c&quot;&gt;# chroot のルートディレクトリ指定&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ( 指定しない場合はユーザーのホームディレクトリ直下 )&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# public_htmlを指定した場合で、且つ当該ディレクトリがないとログインできないので注意&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;local_root&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;public_html

&lt;span class=&quot;c&quot;&gt;# seccomp filter をオフにする&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;seccomp_sandbox&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO

&lt;span class=&quot;c&quot;&gt;# PASV モード有効化&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;pasv_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;span class=&quot;nv&quot;&gt;pasv_min_port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4000
&lt;span class=&quot;nv&quot;&gt;pasv_max_port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4005
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-ホームディレクトリより上層へのアクセス許可設定&quot;&gt;3. ホームディレクトリより上層へのアクセス許可設定&lt;/h3&gt;

&lt;p&gt;ホームディレクトリより上層へのアクセスを許可するユーザのリストを作成する。（上記設定ファイル内の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.chroot_list&lt;/code&gt; のこと）&lt;br /&gt;
指定は、１行に１ユーザ。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.chroot_list&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;masaru
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-ssl-サーバの構築&quot;&gt;4. SSL サーバの構築&lt;/h3&gt;

&lt;p&gt;vsftpd を SSL/TLS で使用できるようにするには SSL サーバが必要であるので、未インストールなら OpenSSL をインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install openssl
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-サーバ証明書の作成&quot;&gt;5. サーバ証明書の作成&lt;/h3&gt;

&lt;p&gt;vsftpd を SSL/TLS で使用できるようサーバ証明書を作成する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /etc/ssl/private
# openssl req -x509 -nodes -newkey rsa:2048 -keyout /etc/ssl/private/vsftpd.pem -out /etc/ssl/private/vsftpd.pem

      :
===&amp;lt; 中略 &amp;gt;===
      :

-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &apos;.&apos;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:JP                                    # &amp;lt;= 国の略名
State or Province Name (full name) [Some-State]:Shimane                 # &amp;lt;= 都道府県名
Locality Name (eg, city) []:Matsue                                      # &amp;lt;= 市区町村名
Organization Name (eg, company) [Internet Widgits Pty Ltd]:mk-mode.com  # &amp;lt;= サイト名（何でもよい）
Organizational Unit Name (eg, section) []:                              # &amp;lt;= 部署名（空でよい）
Common Name (e.g. server FQDN or YOUR name) []:ftp.mk-mode.com          # &amp;lt;= ホスト名
Email Address []:root@mk-mode.com                                       # &amp;lt;= 管理者メールアドレス
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;作成したサーバ証明書のパーミッションを設定する。（所有者読み込み専用に）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chmod 400 vsftpd.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-vsftpd-設定ファイルの編集&quot;&gt;6. vsftpd 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;サーバ証明書を使用できるよう vsftpd 設定ファイルを以下のように編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;ssl_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES              &lt;span class=&quot;c&quot;&gt;# 編集（SSL有効化）&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;ssl_ciphers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;HIGH
&lt;span class=&quot;nv&quot;&gt;ssl_tlsv1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;span class=&quot;nv&quot;&gt;ssl_sslv2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO
&lt;span class=&quot;nv&quot;&gt;ssl_sslv3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NO
&lt;span class=&quot;nv&quot;&gt;force_local_data_ssl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;span class=&quot;nv&quot;&gt;force_local_logins_ssl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;YES
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-vsftpd-の再起動&quot;&gt;7. vsftpd の再起動&lt;/h3&gt;

&lt;p&gt;設定を有効化するために vsftpd を再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart vsftpd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-ファイアウォール-ufw-の設定&quot;&gt;8. ファイアウォール (ufw) の設定&lt;/h3&gt;

&lt;p&gt;外部に公開する場合は、TCP ポート 21(FTP) へのアクセスを許可する必要がある。&lt;br /&gt;
また、 PASV モードで運用する場合は、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/vsftpd.conf&lt;/code&gt; の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pasv_min_port&lt;/code&gt; から &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pasv_max_port&lt;/code&gt; で設定したポートも開放する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 21/tcp
Rule added

# ufw allow 4000,4001,4002,4003,4004,4005/tcp
Rule added

# ufw status
Status: active

To                         Action      From
--                         ------      ----
9999/tcp                   ALLOW       192.168.11.0/24
53                         ALLOW       Anywhere
21/tcp                     ALLOW       Anywhere
4000,4001,4002,4003,4004,4005/tcp ALLOW       Anywhere
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-動作確認&quot;&gt;9. 動作確認&lt;/h3&gt;

&lt;p&gt;クライアント側からコマンドラインや FTP クライアントでサーバに接続して、アップロード・ダウンロード等各種操作が可能かチェックする。&lt;br /&gt;
FTP クライアント FileZilla なら以下のように設定してログイン。
e&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ホスト：サーバホスト名 or サーバ IP アドレス&lt;/li&gt;
  &lt;li&gt;プロトコル：「FTP - ファイル転送プロトコル」&lt;/li&gt;
  &lt;li&gt;暗号化：「明示的な FTP over TLS が必要」&lt;/li&gt;
  &lt;li&gt;ログオンの種類：「通常」 or 「パスワードを尋ねる」&lt;/li&gt;
  &lt;li&gt;ユーザ：ユーザ名&lt;/li&gt;
  &lt;li&gt;転送モード：「アクティブ」&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;lftp を使用するなら、インストール後、設定を行なう。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt install lftp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.lftprc&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;set ftp:ssl-auth TLS
set ftp:ssl-force true
set ftp:ssl-protect-list yes
set ftp:ssl-protect-data yes
set ftp:ssl-protect-fxp yes
set ssl:verify-certificate no
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そして、ログイン。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ lftp -u masaru 192.168.11.101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;10-自動起動の設定&quot;&gt;10. 自動起動の設定&lt;/h3&gt;

&lt;p&gt;vsftpd インストール直後はマシン起動時に自動で vsftpd が起動するようになっている。&lt;/p&gt;

&lt;p&gt;自動起動しないように設定するなら以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl disable vsftpd
Synchronizing state of vsftpd.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable vsftpd
insserv: warning: current start runlevel(s) (empty) of script `vsftpd&apos; overrides LSB defaults (2 3 4 5).
insserv: warning: current stop runlevel(s) (0 1 2 3 4 5 6) of script `vsftpd&apos; overrides LSB defaults (0 1 6).

# systemctl is-enabled vsftpd
disabled  # &amp;lt;= disabled であることを確認
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;逆に自動起動するように設定するなら以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl enable vsftpd
Synchronizing state of vsftpd.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable vsftpd
insserv: warning: current start runlevel(s) (empty) of script `vsftpd&apos; overrides LSB defaults (2 3 4 5).
insserv: warning: current stop runlevel(s) (0 1 2 3 4 5 6) of script `vsftpd&apos; overrides LSB defaults (0 1 6).

# systemctl is-enabled vsftpd
enabled  # &amp;lt;= enabled であることを確認
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="FTP" /><summary type="html">Debian GNU/Linux 12 (bookworm) に FTP サーバを構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - DNS サーバ BIND9 構築！</title><link href="https://komasaru.github.io/2023/09/06/debian-12-bind-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - DNS サーバ BIND9 構築！" /><published>2023-09-06T00:00:00+09:00</published><updated>2023-09-06T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/09/06/debian-12-bind-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/09/06/debian-12-bind-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に DNS サーバを構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12.0.0 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;サーバのローカル IP アドレスは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.11&lt;/code&gt;、グローバル IP アドレスは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xxx.yyy.zzz.aaa&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、マシンのホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opti&lt;/code&gt;、ネームサーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ns&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;セカンダリ DNS は用意しない。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-bind-のインストール&quot;&gt;1. BIND のインストール&lt;/h3&gt;

&lt;p&gt;（”dnsutils” は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dig&lt;/code&gt; コマンド用）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install bind9 dnsutils
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-bind-設定ファイルの編集&quot;&gt;2. BIND 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.options&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.local&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#include &quot;/etc/bind/named.conf.default-zones&quot;;  # &amp;lt;= コメント化（内部向け・外部向けゾーンファイルで定義するので）&lt;/span&gt;
include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.internal-zones&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# &amp;lt; = 追加&lt;/span&gt;
include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.external-zones&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# &amp;lt; = 追加&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-内部向けゾーンファイルの作成&quot;&gt;3. 内部向けゾーンファイルの作成&lt;/h3&gt;

&lt;p&gt;BIND 設定ファイルで指定している内部向けゾーンファイルを以下のように作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf.internal-zones&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;view &lt;span class=&quot;s2&quot;&gt;&quot;internal&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# 内部向け設定の対象範囲定義&lt;/span&gt;
    match-clients &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        192.168.11.0/24&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 内部向け正引きゾーン定義&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;mk-mode.com&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/mk-mode.com.lan&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 内部向け逆引きゾーン定義&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;11.168.192.in-addr.arpa&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/11.168.192.db&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    include &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/named.conf.default-zones&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    empty-zones-enable no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;最後の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;empty-zones-enable no;&lt;/code&gt; は、ログに以下のようなメッセージが出力されないための対処。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Warning: view internal: &apos;empty-zones-enable/disable-empty-zone&apos; not set: disabling RFC 1918 empty zones
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-外部向けゾーンファイルの作成&quot;&gt;4. 外部向けゾーンファイルの作成&lt;/h3&gt;

&lt;p&gt;BIND 設定ファイルで指定している外部向けゾーンファイルを以下のように作成する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf.external-zones&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;view &lt;span class=&quot;s2&quot;&gt;&quot;external&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    match-clients &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# 全て対象（内部向け範囲以外のホスト）&lt;/span&gt;
    allow-query &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# 問い合わせは全て許可&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#recursion no;            # 再帰検索禁止&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 外部向け正引きゾーン定義&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;mk-mode.com&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/mk-mode.com.wan&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 外部向け正引き情報を定義 *注&lt;/span&gt;
    zone &lt;span class=&quot;s2&quot;&gt;&quot;zzz.yyy.xxx.in-addr.arpa&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/zzz.yyy.xxx.db&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-update &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-オプション設定ファイルの編集&quot;&gt;5. オプション設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;その他の設定用ファイルを以下のように編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/named.conf.options&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;options &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        directory &lt;span class=&quot;s2&quot;&gt;&quot;/var/cache/bind&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        // 問合わせを許可する範囲
        // &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;サーバー、ローカルネットワーク内のホストからの問合せのみ許可&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        allow-query &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; localnets&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;      &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

        // ゾーン情報の転送を許可する範囲
        // &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;サーバー、ローカルネットワーク内のホストへのみ転送を許可&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; localnets&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

        // 再帰検索を許可する範囲
        // &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;サーバー、ローカルネットワーク内のホストのみ再検索を許可&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        allow-recursion &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; localnets&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;

        dnssec-validation auto&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        auth-nxdomain no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;# conform to RFC1035&lt;/span&gt;

        // IPv6 は使用しないので無効化
        //listen-on-v6 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        listen-on-v6 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# EDNS0 の無効化&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# &quot;error (unexpected RCODE REFUSED) ...&quot; 出力の抑止&lt;/span&gt;
server 0.0.0.0 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        edns no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# &quot;DNS format error ... invalid response&quot; 出力の抑止&lt;/span&gt;
logging &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        category resolver &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-内部向け正引きゾーン定義ファイルの作成&quot;&gt;6. 内部向け正引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/mk-mode.com.lan&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2023082201  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  A       192.168.11.11
        IN  MX 10   ns.mk-mode.com.
ns      IN  A       192.168.11.101
vbox    IN  A       192.168.11.101
hoge    IN  A       192.168.11.2
fuga    IN  A       192.168.11.3
www     IN  CNAME   ns.mk-mode.com.
ftp     IN  CNAME   ns.mk-mode.com.
mail    IN  CNAME   ns.mk-mode.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hoge&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fuga&lt;/code&gt; はローカルネットワーク内の別のマシン。&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ftp&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mail&lt;/code&gt; は別名定義。&lt;/p&gt;

&lt;h3 id=&quot;7-外部向け正引きゾーン定義ファイルの作成&quot;&gt;7. 外部向け正引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/mk-mode.com.wan&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2023082201  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  A       xxx.yyy.zzz.aaa
        IN  MX 10   ns.mk-mode.com.
ns      IN  A       xxx.yyy.zzz.aaa
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-内部向け逆引きゾーン定義ファイルの作成&quot;&gt;8. 内部向け逆引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/11.168.192.db&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2023082201  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  PTR     mk-mode.com.
        IN  A       255.255.255.0
101     IN  PTR     ns.mk-mode.com.
101     IN  PTR     vbox.mk-mode.com.
2       IN  PTR     hoge.mk-mode.com.
3       IN  PTR     fuga.mk-mode.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-外部向け逆引きゾーン定義ファイルの作成&quot;&gt;9. 外部向け逆引きゾーン定義ファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/bind/zzz.yyy.xxx.db&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt; 86400
@   IN  SOA     ns.mk-mode.com. root.mk-mode.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        2023082201  &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Serial
        3600        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Refresh
        1800        &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Retry
        604800      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Expire
        86400       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;Minimum TTL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

        IN  NS      ns.mk-mode.com.
        IN  PTR     mk-mode.com.
        IN  A       255.255.255.254
aaa     IN  PTR     ns.mk-mode.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;255.255.255.254&lt;/code&gt; はグローバル IP が１個のみの場合の設定値）&lt;/p&gt;

&lt;h3 id=&quot;10-問合せ先-dns-サーバの追加&quot;&gt;10. 問合せ先 DNS サーバの追加&lt;/h3&gt;

&lt;p&gt;DNS サーバー自身も問合せ先に追加する。&lt;br /&gt;
最初から記載のあるルータの IP アドレス（インストール・初期設定時のもの）をセカンダリ、今回構築のサーバ自身をプライマリに設定するので、ルータより先に記述する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/resolv.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;domain localdomai
search localdomain
nameserver 192.168.11.101  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;
nameserver 192.168.11.1    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= ルータの IP アドレス&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;11-ipv6-の無効化設定&quot;&gt;11. IPv6 の無効化設定&lt;/h3&gt;

&lt;p&gt;システムとして IPv6 を無効にしている場合は、以下のように “/etc/default/bind9” を編集する。
（”/var/log/syslog” に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;... named[9999]: error (network unreachable) resolving ...&lt;/code&gt; のようなエラーが出力されないようにするため）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/named&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;OPTIONS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-u bind -4&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;12-bind-の再起動&quot;&gt;12. BIND の再起動&lt;/h3&gt;

&lt;p&gt;設定を有効化するために BIND を再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart named
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;もし、この際に次のようなエラーとなる場合、&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;System has not been booted with systemd as init system (PID 1). Can&apos;t operate.
Failed to connect to bus: ホストが落ちています
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;これは、 SystemD が正常に起動していない（SystemCtl がインストールされていない）ためなので、 SystemCtl をインストールする。&lt;/p&gt;

&lt;h3 id=&quot;13-動作確認&quot;&gt;13. 動作確認&lt;/h3&gt;

&lt;p&gt;DNS サーバが正常に機能する（正引きで IP アドレス、逆引きでホスト名が返ってくる）か、確認してみる。&lt;/p&gt;

&lt;p&gt;・内部向け正引きテスト&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig ns.mk-mode.com.

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1~deb12u1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; ns.mk-mode.com.
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 33866
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 3366292790b8d1870100000064f6b3d7b3b6be5ed17756da (good)
;; QUESTION SECTION:
;ns.mk-mode.com.                        IN      A

;; ANSWER SECTION:
ns.mk-mode.com.         86400   IN      A       192.168.11.101

;; Query time: 0 msec
;; SERVER: 192.168.11.101#53(192.168.11.101) (UDP)
;; WHEN: Tue Sep 05 13:51:35 JST 2023
;; MSG SIZE  rcvd: 87
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;・内部向け逆引きテスト&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig -x 192.168.11.101

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1~deb12u1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; -x 192.168.11.101
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 14510
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 0134ba8c574723ea0100000064f6b3f8eef6d1ed068fcb4e (good)
;; QUESTION SECTION:
;101.11.168.192.in-addr.arpa.   IN      PTR

;; ANSWER SECTION:
101.11.168.192.in-addr.arpa. 86400 IN   PTR     vbox.mk-mode.com.
101.11.168.192.in-addr.arpa. 86400 IN   PTR     ns.mk-mode.com.

;; Query time: 0 msec
;; SERVER: 192.168.11.101#53(192.168.11.101) (UDP)
;; WHEN: Tue Sep 05 13:52:08 JST 2023
;; MSG SIZE  rcvd: 131
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;・外部向け正引きテスト&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig www.isc.org

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1~deb12u1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; www.isc.org
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 42466
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 6609a8b670fa84ae0100000064f6b42016133bc852f562a9 (good)
;; QUESTION SECTION:
;www.isc.org.                   IN      A

;; ANSWER SECTION:
www.isc.org.            300     IN      CNAME   dualstack.osff2.map.fastly.net.
dualstack.osff2.map.fastly.net. 30 IN   A       151.101.90.217

;; Query time: 1027 msec
;; SERVER: 192.168.11.101#53(192.168.11.101) (UDP)
;; WHEN: Tue Sep 05 13:52:48 JST 2023
;; MSG SIZE  rcvd: 128
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;・外部向け逆引きテスト&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dig -x 151.101.110.217

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.16-1~deb12u1-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; -x 151.101.110.217
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NXDOMAIN, id: 55453
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 9748c1f85cf218f90100000064f6b43b64ac3ea5263aab9a (good)
;; QUESTION SECTION:
;217.110.101.151.in-addr.arpa.  IN      PTR

;; AUTHORITY SECTION:
151.in-addr.arpa.       3600    IN      SOA     pri.authdns.ripe.net. dns.ripe.net. 1693818121 3600 600 864000 3600

;; Query time: 1543 msec
;; SERVER: 192.168.11.101#53(192.168.11.101) (UDP)
;; WHEN: Tue Sep 05 13:53:15 JST 2023
;; MSG SIZE  rcvd: 169
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;14-ファイアウォール-ufw-の設定&quot;&gt;14. ファイアウォール (ufw) の設定&lt;/h3&gt;

&lt;p&gt;実際に運用する場合は、外部からのTCP/UDP53番ポート(DNS)へのアクセスを許可する必要がある。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 53
Rule added

# ufw status
Status: active

To                         Action      From
--                         ------      ----
9999/tcp                   ALLOW       192.168.11.0/24
53                         ALLOW       Anywhere
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="DNS" /><summary type="html">Debian GNU/Linux 12 (bookworm) に DNS サーバを構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">2023年8月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2023/09/01/blog-access/" rel="alternate" type="text/html" title="2023年8月 - OS・ブラウザ別アクセス状況！" /><published>2023-09-01T00:00:00+09:00</published><updated>2023-09-01T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/09/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2023/09/01/blog-access/">&lt;p&gt;9月になりましたので、先月8月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13,388&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;72.9790&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,110&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16.9528&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;826&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.5026&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;650&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.5432&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;210&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.1447&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;156&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8504&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0164&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0055&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OpenBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0055&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18,345&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13,293&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;72.4612&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,110&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16.9528&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;826&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.5026&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;650&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.5432&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;210&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.1447&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;156&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8504&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;77&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4197&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0654&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;XP&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0273&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0164&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0055&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OpenBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0055&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0055&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18,345&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15,331&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;83.5705&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,598&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8.7108&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,314&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7.1627&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;94&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5124&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Debian IceWeasel&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0164&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0164&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla SeaMonkey&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0055&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0055&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18,345&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9,512&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;51.8506&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,699&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20.1635&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;114.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,058&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.7672&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;895&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.8787&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;804&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.3827&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;113.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;580&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.1616&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;414&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.2567&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;102.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;281&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.5318&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;266&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.4500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;94&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5124&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;109.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;58&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3162&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;112.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;55&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2998&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;48&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2617&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;50.0.2661.102&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;43&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2344&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;111.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;35&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1908&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;113.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;22&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1199&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;108.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;21&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1145&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;68.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1090&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;110.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0981&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;81.0.4044.138&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0872&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18,345&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">9月になりましたので、先月8月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 12 (bookworm) - サービスの管理！</title><link href="https://komasaru.github.io/2023/08/30/debian-12-service-management/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - サービスの管理！" /><published>2023-08-30T00:00:00+09:00</published><updated>2023-08-30T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/08/30/debian-12-service-management</id><content type="html" xml:base="https://komasaru.github.io/2023/08/30/debian-12-service-management/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) でのサービスの管理についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;※※※ 2023-09-05 追記 ※※※&lt;/strong&gt;&lt;br /&gt;
以下では sysv-rc-conf のインストールについて説明しているが、&lt;br /&gt;
sysv-rc-conf をインストールすると、ファイアウォール関連(ufw, iptables)が機能しなくなる。&lt;br /&gt;
原因は不明。&lt;br /&gt;
よって、 sysv-rc-conf のインストール・利用はしないこととした。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12.0.0 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;SystemD の簡単な使用法と SysVinit の導入を行う。&lt;br /&gt;
（当方、普段は SystemD でサービスの管理を行うが、有事の際に備えて &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; コマンドも使用できるよう準備しておく（RedHat 系ディストリビューションのサービス管理ツール &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chkconfig&lt;/code&gt; にあたるもの））&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-systemd-の使用方法&quot;&gt;1. SystemD の使用方法&lt;/h3&gt;

&lt;p&gt;以下は vsftpd サーバの例。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vsftpd.service&lt;/code&gt; が正式なサービス名だが &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.service&lt;/code&gt; は省略可能）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ systemctl start vsftpd        # &amp;lt;= vsftpd サービスの起動
$ systemctl stop vsftpd         # &amp;lt;= vsftpd サービスの停止
$ systemctl status vsftpd       # &amp;lt;= vsftpd サービスの状況確認
$ systemctl enable vsftpd       # &amp;lt;= vsftpd サービスの自動起動設定
$ systemctl disble vsftpd       # &amp;lt;= vsftpd サービスの自動起動解除
$ systemctl is-enabled vsftpd   # &amp;lt;= vsftpd サービスが自動起動設定されているか
$ systemctl list-unit-files -t service | grep vsftpd  # &amp;lt;= vsftpd 起動設定の確認
$ systemctl -t service          # &amp;lt;= 起動中サービス一覧の確認
$ systemctl -t service --all    # &amp;lt;= 全サービス一覧の確認
$ systemctl poweroff            # &amp;lt;= システム Shutdown 後電源 OFF
$ systemctl halt                # &amp;lt;= システム Shutdown 後 Halt
$ systemctl reboot              # &amp;lt;= システム Shutdown 後リブート
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SystemD 未対応のサービスの場合でも自動で従来の SysVinit にサービスの管理を移譲しますが、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;systemctl list-unit-files&lt;/code&gt; での確認はできないので注意。&lt;/p&gt;

&lt;h3 id=&quot;2-sysv-rc-conf-のインストール&quot;&gt;2. sysv-rc-conf のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install sysv-rc-conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-sysv-rc-conf-でサービス一覧表示&quot;&gt;3. sysv-rc-conf でサービス一覧表示&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; でサービスの一覧を表示するには以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sysv-rc-conf --list
apparmor     S:on
bootlogs     1:on       2:on    3:on    4:on    5:on
brightness   0:off      6:off   S:on
clamav-daemo 0:off      1:off   2:on    3:on    4:on    5:on    6:off
clamav-fresh 0:off      1:off   2:on    3:on    4:on    5:on    6:off
         :
====&amp;lt; 途中省略 &amp;gt;====
         :
umountfs     0:off      6:off
umountroot   0:off      6:off
unattended-u 0:off      2:on    3:on    4:on    5:on    6:off
urandom      0:off      6:off   S:on
x11-common   S:on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-sysv-rc-conf-でのサービス自動起動設定&quot;&gt;4. sysv-rc-conf でのサービス自動起動設定&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; でサービスの自動起動を有効化・無効化するには以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sysv-rc-conf acpid off  # acpid の自動起動無効化する場合

# sysv-rc-conf acpid on   # acpid の自動起動有効化する場合
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-一覧形式での自動起動設定&quot;&gt;5. 一覧形式での自動起動設定&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; をオプション無しで実行すると以下のような画面になる。（ある程度のサイズのコンソール画面が必要）&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-&lt;/code&gt; でサービス停止、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;=&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;+&lt;/code&gt; でサービス開始、スペースでランレベル別に ON/OFF できる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌ SysV Runlevel Config   -: stop service  =/+: start service  h: help  q: quit ─┐
│                                                                                │
│ service      1       2       3       4       5       0       6       S         │
│ ----------------------------------------------------------------------------   │
│ apparmor    [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [X]        │
│ bootlogs    [X]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]        │
│ brightness  [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [X]        │
│ clamav-da$  [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]        │
│ clamav-fr$  [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]        │
│ cron        [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]        │
│ dbus        [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]        │
│ exim4       [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]        │
│ halt        [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]        │
│ killprocs   [X]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]        │
│ kmod        [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [X]        │
│ mount-con$  [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [X]        │
│ networking  [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [X]        │
│ nftables    [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [X]        │
│ procps      [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [X]        │
│ rc.local    [ ]     [X]     [X]     [X]     [X]     [ ]     [ ]     [ ]        │
│ reboot      [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]     [ ]        │
│                                                                                │
└────────────────────────────────────────┘
┌────────────────────────────────────────┐
│ Use the arrow keys or mouse to move around.      ^n: next pg     ^p: prev pg   │
│                        space: toggle service on / off                          │
└────────────────────────────────────────┘
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-insserv-コマンドの利用&quot;&gt;6. insserv コマンドの利用&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysv-rc-conf&lt;/code&gt; をインストールして使用しなくても、デフォルトで用意されている &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;insserv&lt;/code&gt; コマンドを使用することも可能である。&lt;/p&gt;

&lt;p&gt;以下のコマンドでサービスの一覧（終了・起動時のランレベル等）を表示する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-s&lt;/code&gt; は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--showall&lt;/code&gt; でもよい）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# insserv -s
K:01:0 6:udev
K:01:0 1 6:clamav-freshclam
K:04:0 6:umountnfs.sh
K:03:0 6:sendsigs
K:06:0 6:umountfs
         :
====&amp;lt; 途中省略 &amp;gt;====
         :
S:05:S:checkroot.sh
S:08:S:mount-configfs
S:07:S:kmod
S:14:S:x11-common
S:10:S:procps
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;サービスの自動起動を無効化するには以下のようにする。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-r&lt;/code&gt; は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--remove&lt;/code&gt; でもよい）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# insserv -r hoge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;サービスの自動起動を有効化するには以下のようにする。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-d&lt;/code&gt; は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--default&lt;/code&gt; でもよい）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# insserv -d hoge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><summary type="html">Debian GNU/Linux 12 (bookworm) でのサービスの管理についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください） ※※※ 2023-09-05 追記 ※※※ 以下では sysv-rc-conf のインストールについて説明しているが、 sysv-rc-conf をインストールすると、ファイアウォール関連(ufw, iptables)が機能しなくなる。 原因は不明。 よって、 sysv-rc-conf のインストール・利用はしないこととした。</summary></entry><entry><title type="html">Debian 12 (bookworm) - ファイアウォール設定！</title><link href="https://komasaru.github.io/2023/08/23/debian-12-firewall-setting/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - ファイアウォール設定！" /><published>2023-08-23T00:00:00+09:00</published><updated>2023-08-23T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/08/23/debian-12-firewall-setting</id><content type="html" xml:base="https://komasaru.github.io/2023/08/23/debian-12-firewall-setting/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) でファイアウォールを設定する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12.0.0 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12.0.0 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;ufw (= &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Uncomplicated Firewall&lt;/code&gt;) という nftables のフロントエンドツールを使用する。&lt;/li&gt;
  &lt;li&gt;ファイアウォールのルールは、取り急ぎ最低限の設定のみ。（運用する環境やインストールしたサービスに合わせて適宜行う）&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-ufw-のインストール&quot;&gt;1. ufw のインストール&lt;/h3&gt;

&lt;p&gt;依存する nftables もインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install ufw nftables
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-nftables-の起動&quot;&gt;2. nftables の起動&lt;/h3&gt;

&lt;p&gt;デフォルトでは起動していないかもしれないので、起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl start nftables
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-nftables-の自動起動設定&quot;&gt;3. nftables の自動起動設定&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl enable nftables
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-設定ファイルの編集&quot;&gt;4. 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;IPv6 を使用しない場合は以下のように編集しておく&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/default/ufw&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;IPV6=no
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-各種コマンドについて&quot;&gt;5. 各種コマンドについて&lt;/h3&gt;

&lt;p&gt;各種コマンドの使用法について簡単に説明する。&lt;br /&gt;
（以下のサービス名、ポート番号は一例）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw status            # &amp;lt;= 状況確認
# ufw enable            # &amp;lt;= ファイアウォールの有効化
# ufw disable           # &amp;lt;= ファイアウォールの無効化
# ufw default deny      # &amp;lt;= 全アクセスの拒否
# ufw default allow     # &amp;lt;= 全アクセスの許可
# ufw deny smtp         # &amp;lt;= SMTP サービスのアクセスを拒否
# ufw allow ftp         # &amp;lt;= FTP サービスのアクセスを許可
# ufw deny 25/tcp       # &amp;lt;= TCP ポート 25 でのアクセスを拒否
# ufw allow 80/udp      # &amp;lt;= UDP ポート 80 でのアクセスを許可
# ufw allow 53          # &amp;lt;= TCP ポート 53, UDP ポート 53 でのアクセスを拒否
# ufw allow in http     # &amp;lt;= HTTP サービスのアクセスを IN のみ許可
# ufw reject out smtp   # &amp;lt;= SMTP サービスのアクセスを OUT のみ却下
# ufw allow proto tcp from any to any port 8080:8090
                        # &amp;lt;= TCP ポート 8080 〜 8090 での全アクセスを許可
# ufw allow proto tcp from 192.168.11.0/24 to any port 9999
                        # &amp;lt;= TCP ローカルネットワーク 192.168.11.0/24 からの
                        #    TCP ポート 9999 でのアクセスを許可
# ufw delete 3          # &amp;lt;= 3 番目のルールを削除
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;その他、詳細な説明は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;man ufw&lt;/code&gt; で確認可。&lt;/p&gt;

&lt;h3 id=&quot;6-その他&quot;&gt;6. その他&lt;/h3&gt;

&lt;p&gt;一般的には、一旦全てのアクセスを拒否し、許可したいポートのみ解放するという形式となる。&lt;/p&gt;

&lt;p&gt;サーバインストール直後（SSH サーバ導入済み）なら、以下のようにローカルネットからのみ SSH 接続を許可するようにし、後に各種サービスを運用するたびに解放するポートを設定すればよいだろう。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw default deny
Default incoming policy changed to &apos;deny&apos;
(be sure to update your rules accordingly)

# ufw allow proto tcp from 192.168.11.0/24 to any port 9999
Rules updated

# ufw enable
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup

# ufw status
Status: active

To                         Action      From
--                         ------      ----
9999/tcp                   ALLOW       192.168.11.0/24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ファイアウォールを有効にする際に SSH 接続できるように設定しておかないとリモートで操作できなるのでご注意を。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="ファイアウォール" /><summary type="html">Debian GNU/Linux 12 (bookworm) でファイアウォールを設定する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - 時刻同期設定(systemd-timesyncd)！</title><link href="https://komasaru.github.io/2023/08/16/debian-12-systemd-timesyncd/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - 時刻同期設定(systemd-timesyncd)！" /><published>2023-08-16T00:00:00+09:00</published><updated>2023-08-16T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/08/16/debian-12-systemd-timesyncd</id><content type="html" xml:base="https://komasaru.github.io/2023/08/16/debian-12-systemd-timesyncd/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) 上で systemd-timesyncd サービスを使用して時刻同期する設定についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12.0.0 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntpd&lt;/code&gt; や &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chronyd&lt;/code&gt; は使用しない。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-ntpd-chronyd-の停止&quot;&gt;1. ntpd, chronyd の停止&lt;/h3&gt;

&lt;p&gt;ntpd や chronyd は不要なので、サービスが起動していれば停止し、自動起動もしないように設定しておく。（以下のようなコマンドで）&lt;br /&gt;
ちなみに、 OS インストール直後は ntpd も chronyd も起動してなく、 systemd-timesyncd が起動しているはず。（chronyd 自体、インストールされていないはず）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl status chronyd
# systemctl stop chronyd
# systemctl disable chronyd
# systemctl is-enabled chronyd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-ntp-機能の有効化&quot;&gt;2. NTP 機能の有効化&lt;/h3&gt;

&lt;p&gt;まず、現状の NTP の設定状況を確認する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# timedatectl status
               Local time: 水 2023-07-12 15:17:05 JST
           Universal time: 水 2023-07-12 06:17:05 UTC
                 RTC time: 水 2023-07-12 06:17:05
                Time zone: Asia/Tokyo (JST, +0900)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NTP service&lt;/code&gt; が &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;active&lt;/code&gt; になっていれば、 NTP 機能は有効になっているということ。（次項 3 へ）&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NTP service&lt;/code&gt; が &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;inactive&lt;/code&gt; になっていれば、 NTP 機能が無効になっているということなので、以下を実行して NTP 機能を有効化する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# timedatectl set-ntp true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-ntp-サーバの設定&quot;&gt;3. NTP サーバの設定&lt;/h3&gt;

&lt;p&gt;以下は当方の例。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/systemd/timesyncd.conf&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Time]
&lt;span class=&quot;nv&quot;&gt;NTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ntp.nict.jp
&lt;span class=&quot;nv&quot;&gt;FallbackNTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ntp1.jst.mfeed.ad.jp ntp2.jst.mfeed.ad.jp ntp3.jst.mfeed.ad.jp&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NTP&lt;/code&gt; がメイン、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FallbackNTP&lt;/code&gt; が予備。&lt;/li&gt;
  &lt;li&gt;複数のサーバを設定する場合は半角スペースで区切る。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;4-時刻同期デーモンの再起動&quot;&gt;4. 時刻同期デーモンの再起動&lt;/h3&gt;

&lt;p&gt;設定を有効化するために時刻同期デーモン systemd-timesyncd を再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart systemd-timesyncd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;元々 ntpd や chronyd を起動していた場合は systemd-timesyncd は起動していなかったであろうから、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;restart&lt;/code&gt; でなく &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;start&lt;/code&gt; とする。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;5-時刻同期デーモン自動起動の設定&quot;&gt;5. 時刻同期デーモン自動起動の設定&lt;/h3&gt;

&lt;p&gt;元々 ntpd や chronyd を起動していなかった場合は systemd-timesyncd は自動起動する設定になっているはず。&lt;/p&gt;

&lt;p&gt;自動起動する設定になっていなかった場合は、設定しておく。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl enable systemd-timesyncd
# systemctl is-enabled systemd-timesyncd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Linux" /><category term="Debian" /><summary type="html">Debian GNU/Linux 12 (bookworm) 上で systemd-timesyncd サービスを使用して時刻同期する設定についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - アンチウィルスソフト導入！</title><link href="https://komasaru.github.io/2023/08/09/debian-12-anti-virus-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - アンチウィルスソフト導入！" /><published>2023-08-09T00:00:00+09:00</published><updated>2023-08-09T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/08/09/debian-12-anti-virus-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/08/09/debian-12-anti-virus-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) にウイルス対策ソフト ClamAV をインストールする方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12.0.0 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;Apt でインストールする。（但し、Apt のパッケージはバージョンが古い。最新版が良ければ、&lt;a href=&quot;http://sourceforge.net/projects/clamav/files/clamav/&quot;&gt;こちら&lt;/a&gt;からダウンロードしてビルドするとよい）&lt;/li&gt;
  &lt;li&gt;毎日自動でウィルススキャンを実行するようにする。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-clamav-のインストール&quot;&gt;1. ClamAV のインストール&lt;/h3&gt;

&lt;p&gt;以下のようにして、アンチウィルスソフト ClamAV, ClamAV Daemon をインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install clamav clamav-daemon
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-ウィルス定義ファイルの最新化&quot;&gt;2. ウィルス定義ファイルの最新化&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;freshclam&lt;/code&gt; コマンドでウィルス定義ファイルを最新に更新する。&lt;/p&gt;

&lt;p&gt;しかし、デフォルトの状態では以下のようになってしまう。（以前はこのような事態にはならなかったが）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# freshclam
ERROR: /var/log/clamav/freshclam.log is locked by another process
ERROR: Problem with internal logger (UpdateLogFile = /var/log/clamav/freshclam.log).
ERROR: initialize: libfreshclam init failed.
ERROR: Initialization error!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そこで、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/log/clamav/freshclam.log&lt;/code&gt; を作り直す。&lt;br /&gt;
（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamav:adm&lt;/code&gt; となっている所有者・グループを &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamav:clamav&lt;/code&gt; に変更するだけはうまく行かない）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rm -f /var/log/clamav/freshclam.log
# touch /var/log/clamav/freshclam.log
# chown clamav:clamav /var/log/clamav/freshclam.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そして、 freshclam を実行&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# freshclam
Wed Jul 12 15:13:33 2023 -&amp;gt; ClamAV update process started at Wed Jul 12 15:13:33 2023
Wed Jul 12 15:13:33 2023 -&amp;gt; daily.cvd database is up-to-date (version: 26966, sigs: 2038808, f-level: 90, builder: raynman)
Wed Jul 12 15:13:33 2023 -&amp;gt; main.cvd database is up-to-date (version: 62, sigs: 6647427, f-level: 90, builder: sigmgr)
Wed Jul 12 15:13:33 2023 -&amp;gt; bytecode.cvd database is up-to-date (version: 334, sigs: 91, f-level: 90, builder: anvilleg)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;（インストールした ClamAV のバージョンが古い場合に警告メッセージが出力されるが、特に問題はないので無視してよい）&lt;/p&gt;

&lt;p&gt;但し、上記の方法は一時的なものであり、また同じ現象に陥ってしまう。&lt;br /&gt;
ログローテートの設定を編集する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/logrotate.d/clamav-freshclam&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;/var/log/clamav/freshclam.log &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
     rotate 12
     weekly
     compress
     delaycompress
     missingok
     &lt;span class=&quot;c&quot;&gt;#create 640  clamav adm    # &amp;lt;== 削除&lt;/span&gt;
     create 640  clamav clamav  &lt;span class=&quot;c&quot;&gt;# &amp;lt;== 追加&lt;/span&gt;
     postrotate
     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; /run/systemd/system &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
         &lt;/span&gt;systemctl &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; is-active clamav-freshclam &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; systemctl &lt;span class=&quot;nb&quot;&gt;kill&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--signal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;SIGHUP clamav-freshclam &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true
     &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else
         &lt;/span&gt;invoke-rc.d clamav-freshclam reload-log &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true
     &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;fi
     &lt;/span&gt;endscript
     &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ついでに、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/logrotate.d/clamav-daemon&lt;/code&gt; も同様に編集しておいたほうがよいかもしれない。&lt;/p&gt;

&lt;h3 id=&quot;3-ウィルススキャンのテストウィルス無しの場合&quot;&gt;3. ウィルススキャンのテスト（ウィルス無しの場合）&lt;/h3&gt;

&lt;p&gt;以下のようにして、ウィルススキャンを行ってみる。&lt;br /&gt;
（スキャンするディレクトリを指定するなら、最後にディレクトリを指定する）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# clamscan --infected --remove --recursive

----------- SCAN SUMMARY -----------
Known viruses: 8670704
Engine version: 1.0.1
Scanned directories: 5
Scanned files: 4
Infected files: 0
Data scanned: 0.02 MB
Data read: 0.01 MB (ratio 2.00:1)
Time: 17.822 sec (0 m 17 s)
Start Date: 2023:07:12 15:14:50
End Date:   2023:07:12 15:15:08
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-ウィルススキャンのテストウィルス有りの場合&quot;&gt;4. ウィルススキャンのテスト（ウィルス有りの場合）&lt;/h3&gt;

&lt;p&gt;ウィルスが有る場合に正常に機能するかをテストするために、まずテスト用ウィルスを用意する。&lt;br /&gt;
今回は以下の４つのテストウィルスをダウンロードしてみた。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# wget http://www.eicar.org/download/eicar.com \
http://www.eicar.org/download/eicar.com.txt \
http://www.eicar.org/download/eicar_com.zip \
http://www.eicar.org/download/eicarcom2.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;そして、ウィルススキャンを行ってみる。&lt;br /&gt;
４つとも検知し削除されているのが分かる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# clamscan --infected --remove --recursive
/root/eicar_com.zip: Win.Test.EICAR_HDB-1 FOUND
/root/eicar_com.zip: Removed.
/root/eicar.com: Win.Test.EICAR_HDB-1 FOUND
/root/eicar.com: Removed.
/root/eicarcom2.zip: Win.Test.EICAR_HDB-1 FOUND
/root/eicarcom2.zip: Removed.
/root/eicar.com.txt: Win.Test.EICAR_HDB-1 FOUND
/root/eicar.com.txt: Removed.

----------- SCAN SUMMARY -----------
Known viruses: 8670704
Engine version: 1.0.1
Scanned directories: 5
Scanned files: 8
Infected files: 4
Data scanned: 0.02 MB
Data read: 0.01 MB (ratio 2.00:1)
Time: 17.437 sec (0 m 17 s)
Start Date: 2023:07:12 15:15:27
End Date:   2023:07:12 15:15:44
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-ウィルススキャン実行用スクリプトの作成&quot;&gt;5. ウィルススキャン実行用スクリプトの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/bin:/bin

&lt;span class=&quot;c&quot;&gt;# スキャン除外設定&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# （clamdscan でなく clamscan を使用する場合はコメント解除）&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#excludelist=/root/clamscan.exclude&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#if [ -s $excludelist ]; then&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    for i in `cat $excludelist`&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    do&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#        if [ $(echo &quot;$i&quot;|grep \/$) ]; then&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#            i=`echo $i|sed -e &apos;s/^\([^ ]*\)\/$/\1/p&apos; -e d`&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#            excludeopt=&quot;${excludeopt} --exclude-dir=^$i&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#        else&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#            excludeopt=&quot;${excludeopt} --exclude=^$i&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#        fi&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    done&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#fi&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ウィルス定義ファイル最新化&lt;/span&gt;
freshclam &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null

&lt;span class=&quot;c&quot;&gt;# ウィルススキャン&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CLAMSCANTMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mktemp&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# （clamdscan では --remove オプションが使用できない）&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#clamscan --recursive --remove ${excludeopt} / &amp;gt; $CLAMSCANTMP 2&amp;gt;&amp;amp;1&lt;/span&gt;
clamdscan &lt;span class=&quot;nt&quot;&gt;--recursive&lt;/span&gt; / &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CLAMSCANTMP&lt;/span&gt; 2&amp;gt;&amp;amp;1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;FOUND&lt;span class=&quot;nv&quot;&gt;$ $CLAMSCANTMP&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# レポートのメール送信&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;FOUND&lt;span class=&quot;nv&quot;&gt;$ $CLAMSCANTMP&lt;/span&gt; | mail &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Virus Found in &lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; root
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CLAMSCANTMP&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;6-ウィルススキャン実行用スクリプトに実行権限付与&quot;&gt;6. ウィルススキャン実行用スクリプトに実行権限付与&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chmod +x clamscan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-スキャン対象外ファイルの編集&quot;&gt;7. スキャン対象外ファイルの編集&lt;/h3&gt;

&lt;p&gt;ウィルススキャンを行わないディレクトリがあれば、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan.exclude&lt;/code&gt; ファイルに記述する。（但し、 clamscan を使用する場合）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan.exclude&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/dev/   # &amp;lt;= dev  ディレクトリをスキャン対象外にする場合
/proc/  # &amp;lt;= proc ディレクトリをスキャン対象外にする場合
/sys/   # &amp;lt;= sys  ディレクトリをスキャン対象外にする場合
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ウィルススキャン実行用スクリプト内で &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan&lt;/code&gt; でなく &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamdscan&lt;/code&gt; を使用するようにしている場合は、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan.exclude&lt;/code&gt; を作成せず、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/clamav/clamd.conf&lt;/code&gt; に以下のように追記する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/clamav/clamd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ExcludePath ^/dev/
ExcludePath ^/proc/
ExcludePath ^/sys/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-スクリプトの実行&quot;&gt;8. スクリプトの実行&lt;/h3&gt;

&lt;p&gt;作成したウィルススキャン実行スクリプトが正常に実行されるか試しに動かしてみる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ./clamscan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-自動実行の設定&quot;&gt;9. 自動実行の設定&lt;/h3&gt;

&lt;p&gt;ウィルススキャン実行スクリプトに問題がなければ、毎日自動で実行させるために cron ディレクトリへ移動する。（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;daily&lt;/code&gt; でなく &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;weekly&lt;/code&gt; や &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;monthly&lt;/code&gt; でもよい。好みの問題）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mv clamscan /etc/cron.daily/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="ウイルス対策" /><summary type="html">Debian GNU/Linux 12 (bookworm) にウイルス対策ソフト ClamAV をインストールする方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry></feed>