<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.2">Jekyll</generator><link href="https://komasaru.github.io/atom.xml" rel="self" type="application/atom+xml" /><link href="https://komasaru.github.io/" rel="alternate" type="text/html" /><updated>2023-12-12T21:38:21+09:00</updated><id>https://komasaru.github.io/atom.xml</id><title type="html">mk-mode BLOG</title><subtitle>このブログは自宅サーバ(Debian GNU/Linux)で運用してしている&lt;a href=&quot;https://www.mk-mode.com/blog/&quot;&gt;ブログ&lt;/a&gt;のクローンです。&lt;br /&gt;PC・サーバ構築等の話題を中心に公開しております。</subtitle><author><name>mk-mode.com</name></author><entry><title type="html">Debian 12 (bookworm) - Web サーバ Nginx 構築（Nginx 公式リポジトリ使用）！</title><link href="https://komasaru.github.io/2023/12/13/debian-12-nginx-installation-by-official-apt/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - Web サーバ Nginx 構築（Nginx 公式リポジトリ使用）！" /><published>2023-12-13T00:00:00+09:00</published><updated>2023-12-13T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/12/13/debian-12-nginx-installation-by-official-apt</id><content type="html" xml:base="https://komasaru.github.io/2023/12/13/debian-12-nginx-installation-by-official-apt/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に Web サーバ Nginx を Nginx 公式リポジトリを使用して導入する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;Debian 公式リポジトリの Nginx はバージョンが古いため、Nginx リポジトリを使用して 1.24.0（当記事執筆時点最新安定版）をインストールする。&lt;/li&gt;
  &lt;li&gt;実際に運用する際は、ドキュメントルートを変更する等、設定を編集すること。&lt;/li&gt;
  &lt;li&gt;一般ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-必要パッケージのインストール&quot;&gt;1. 必要パッケージのインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo apt -y install curl gnupg2 ca-certificates lsb-release debian-archive-keyring
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-公式-nginx-署名キーのインポート&quot;&gt;2. 公式 Nginx 署名キーのインポート&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ curl https://nginx.org/keys/nginx_signing.key | gpg --dearmor \
    | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg &amp;gt;/dev/null
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-署名キーの検証&quot;&gt;3. 署名キーの検証&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;出力されるフィンガープリンが以下と一致することを確認する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pub   rsa2048 2011-08-19 [SC] [expires: 2024-06-14]
      573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62
uid                      nginx signing key &amp;lt;signing-key@nginx.com&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-apt-リポジトリの設定&quot;&gt;4. apt リポジトリの設定&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ echo &quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
    http://nginx.org/packages/debian `lsb_release -cs` nginx&quot; \
    | sudo tee /etc/apt/sources.list.d/nginx.list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-apt-リポジトリの優先度設定&quot;&gt;5. apt リポジトリの優先度設定&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ echo -e &quot;Package: *\nPin: origin nginx.org\nPin: release o=nginx\nPin-Priority: 900\n&quot; \
    | sudo tee /etc/apt/preferences.d/99nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-nginx-のインストール&quot;&gt;6. Nginx のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo apt -y update
$ sudo apt -y install nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-インストールの確認&quot;&gt;7. インストールの確認&lt;/h3&gt;

&lt;p&gt;Nginx がインストールできたか確認してみる。(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-v&lt;/code&gt; の代わりに &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-V&lt;/code&gt; オプションを使用すると詳細に表示される）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nginx -v
nginx version: nginx/1.24.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-設定&quot;&gt;8. 設定&lt;/h3&gt;

&lt;p&gt;今回のインストール環境の場合、基本的（グローバル）な設定のファイルは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/nginx/nginx.conf&lt;/code&gt; で、このファイルから &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/nginx/conf.d&lt;/code&gt; ディレクトリ配下の設定ファイルを読み込む形式となっている。&lt;br /&gt;
取り急ぎ、デフォルトのままとした。&lt;br /&gt;
詳細な設定は、「&lt;a href=&quot;https://www.mk-mode.com/blog/tags/nginx/&quot; title=&quot;Tag: Nginx - mk-mode BLOG&quot;&gt;当ブログ Nginx 関連の過去記事&lt;/a&gt;」を参照。&lt;/p&gt;

&lt;h3 id=&quot;9-ファイアウォールufwの設定&quot;&gt;9. ファイアウォール(ufw)の設定&lt;/h3&gt;

&lt;p&gt;TCP ポート 80 を開放する必要がある。（HTTPS の場合は TCP: 443）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo ufw allow 80/tcp
Rule added

$ sudo ufw status
    :
80/tcp                     ALLOW       Anywhere
    :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;10-サーバの起動&quot;&gt;10. サーバの起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl start nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;11-起動確認&quot;&gt;11. 起動確認&lt;/h3&gt;

&lt;p&gt;ブラウザで &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://＜サーバアドレス or ホスト名＞/&lt;/code&gt; にアクセスしてみる。
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Welcome to nginx!&lt;/code&gt; と以下5行くらい表示されば成功。&lt;/p&gt;

&lt;h3 id=&quot;12-自動起動の設定&quot;&gt;12. 自動起動の設定&lt;/h3&gt;

&lt;p&gt;マシン起動時に自動で Nginx を起動させるには以下のようにする。（インストール直後は自動起動するようになっているはずなので、そうなっていない場合）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl enable nginx
Synchronizing state of nginx.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable nginx
Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /lib/systemd/system/nginx.service.

$ sudo systemctl is-enabled nginx
enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nginx&lt;/code&gt; はネイティブなサービスでないため、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;systemd-sysv-install&lt;/code&gt; にリダイレクトされる）&lt;/p&gt;

&lt;p&gt;自動起動しないようにするには、&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl disable nginx
Synchronizing state of nginx.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable nginx
Removed &quot;/etc/systemd/system/multi-user.target.wants/nginx.service&quot;.

# systemctl is-enabled nginx
disabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;13-参考サイト&quot;&gt;13. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://nginx.org/en/linux_packages.html&quot; title=&quot;nginx: Linux packages&quot;&gt;nginx: Linux packages&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Nginx" /><summary type="html">Debian GNU/Linux 12 (bookworm) に Web サーバ Nginx を Nginx 公式リポジトリを使用して導入する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - MariaDB 10.11 サーバ構築（ソースビルド）！</title><link href="https://komasaru.github.io/2023/12/06/debian-12-mariadb-mroonga-installation-by-apt/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - MariaDB 10.11 サーバ構築（ソースビルド）！" /><published>2023-12-06T00:00:00+09:00</published><updated>2023-12-06T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/12/06/debian-12-mariadb-mroonga-installation-by-apt</id><content type="html" xml:base="https://komasaru.github.io/2023/12/06/debian-12-mariadb-mroonga-installation-by-apt/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) 上に DB サーバ MariaDB（10.11系）、全文検索エンジン Mroonga を構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;インストールする MariaDB は、当記事執筆時点、 10.11 系で最新の 10.11.5 とする。&lt;/li&gt;
  &lt;li&gt;全文検索エンジン Mroonga プラグインもインストールする。&lt;/li&gt;
  &lt;li&gt;ここで紹介する MariaDB + Mroonga のインストール方法は、 Mroonga 公式サイトで案内されている Mroonga 込の MariaDB をインストールする方法や、ソールをビルドしているインストールする方法ではない）&lt;/li&gt;
  &lt;li&gt;MariaDB とは言っても中身は MySQL が元になっているので、各所で &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysql&lt;/code&gt; のキーワードが出現する。&lt;/li&gt;
  &lt;li&gt;データディレクトリは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/mysql&lt;/code&gt; ディレクトリ配下とする。&lt;/li&gt;
  &lt;li&gt;（今回は）一般ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-リポジトリキーのインポート&quot;&gt;1. リポジトリキーのインポート&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo apt -y install apt-transport-https curl
$ sudo mkdir -p /etc/apt/keyrings
$ sudo curl -o /etc/apt/keyrings/mariadb-keyring.pgp &apos;https://mariadb.org/mariadb_release_signing_key.pgp&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-リポジトリリストファイルの作成&quot;&gt;2. リポジトリリストファイルの作成&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apt/sources.list.d/mariadb.sources&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# MariaDB 10.11 repository list - created 2023-10-27 02:05 UTC&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# https://mariadb.org/download/&lt;/span&gt;
X-Repolib-Name: MariaDB
Types: deb
&lt;span class=&quot;c&quot;&gt;# deb.mariadb.org is a dynamic mirror if your preferred mirror goes offline. See https://mariadb.org/mirrorbits/ for details.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# URIs: https://deb.mariadb.org/10.11/debian&lt;/span&gt;
URIs: https://ftp.yz.yamagata-u.ac.jp/pub/dbms/mariadb/repo/10.11/debian
Suites: bookworm
Components: main
Signed-By: /etc/apt/keyrings/mariadb-keyring.pgp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-mariadb-サーバのインストール&quot;&gt;3. MariaDB サーバのインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo apt -y update
$ sudo apt -y install mariadb-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-全文検索エンジン-mroonga-プラグインのインストール&quot;&gt;4. 全文検索エンジン Mroonga プラグインのインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo apt -y install mariadb-plugin-mroonga
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-mariadb-の初期設定&quot;&gt;5. MariaDB の初期設定&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mysql_secure_installation

NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MariaDB to secure it, we&apos;ll need the current
password for the root user. If you&apos;ve just installed MariaDB, and
haven&apos;t set the root password yet, you should just press enter here.

Enter current password for root (enter for none):  # &amp;lt;= root ユーザの既存パスワード: 空エンター
OK, successfully used password, moving on...

Setting the root password or using the unix_socket ensures that nobody
can log into the MariaDB root user without the proper authorisation.

You already have your root account protected, so you can safely answer &apos;n&apos;.

Switch to unix_socket authentication [Y/n]         # &amp;lt;= Unix ソケット認証設定: Y 応答
Enabled successfully!
Reloading privilege tables..
 ... Success!


You already have your root account protected, so you can safely answer &apos;n&apos;.

Change the root password? [Y/n]                    # &amp;lt;= root パスワード変更: Y 応答
New password:                                      # &amp;lt;= root パスワード
Re-enter new password:                             # &amp;lt;= root パスワード確認入力
Password updated successfully!
Reloading privilege tables..
 ... Success!


By default, a MariaDB installation has an anonymous user, allowing anyone
to log into MariaDB without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n]                      # &amp;lt;= 匿名ユーザの削除: Y 応答
 ... Success!

Normally, root should only be allowed to connect from &apos;localhost&apos;.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n] n              # &amp;lt;= root のリモートログイン: リモート接続したいので n 応答（Y でもよい）
 ... skipping.

By default, MariaDB comes with a database named &apos;test&apos; that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n]       # &amp;lt;= テストデータベースの削除： Y 応答
 - Dropping test database...
 ... Success!
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n]                 # &amp;lt;= 特権情報のリロード： Y 応答
 ... Success!

Cleaning up...

All done!  If you&apos;ve completed all of the above steps, your MariaDB
installation should now be secure.

Thanks for using MariaDB!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-動作確認&quot;&gt;6. 動作確認&lt;/h3&gt;

&lt;p&gt;インストール直後は、サーバは起動している。&lt;br /&gt;
ログインしてみる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ mariadb -u root -p
Enter password:
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 40
Server version: 10.11.5-MariaDB-1:10.11.5+maria~deb12 mariadb.org binary distribution

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.

MariaDB [(none)]&amp;gt; show engines;
+--------------------+---------+-------------------------------------------------------------------------------------------------+--------------+------+------------+
| Engine             | Support | Comment                                                                                         | Transactions | XA   | Savepoints |
+--------------------+---------+-------------------------------------------------------------------------------------------------+--------------+------+------------+
| CSV                | YES     | Stores tables as CSV files                                                                      | NO           | NO   | NO         |
| MRG_MyISAM         | YES     | Collection of identical MyISAM tables                                                           | NO           | NO   | NO         |
| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables                                       | NO           | NO   | NO         |
| Aria               | YES     | Crash-safe tables with MyISAM heritage. Used for internal temporary tables and privilege tables | NO           | NO   | NO         |
| MyISAM             | YES     | Non-transactional engine with good performance and small data footprint                         | NO           | NO   | NO         |
| SEQUENCE           | YES     | Generated tables filled with sequential values                                                  | YES          | NO   | YES        |
| Mroonga            | YES     | CJK-ready fulltext search, column store                                                         | NO           | NO   | NO         |
| PERFORMANCE_SCHEMA | YES     | Performance Schema                                                                              | NO           | NO   | NO         |
| InnoDB             | DEFAULT | Supports transactions, row-level locking, foreign keys and encryption for tables                | YES          | YES  | YES        |
+--------------------+---------+-------------------------------------------------------------------------------------------------+--------------+------+------------+
9 rows in set (0.000 sec)

MariaDB [(none)]&amp;gt; exit
Bye
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;全文検索エンジン Mroonga もインストールされている。&lt;/li&gt;
  &lt;li&gt;上記の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mariadb -u root -p&lt;/code&gt; は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysql -u root -p&lt;/code&gt; でもよい。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;もし、全文検索エンジン Mroonga が前述の apt でのインストール方法でインストールされていなければ、 MariaDB コンソールで以下を実行してみる。&lt;br /&gt;
（MariaDB をインストールする過程で、なかなかうまくいかず色々とイジっているうちに、 apt インストールできない状態になるかもしれない（当方の経験談））&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;INSTALL SONAME &apos;ha_mroonga&apos;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-起動再起動ステータス確認停止のテスト&quot;&gt;7. 起動・再起動・ステータス確認・停止のテスト&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl start mariadb
$ sudo systemctl restart mariadb
$ sudo systemctl stop mariadb
$ systemctl status mariadb
$ systemctl is-enabled mariadb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mariadb&lt;/code&gt; は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysqld&lt;/code&gt; でもよい。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;8-設定編集&quot;&gt;8. 設定編集&lt;/h3&gt;

&lt;p&gt;必要に応じて、各種設定ファイルを編集する。（以下は、一例）&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/mysql/my.cnf&lt;/code&gt; が &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/mysql/conf.d&lt;/code&gt; や &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/mysql/mariadb.conf.d&lt;/code&gt; ディレクトリ配下の cnf ファイルを読み込むようになっている。（以前のように &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/my.cnf&lt;/code&gt; ファイルにまとめて記述する方法にしてもよいだろう）&lt;/p&gt;

&lt;p&gt;（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[mysqld]&lt;/code&gt; の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;innodb_data_file_path&lt;/code&gt; や &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;innodb_log_file_size&lt;/code&gt; を変更する際は、細心の注意を）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/mysql/mariadb.conf.d/50-client.cnf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# This group is read by the client library&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Use it for options that affect all clients, but not the server&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;client]
&lt;span class=&quot;c&quot;&gt;# Default is Latin1, if you need UTF-8 set this (also in server section)&lt;/span&gt;
port   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3306
socket &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/run/mysqld/mysqld.sock
default-character-set &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; utf8mb4

&lt;span class=&quot;c&quot;&gt;# Example of client certificate usage&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ssl-cert=/etc/mysql/client-cert.pem&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ssl-key=/etc/mysql/client-key.pem&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Allow only TLS encrypted connections&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ssl-verify-server-cert=on&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# This group is *never* read by mysql client library, though this&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# /etc/mysql/mariadb.cnf.d/client.cnf file is not read by Oracle MySQL&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# client anyway.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# If you use the same .cnf file for MySQL and MariaDB,&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# use it for MariaDB-only client options&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;client-mariadb]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/mysql/mariadb.conf.d/50-mysql-clients.cnf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# These groups are read by MariaDB command-line tools&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Use it for options that affect only one utility&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysql]
&lt;span class=&quot;c&quot;&gt;# Default is Latin1, if you need UTF-8 set this (also in server section)&lt;/span&gt;
default-character-set &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; utf8mb4
no-auto-rehash
show-warnings
&lt;span class=&quot;nv&quot;&gt;prompt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;@&lt;span class=&quot;se&quot;&gt;\h&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\d\_\R&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;s&amp;gt;&lt;span class=&quot;se&quot;&gt;\_&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;pager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;less -n -i -F -X -E&quot;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysql_upgrade]

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqladmin]

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqlbinlog]

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqlcheck]

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqldump]

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqlimport]

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqlshow]

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqlslap]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/mysql/mariadb.conf.d/50-mysqld_safe.cnf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# NOTE: This file is read only by the traditional SysV init script, not systemd.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# MARIADB SYSTEMD DOES _NOT_ UTILIZE MYSQLD_SAFE NOR READ THIS FILE.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# For similar behaviour, systemd users should create the following file:&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# /etc/systemd/system/mariadb.service.d/migrated-from-my.cnf-settings.conf&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# To achieve the same result as the default 50-mysqld_safe.cnf, please create&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# /etc/systemd/system/mariadb.service.d/migrated-from-my.cnf-settings.conf&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# with the following contents:&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [Service]&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# User=mysql&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# StandardOutput=syslog&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# StandardError=syslog&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# SyslogFacility=daemon&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# SyslogLevel=err&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# SyslogIdentifier=mysqld&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# For more information, please read https://mariadb.com/kb/en/mariadb/systemd/&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqld_safe]
&lt;span class=&quot;c&quot;&gt;# This will be passed to all mysql clients&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# It has been reported that passwords should be enclosed with ticks/quotes&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# especially if they contain &quot;#&quot; chars...&lt;/span&gt;

socket &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/run/mysqld/mysqld.sock
&lt;span class=&quot;nb&quot;&gt;nice&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
skip_log_error
syslog
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/mysql/mariadb.conf.d/50-server.cnf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# These groups are read by MariaDB server.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Use it for options that only the server (but not clients) should see&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# this is read by the standalone daemon and embedded servers&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;server]

&lt;span class=&quot;c&quot;&gt;# this is only for the mysqld standalone daemon&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mysqld]

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Recovery&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#innodb_force_recovery = 11  #クラッシュリカバリ時のみ有効化&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# * Basic Settings&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
user                    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mysql
pid-file                &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/run/mysqld/mysqld.pid
socket                  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/run/mysqld/mysqld.sock
port                    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3306
basedir                 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /usr
datadir                 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/lib/mysql
tmpdir                  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /tmp
lc-messages-dir         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /usr/share/mysql
lc_messages             &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; en_US   &lt;span class=&quot;c&quot;&gt;# Default: en_US&lt;/span&gt;
skip-external-locking
performance_schema      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; OFF     &lt;span class=&quot;c&quot;&gt;# Default: ON&lt;/span&gt;
sql_mode                &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;
default_storage_engine  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; InnoDB  &lt;span class=&quot;c&quot;&gt;# Default: InnoDB&lt;/span&gt;
skip-character-set-client-handshake

&lt;span class=&quot;c&quot;&gt;# Broken reverse DNS slows down connections considerably and name resolve is&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# safe to skip if there are no &quot;host by domain name&quot; access grants&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#skip-name-resolve&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Instead of skip-networking the default is now to listen only on&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# localhost which is more compatible and is not less secure.&lt;/span&gt;
bind-address            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0.0.0.0  &lt;span class=&quot;c&quot;&gt;# 127.0.0.1&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# * Fulltext Index&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
ft_min_word_len &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2
innodb_ft_min_token_size &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2
innodb_ft_enable_stopword &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; OFF

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# * Fine Tuning&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

key_buffer_size         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8M    &lt;span class=&quot;c&quot;&gt;# Default: 8M (for MyISAM)&lt;/span&gt;
myisam_sort_buffer_size &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8M    &lt;span class=&quot;c&quot;&gt;# Default: 8M (for MyISAM)&lt;/span&gt;
sort_buffer_size        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8M    &lt;span class=&quot;c&quot;&gt;# Default: 2M (通常時:8M, ALTER TABLE 時:64M)&lt;/span&gt;
read_buffer_size        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8M    &lt;span class=&quot;c&quot;&gt;# Default: 128K&lt;/span&gt;
read_rnd_buffer_size    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8M    &lt;span class=&quot;c&quot;&gt;# Default: 256K&lt;/span&gt;
join_buffer_size        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8M    &lt;span class=&quot;c&quot;&gt;# Default: 128K&lt;/span&gt;
max_allowed_packet      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 128M  &lt;span class=&quot;c&quot;&gt;# Default: 1M&lt;/span&gt;
net_buffer_length       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1M    &lt;span class=&quot;c&quot;&gt;# Default: 16K&lt;/span&gt;
thread_stack            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 288K  &lt;span class=&quot;c&quot;&gt;# Default: 192K(32bit), 288K(64bit)&lt;/span&gt;
thread_cache_size       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 40    &lt;span class=&quot;c&quot;&gt;# Default: 0 (max_connections の 1/3 程度?)&lt;/span&gt;
table_open_cache        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 400   &lt;span class=&quot;c&quot;&gt;# Default: 400 (同時接続数 * テーブル数?)&lt;/span&gt;
table_definition_cache  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 400   &lt;span class=&quot;c&quot;&gt;# Default: -1:autosized = 400 + (table_open_cache / 2&lt;/span&gt;
tmp_table_size          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 16M   &lt;span class=&quot;c&quot;&gt;# Default: System 依存 (for Memory, &amp;lt;= max_heap_table_size)&lt;/span&gt;
max_heap_table_size     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 32M   &lt;span class=&quot;c&quot;&gt;# Default: 16M         (for Memory, &amp;gt;= tmp_table_size)&lt;/span&gt;
bulk_insert_buffer_size &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 64M
&lt;span class=&quot;c&quot;&gt;# This replaces the startup script and checks MyISAM tables if needed&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# the first time they are touched&lt;/span&gt;
myisam_recover_options &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; BACKUP
max_connections        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 100   &lt;span class=&quot;c&quot;&gt;# Default: 151&lt;/span&gt;
max_connect_errors     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 100   &lt;span class=&quot;c&quot;&gt;# Default: 100&lt;/span&gt;
max_user_connections   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0     &lt;span class=&quot;c&quot;&gt;# Default: 0&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#table_cache            = 64&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#thread_concurrency     = 10&lt;/span&gt;
wait_timeout           &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 300   &lt;span class=&quot;c&quot;&gt;# Default: 28800 (通常時:300, データインポート時:3600程度)&lt;/span&gt;
interactive_timeout    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3600  &lt;span class=&quot;c&quot;&gt;# Default: 28800&lt;/span&gt;
connect_timeout        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 30    &lt;span class=&quot;c&quot;&gt;# Default: 10&lt;/span&gt;
net_read_timeout       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3600  &lt;span class=&quot;c&quot;&gt;# Default: 30&lt;/span&gt;
net_write_timeout      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3600  &lt;span class=&quot;c&quot;&gt;# Default: 60&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# * Query Cache Configuration&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
query_cache_limit      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8M    &lt;span class=&quot;c&quot;&gt;# Default: 1M&lt;/span&gt;
query_cache_size       &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 32M   &lt;span class=&quot;c&quot;&gt;# Default: 0 (通常時: 32M, データインポート時: 0)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# * Logging and Replication&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
log_output          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; FILE  &lt;span class=&quot;c&quot;&gt;# Default: FILE&lt;/span&gt;
log_warnings        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1     &lt;span class=&quot;c&quot;&gt;# Default: 1&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Both location gets rotated by the cronjob.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Be aware that this log type is a performance killer.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Recommend only changing this at runtime for short testing periods if needed&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#general_log_file    = /var/log/mysql/mysql.log  # デバッグ時に有効化&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#general_log         = 1                         # デバッグ時に有効化&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# When running under systemd, error logging goes via stdout/stderr to journald&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# and when running legacy init error logging goes to syslog due to&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# /etc/mysql/conf.d/mariadb.conf.d/50-mysqld_safe.cnf&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Enable this if you want to have error logging into a separate file&lt;/span&gt;
log_error &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/log/mysql/error.log
&lt;span class=&quot;c&quot;&gt;# Enable the slow query log to see queries with especially long duration&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#slow_query_log_file    = /var/log/mysql/mariadb-slow.log  # デバッグ時に有効&amp;gt;化&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#slow_query_log         = 1                                # デバッグ時に有効&amp;gt;化&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#long_query_time        = 30  # 10                         # デバッグ時に有効&amp;gt;化&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#log_slow_verbosity     = query_plan,explain&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#log-queries-not-using-indexes&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#min_examined_row_limit = 1000&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# The following can be used as easy to replay backup logs or for replication.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# note: if you are setting up a replication slave, see README.Debian about&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#       other settings you may need to change.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#server-id        = 101  # 1 # レプリケーション時 (1 〜 2^32 - 1)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#log_bin          = mysql-bin  # /var/log/mysql/mysql-bin.log  # レプリケーション、ポイントインタイムリカバリを利用したい場合のみ有効化&lt;/span&gt;
expire_logs_days  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 10
max_binlog_size   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 100M
binlog_format     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; MIXED
log_bin_trust_function_creators &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1  &lt;span class=&quot;c&quot;&gt;# Default: 0 (for TRIGGER)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#binlog_do_db     = include_database_name&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#binlog_ignore_db = exclude_database_name&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# * SSL/TLS&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# For documentation, please read&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# https://mariadb.com/kb/en/securing-connections-for-client-and-server/&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ssl-ca = /etc/mysql/cacert.pem&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ssl-cert = /etc/mysql/server-cert.pem&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ssl-key = /etc/mysql/server-key.pem&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#require-secure-transport = on&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# * Character sets&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# MySQL/MariaDB default is Latin1, but in Debian we rather default to the full&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# utf8 4-byte character set. See also client.cnf&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
character-set-server  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; utf8mb4
collation-server      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; utf8mb4_general_ci

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# * Event Scheduler&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
event_scheduler &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1  &lt;span class=&quot;c&quot;&gt;# Default: 0&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# * InnoDB&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# InnoDB is enabled by default with a 10MB datafile in /var/lib/mysql/.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Read the manual for more InnoDB related options. There are many!&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Most important is to give InnoDB 80 % of the system RAM for buffer use:&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# https://mariadb.com/kb/en/innodb-system-variables/#innodb_buffer_pool_size&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#innodb_buffer_pool_size = 8G&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# this is only for embedded server&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;embedded]

&lt;span class=&quot;c&quot;&gt;# This group is only read by MariaDB servers, not by MySQL.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# If you use the same .cnf file for MySQL and MariaDB,&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# you can put MariaDB-only options here&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mariadb]

&lt;span class=&quot;c&quot;&gt;# This group is only read by MariaDB-10.5 servers.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# If you use the same .cnf file for MariaDB of different versions,&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# use this group for options that older servers don&apos;t understand&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mariadb-10.11]
innodb_data_file_path          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ibdata1:1G  &lt;span class=&quot;c&quot;&gt;#:autoextend&lt;/span&gt;
innodb_autoextend_increment    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 64          &lt;span class=&quot;c&quot;&gt;# Default: 64&lt;/span&gt;
innodb_file_per_table          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
innodb_file_format             &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Barracuda   &lt;span class=&quot;c&quot;&gt;# Default: Antelope&lt;/span&gt;
innodb_large_prefix            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1           &lt;span class=&quot;c&quot;&gt;# Default: 0&lt;/span&gt;
innodb_buffer_pool_size        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 768M        &lt;span class=&quot;c&quot;&gt;# Default: 128M (innodb_log_files_in_group * innodb_log_file_size &amp;lt; innodb_buffer_pool_size)&lt;/span&gt;
innodb_buffer_pool_instances   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 16          &lt;span class=&quot;c&quot;&gt;# Default: autosized(32bit), 8(64bit) (innodb_buffer_pool_size &amp;gt;= 1G の場合にのみ有効)&lt;/span&gt;
innodb_sort_buffer_size        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8M         &lt;span class=&quot;c&quot;&gt;# Default: 1M (通常時:8M, ALTER TABLE 時:256M)&lt;/span&gt;
innodb_thread_concurrency      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 4           &lt;span class=&quot;c&quot;&gt;# Default: 0 (Defalut 推奨? CPU数 * ディスク数 * 2 が最適?)&lt;/span&gt;
innodb_thread_sleep_delay      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 10000       &lt;span class=&quot;c&quot;&gt;# Default: 10000 (単位:マイクロ秒)&lt;/span&gt;
innodb_commit_concurrency      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 4           &lt;span class=&quot;c&quot;&gt;# Default: 0 (Default 推奨?)&lt;/span&gt;
innodb_write_io_threads        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8           &lt;span class=&quot;c&quot;&gt;# Default: 4 (1 - 64)&lt;/span&gt;
innodb_read_io_threads         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8           &lt;span class=&quot;c&quot;&gt;# Default: 4 (1 - 64)&lt;/span&gt;
innodb_log_buffer_size         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 32M         &lt;span class=&quot;c&quot;&gt;# Default: 8M (通常時:32M, データインポート時:256M程度)&lt;/span&gt;
innodb_log_group_home_dir      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/lib/mysql
innodb_log_files_in_group      &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2           &lt;span class=&quot;c&quot;&gt;# Default: 2   (変更注意!)&lt;/span&gt;
innodb_log_file_size           &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 256M        &lt;span class=&quot;c&quot;&gt;# Default: 48M (変更注意!)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# &amp;lt;= innodb_log_files_in_group  innodb_log_file_size &amp;lt; innodb_buffer_pool_size&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#    [変更方法](http://dev.mysq.com/doc/refman/5.6/ja/innodb-data-log-reconfiguration.html)&lt;/span&gt;
innodb_max_dirty_pages_pct     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 90          &lt;span class=&quot;c&quot;&gt;# Default: 75(%)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# &amp;lt;= 小さい値：低速＆安定、大き 値：高速＆不安定(?)&lt;/span&gt;
innodb_io_capacity             &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 256         &lt;span class=&quot;c&quot;&gt;# Default: 200 (100 - 2^64-1)&lt;/span&gt;
innodb_io_capacity_max         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 512         &lt;span class=&quot;c&quot;&gt;# Default: 200 (100 - 2^64-1)&lt;/span&gt;
innodb_lru_scan_depth          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2048     &lt;span class=&quot;c&quot;&gt;# Default: 1024 (100 - 2^32-1(32bit))&lt;/span&gt;
innodb_flush_method            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; O_DIRECT    &lt;span class=&quot;c&quot;&gt;# Default: Not set&lt;/span&gt;
innodb_flush_log_at_trx_commit &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1           &lt;span class=&quot;c&quot;&gt;# Default: 1 (データインポート時: 2 or 0)&lt;/span&gt;
innodb_doublewrite             &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1           &lt;span class=&quot;c&quot;&gt;# Default: 1 (データインポート時: 0)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ibdata1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ib_lofile0&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ib_logfile1&lt;/code&gt; のサイズを変更した場合は、MariaDB サーバ停止後に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ibdata1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ib_lofile0&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ib_logfile1&lt;/code&gt; を削除してから再度起動すること。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;9-サービスの自動起動設定&quot;&gt;9. サービスの自動起動設定&lt;/h3&gt;

&lt;p&gt;インストール直後はマシン起動時に自動で MariaDB サーバが起動するようになっている。&lt;br /&gt;
自動起動しないようにしたければ以下のようにする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl disable mariadb
Synchronizing state of mariadb.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable mariadb
Removed &quot;/etc/systemd/system/multi-user.target.wants/mariadb.service&quot;.

$ systemctl is-enabled mariadb
disabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mariadb&lt;/code&gt; は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysqld&lt;/code&gt; でもよい（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysql&lt;/code&gt; はダメ）&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;10-ファイアウォールufwの設定&quot;&gt;10. ファイアウォール(ufw)の設定&lt;/h3&gt;

&lt;p&gt;リモートで MariaDB サーバにアクセスする場合（GUI ツールを使用する場合等）は、TCP ポート 3306 を開放する必要がある。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo ufw allow 3306/tcp
Rule added

$ sudo ufw status
    :
3306/tcp                   ALLOW       Anywhere
    :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;11-参考サイト&quot;&gt;11. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://mariadb.org/download/?t=repo-config&amp;amp;d=Debian+12+%22Bookworm%22&amp;amp;v=10.11&amp;amp;r_m=yamagata-university&quot; title=&quot;Download MariaDB Server - MariaDB.org&quot;&gt;Download MariaDB Server - MariaDB.org&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://mariadb.com/kb/en/about-mroonga/&quot; title=&quot;About Mroonga - MariaDB Knowledge Base&quot;&gt;About Mroonga - MariaDB Knowledge Base&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Linux" /><category term="Debian" /><category term="MariaDB" /><summary type="html">Debian GNU/Linux 12 (bookworm) 上に DB サーバ MariaDB（10.11系）、全文検索エンジン Mroonga を構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">2023年11月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2023/12/01/blog-access/" rel="alternate" type="text/html" title="2023年11月 - OS・ブラウザ別アクセス状況！" /><published>2023-12-01T00:00:00+09:00</published><updated>2023-12-01T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/12/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2023/12/01/blog-access/">&lt;p&gt;12月になりましたので、先月11月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8,265&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;70.7499&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,063&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;17.6596&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;543&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.6482&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;472&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.0404&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;203&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.7377&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;128&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0957&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0257&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0257&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux Mint&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,682&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8,214&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;70.3133&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,063&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;17.6596&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;543&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.6482&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;472&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.0404&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;203&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.7377&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;128&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0957&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3595&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0685&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0257&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0257&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux Mint&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;XP&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NetBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,682&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9,589&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;82.0835&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,056&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;9.0395&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;878&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7.5158&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;159&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.3611&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,682&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;119.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5,319&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;45.5316&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,157&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18.4643&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,553&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13.2940&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;766&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6.5571&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;119.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;466&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.9890&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;287&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.4568&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;186&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.5922&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;159&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.3611&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;147&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.2583&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;120.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;89&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7619&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;102.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;51&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4366&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;114.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;45&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3852&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;36&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3082&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;36&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3082&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;109.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;35&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2996&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;50.0.2661.102&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;26&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2226&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2054&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;112.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;23&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1969&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;111.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1370&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;113.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;13&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1113&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,682&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">12月になりましたので、先月11月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 12 (bookworm) - 全文検索エンジン Groonga インストール（by Groonga 公式リポジトリ）！</title><link href="https://komasaru.github.io/2023/11/29/debian-12-groonga-installation-by-official-apt/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - 全文検索エンジン Groonga インストール（by Groonga 公式リポジトリ）！" /><published>2023-11-29T00:00:00+09:00</published><updated>2023-11-29T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/11/29/debian-12-groonga-installation-by-official-apt</id><content type="html" xml:base="https://komasaru.github.io/2023/11/29/debian-12-groonga-installation-by-official-apt/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) にカラムストア機能付き全文検索エンジン Groonga を Groonga の公式リポジトリを使用して導入する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12.1.0 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;当記事執筆時点で最新の Groonga 13.0.8 をインストールする。&lt;/li&gt;
  &lt;li&gt;トークナイザとして MeCab を使用することを想定。&lt;/li&gt;
  &lt;li&gt;トークンフィルタとして TokenFilterStem を使用することを想定。&lt;/li&gt;
  &lt;li&gt;ノーマライザとして MySQL 互換の groonga-normalizer-mysql を使用することを想定。（将来、 Mroonga を使用することを想定）&lt;/li&gt;
  &lt;li&gt;ここでは、全文検索がどういうものかという説明はしない。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
  &lt;li&gt;以下の説明内で出力するデータは、可読性を考慮して整形している。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-groonga-apt-source-パッケージのインストール&quot;&gt;1. groonga-apt-source パッケージのインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt update
# apt install -y -V ca-certificates lsb-release wget
# wget https://apache.jfrog.io/artifactory/arrow/$(lsb_release --id --short | tr &apos;A-Z&apos; &apos;a-z&apos;)/apache-arrow-apt-source-latest-$(lsb_release --codename --short).deb
# apt install -y -V ./apache-arrow-apt-source-latest-$(lsb_release --codename --short).deb
# apt update
# wget https://packages.groonga.org/debian/groonga-apt-source-latest-$(lsb_release --codename --short).deb
# apt install -y -V ./groonga-apt-source-latest-$(lsb_release --codename --short).deb
# apt update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2--groonga-のインストール&quot;&gt;2.  groonga のインストール&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt install -y -V groonga
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-日本語形態素解析器-mecab-のインストール&quot;&gt;3. 日本語形態素解析器 MeCab のインストール&lt;/h3&gt;

&lt;p&gt;（トークナイザとして MeCab を使用しないのなら、この作業は不要）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install mecab
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-トークナイザ-mecab-のインストール&quot;&gt;4. トークナイザ MeCab のインストール&lt;/h3&gt;

&lt;p&gt;（トークナイザとして MeCab を使用しないのなら、この作業は不要）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt install -y -V groonga-tokenizer-mecab
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-トークンフィルタ-tokenfilterstem-のインストール&quot;&gt;5. トークンフィルタ TokenFilterStem のインストール&lt;/h3&gt;

&lt;p&gt;（トークンフィルタとして TokenFilterStem を使用しないのなら、この作業は不要）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt install -y -V groonga-token-filter-stem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-munin-プラグインのインストール&quot;&gt;6. Munin プラグインのインストール&lt;/h3&gt;

&lt;p&gt;（Munin プラグインを使用しないのなら、この作業は不要）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt install -y -V groonga-munin-plugins
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;当記事執筆時点、エラーが発生してインストールできなかった。&lt;br /&gt;
（この時点では munin 未設定。 munin 設定後ならインストール可能かも（未確認））&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;7-mysql-互換ノーマライザのインストール&quot;&gt;7. MySQL 互換ノーマライザのインストール&lt;/h3&gt;

&lt;p&gt;（ノーマライザとして groonga-normalizer-mysql を使用しないのなら、この作業は不要）&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt install -y -V groonga-normalizer-mysql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-インストール確認&quot;&gt;8. インストール確認&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ groonga --version
Groonga 13.0.8 [Linux,x86_64,utf8,match-escalation-threshold=0,nfkc,mecab,message-pack,mruby,onigmo,zlib,lz4,zstandard,epoll,rapidjson,apache-arrow,xxhash,blosc]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-動作確認&quot;&gt;9. 動作確認&lt;/h3&gt;

&lt;p&gt;（過去記事「&lt;a href=&quot;/2015/08/09/linux-mint-groonga-installation-by-src/&quot; title=&quot;Linux Mint - Groonga インストール（by ソースビルド）！&quot;&gt;Linux Mint - Groonga インストール（by ソースビルド）！&lt;/a&gt;」を参照）&lt;/p&gt;

&lt;h3 id=&quot;10-参考サイト&quot;&gt;10. 参考サイト&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://groonga.org/ja/docs/install/debian.html#bookworm&quot; title=&quot;2.3. Debian GNU/Linux — Groonga v13.0.8 documentation&quot;&gt;2.3. Debian GNU/Linux — Groonga v13.0.8 documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Groonga" /><summary type="html">Debian GNU/Linux 12 (bookworm) にカラムストア機能付き全文検索エンジン Groonga を Groonga の公式リポジトリを使用して導入する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - Postfix ログ解析！</title><link href="https://komasaru.github.io/2023/11/22/debian-12-postfix-log-analysis/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - Postfix ログ解析！" /><published>2023-11-22T00:00:00+09:00</published><updated>2023-11-22T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/11/22/debian-12-postfix-log-analysis</id><content type="html" xml:base="https://komasaru.github.io/2023/11/22/debian-12-postfix-log-analysis/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に導入した SMTP サーバ Postfix のログを解析する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;SMTP サーバ Postfix を「&lt;a href=&quot;/2023/10/11/debian-12-postfix-installation&quot; title=&quot;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&quot;&gt;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&lt;/a&gt;」の方法で導入済み。&lt;/li&gt;
  &lt;li&gt;ログローテート（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;logrotate&lt;/code&gt;）でメールログがローテーションされていることを想定。（デフォルトでなっているはず）&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-pflogsumm-のインストール&quot;&gt;1. pflogsumm のインストール&lt;/h3&gt;

&lt;p&gt;Postfix のログ解析ツールである pflogsumm を、以下のようにしてインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install pflogsumm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-pflogsumm-実行用スクリプトの作成&quot;&gt;2. pflogsumm 実行用スクリプトの作成&lt;/h3&gt;

&lt;p&gt;pflogsumm を実行するスクリプト &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pflogsumm_report&lt;/code&gt; を以下のように作成する。&lt;br /&gt;
単純に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pflogsumm&lt;/code&gt; コマンドを実行するだけでもレポートはできるが、それだとログローテートしている場合に正常に取得できない部分も発生する可能性があるので、それを考慮している。&lt;br /&gt;
また、以下のスクリプトでは前日のメールログを解析し、結果を postmaster 宛にメール送信している。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pflogsumm_report&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;LANG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;C
&lt;span class=&quot;nv&quot;&gt;MAILLOG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;mktemp&apos;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;log &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /var/log/mail.log&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;|sort &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;do
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$MAILLOG&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;done
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;REPORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mktemp&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
pflogsumm &lt;span class=&quot;nt&quot;&gt;--problems_first&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--verbose_msg_detail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--mailq&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; yesterday &lt;span class=&quot;nv&quot;&gt;$MAILLOG&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$REPORT&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$REPORT&lt;/span&gt; | mail &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$REPORT&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; in &lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;uname&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; postmaster
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$MAILLOG&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$REPORT&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;スクリプト内のメール送信コマンド &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mail&lt;/code&gt; が使用できない場合は、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mailutils&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;heirloom-mailx&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bsd-mailx&lt;/code&gt; 等をインストールする。複数ある場合は、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;update-alternatives --config mailx&lt;/code&gt; でデフォルト設定をする。&lt;/p&gt;

&lt;p&gt;なお、ログローテートしていない場合は、もっと簡単なスクリプトにすることも可能であるし、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pflogsumm&lt;/code&gt; コマンドを直接実行して運用してもよい。&lt;/p&gt;

&lt;h3 id=&quot;3-実行権限の付与&quot;&gt;3. 実行権限の付与&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chmod 700 pflogsumm_report
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-スクリプトの実行&quot;&gt;4. スクリプトの実行&lt;/h3&gt;

&lt;p&gt;作成したスクリプトを実行してみる。&lt;br /&gt;
（postfix の再起動が必要かも。これまで再起動は必要なかったが）&lt;br /&gt;
問題がなければ、 postmaster 宛にメールが送信されるはずである。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ./pflogsumm_report
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-自動実行の設定&quot;&gt;5. 自動実行の設定&lt;/h3&gt;

&lt;p&gt;毎日自動で実行するように cron 登録する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mv pflogsumm_report /etc/cron.daily/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Postfix" /><summary type="html">Debian GNU/Linux 12 (bookworm) に導入した SMTP サーバ Postfix のログを解析する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - Postfix ウィルス・スパム対策(ClamAV)！</title><link href="https://komasaru.github.io/2023/11/15/debian-12-postfix-anti-virus-with-clamav/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - Postfix ウィルス・スパム対策(ClamAV)！" /><published>2023-11-15T00:00:00+09:00</published><updated>2023-11-15T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/11/15/debian-12-postfix-anti-virus-with-clamav</id><content type="html" xml:base="https://komasaru.github.io/2023/11/15/debian-12-postfix-anti-virus-with-clamav/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) にアンチウイルスソフト ClamAV をインストールする方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;SMTP サーバ Postfix を「&lt;a href=&quot;/2023/11/08/debian-12-mail-ssl-setting&quot; title=&quot;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&quot;&gt;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&lt;/a&gt;」の方法で導入済み。&lt;/li&gt;
  &lt;li&gt;アンチウィルスソフト ClamAV 導入済み。&lt;/li&gt;
  &lt;li&gt;アンチウィルス ClamAV との連携には、 ClamAV daemon を使用する方法の他に、ClamSMTP を使用する方法もある。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-インストール&quot;&gt;1. インストール&lt;/h3&gt;

&lt;p&gt;Postfix を ClamAV と連携させてウィルススキャンを行うのに必要な ClamAV daemon, amavisd-new を、以下のようにしてインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install clamav-daemon amavisd-new
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-amavisd-new-設定ファイルの編集&quot;&gt;2. amavisd-new 設定ファイルの編集&lt;/h3&gt;

&lt;p&gt;Postfix と ClamAV を連携するのに必要な amavisd-new の設定ファイルを用意し、編集する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cp /usr/share/doc/amavisd-new/examples/amavisd.conf-default /etc/amavis/amavisd.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/amavis/amavisd.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$myhostname&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;mail.mk-mode.com&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= ホスト名&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$mydomain&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;mk-mode.com&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;         &lt;span class=&quot;c&quot;&gt;# &amp;lt;= ドメイン名&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$daemon_user&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;amavis&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;           &lt;span class=&quot;c&quot;&gt;# &amp;lt;= amavis デーモンユーザ名&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$daemon_group&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;amavis&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;           &lt;span class=&quot;c&quot;&gt;# &amp;lt;= amavis デーモングループ名&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$MYHOME&lt;/span&gt;        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/var/lib/amavis&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= amavisd ホーム&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# $virus_admin = undef;             # &amp;lt;= コメント化されていることを確認（ウィルス検知を都度通知しない）&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-15-content_filter_mode-の編集&quot;&gt;3. 15-content_filter_mode の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/amavis/conf.d/15-content_filter_mode&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;@bypass_virus_checks_maps &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;                                                    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
   &lt;span class=&quot;se&quot;&gt;\%&lt;/span&gt;bypass_virus_checks, &lt;span class=&quot;se&quot;&gt;\@&lt;/span&gt;bypass_virus_checks_acl, &lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;bypass_virus_checks_re&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;

@bypass_spam_checks_maps &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;                                                     &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
   &lt;span class=&quot;se&quot;&gt;\%&lt;/span&gt;bypass_spam_checks, &lt;span class=&quot;se&quot;&gt;\@&lt;/span&gt;bypass_spam_checks_acl, &lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;bypass_spam_checks_re&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ちなみに、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;amavisd.conf&lt;/code&gt; にも同じ記述がある。どちらを有効にしても良いだろう。&lt;/p&gt;

&lt;h3 id=&quot;4-15-av_scanners-の編集&quot;&gt;4. 15-av_scanners の編集&lt;/h3&gt;

&lt;p&gt;メールのウィルスチェックの度に clamscan が作動するとマシンが非力な場合は非常に重くなるため、 clamav-daemon が動作する今回の環境では clamdscan でウィルスチェックを行うこととする。（clamscan と clamdscan の違いについては、ここでは説明しない）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/amavis/conf.d/15-av_scanners&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;c&quot;&gt;#[&apos;ClamAV-clamscan&apos;, &apos;clamscan&apos;,  # &amp;lt;= コメント化&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;ClamAV-clamscan&apos;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&apos;clamdscan&apos;&lt;/span&gt;,  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-20-debian_defaults-の編集-不要&quot;&gt;5. 20-debian_defaults の編集 （不要？）&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Considered UNSOLICITED BULK EMAIL, apparently from you&lt;/code&gt; というタイトルのメールが届くことがあるので、それを抑止するための設定を行う。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/amavis/conf.d/20-debian_defaults&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#$final_banned_destiny     = D_DISCARD;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$final_banned_destiny&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; D_REJECT&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;D_PASS&lt;/code&gt; … メールは受信者に配送される&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;D_REJECT&lt;/code&gt; … メールは配送されないが、送信者に配送されなかった事を伝える&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;D_BOUNCE&lt;/code&gt; … メールは配送されないが、送信者に配送されなかった事を伝える。例外で伝えない場合もある&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;D_DISCARD&lt;/code&gt; … メールは配送されず、送信者にも配送されなかった事を伝えない&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;6-postfix---maincf-の編集&quot;&gt;6. Postfix - main.cf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/main.cf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 最終行へ追加&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;content_filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;smtp-amavis:[127.0.0.1]:10024
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-postfix---mastercf-の編集&quot;&gt;7. Postfix - master.cf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/master.cf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 最終行へ追加&lt;/span&gt;
smtp-amavis unix -       -       n      -     2 smtp
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtp_data_done_timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1200
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtp_send_xforward_command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;yes&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;disable_dns_lookups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;yes
&lt;/span&gt;127.0.0.1:10025 inet n     -     n     -     - smtpd
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;content_filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;local_recipient_maps&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;relay_recipient_maps&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_restriction_classes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_client_restrictions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_helo_restrictions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_sender_restrictions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_recipient_restrictions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;permit_mynetworks,reject
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mynetworks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;127.0.0.0/8
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;strict_rfc821_envelopes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;yes&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_error_sleep_time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_soft_error_limit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1001
      &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_hard_error_limit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-その他の設定&quot;&gt;8. その他の設定&lt;/h3&gt;

&lt;p&gt;処理に必要なファイルを作成したり、権限設定、ユーザ作成を行う。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# touch /etc/mailname
# chmod -R 775 /var/lib/amavis/tmp
# usermod -G amavis clamav
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;9-サービスの再起動&quot;&gt;9. サービスの再起動&lt;/h3&gt;

&lt;p&gt;ClamAV daemon, Postfix, Amavisd を再起動する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart clamav-daemon
# systemctl restart postfix
# systemctl restart amavis
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;10-サービス自動起動の設定&quot;&gt;10. サービス自動起動の設定&lt;/h3&gt;

&lt;p&gt;デフォルトで自動起動する設定になっている。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl is-enabled clamav-daemon
enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;disabled&lt;/code&gt; になっていれば、設定する。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl enable clamav-daemon
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;11-動作確認&quot;&gt;11. 動作確認&lt;/h3&gt;

&lt;p&gt;メールを送信してみる。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# echo test | mail -s &quot;TEST&quot; root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;受信メールのヘッダに &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-Virus-Scanned: Debian amavis at&lt;/code&gt; の文字列が存在することが確認できれば成功である。（メールソフトでヘッダを表示できる。または、サーバ内に届いたメールファイルを開いてみる）&lt;/p&gt;

&lt;p&gt;メール送信コマンド &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mail&lt;/code&gt; が使用できない場合は、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mailutils&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;heirloom-mailx&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bsd-mailx&lt;/code&gt; 等をインストールする。複数ある場合は、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;update-alternatives --config mailx&lt;/code&gt; でデフォルト設定をする。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Return-Path: &amp;lt;root@vbox.mk-mode.com&amp;gt;
X-Original-To: root@mk-mode.com
Delivered-To: root@mk-mode.com
Received: from localhost &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;localhost &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;127.0.0.1]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        by mail.mk-mode.com &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Postfix&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; with ESMTP &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;3E2698B
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &amp;lt;root@mk-mode.com&amp;gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Mon, 16 Oct 2023 14:25:44 +0900 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;JST&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
X-Virus-Scanned: Debian amavis at vbox.mk-mode.com
Received: from mail.mk-mode.com &lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;127.0.0.1]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
 by localhost &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vbox.mk-mode.com &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;127.0.0.1]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;amavis, port 10024&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; with ESMTP
 &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;gHktjXQxFmZn &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &amp;lt;root@mk-mode.com&amp;gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Mon, 16 Oct 2023 14:25:43 +0900 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;JST&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Received: by mail.mk-mode.com &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Postfix, from userid 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;BD0798A&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Mon, 16 Oct 2023 14:25:43 +0900 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;JST&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Subject: TEST
To: root@mk-mode.com
User-Agent: mail &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GNU Mailutils 3.15&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Date: Mon, 16 Oct 2023 14:25:43 +0900
Message-Id: &amp;lt;20231016052543.BD0798A@mail.mk-mode.com&amp;gt;
From: root &amp;lt;root@vbox.mk-mode.com&amp;gt;

&lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Postfix" /><category term="ウイルス対策" /><category term="スパム対策" /><summary type="html">Debian GNU/Linux 12 (bookworm) にアンチウイルスソフト ClamAV をインストールする方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください） [‘ClamAV-clamscan’, ‘clamdscan’, # &amp;lt;= 追加 ### 5. 20-debian_defaults の編集 （不要？） `Considered UNSOLICITED BULK EMAIL, apparently from you` というタイトルのメールが届くことがあるので、それを抑止するための設定を行う。 File: `/etc/amavis/conf.d/20-debian_defaults` ``` bash #$final_banned_destiny = D_DISCARD; $final_banned_destiny = D_REJECT; D_PASS … メールは受信者に配送される D_REJECT … メールは配送されないが、送信者に配送されなかった事を伝える D_BOUNCE … メールは配送されないが、送信者に配送されなかった事を伝える。例外で伝えない場合もある D_DISCARD … メールは配送されず、送信者にも配送されなかった事を伝えない 6. Postfix - main.cf の編集 File: /etc/postfix/main.cf ``` bash 最終行へ追加 content_filter=smtp-amavis:[127.0.0.1]:10024</summary></entry><entry><title type="html">Debian 12 (bookworm) - メールサーバ SSL 設定！</title><link href="https://komasaru.github.io/2023/11/08/debian-12-mail-ssl-setting/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - メールサーバ SSL 設定！" /><published>2023-11-08T00:00:00+09:00</published><updated>2023-11-08T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/11/08/debian-12-mail-ssl-setting</id><content type="html" xml:base="https://komasaru.github.io/2023/11/08/debian-12-mail-ssl-setting/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に導入したメールサーバを SSL 設定する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;SMTP サーバは Postfix, POP/IMAP サーバは Dovecot を想定。
    &lt;ul&gt;
      &lt;li&gt;Postfix を「&lt;a href=&quot;/2023/10/11/debian-12-postfix-installation&quot; title=&quot;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&quot;&gt;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&lt;/a&gt;」の方法で導入済み。&lt;/li&gt;
      &lt;li&gt;Dovecot を「&lt;a href=&quot;/2023/10/25/debian-12-dovecot-installation&quot; title=&quot;Debian 12 (bookworm) - POP/IMAP サーバ Dovecot 構築！&quot;&gt;Debian 12 (bookworm) - POP/IMAP サーバ Dovecot 構築！&lt;/a&gt;」の方法で導入済み。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;接続可能なマシンのネットワークは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.0/24&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、サーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vbox&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;SSL サーバ OpenSSL 導入済み。（インストールは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apt -y install openssl&lt;/code&gt; でよい）&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-ssl-証明書の作成&quot;&gt;1. SSL 証明書の作成&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /etc/ssl/private

# openssl genrsa -aes128 -out server.key 2048
Enter PEM pass phrase:              # &amp;lt;= サーバ証明書用パスワード設定
Verifying - Enter PEM pass phrase:  # &amp;lt;= サーバ証明書用パスワード確認入力

# openssl rsa -in server.key -out server.key
Enter pass phrase for server.key:              # &amp;lt;= サーバ証明書用パスワード応答
writing RSA key

# openssl req -new -days 3650 -key server.key -out server.csr
Ignoring -days without -x509; not generating a certificate
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &apos;.&apos;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:JP                                    # &amp;lt;= 国の略名
State or Province Name (full name) [Some-State]:Shimane                 # &amp;lt;= 都道府県名
Locality Name (eg, city) []:Matsue                                      # &amp;lt;= 市区町村名
Organization Name (eg, company) [Internet Widgits Pty Ltd]:mk-mode.com  # &amp;lt;= サイト名（何でもよい）
Organizational Unit Name (eg, section) []:                              # &amp;lt;= 部署名（空でよい）
Common Name (e.g. server FQDN or YOUR name) []:mail.mk-mode.com         # &amp;lt;= ホスト名
Email Address []:postmaster@mk-mode.com                                 # &amp;lt;= 管理者メールアドレス

Please enter the following &apos;extra&apos; attributes
to be sent with your certificate request
A challenge password []:      # &amp;lt;= 追加属性・空エンターでよい
An optional company name []:  # &amp;lt;= 追加属性・空エンターでよい

# openssl x509 -in server.csr -out server.crt -req -signkey server.key -days 3650
Certificate request self-signature ok
subject=C = JP, ST = Shimane, L = Matsue, O = mk-mode.com, CN = mail.mk-mode.com, emailAddress = postmaster@mk-mode.com

# chmod 400 server.*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-postfix---maincf-の設定&quot;&gt;2. Postfix - main.cf の設定&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/main.cf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# SSL 用（最終行に追加）&lt;/span&gt;
smtpd_use_tls &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;yes
&lt;/span&gt;smtp_tls_mandatory_protocols &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;SSLv2, &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;SSLv3
smtpd_tls_mandatory_protocols &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;SSLv2, &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;SSLv3
smtpd_tls_cert_file &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /etc/ssl/private/server.crt
smtpd_tls_key_file &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /etc/ssl/private/server.key
smtpd_tls_session_cache_database &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; btree:&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;data_directory&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/smtpd_scache
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-postfix---mastercf-の編集&quot;&gt;3. Postfix - master.cf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/master.cf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# コメント解除&lt;/span&gt;
submission inet n       -       y       -       -       smtpd
  &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;syslog_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;postfix/submission
&lt;span class=&quot;c&quot;&gt;#  -o smtpd_tls_security_level=encrypt&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_sasl_auth_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;yes&lt;/span&gt;

 &lt;span class=&quot;c&quot;&gt;# 最終行に追記&lt;/span&gt;
smtps     inet  n       -       y       -       -       smtpd
  &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;syslog_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;postfix/smtps
  &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_tls_wrappermode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;yes&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smtpd_sasl_auth_enable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;yes&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-dovecot---10-sslconf-の編集&quot;&gt;4. Dovecot - 10-ssl.conf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dovecot/conf.d/10-ssl.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# SSL 有効化&lt;/span&gt;
ssl &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;yes&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# 証明書/鍵ファイル指定&lt;/span&gt;
ssl_cert &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &amp;lt;/etc/ssl/private/server.crt
ssl_key &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &amp;lt;/etc/ssl/private/server.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-postfix-dovecot-の再起動&quot;&gt;5. Postfix, Dovecot の再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart postfix dovecot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-ファイアウォールufwの設定&quot;&gt;6. ファイアウォール(ufw)の設定&lt;/h3&gt;

&lt;p&gt;実際に運用する場合は、TCP ポート 465(SMTPS), 993(IMAPS), 995(POP3S) を開放する必要がある。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 465,993,995/tcp
Rule added

# ufw status
    :
465,993,995/tcp            ALLOW       Anywhere
    :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-メールソフトの設定&quot;&gt;7. メールソフトの設定&lt;/h3&gt;

&lt;p&gt;メールソフトではポート番号を変更すればよい。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;受信メールサーバポート：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;993&lt;/code&gt;(IMAP) or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;995&lt;/code&gt;(POP)&lt;/li&gt;
  &lt;li&gt;送信メールサーバポート：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;465&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;認証警告画面が表示され、認証すれば（例外として承認すれば） SSL 通信で送受信できるようになる。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Postfix" /><category term="Dovecot" /><category term="SSL" /><summary type="html">Debian GNU/Linux 12 (bookworm) に導入したメールサーバを SSL 設定する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">2023年10月 - OS・ブラウザ別アクセス状況！</title><link href="https://komasaru.github.io/2023/11/01/blog-access/" rel="alternate" type="text/html" title="2023年10月 - OS・ブラウザ別アクセス状況！" /><published>2023-11-01T00:00:00+09:00</published><updated>2023-11-01T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/11/01/blog-access</id><content type="html" xml:base="https://komasaru.github.io/2023/11/01/blog-access/">&lt;p&gt;11月になりましたので、先月10月分の当ブログアクセス状況を公開します。（※自分用の記録）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;1-アクセスをos別に集計&quot;&gt;1. アクセスをOS別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,340&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;72.8792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,516&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16.1697&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;837&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.3792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;572&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.6761&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;158&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0154&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;132&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8483&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0257&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0064&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15,560&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-アクセスをosバージョン別に集計&quot;&gt;2. アクセスをOS・バージョン別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;11,260&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;72.3650&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2,516&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16.1697&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;837&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.3792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;572&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.6761&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;158&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.0154&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;132&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8483&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;53&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3406&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;23&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1478&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0257&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;XP&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0193&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora Linux&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0064&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0064&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15,560&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;3-アクセスをブラウザ別に集計&quot;&gt;3. アクセスをブラウザ別に集計&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12,896&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;82.8792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,350&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8.6761&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1,179&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7.5771&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;131&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8419&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Internet Explorer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0193&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unknown&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0064&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15,560&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;h3 id=&quot;4-アクセスをブラウザバージョン別に集計上位20件&quot;&gt;4. アクセスをブラウザ・バージョン別に集計（上位20件）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ブラウザ&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;PageViews&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;比率(%)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5,213&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;33.5026&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,878&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24.9229&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3,196&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20.5398&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;604.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;838&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5.3856&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;118.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;659&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4.2352&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Safari&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;605.1.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;337&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.1658&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;307&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1.9730&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Netscape Navigator&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;131&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8419&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;114.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;90&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5784&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;102.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;89&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5720&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;115.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;82&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5270&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;117.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;82&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5270&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;109.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;78&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5013&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;119.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;78&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5013&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mozilla Firefox&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;78.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;43&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2763&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;112.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;34&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2185&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116.0.5845.2271&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;29&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1864&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;50.0.2661.102&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;24&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1542&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;108.0.5359.128&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;21&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1350&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;111.0.0.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.1221&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;：&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
  &lt;tfoot&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;合　計&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;15,560&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100.0000&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tfoot&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="ブログ" /><category term="Jekyll" /><summary type="html">11月になりましたので、先月10月分の当ブログアクセス状況を公開します。（※自分用の記録）</summary></entry><entry><title type="html">Debian 12 (bookworm) - POP/IMAP サーバ Dovecot 構築！</title><link href="https://komasaru.github.io/2023/10/25/debian-12-dovecot-installation/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - POP/IMAP サーバ Dovecot 構築！" /><published>2023-10-25T00:00:00+09:00</published><updated>2023-10-25T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/10/25/debian-12-dovecot-installation</id><content type="html" xml:base="https://komasaru.github.io/2023/10/25/debian-12-dovecot-installation/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) に POP/IMAP サーバ Dovecot を構築する方法についての記録です。&lt;/p&gt;

&lt;p&gt;以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。&lt;br /&gt;
（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;接続元のマシンも Debian GNU/Linux 12 (bookworm; 64bit) を想定。&lt;/li&gt;
  &lt;li&gt;接続可能なマシンのネットワークは &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.11.0/24&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;ドメイン名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mk-mode.com&lt;/code&gt;、サーバホスト名は &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vbox&lt;/code&gt; を想定。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-dovecot-のインストール&quot;&gt;1. Dovecot のインストール&lt;/h3&gt;

&lt;p&gt;POP/IMAP サーバ Dovecot を以下のようにしてインストールする。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# apt -y install dovecot-common dovecot-pop3d dovecot-imapd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-設定ファイル-dovecotconf-の編集&quot;&gt;2. 設定ファイル dovecot.conf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dovecot/dovecot.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;listen &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= IPv6を使用しない場合&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-設定ファイル-10-authconf-の編集&quot;&gt;3. 設定ファイル 10-auth.conf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dovecot/conf.d/10-auth.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;disable_plaintext_auth &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; no    &lt;span class=&quot;c&quot;&gt;# &amp;lt;= プレーンテキスト認証も許可&lt;/span&gt;

auth_mechanisms &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; plain login  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 認証時のパスフレーズ送信方式&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-設定ファイル-10-mailconf-の編集&quot;&gt;4. 設定ファイル 10-mail.conf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dovecot/conf.d/10-mail.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mail_location &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; maildir:~/Maildir  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= メールボックス形式をMaildir形式&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;5-設定ファイル-10-masterconf-の編集&quot;&gt;5. 設定ファイル 10-master.conf の編集&lt;/h3&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dovecot/conf.d/10-master.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Postfix smtp-auth&lt;/span&gt;
unix_listener /var/spool/postfix/private/auth &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
    mode &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0666                                  &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
    user &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; postfix                               &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加（ユーザ）&lt;/span&gt;
    group &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; postfix                              &lt;span class=&quot;c&quot;&gt;# &amp;lt;= 追加（グループ）&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;                                                &lt;span class=&quot;c&quot;&gt;# &amp;lt;= コメント解除&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;6-dovecot-の再起動&quot;&gt;6. Dovecot の再起動&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart dovecot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;7-ファイアウォールufwの設定&quot;&gt;7. ファイアウォール(ufw)の設定&lt;/h3&gt;

&lt;p&gt;実際に運用する場合は、TCPポート 110(POP3), 143(IMAP) を開放する必要がある。&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ufw allow 110,143/tcp
Rule added

# ufw status
    :
110,143/tcp                ALLOW       Anywhere
    :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;8-メールソフトの設定&quot;&gt;8. メールソフトの設定&lt;/h3&gt;

&lt;p&gt;Postfix, Dovecot 構築が完了すれば、メールソフトでメールの送受信が可能になる。&lt;br /&gt;
メールソフトでは以下のように設定すればよい。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;メールアドレス：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;アカウント名@メールホスト名&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;パスワード：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;アカウントのパスワード&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;受信メールサーバ：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;POP&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IMAP&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;受信メールサーバアドレス：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;メールホスト名&lt;/code&gt;（内部なら &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;サーバローカルIPアドレス&lt;/code&gt; でもよい）&lt;/li&gt;
  &lt;li&gt;受信メールサーバポート番号：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;110&lt;/code&gt;(POP) or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;143&lt;/code&gt;(IMAP)&lt;/li&gt;
  &lt;li&gt;ログオンユーザ：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;アカウント名&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;送信メールサーバアドレス：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;メールホスト名&lt;/code&gt;（内部なら &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;サーバローカルIPアドレス&lt;/code&gt; でもよい）&lt;/li&gt;
  &lt;li&gt;送信メールサーバポート番号：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;25&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;送信認証：「必要」&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Dovecot" /><summary type="html">Debian GNU/Linux 12 (bookworm) に POP/IMAP サーバ Dovecot を構築する方法についての記録です。 以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。 （当然ながら、興味がなければスルーしてください）</summary></entry><entry><title type="html">Debian 12 (bookworm) - SMTP サーバ Postfix 受信拒否設定！</title><link href="https://komasaru.github.io/2023/10/18/debian-12-postfix-reject-reception/" rel="alternate" type="text/html" title="Debian 12 (bookworm) - SMTP サーバ Postfix 受信拒否設定！" /><published>2023-10-18T00:00:00+09:00</published><updated>2023-10-18T00:00:00+09:00</updated><id>https://komasaru.github.io/2023/10/18/debian-12-postfix-reject-reception</id><content type="html" xml:base="https://komasaru.github.io/2023/10/18/debian-12-postfix-reject-reception/">&lt;p&gt;Debian GNU/Linux 12 (bookworm) 上の SMTP サーバ Postfix で受信を拒否する設定についての記録です。&lt;/p&gt;

&lt;p&gt;（当然ながら、興味がなければスルーしてください）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h3 id=&quot;0-前提条件&quot;&gt;0. 前提条件&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Debian GNU/Linux 12 (bookworm; 64bit) での作業を想定。&lt;/li&gt;
  &lt;li&gt;SMTP サーバ Postfix を「&lt;a href=&quot;/2023/10/11/debian-12-postfix-installation&quot; title=&quot;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&quot;&gt;Debian 12 (bookworm) - SMTP サーバ Postfix 構築！&lt;/a&gt;」の方法で導入済み。&lt;/li&gt;
  &lt;li&gt;メールの header や body の内容をチェックしてフィルタリングする設定。&lt;/li&gt;
  &lt;li&gt;root ユーザでの作業を想定。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-設定ファイル-maincf-の編集&quot;&gt;1. 設定ファイル main.cf の編集&lt;/h3&gt;

&lt;p&gt;コメントアウトされていれば、アンコメントする。&lt;br /&gt;
行自体が存在しなければ、追加する。&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/main.cf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;header_checks &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; regexp:/etc/postfix/header_checks
body_checks   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; regexp:/etc/postfix/body_checks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-header-のフィルタリング設定&quot;&gt;2. header のフィルタリング設定&lt;/h3&gt;

&lt;p&gt;以下は header の &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Received&lt;/code&gt; に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aznavrchol.cz&lt;/code&gt; があれば、そのメールを受信拒否してエラーにする例。&lt;br /&gt;
（受信拒否でなく、受信して破棄したければ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISCARD&lt;/code&gt; にする）&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/header_checks&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/^Received:.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;aznavrchol&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;cz/ REJECT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Received&lt;/code&gt; の他に、 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Subject&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;From&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-Mailer-Agent&lt;/code&gt; 等、 &lt;strong&gt;正規表現&lt;/strong&gt; を使用して設定可能。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-body-のフィルタリング設定&quot;&gt;3. body のフィルタリング設定&lt;/h3&gt;

&lt;p&gt;以下は body の内容に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Bitcoin&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bitcoin&lt;/code&gt; があれば、そのメールを受信拒否してエラーにする例。&lt;br /&gt;
※以下、実際の設定内容。(230926 現在)&lt;/p&gt;

&lt;p&gt;File: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/postfix/body_checks&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Bb]itcoin.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/ REJECT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;（受信拒否でなく、受信して破棄したければ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISCARD&lt;/code&gt; にする）&lt;/p&gt;

&lt;p&gt;※上記の設定で、メール本文に &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Bitcoin&lt;/code&gt; や &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bitcoin&lt;/code&gt; がある場合に廃棄するようになるが、この場合、メールログ解析（後日紹介予定の pflogsumm ）の結果メールも廃棄してしまうので、注意。&lt;/p&gt;

&lt;h3 id=&quot;4-設定のリロード&quot;&gt;4. 設定のリロード&lt;/h3&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# postmap /etc/postfix/header_checks
# postmap /etc/postfix/body_checks
# systemctl reload postfix
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;これで、 Postfix のみで基本的な header, body のフィルタリングが可能になる。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;以上。&lt;/p&gt;</content><author><name>mk-mode.com</name></author><category term="サーバ構築" /><category term="Debian" /><category term="Linux" /><category term="Postfix" /><summary type="html">Debian GNU/Linux 12 (bookworm) 上の SMTP サーバ Postfix で受信を拒否する設定についての記録です。 （当然ながら、興味がなければスルーしてください）</summary></entry></feed>