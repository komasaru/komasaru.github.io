<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ja" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Ruby - ヒープ生成（上方・下方移動）！ - mk-mode BLOG</title>
<meta name="description" content="前々回、前回は「ヒープ（上方移動・下方移動）」のアルゴリズムを C++ で実装することについて紹介しました。。  C++ - ヒープ生成（上方移動）！  C++ - ヒープ生成（下方移動）！今回は、同じアルゴリズムを Ruby で実装してみました。（上方・下方移動）以下、Ruby スクリプトの紹介です。">



<meta property="og:type" content="article">
<meta property="og:locale" content="ja_JP">
<meta property="og:site_name" content="mk-mode BLOG">
<meta property="og:title" content="Ruby - ヒープ生成（上方・下方移動）！">
<meta property="og:url" content="https://komasaru.github.io/2014/04/07/ruby-generation-heap/">


  <meta property="og:description" content="前々回、前回は「ヒープ（上方移動・下方移動）」のアルゴリズムを C++ で実装することについて紹介しました。。  C++ - ヒープ生成（上方移動）！  C++ - ヒープ生成（下方移動）！今回は、同じアルゴリズムを Ruby で実装してみました。（上方・下方移動）以下、Ruby スクリプトの紹介です。">



  <meta property="og:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">



  <meta name="twitter:site" content="@rsm_mzk">
  <meta name="twitter:title" content="Ruby - ヒープ生成（上方・下方移動）！">
  <meta name="twitter:description" content="前々回、前回は「ヒープ（上方移動・下方移動）」のアルゴリズムを C++ で実装することについて紹介しました。。  C++ - ヒープ生成（上方移動）！  C++ - ヒープ生成（下方移動）！今回は、同じアルゴリズムを Ruby で実装してみました。（上方・下方移動）以下、Ruby スクリプトの紹介です。">
  <meta name="twitter:url" content="https://komasaru.github.io/2014/04/07/ruby-generation-heap/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.mk-mode.com/blog/assets/images/about_me.png">
    
  

  



  <meta property="article:published_time" content="2014-04-07T00:20:00+09:00">





  

  


<link rel="canonical" href="https://komasaru.github.io/2014/04/07/ruby-generation-heap/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://komasaru.github.io",
      "logo": "https://www.mk-mode.com/blog/assets/images/about_me.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "mk-mode.com",
      "url": "https://komasaru.github.io",
      "sameAs": null
    }
  </script>



  <meta name="google-site-verification" content="0kSwKhNo71fC7OeEFLllD3S11F8Pa-z_OqsBTSFxXAk" />





<!-- end _includes/seo.html -->


<link href="https://www.mk-mode.com/blog/atom.xml" type="application/atom+xml" rel="alternate" title="mk-mode BLOG Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    
    <script defer src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <!-- start custom head snippets -->

<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com" />
<link rel="dns-prefetch" href="//googleads.g.doubleclick.net" />
<link rel="dns-prefetch" href="//tpc.googlesyndication.com" />
<link rel="dns-prefetch" href="//cm.g.doubleclick.net" />
<link rel="dns-prefetch" href="//www.gstatic.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />
<link rel='dns-prefetch' href='//use.fontawesome.com' />
<link rel="dns-prefetch" href="//twitter.com" />
<link rel="dns-prefetch" href="//www.facebook.com" />

<link rel="icon" href="/assets/images/favicon.ico">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-7320193476057758",
      enable_page_level_ads: true
    });
  </script>


<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">mk-mode BLOG</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/" >Archives</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/calendar/calendar" >Calendar</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.mk-mode.com/rails/jmaxml" >JMAXML</a>
            </li><li class="masthead__menu-item">
              <a href="/privacy.html" >Privacy Policy</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/about_me.png" alt="mk-mode.com" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">mk-mode.com</h3>
    
    
      <p class="author__bio" itemprop="description">
        Linux, Debian, IT, Server, PG, Ruby, Rails, Python, C++, Fortran, PC, MariaDB, math, GIS, etc...
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Ruby City MATSUE</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://www.mk-mode.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode SITE</a></li>
          
        
          
            <li><a href="https://www.mk-mode.com/blog" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode BLOG (original)</a></li>
          
        
          
            <li><a href="https://mk-mode.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode TUMBLR</a></li>
          
        
          
            <li><a href="https://mk-ephemeris.tumblr.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> mk-mode EPHEMERIS</a></li>
          
        
          
            <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
        
          
            <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Ruby - ヒープ生成（上方・下方移動）！">
    <meta itemprop="description" content="前々回、前回は「ヒープ（上方移動・下方移動）」のアルゴリズムを C++ で実装することについて紹介しました。。  C++ - ヒープ生成（上方移動）！  C++ - ヒープ生成（下方移動）！今回は、同じアルゴリズムを Ruby で実装してみました。（上方・下方移動）以下、Ruby スクリプトの紹介です。">
    <meta itemprop="datePublished" content="April 07, 2014">
    

    <div class="page__inner-wrap">
      
        <header>
          <!-- div id="google-ad-1"></div -->
          <h1 id="page-title" class="page__title" itemprop="headline">Ruby - ヒープ生成（上方・下方移動）！
</h1>
          
          
            
            <p class="page__date"><small><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-04-07T00:20:00+09:00">2014-04-07 00:20</time></small></p>
          
        </header>
      
      <div id="google-ad-2"></div>
      <br />

      <section class="page__content" itemprop="text">
        
        <p>前々回、前回は「ヒープ（上方移動・下方移動）」のアルゴリズムを C++ で実装することについて紹介しました。。</p>

<ul>
  <li><a href="/2014/04/04/cpp-generation-heap-upward" title="C++ - ヒープ生成（上方移動）！">C++ - ヒープ生成（上方移動）！</a></li>
  <li><a href="/2014/04/06/cpp-generation-heap-downward" title="C++ - ヒープ生成（下方移動）！">C++ - ヒープ生成（下方移動）！</a></li>
</ul>

<p>今回は、同じアルゴリズムを Ruby で実装してみました。（上方・下方移動）</p>

<p>以下、Ruby スクリプトの紹介です。</p>

<!--more-->

<h3 id="1-ヒープについて">1. ヒープについて</h3>

<p>「ヒープ」、「上方移動」、「下方移動」については前々回、前回の記事を参照ください。</p>

<ul>
  <li><a href="/2014/04/04/cpp-generation-heap-upward" title="C++ - ヒープ生成（上方移動）！">C++ - ヒープ生成（上方移動）！</a></li>
  <li><a href="/2014/04/06/cpp-generation-heap-downward" title="C++ - ヒープ生成（下方移動）！">C++ - ヒープ生成（下方移動）！</a></li>
</ul>

<h3 id="2-ruby-スクリプト作成上方移動">2. Ruby スクリプト作成（上方移動）</h3>

<p>以下のようにスクリプトを作成してみた。（要素はメルセンヌ・ツイスタに基づく疑似乱数で生成）</p>

<p>File: <code class="language-plaintext highlighter-rouge">heap_upward.rb</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre></td><td class="code"><pre><span class="c1">#! /usr/local/bin/ruby</span>
<span class="c1"># **************************************</span>
<span class="c1"># ヒープ作成（上方移動）</span>
<span class="c1"># **************************************</span>
<span class="c1">#</span>
<span class="k">class</span> <span class="nc">Heap</span>
  <span class="no">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># データ個数</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="c1"># ヒープに追加する要素の配列を生成</span>
    <span class="vi">@base</span> <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span>
    <span class="no">N</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="vi">@base</span> <span class="o">&lt;&lt;</span> <span class="no">Random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="no">N</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="c1"># 乱数の種を毎回同じ値で初期化するなら以下２行のように。</span>
    <span class="c1">#prng = Random.new(1234)</span>
    <span class="c1">#N.times { |i| @base &lt;&lt; prng.rand(N) + 1 }</span>
    <span class="nb">display</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># ヒープ用配列</span>
    <span class="vi">@heap</span> <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># ヒープ生成</span>
  <span class="k">def</span> <span class="nf">generate</span>
    <span class="mi">1</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="no">N</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
      <span class="c1"># 元データ配列から１つヒープ要素として追加</span>
      <span class="vi">@heap</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="vi">@base</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
      <span class="n">s</span> <span class="o">=</span> <span class="n">n</span>        <span class="c1"># 追加要素の位置</span>
      <span class="nb">p</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">2</span>    <span class="c1"># 親要素の位置</span>
      <span class="k">while</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="vi">@heap</span><span class="p">[</span><span class="nb">p</span><span class="p">]</span> <span class="o">&gt;</span> <span class="vi">@heap</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">w</span>        <span class="o">=</span> <span class="vi">@heap</span><span class="p">[</span><span class="nb">p</span><span class="p">]</span>
        <span class="vi">@heap</span><span class="p">[</span><span class="nb">p</span><span class="p">]</span> <span class="o">=</span> <span class="vi">@heap</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="vi">@heap</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">p</span>      <span class="c1"># 追加要素の位置</span>
        <span class="nb">p</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># 親要素の位置</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="c1"># 結果出力</span>
    <span class="nb">display</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="c1"># 結果出力</span>
  <span class="c1">#   param: 0 - Base 配列</span>
  <span class="c1">#          1 - Heap 配列</span>
  <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"#### </span><span class="si">#{</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="s2">"Base"</span> <span class="p">:</span> <span class="s2">"Heap"</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">k</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="no">N</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="nb">printf</span><span class="p">(</span><span class="s2">"%5d "</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="vi">@base</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="vi">@heap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="nb">puts</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">i</span> <span class="o">==</span> <span class="no">N</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">if</span> <span class="kp">__FILE__</span> <span class="o">==</span> <span class="vg">$0</span>
  <span class="k">begin</span>
    <span class="no">Heap</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">generate</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="s2">"[</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">e</span><span class="p">.</span><span class="nf">backtrace</span><span class="p">.</span><span class="nf">each</span><span class="p">{</span><span class="o">|</span><span class="n">trace</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"</span><span class="se">\t</span><span class="si">#{</span><span class="n">trace</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
    <span class="nb">exit</span> <span class="mi">1</span>
    <span class="vg">$stderr</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"[</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">e</span><span class="p">.</span><span class="nf">backtrace</span><span class="p">.</span><span class="nf">each</span><span class="p">{</span> <span class="o">|</span><span class="n">tr</span><span class="o">|</span> <span class="vg">$stderr</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"</span><span class="se">\t</span><span class="si">#{</span><span class="n">tr</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li><a href="https://gist.github.com/komasaru/9775475" title="Gist - Ruby script to generate a heap by the upward method.">Gist - Ruby script to generate a heap by the upward method.</a></li>
</ul>

<h3 id="3-ruby-スクリプト作成下方移動">3. Ruby スクリプト作成（下方移動）</h3>

<p>以下のようにスクリプトを作成してみた。（要素はメルセンヌ・ツイスタに基づく疑似乱数で生成）</p>

<p>File: <code class="language-plaintext highlighter-rouge">heap_downward.rb</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="code"><pre><span class="c1">#! /usr/local/bin/ruby</span>
<span class="c1"># **************************************</span>
<span class="c1"># ヒープ作成（下方移動）</span>
<span class="c1"># **************************************</span>
<span class="c1">#</span>
<span class="c1"># ヒープクラス</span>
<span class="k">class</span> <span class="nc">Heap</span>
  <span class="no">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># データ個数</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="c1"># ヒープの元になる木を生成</span>
    <span class="vi">@heap</span> <span class="o">=</span> <span class="p">[</span><span class="kp">nil</span><span class="p">]</span>
    <span class="no">N</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="vi">@heap</span> <span class="o">&lt;&lt;</span> <span class="no">Random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="no">N</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="c1"># 乱数の種を毎回同じ値で初期化するなら以下２行のように。</span>
    <span class="c1">#prng = Random.new(1234)</span>
    <span class="c1">#N.times { |i| @heap &lt;&lt; prng.rand(N) + 1 }</span>
    <span class="nb">display</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># ヒープ生成</span>
  <span class="k">def</span> <span class="nf">generate</span>
    <span class="n">n</span> <span class="o">=</span> <span class="no">N</span>           <span class="c1"># データ個数</span>
    <span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">).</span><span class="nf">downto</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="nb">p</span> <span class="o">=</span> <span class="n">i</span>         <span class="c1"># 親要素の位置</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">p</span>     <span class="c1"># 左の子要素の位置</span>
      <span class="k">while</span> <span class="n">s</span> <span class="o">&lt;=</span> <span class="n">n</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="vi">@heap</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="vi">@heap</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>  <span class="c1"># 左右子要素の小さい方</span>
        <span class="k">break</span> <span class="k">if</span> <span class="vi">@heap</span><span class="p">[</span><span class="nb">p</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="vi">@heap</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">swap</span><span class="p">(</span><span class="nb">p</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>  <span class="c1"># 交換</span>
        <span class="nb">p</span> <span class="o">=</span> <span class="n">s</span>       <span class="c1"># 親要素の位置</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">p</span>   <span class="c1"># 左の子要素の位置</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="c1"># 結果出力</span>
    <span class="nb">display</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="c1"># 交換</span>
  <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">w</span>        <span class="o">=</span> <span class="vi">@heap</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
    <span class="vi">@heap</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="vi">@heap</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
    <span class="vi">@heap</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
  <span class="k">end</span>

  <span class="c1"># 結果出力</span>
  <span class="c1">#   param: 0 - Tree 配列</span>
  <span class="c1">#          1 - Heap 配列</span>
  <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"#### </span><span class="si">#{</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="s2">"Tree"</span> <span class="p">:</span> <span class="s2">"Heap"</span><span class="si">}</span><span class="s2">"</span>
    <span class="mi">1</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="no">N</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="nb">printf</span><span class="p">(</span><span class="s2">"%5d "</span><span class="p">,</span> <span class="vi">@heap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="nb">puts</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">i</span> <span class="o">==</span> <span class="no">N</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="k">raise</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">exit</span> <span class="mi">0</span> <span class="k">unless</span> <span class="kp">__FILE__</span> <span class="o">==</span> <span class="vg">$0</span>

<span class="k">begin</span>
  <span class="no">Heap</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">generate</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"[</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">backtrace</span><span class="p">.</span><span class="nf">each</span><span class="p">{</span><span class="o">|</span><span class="n">trace</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"</span><span class="se">\t</span><span class="si">#{</span><span class="n">trace</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
  <span class="nb">exit</span> <span class="mi">1</span>
  <span class="vg">$stderr</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"[</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">backtrace</span><span class="p">.</span><span class="nf">each</span><span class="p">{</span> <span class="o">|</span><span class="n">tr</span><span class="o">|</span> <span class="vg">$stderr</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"</span><span class="se">\t</span><span class="si">#{</span><span class="n">tr</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li><a href="https://gist.github.com/komasaru/9775492" title="Gist - Ruby script to generate a heap by the downward method.">Gist - Ruby script to generate a heap by the downward method.</a></li>
</ul>

<h3 id="4-実行">4. 実行</h3>

<p>まず、実行権限を付与。</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ chmod +x heap_upward.rb
$ chmod +x heap_downward.rb
</code></pre></div></div>

<p>そして、実行。</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./heap_upward.rb

#### Base

   71    84    97    53    41     4    86    55    68     8
    7    10    52    64    44    89    13    73    73     8
    4    16    94    17    87    12    40     6    37    83
   32    39    17    25    72    29    31    21    51    10
    9     7     8    64    77     5    54    92    79    42
   40    40    61    72    64    42    68    35     6    21
   96    71    71    69    14    97    43    91    12    73
   91    81    46    53    97    93    23    16    79    44
   14    13    69    86     6    15    52    43    94    64
   43    76    33    20    63    71    24     8    90    82

#### Heap

    4     4     6    12     5     8     6    13    16     6
    7    12    17    10    21    17    14    31    21     9
    7    43    16    24    41    40    40    42    35    32
   64    39    43    25    72    46    53    29    23    14
   10     8     8    53    43    33    20    71    40    82
   42    52    61    72    64    86    68    44    37    83
   96    71    71    89    69    97    55    91    84    73
   91    81    73    68    97    93    73    51    79    71
   44    13    69    86     8    15    52    64    94    77
   64    94    76    54    63    97    79    92    90    87 

$ ./heap_downward.rb

#### Tree

   29    39    30    97    77    21    74    24    85    83
  100    93    49    65    80    22    64    66    42    35
   99    79    43    85    41    38    74    76    43    90
    3    60    16    28     6    24    91    59    99    91
   27    22    62    19     4     9    85    72    53     1
   96    93    85    69    86    74    69    75    12    39
   55    26    68     8    93    47    50     1    29     1
   75    73    55    49    10    33    36    32    24    63
   91    29    37    50    58    23    28    10    91     1
   32    64    25    40    96    96    34     9    87    99

#### Heap

    1     1     1     6     1     9     3     8    10    22
    4    21    38    12    26    16    24    24    24    27
   23    10     9    30    41    49    69    69    43    39
   68    22    29    28    39    55    49    33    32    63
   29    50    28    19    32    25    40    34    53    93
   96    93    85    74    86    74    76    75    65    90
   55    80    74    60    93    47    50    64    29    97
   75    73    85    66    91    59    36    42    99    91
   91    35    37    99    58    62    83    77    91    79
  100    64    43    85    96    96    72    85    87    99
</code></pre></div></div>

<p>実際に配列を置き換えてみると、ヒープになっていることが確認できる。</p>

<p>また、上方移動と下方移動とでは同じ要素を使ってヒープを生成しても並び順は異なる。<br />
これは、「乱数の種を同じ値で初期化」して実行してみると分かる。</p>

<hr />

<p>ヒープについて知っておくと、ヒープを使ったソート処理（ヒープ・ソート）を行う際には役立つでしょう。</p>

<p>以上。</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/ruby" class="page__taxonomy-item" rel="tag">Ruby</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0" class="page__taxonomy-item" rel="tag">プログラミング</a><span class="sep">, </span>
    
      
      
      <a href="/categories/%E6%95%B0%E5%AD%A6" class="page__taxonomy-item" rel="tag">数学</a>
    
    </span>
  </p>


        
          
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-04-07T00:20:00+09:00">2014-04-07 00:20</time></p>
        
        <br />
      </footer>
      <div id="google-ad-3"></div>
      <br />
      <br />
      <br />
      <br />

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=rsm_mzk&text=Ruby+-+%E3%83%92%E3%83%BC%E3%83%97%E7%94%9F%E6%88%90%EF%BC%88%E4%B8%8A%E6%96%B9%E3%83%BB%E4%B8%8B%E6%96%B9%E7%A7%BB%E5%8B%95%EF%BC%89%EF%BC%81%20https%3A%2F%2Fkomasaru.github.io%2F2014%2F04%2F07%2Fruby-generation-heap%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkomasaru.github.io%2F2014%2F04%2F07%2Fruby-generation-heap%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  

  <a href="https://www.tumblr.com/share" class="btn btn--tumblr" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Tumblr"><i class="fab fa-fw fa-tumblr" aria-hidden="true"></i><span> Tumblr</span></a><script id="tumblr-js" async src="https://assets.tumblr.com/share-button.js"></script>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fkomasaru.github.io%2F2014%2F04%2F07%2Fruby-generation-heap%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      <section>
        &nbsp;
        <h4>Sponsored Link</h4>
        <div id="rakuten-ad"></div>
        <div id="amazon-ad-1"></div>
      </section>
      &nbsp;
      
  <nav class="pagination">
    
      <a href="/2014/04/06/cpp-generation-heap-downward/" class="pagination--pager" title="C++ - ヒープ生成（下方移動）！
">Previous</a>
    
    
      <a href="/2014/04/08/linux-difference-of-service-start/" class="pagination--pager" title="Linux - サービスの init.d 起動と service 起動の違い！
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <div id="google-ad-4"></div>
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2023/11/15/debian-12-postfix-anti-virus-with-clamav/" rel="permalink">Debian 12 (bookworm) - Postfix ウィルス・スパム対策(ClamAV)！
</a>
        &nbsp;<small>(2023-11-15)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 12 (bookworm) にアンチウイルスソフト ClamAV をインストールする方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてください...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2023/11/08/debian-12-mail-ssl-setting/" rel="permalink">Debian 12 (bookworm) - メールサーバ SSL 設定！
</a>
        &nbsp;<small>(2023-11-08)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 12 (bookworm) に導入したメールサーバを SSL 設定する方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてください）

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2023/11/01/blog-access/" rel="permalink">2023年10月 - OS・ブラウザ別アクセス状況！
</a>
        &nbsp;<small>(2023-11-01)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">11月になりましたので、先月10月分の当ブログアクセス状況を公開します。（※自分用の記録）

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h3 class="archive__item-title" itemprop="headline">
      
        <a href="/2023/10/25/debian-12-dovecot-installation/" rel="permalink">Debian 12 (bookworm) - POP/IMAP サーバ Dovecot 構築！
</a>
        &nbsp;<small>(2023-10-25)</small>
    </h3>
    
    <p class="archive__item-excerpt" itemprop="description">Debian GNU/Linux 12 (bookworm) に POP/IMAP サーバ Dovecot を構築する方法についての記録です。

以前古いバージョンでの作業時に残していた記録を参考に作業を行い、今回更新した作業記録を貼付する形式の内容となっています。
（当然ながら、興味がなければスルーしてください）

</p>
  </article>
</div>

        
      </div>
      <!-- &nbsp;
      <div id="amazon-wd"></div -->
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <input type="text" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    </form>
    <div id="results" class="results">
        <gcse:searchresults-only></gcse:searchresults-only>    
    </div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<div id="qr"><img src="/assets/images/qr.png" alt="mk-mode BLOG"></div>
<div id="google-ad-5"></div>
<div class="page__footer-etc">
  <strong>ブログ開設日</strong> <tt>2009-01-05</tt><br />
  <strong>サーバ連続稼働時間</strong> <tt id="uptime">Loading...</tt><br />
  <strong>Page View</strong><br />
  &emsp;合計 <tt id="pv-total">Loading...</tt><br />
  &emsp;今日 <tt id="pv-today">Loading...</tt><br />
  &emsp;昨日 <tt id="pv-yesterday">Loading...</tt><br />
  <small>※<a href="/privacy.html" title="「プライバシーポリシー」ページへ">プライバシーポリシー</a></small>
</div>
<p id="page-top">
  <a href="#">
    <i class="fa fa-angle-double-up fa-2x" aria-hidden="true"></i>
  </a>
</p>
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/rsm_mzk" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/komasaru" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    <li><a href="https://www.mk-mode.com/blog/atom.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 mk-mode.com. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script defer src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>
  <script defer src="/assets/js/my_custom.js"></script>


<script>
  (function () {
    var cx = 'partner-pub-7320193476057758:6328726109';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
</script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18154748-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





    
  <script>
    var disqus_config = function () {
      this.page.url = "https://komasaru.github.io/2014/04/07/ruby-generation-heap/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2014/04/07/ruby-generation-heap"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://mkmodeblog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>
